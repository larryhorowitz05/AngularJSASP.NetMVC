var common;(function(common){var objects;(function(objects){function copyObject(object){var objectCopy={};for(var key in object){if(object.hasOwnProperty(key)){if(typeof object[key]=="object"){objectCopy[key]=object[key].deepClone();}else{objectCopy[key]=object[key];}}}return objectCopy;}objects.copyObject=copyObject;function automap(target,source){for(var key in source){if(source.hasOwnProperty(key)){target[key]=source[key];}}}objects.automap=automap;function setDefault(a,b){for(var key in b){if(b[key]===null){a[key]=null;}else{if(typeof b[key]==="string"){a[key]="";}else{if(typeof b[key]==="boolean"){a[key]=false;}else{if(typeof b[key]==="number"){a[key]=0;}else{if(Array.isArray(b[key])){a[key]=[];}else{if(typeof b[key]==="object"){setDefault(a[key]={},b[key]);}}}}}}}}objects.setDefault=setDefault;function isSame(a,b,leaveOutKeys){for(var key in a){if(a.hasOwnProperty(key)&&b.hasOwnProperty(key)&&leaveOutKeys&&(leaveOutKeys.indexOf(key)==-1)){if(typeof a[key]=="object"){var result=isSame(a[key],b[key],leaveOutKeys);if(!result){return false;}}if(a[key]!=b[key]){return false;}}}return true;}objects.isSame=isSame;function isNullOrUndefined(a){return a==null||a==undefined;}objects.isNullOrUndefined=isNullOrUndefined;function boolToString(obj){return !common.objects.isNullOrUndefined(obj)?String(obj):"";}objects.boolToString=boolToString;})(objects=common.objects||(common.objects={}));})(common||(common={}));var common;(function(common){var string;(function(string){function isNullOrWhiteSpace(value){try{return(value==null||value.trim().length===0);}catch(ex){return true;}}string.isNullOrWhiteSpace=isNullOrWhiteSpace;function isEmptyGuid(value){return value==="00000000-0000-0000-0000-000000000000";}string.isEmptyGuid=isEmptyGuid;function isEmptyGuidOrNull(value){return isNullOrWhiteSpace(value)||isEmptyGuid(value);}string.isEmptyGuidOrNull=isEmptyGuidOrNull;function buildCommaSeparatedString(stringCollection){var retVal="";if(stringCollection!=null&&stringCollection.length>0){for(var i=0;i<stringCollection.length;i++){retVal+=stringCollection[i];retVal+=", ";}retVal=retVal.trim();if(retVal.length>0&&retVal.substring(retVal.length-1)==","){retVal=retVal.substring(0,retVal.length-1);}}return retVal;}string.buildCommaSeparatedString=buildCommaSeparatedString;function toBool(value){if(!!value){if(value.toLowerCase()=="false"||value=="0"){return false;}else{if(value.toLowerCase()=="true"||value=="1"){return true;}else{throw new Error("Invalid cast");}}}return null;}string.toBool=toBool;})(string=common.string||(common.string={}));})(common||(common={}));var common;(function(common){var date;(function(date){function isValidDate(value,validateNineteenHundred){if(validateNineteenHundred===void 0){validateNineteenHundred=false;}try{var retVal=value!=null&&value.trim().length!=0&&value.trim().length>=10&&value.substring(0,4)!="0001";if(retVal&&validateNineteenHundred){var a=new Date(value);var b=new Date("01/01/1900");retVal=a>b;}return retVal;}catch(ex){return false;}}date.isValidDate=isValidDate;})(date=common.date||(common.date={}));})(common||(common={}));angular.module("http.ui.status",["blockUI","simpleModalWindow"]).config(["blockUIConfig",function(blockUIConfig){blockUIConfig.autoBlock=false;}]);var common;(function(common){var HttpUIStatusService=(function(){function HttpUIStatusService(blockUI,simpleModalWindowFactory,commonModalWindowFactory,modalWindowType){var _this=this;this.blockUI=blockUI;this.simpleModalWindowFactory=simpleModalWindowFactory;this.commonModalWindowFactory=commonModalWindowFactory;this.modalWindowType=modalWindowType;this.save=function(message,saveMethod,happyPathHandler,unhappyPathHandler,displayStatus){if(displayStatus===void 0){displayStatus=true;}return _this.call(message,"ERROR_SAVE_MODAL",saveMethod,happyPathHandler,unhappyPathHandler,displayStatus);};this.load=function(message,loadMethod,happyPathHandler,unhappyPathHandler,displayStatus){if(displayStatus===void 0){displayStatus=true;}return _this.call(message,"ERROR_LOAD_MODAL",loadMethod,happyPathHandler,unhappyPathHandler,displayStatus);};this.call=function(message,mode,method,happyPathHandler,unhappyPathHandler,displayStatus){if(displayStatus){_this.commonModalWindowFactory.open({type:_this.modalWindowType.loader,message:message});}return method(function(returnData){if(displayStatus){_this.commonModalWindowFactory.close();}if(happyPathHandler){return happyPathHandler(returnData);}else{return returnData;}},function(error){if(displayStatus){_this.commonModalWindowFactory.close();}if(unhappyPathHandler){unhappyPathHandler(error);}_this.simpleModalWindowFactory.trigger(mode);});};}HttpUIStatusService.className="HttpUIStatusService";HttpUIStatusService.$inject=["blockUI","simpleModalWindowFactory","commonModalWindowFactory","modalWindowType"];return HttpUIStatusService;})();common.HttpUIStatusService=HttpUIStatusService;angular.module("http.ui.status").service(HttpUIStatusService.className,HttpUIStatusService);})(common||(common={}));var __extends=this.__extends||function(d,b){for(var p in b){if(b.hasOwnProperty(p)){d[p]=b[p];}}function __(){this.constructor=d;}__.prototype=b.prototype;d.prototype=new __();};var srv;(function(srv){var cls;(function(cls){var BaseViewModel=(function(){function BaseViewModel(){}return BaseViewModel;})();cls.BaseViewModel=BaseViewModel;var GlobalContactsViewModelReSTOpEnvelopeBase=(function(){function GlobalContactsViewModelReSTOpEnvelopeBase(){}return GlobalContactsViewModelReSTOpEnvelopeBase;})();cls.GlobalContactsViewModelReSTOpEnvelopeBase=GlobalContactsViewModelReSTOpEnvelopeBase;var LedgerEntryBase=(function(){function LedgerEntryBase(){}return LedgerEntryBase;})();cls.LedgerEntryBase=LedgerEntryBase;var LiabilityInfoViewModel=(function(){function LiabilityInfoViewModel(){}return LiabilityInfoViewModel;})();cls.LiabilityInfoViewModel=LiabilityInfoViewModel;var LoanMember=(function(){function LoanMember(){}return LoanMember;})();cls.LoanMember=LoanMember;var LookupItem=(function(){function LookupItem(){}return LookupItem;})();cls.LookupItem=LookupItem;var TransactionSummaryViewModelReSTOpEnvelopeBase=(function(){function TransactionSummaryViewModelReSTOpEnvelopeBase(){}return TransactionSummaryViewModelReSTOpEnvelopeBase;})();cls.TransactionSummaryViewModelReSTOpEnvelopeBase=TransactionSummaryViewModelReSTOpEnvelopeBase;var BorrowerViewModel=(function(_super){__extends(BorrowerViewModel,_super);function BorrowerViewModel(){_super.call(this);}return BorrowerViewModel;})(LoanMember);cls.BorrowerViewModel=BorrowerViewModel;var CostBase=(function(_super){__extends(CostBase,_super);function CostBase(){_super.call(this);}return CostBase;})(LedgerEntryBase);cls.CostBase=CostBase;})(cls=srv.cls||(srv.cls={}));})(srv||(srv={}));var __extends=this.__extends||function(d,b){for(var p in b){if(b.hasOwnProperty(p)){d[p]=b[p];}}function __(){this.constructor=d;}__.prototype=b.prototype;d.prototype=new __();};var srv;(function(srv){var cls;(function(cls){var AddressViewModel_OBSOLETE=(function(){function AddressViewModel_OBSOLETE(){}return AddressViewModel_OBSOLETE;})();cls.AddressViewModel_OBSOLETE=AddressViewModel_OBSOLETE;var AdjustmentsViewModel=(function(){function AdjustmentsViewModel(){}return AdjustmentsViewModel;})();cls.AdjustmentsViewModel=AdjustmentsViewModel;var AdjustmentTypeDescViewModel=(function(_super){__extends(AdjustmentTypeDescViewModel,_super);function AdjustmentTypeDescViewModel(){_super.call(this);}return AdjustmentTypeDescViewModel;})(cls.LookupItem);cls.AdjustmentTypeDescViewModel=AdjustmentTypeDescViewModel;var AdjustmentTypesViewModel=(function(_super){__extends(AdjustmentTypesViewModel,_super);function AdjustmentTypesViewModel(){_super.call(this);}return AdjustmentTypesViewModel;})(cls.LookupItem);cls.AdjustmentTypesViewModel=AdjustmentTypesViewModel;var AdverseReasonViewModel=(function(){function AdverseReasonViewModel(){}return AdverseReasonViewModel;})();cls.AdverseReasonViewModel=AdverseReasonViewModel;var AgentContactViewModel=(function(){function AgentContactViewModel(){}return AgentContactViewModel;})();cls.AgentContactViewModel=AgentContactViewModel;var AntiSteeringOptionsViewModel=(function(){function AntiSteeringOptionsViewModel(){}return AntiSteeringOptionsViewModel;})();cls.AntiSteeringOptionsViewModel=AntiSteeringOptionsViewModel;var AppraisalContactViewModel=(function(){function AppraisalContactViewModel(){}return AppraisalContactViewModel;})();cls.AppraisalContactViewModel=AppraisalContactViewModel;var AppraisalProductViewModel=(function(){function AppraisalProductViewModel(){}return AppraisalProductViewModel;})();cls.AppraisalProductViewModel=AppraisalProductViewModel;var AppraisalViewModel=(function(){function AppraisalViewModel(){}return AppraisalViewModel;})();cls.AppraisalViewModel=AppraisalViewModel;var AppraisedValueHistoryItemViewModel=(function(){function AppraisedValueHistoryItemViewModel(){}return AppraisedValueHistoryItemViewModel;})();cls.AppraisedValueHistoryItemViewModel=AppraisedValueHistoryItemViewModel;var AssetViewModel=(function(){function AssetViewModel(){}return AssetViewModel;})();cls.AssetViewModel=AssetViewModel;var AusViewModel=(function(){function AusViewModel(){}return AusViewModel;})();cls.AusViewModel=AusViewModel;var BasicCost=(function(_super){__extends(BasicCost,_super);function BasicCost(){_super.call(this);}return BasicCost;})(cls.CostBase);cls.BasicCost=BasicCost;var BorrowerNamesViewModel=(function(){function BorrowerNamesViewModel(){}return BorrowerNamesViewModel;})();cls.BorrowerNamesViewModel=BorrowerNamesViewModel;var BorrowerWithAdditionalInfoViewModel=(function(_super){__extends(BorrowerWithAdditionalInfoViewModel,_super);function BorrowerWithAdditionalInfoViewModel(){_super.call(this);}return BorrowerWithAdditionalInfoViewModel;})(cls.BorrowerViewModel);cls.BorrowerWithAdditionalInfoViewModel=BorrowerWithAdditionalInfoViewModel;var BranchAbridgedViewModel=(function(){function BranchAbridgedViewModel(){}return BranchAbridgedViewModel;})();cls.BranchAbridgedViewModel=BranchAbridgedViewModel;var BranchesAbridgedViewModel=(function(){function BranchesAbridgedViewModel(){}return BranchesAbridgedViewModel;})();cls.BranchesAbridgedViewModel=BranchesAbridgedViewModel;var BranchViewModel=(function(){function BranchViewModel(){}return BranchViewModel;})();cls.BranchViewModel=BranchViewModel;var CalculatedCashToCloseViewModel=(function(){function CalculatedCashToCloseViewModel(){}return CalculatedCashToCloseViewModel;})();cls.CalculatedCashToCloseViewModel=CalculatedCashToCloseViewModel;var CalculatorCostViewModel=(function(){function CalculatorCostViewModel(){}return CalculatorCostViewModel;})();cls.CalculatorCostViewModel=CalculatorCostViewModel;var CalculatorRequest=(function(){function CalculatorRequest(){}return CalculatorRequest;})();cls.CalculatorRequest=CalculatorRequest;var CalculatorResponse=(function(){function CalculatorResponse(){}return CalculatorResponse;})();cls.CalculatorResponse=CalculatorResponse;var CashoutRuleResultCalculatedViewModel=(function(){function CashoutRuleResultCalculatedViewModel(){}return CashoutRuleResultCalculatedViewModel;})();cls.CashoutRuleResultCalculatedViewModel=CashoutRuleResultCalculatedViewModel;var ChannelViewModel=(function(){function ChannelViewModel(){}return ChannelViewModel;})();cls.ChannelViewModel=ChannelViewModel;var ClosingCostViewModel=(function(_super){__extends(ClosingCostViewModel,_super);function ClosingCostViewModel(){_super.call(this);}return ClosingCostViewModel;})(cls.BaseViewModel);cls.ClosingCostViewModel=ClosingCostViewModel;var CollectionsViewModel=(function(){function CollectionsViewModel(){}return CollectionsViewModel;})();cls.CollectionsViewModel=CollectionsViewModel;var CombinedDTIandHousingRatioCalculatedViewModel=(function(){function CombinedDTIandHousingRatioCalculatedViewModel(){}return CombinedDTIandHousingRatioCalculatedViewModel;})();cls.CombinedDTIandHousingRatioCalculatedViewModel=CombinedDTIandHousingRatioCalculatedViewModel;var CompanyDataViewModel=(function(){function CompanyDataViewModel(){}return CompanyDataViewModel;})();cls.CompanyDataViewModel=CompanyDataViewModel;var CompanyEmployeeUserAccountViewModel=(function(_super){__extends(CompanyEmployeeUserAccountViewModel,_super);function CompanyEmployeeUserAccountViewModel(){_super.call(this);}return CompanyEmployeeUserAccountViewModel;})(cls.BaseViewModel);cls.CompanyEmployeeUserAccountViewModel=CompanyEmployeeUserAccountViewModel;var CompanyProfileViewModel=(function(){function CompanyProfileViewModel(){}return CompanyProfileViewModel;})();cls.CompanyProfileViewModel=CompanyProfileViewModel;var ComparisonViewModel=(function(){function ComparisonViewModel(){}return ComparisonViewModel;})();cls.ComparisonViewModel=ComparisonViewModel;var ComplianceCheckErrorViewModel=(function(){function ComplianceCheckErrorViewModel(){}return ComplianceCheckErrorViewModel;})();cls.ComplianceCheckErrorViewModel=ComplianceCheckErrorViewModel;var ComplianceEaseRequestViewModel=(function(){function ComplianceEaseRequestViewModel(){}return ComplianceEaseRequestViewModel;})();cls.ComplianceEaseRequestViewModel=ComplianceEaseRequestViewModel;var ComplianceResultDetailViewModel=(function(){function ComplianceResultDetailViewModel(){}return ComplianceResultDetailViewModel;})();cls.ComplianceResultDetailViewModel=ComplianceResultDetailViewModel;var ComplianceResultViewModel=(function(){function ComplianceResultViewModel(){}return ComplianceResultViewModel;})();cls.ComplianceResultViewModel=ComplianceResultViewModel;var ConditionConfigurationViewModel=(function(_super){__extends(ConditionConfigurationViewModel,_super);function ConditionConfigurationViewModel(){_super.call(this);}return ConditionConfigurationViewModel;})(cls.BaseViewModel);cls.ConditionConfigurationViewModel=ConditionConfigurationViewModel;var ConditionItemViewModel=(function(){function ConditionItemViewModel(){}return ConditionItemViewModel;})();cls.ConditionItemViewModel=ConditionItemViewModel;var ConditionPrivileges=(function(){function ConditionPrivileges(){}return ConditionPrivileges;})();cls.ConditionPrivileges=ConditionPrivileges;var ConditionsDocumentViewModel=(function(){function ConditionsDocumentViewModel(){}return ConditionsDocumentViewModel;})();cls.ConditionsDocumentViewModel=ConditionsDocumentViewModel;var ConditionsMainViewModel=(function(_super){__extends(ConditionsMainViewModel,_super);function ConditionsMainViewModel(){_super.call(this);}return ConditionsMainViewModel;})(cls.BaseViewModel);cls.ConditionsMainViewModel=ConditionsMainViewModel;var ConditionsSubViewModel=(function(){function ConditionsSubViewModel(){}return ConditionsSubViewModel;})();cls.ConditionsSubViewModel=ConditionsSubViewModel;var ConditionViewModel=(function(){function ConditionViewModel(){}return ConditionViewModel;})();cls.ConditionViewModel=ConditionViewModel;var ConfigurationViewModel=(function(){function ConfigurationViewModel(){}return ConfigurationViewModel;})();cls.ConfigurationViewModel=ConfigurationViewModel;var CopyLoanViewModel=(function(){function CopyLoanViewModel(){}return CopyLoanViewModel;})();cls.CopyLoanViewModel=CopyLoanViewModel;var CostCalcCalculatedViewModel=(function(){function CostCalcCalculatedViewModel(){}return CostCalcCalculatedViewModel;})();cls.CostCalcCalculatedViewModel=CostCalcCalculatedViewModel;var CostPaidViewModel=(function(){function CostPaidViewModel(){}return CostPaidViewModel;})();cls.CostPaidViewModel=CostPaidViewModel;var CostViewModel=(function(){function CostViewModel(){}return CostViewModel;})();cls.CostViewModel=CostViewModel;var CreditTabViewModel=(function(_super){__extends(CreditTabViewModel,_super);function CreditTabViewModel(){_super.call(this);}return CreditTabViewModel;})(cls.BaseViewModel);cls.CreditTabViewModel=CreditTabViewModel;var CreditViewModel=(function(){function CreditViewModel(){}return CreditViewModel;})();cls.CreditViewModel=CreditViewModel;var CriteriaDictionaryViewModel=(function(){function CriteriaDictionaryViewModel(){}return CriteriaDictionaryViewModel;})();cls.CriteriaDictionaryViewModel=CriteriaDictionaryViewModel;var CurativeItemConfigurationViewModel=(function(){function CurativeItemConfigurationViewModel(){}return CurativeItemConfigurationViewModel;})();cls.CurativeItemConfigurationViewModel=CurativeItemConfigurationViewModel;var CurativeItemNoteViewModel=(function(){function CurativeItemNoteViewModel(){}return CurativeItemNoteViewModel;})();cls.CurativeItemNoteViewModel=CurativeItemNoteViewModel;var DebtViewModel=(function(_super){__extends(DebtViewModel,_super);function DebtViewModel(){_super.call(this);}return DebtViewModel;})(cls.LiabilityInfoViewModel);cls.DebtViewModel=DebtViewModel;var DeclarationInfoViewModel=(function(){function DeclarationInfoViewModel(){}return DeclarationInfoViewModel;})();cls.DeclarationInfoViewModel=DeclarationInfoViewModel;var DeclarationViewModel=(function(){function DeclarationViewModel(){}return DeclarationViewModel;})();cls.DeclarationViewModel=DeclarationViewModel;var DetailedClosingCost=(function(){function DetailedClosingCost(){}return DetailedClosingCost;})();cls.DetailedClosingCost=DetailedClosingCost;var DetailsOfTransactionCalculatedViewModel=(function(){function DetailsOfTransactionCalculatedViewModel(){}return DetailsOfTransactionCalculatedViewModel;})();cls.DetailsOfTransactionCalculatedViewModel=DetailsOfTransactionCalculatedViewModel;var DetailsOfTransactionViewModel=(function(){function DetailsOfTransactionViewModel(){}return DetailsOfTransactionViewModel;})();cls.DetailsOfTransactionViewModel=DetailsOfTransactionViewModel;var DisclosuresDetailsViewModel=(function(){function DisclosuresDetailsViewModel(){}return DisclosuresDetailsViewModel;})();cls.DisclosuresDetailsViewModel=DisclosuresDetailsViewModel;var DisclosureStatusDetailsViewModel=(function(){function DisclosureStatusDetailsViewModel(){}return DisclosureStatusDetailsViewModel;})();cls.DisclosureStatusDetailsViewModel=DisclosureStatusDetailsViewModel;var DivisionViewModel=(function(){function DivisionViewModel(){}return DivisionViewModel;})();cls.DivisionViewModel=DivisionViewModel;var DocumentCategoryViewModel=(function(){function DocumentCategoryViewModel(){}return DocumentCategoryViewModel;})();cls.DocumentCategoryViewModel=DocumentCategoryViewModel;var DocumentClassViewModel=(function(){function DocumentClassViewModel(){}return DocumentClassViewModel;})();cls.DocumentClassViewModel=DocumentClassViewModel;var DocumentMappingViewModel=(function(){function DocumentMappingViewModel(){}return DocumentMappingViewModel;})();cls.DocumentMappingViewModel=DocumentMappingViewModel;var DocumentsViewModel=(function(){function DocumentsViewModel(){}return DocumentsViewModel;})();cls.DocumentsViewModel=DocumentsViewModel;var DocVaultDocumentMetadataModel=(function(){function DocVaultDocumentMetadataModel(){}return DocVaultDocumentMetadataModel;})();cls.DocVaultDocumentMetadataModel=DocVaultDocumentMetadataModel;var DocVaultDocumentViewModel=(function(){function DocVaultDocumentViewModel(){}return DocVaultDocumentViewModel;})();cls.DocVaultDocumentViewModel=DocVaultDocumentViewModel;var DocVaultHistoryModel=(function(){function DocVaultHistoryModel(){}return DocVaultHistoryModel;})();cls.DocVaultHistoryModel=DocVaultHistoryModel;var DocVaultViewModel=(function(){function DocVaultViewModel(){}return DocVaultViewModel;})();cls.DocVaultViewModel=DocVaultViewModel;var DoubleEntryCost=(function(){function DoubleEntryCost(){}return DoubleEntryCost;})();cls.DoubleEntryCost=DoubleEntryCost;var EApprovalConfirmationViewModel=(function(){function EApprovalConfirmationViewModel(){}return EApprovalConfirmationViewModel;})();cls.EApprovalConfirmationViewModel=EApprovalConfirmationViewModel;var EConsentViewModel=(function(){function EConsentViewModel(){}return EConsentViewModel;})();cls.EConsentViewModel=EConsentViewModel;var EmploymentInfoViewModel=(function(_super){__extends(EmploymentInfoViewModel,_super);function EmploymentInfoViewModel(){_super.call(this);}return EmploymentInfoViewModel;})(cls.LoanMember);cls.EmploymentInfoViewModel=EmploymentInfoViewModel;var EntryLocator=(function(){function EntryLocator(){}return EntryLocator;})();cls.EntryLocator=EntryLocator;var EnumerationValueViewModel=(function(){function EnumerationValueViewModel(){}return EnumerationValueViewModel;})();cls.EnumerationValueViewModel=EnumerationValueViewModel;var ESignViewModel=(function(){function ESignViewModel(){}return ESignViewModel;})();cls.ESignViewModel=ESignViewModel;var FHACalculatorRequest=(function(){function FHACalculatorRequest(){}return FHACalculatorRequest;})();cls.FHACalculatorRequest=FHACalculatorRequest;var FHACalculatorResponse=(function(){function FHACalculatorResponse(){}return FHACalculatorResponse;})();cls.FHACalculatorResponse=FHACalculatorResponse;var FHAInformationViewModel=(function(){function FHAInformationViewModel(){}return FHAInformationViewModel;})();cls.FHAInformationViewModel=FHAInformationViewModel;var FHAScenarioViewModel=(function(){function FHAScenarioViewModel(){}return FHAScenarioViewModel;})();cls.FHAScenarioViewModel=FHAScenarioViewModel;var FicoScoreViewModel=(function(){function FicoScoreViewModel(){}return FicoScoreViewModel;})();cls.FicoScoreViewModel=FicoScoreViewModel;var Field=(function(){function Field(){}return Field;})();cls.Field=Field;var FilterByLoanNumberResultsViewModel=(function(){function FilterByLoanNumberResultsViewModel(){}return FilterByLoanNumberResultsViewModel;})();cls.FilterByLoanNumberResultsViewModel=FilterByLoanNumberResultsViewModel;var FilterByLoanNumberResultViewModel=(function(){function FilterByLoanNumberResultViewModel(){}return FilterByLoanNumberResultViewModel;})();cls.FilterByLoanNumberResultViewModel=FilterByLoanNumberResultViewModel;var ForConditionMenuModel=(function(){function ForConditionMenuModel(){}return ForConditionMenuModel;})();cls.ForConditionMenuModel=ForConditionMenuModel;var GeneralSettingViewModel=(function(){function GeneralSettingViewModel(){}return GeneralSettingViewModel;})();cls.GeneralSettingViewModel=GeneralSettingViewModel;var GetDropdownDictionary=(function(_super){__extends(GetDropdownDictionary,_super);function GetDropdownDictionary(){_super.call(this);}return GetDropdownDictionary;})(cls.TransactionSummaryViewModelReSTOpEnvelopeBase);cls.GetDropdownDictionary=GetDropdownDictionary;var GlobalContactsAddCompanyContactOpEnvelope=(function(_super){__extends(GlobalContactsAddCompanyContactOpEnvelope,_super);function GlobalContactsAddCompanyContactOpEnvelope(){_super.call(this);}return GlobalContactsAddCompanyContactOpEnvelope;})(cls.GlobalContactsViewModelReSTOpEnvelopeBase);cls.GlobalContactsAddCompanyContactOpEnvelope=GlobalContactsAddCompanyContactOpEnvelope;var GlobalContactsGetContactsSubListOpEnvelope=(function(_super){__extends(GlobalContactsGetContactsSubListOpEnvelope,_super);function GlobalContactsGetContactsSubListOpEnvelope(){_super.call(this);}return GlobalContactsGetContactsSubListOpEnvelope;})(cls.GlobalContactsViewModelReSTOpEnvelopeBase);cls.GlobalContactsGetContactsSubListOpEnvelope=GlobalContactsGetContactsSubListOpEnvelope;var GlobalContactsViewModel=(function(){function GlobalContactsViewModel(){}return GlobalContactsViewModel;})();cls.GlobalContactsViewModel=GlobalContactsViewModel;var HousingExpensesViewModel=(function(){function HousingExpensesViewModel(){}return HousingExpensesViewModel;})();cls.HousingExpensesViewModel=HousingExpensesViewModel;var ImpoundDataCalculatedViewModel=(function(){function ImpoundDataCalculatedViewModel(){}return ImpoundDataCalculatedViewModel;})();cls.ImpoundDataCalculatedViewModel=ImpoundDataCalculatedViewModel;var ImpoundScheduleViewModel=(function(){function ImpoundScheduleViewModel(){}return ImpoundScheduleViewModel;})();cls.ImpoundScheduleViewModel=ImpoundScheduleViewModel;var IncomeInfoHistoryViewModel=(function(){function IncomeInfoHistoryViewModel(){}return IncomeInfoHistoryViewModel;})();cls.IncomeInfoHistoryViewModel=IncomeInfoHistoryViewModel;var IncomeInfoViewModel=(function(_super){__extends(IncomeInfoViewModel,_super);function IncomeInfoViewModel(){_super.call(this);}return IncomeInfoViewModel;})(cls.LoanMember);cls.IncomeInfoViewModel=IncomeInfoViewModel;var IncomeTabViewModel=(function(_super){__extends(IncomeTabViewModel,_super);function IncomeTabViewModel(){_super.call(this);}return IncomeTabViewModel;})(cls.BaseViewModel);cls.IncomeTabViewModel=IncomeTabViewModel;var IneligibleItemViewModel=(function(){function IneligibleItemViewModel(){}return IneligibleItemViewModel;})();cls.IneligibleItemViewModel=IneligibleItemViewModel;var InitEmptyCreditOrDebit=(function(_super){__extends(InitEmptyCreditOrDebit,_super);function InitEmptyCreditOrDebit(){_super.call(this);}return InitEmptyCreditOrDebit;})(cls.TransactionSummaryViewModelReSTOpEnvelopeBase);cls.InitEmptyCreditOrDebit=InitEmptyCreditOrDebit;var IntegrationItemViewModel=(function(){function IntegrationItemViewModel(){}return IntegrationItemViewModel;})();cls.IntegrationItemViewModel=IntegrationItemViewModel;var IntegrationLogFolderViewModel=(function(){function IntegrationLogFolderViewModel(){}return IntegrationLogFolderViewModel;})();cls.IntegrationLogFolderViewModel=IntegrationLogFolderViewModel;var IntegrationLogItemViewModel=(function(){function IntegrationLogItemViewModel(){}return IntegrationLogItemViewModel;})();cls.IntegrationLogItemViewModel=IntegrationLogItemViewModel;var IntegrationsSettingViewModel=(function(){function IntegrationsSettingViewModel(){}return IntegrationsSettingViewModel;})();cls.IntegrationsSettingViewModel=IntegrationsSettingViewModel;var InvestorExtensionViewModel=(function(){function InvestorExtensionViewModel(){}return InvestorExtensionViewModel;})();cls.InvestorExtensionViewModel=InvestorExtensionViewModel;var InvestorViewModel=(function(){function InvestorViewModel(){}return InvestorViewModel;})();cls.InvestorViewModel=InvestorViewModel;var ItemizedPropertyTaxViewModel=(function(){function ItemizedPropertyTaxViewModel(){}return ItemizedPropertyTaxViewModel;})();cls.ItemizedPropertyTaxViewModel=ItemizedPropertyTaxViewModel;var LeadModel=(function(){function LeadModel(){}return LeadModel;})();cls.LeadModel=LeadModel;var LedgerEntryAttribute=(function(){function LedgerEntryAttribute(){}return LedgerEntryAttribute;})();cls.LedgerEntryAttribute=LedgerEntryAttribute;var LedgerEntryInit=(function(){function LedgerEntryInit(){}return LedgerEntryInit;})();cls.LedgerEntryInit=LedgerEntryInit;var LedgerEntryNames=(function(){function LedgerEntryNames(){}return LedgerEntryNames;})();cls.LedgerEntryNames=LedgerEntryNames;var LegalEntityNames=(function(){function LegalEntityNames(){}return LegalEntityNames;})();cls.LegalEntityNames=LegalEntityNames;var LiabilitiesViewModel=(function(){function LiabilitiesViewModel(){}return LiabilitiesViewModel;})();cls.LiabilitiesViewModel=LiabilitiesViewModel;var LiabilityViewModel=(function(_super){__extends(LiabilityViewModel,_super);function LiabilityViewModel(){_super.call(this);}return LiabilityViewModel;})(cls.LoanMember);cls.LiabilityViewModel=LiabilityViewModel;var LicenseViewModel=(function(){function LicenseViewModel(){}return LicenseViewModel;})();cls.LicenseViewModel=LicenseViewModel;var Loan=(function(){function Loan(){}return Loan;})();cls.Loan=Loan;var LoanApplicationViewModel=(function(_super){__extends(LoanApplicationViewModel,_super);function LoanApplicationViewModel(){_super.call(this);}return LoanApplicationViewModel;})(cls.LoanMember);cls.LoanApplicationViewModel=LoanApplicationViewModel;var LoanControlStatus=(function(){function LoanControlStatus(){}return LoanControlStatus;})();cls.LoanControlStatus=LoanControlStatus;var LoanDateHistoryViewModel=(function(){function LoanDateHistoryViewModel(){}return LoanDateHistoryViewModel;})();cls.LoanDateHistoryViewModel=LoanDateHistoryViewModel;var LoanDateViewModel=(function(){function LoanDateViewModel(){}return LoanDateViewModel;})();cls.LoanDateViewModel=LoanDateViewModel;var LoanDecisionStatusHistoryViewModel=(function(){function LoanDecisionStatusHistoryViewModel(){}return LoanDecisionStatusHistoryViewModel;})();cls.LoanDecisionStatusHistoryViewModel=LoanDecisionStatusHistoryViewModel;var LoanEstimatesViewModel=(function(){function LoanEstimatesViewModel(){}return LoanEstimatesViewModel;})();cls.LoanEstimatesViewModel=LoanEstimatesViewModel;var LoanExternalReferenceViewModel=(function(){function LoanExternalReferenceViewModel(){}return LoanExternalReferenceViewModel;})();cls.LoanExternalReferenceViewModel=LoanExternalReferenceViewModel;var LoanFinancialInfoViewModel=(function(){function LoanFinancialInfoViewModel(){}return LoanFinancialInfoViewModel;})();cls.LoanFinancialInfoViewModel=LoanFinancialInfoViewModel;var LoanLienPositionViewModel=(function(){function LoanLienPositionViewModel(){}return LoanLienPositionViewModel;})();cls.LoanLienPositionViewModel=LoanLienPositionViewModel;var LoanLockHistoryDataViewModel=(function(){function LoanLockHistoryDataViewModel(){}return LoanLockHistoryDataViewModel;})();cls.LoanLockHistoryDataViewModel=LoanLockHistoryDataViewModel;var LoanLockHistoryViewModel=(function(){function LoanLockHistoryViewModel(){}return LoanLockHistoryViewModel;})();cls.LoanLockHistoryViewModel=LoanLockHistoryViewModel;var LoanLockViewModel=(function(){function LoanLockViewModel(){}return LoanLockViewModel;})();cls.LoanLockViewModel=LoanLockViewModel;var LoanOfficerAbridgedViewModel=(function(){function LoanOfficerAbridgedViewModel(){}return LoanOfficerAbridgedViewModel;})();cls.LoanOfficerAbridgedViewModel=LoanOfficerAbridgedViewModel;var LoanOfficersAbridgedViewModel=(function(){function LoanOfficersAbridgedViewModel(){}return LoanOfficersAbridgedViewModel;})();cls.LoanOfficersAbridgedViewModel=LoanOfficersAbridgedViewModel;var LoanParticipantsViewModel=(function(){function LoanParticipantsViewModel(){}return LoanParticipantsViewModel;})();cls.LoanParticipantsViewModel=LoanParticipantsViewModel;var LoanViewModel=(function(){function LoanViewModel(){}return LoanViewModel;})();cls.LoanViewModel=LoanViewModel;var LockingConfigurationViewModel=(function(){function LockingConfigurationViewModel(){}return LockingConfigurationViewModel;})();cls.LockingConfigurationViewModel=LockingConfigurationViewModel;var LockingInformationViewModel=(function(){function LockingInformationViewModel(){}return LockingInformationViewModel;})();cls.LockingInformationViewModel=LockingInformationViewModel;var LockingPricingLookupViewModel=(function(){function LockingPricingLookupViewModel(){}return LockingPricingLookupViewModel;})();cls.LockingPricingLookupViewModel=LockingPricingLookupViewModel;var LookupViewModel=(function(){function LookupViewModel(){}return LookupViewModel;})();cls.LookupViewModel=LookupViewModel;var LosFolderViewModel=(function(){function LosFolderViewModel(){}return LosFolderViewModel;})();cls.LosFolderViewModel=LosFolderViewModel;var ManageUserAccountsViewModel=(function(){function ManageUserAccountsViewModel(){}return ManageUserAccountsViewModel;})();cls.ManageUserAccountsViewModel=ManageUserAccountsViewModel;var ManageUserAccountViewModel=(function(){function ManageUserAccountViewModel(){}return ManageUserAccountViewModel;})();cls.ManageUserAccountViewModel=ManageUserAccountViewModel;var MICalculatorRequest=(function(){function MICalculatorRequest(){}return MICalculatorRequest;})();cls.MICalculatorRequest=MICalculatorRequest;var MICalculatorResponse=(function(){function MICalculatorResponse(){}return MICalculatorResponse;})();cls.MICalculatorResponse=MICalculatorResponse;var MiscellaneousDebtViewModel=(function(){function MiscellaneousDebtViewModel(){}return MiscellaneousDebtViewModel;})();cls.MiscellaneousDebtViewModel=MiscellaneousDebtViewModel;var MiscellaneousExpensesViewModel=(function(){function MiscellaneousExpensesViewModel(){}return MiscellaneousExpensesViewModel;})();cls.MiscellaneousExpensesViewModel=MiscellaneousExpensesViewModel;var NegativeCashFlowInfoViewModel=(function(){function NegativeCashFlowInfoViewModel(){}return NegativeCashFlowInfoViewModel;})();cls.NegativeCashFlowInfoViewModel=NegativeCashFlowInfoViewModel;var NtbActivationViewModel=(function(){function NtbActivationViewModel(){}return NtbActivationViewModel;})();cls.NtbActivationViewModel=NtbActivationViewModel;var NtbBenefitActivation=(function(){function NtbBenefitActivation(){}return NtbBenefitActivation;})();cls.NtbBenefitActivation=NtbBenefitActivation;var NtbBenefitActivationRequest=(function(){function NtbBenefitActivationRequest(){}return NtbBenefitActivationRequest;})();cls.NtbBenefitActivationRequest=NtbBenefitActivationRequest;var NtbBenefitActivationResponse=(function(){function NtbBenefitActivationResponse(){}return NtbBenefitActivationResponse;})();cls.NtbBenefitActivationResponse=NtbBenefitActivationResponse;var NtbBenefitConfigurationViewModel=(function(){function NtbBenefitConfigurationViewModel(){}return NtbBenefitConfigurationViewModel;})();cls.NtbBenefitConfigurationViewModel=NtbBenefitConfigurationViewModel;var NtbRequiredRequest=(function(){function NtbRequiredRequest(){}return NtbRequiredRequest;})();cls.NtbRequiredRequest=NtbRequiredRequest;var NtbRequiredResponse=(function(){function NtbRequiredResponse(){}return NtbRequiredResponse;})();cls.NtbRequiredResponse=NtbRequiredResponse;var OtherCreditViewModel=(function(){function OtherCreditViewModel(){}return OtherCreditViewModel;})();cls.OtherCreditViewModel=OtherCreditViewModel;var OtherInterviewDataViewModel=(function(){function OtherInterviewDataViewModel(){}return OtherInterviewDataViewModel;})();cls.OtherInterviewDataViewModel=OtherInterviewDataViewModel;var PaymentBreakdownModalViewModel=(function(){function PaymentBreakdownModalViewModel(){}return PaymentBreakdownModalViewModel;})();cls.PaymentBreakdownModalViewModel=PaymentBreakdownModalViewModel;var PaymentViewModel=(function(){function PaymentViewModel(){}return PaymentViewModel;})();cls.PaymentViewModel=PaymentViewModel;var PayOffItemViewModel=(function(){function PayOffItemViewModel(){}return PayOffItemViewModel;})();cls.PayOffItemViewModel=PayOffItemViewModel;var PayOffSectionViewModel=(function(){function PayOffSectionViewModel(){}return PayOffSectionViewModel;})();cls.PayOffSectionViewModel=PayOffSectionViewModel;var PeriodPaymentMonthViewModel=(function(){function PeriodPaymentMonthViewModel(){}return PeriodPaymentMonthViewModel;})();cls.PeriodPaymentMonthViewModel=PeriodPaymentMonthViewModel;var PhoneViewModel=(function(){function PhoneViewModel(){}return PhoneViewModel;})();cls.PhoneViewModel=PhoneViewModel;var PledgedAssetViewModel=(function(_super){__extends(PledgedAssetViewModel,_super);function PledgedAssetViewModel(){_super.call(this);}return PledgedAssetViewModel;})(cls.LiabilityInfoViewModel);cls.PledgedAssetViewModel=PledgedAssetViewModel;var PreApprovalLettersViewModel=(function(){function PreApprovalLettersViewModel(){}return PreApprovalLettersViewModel;})();cls.PreApprovalLettersViewModel=PreApprovalLettersViewModel;var PreApprovalLetterTemplateViewModel=(function(){function PreApprovalLetterTemplateViewModel(){}return PreApprovalLetterTemplateViewModel;})();cls.PreApprovalLetterTemplateViewModel=PreApprovalLetterTemplateViewModel;var PricingAdjustmentsViewModel=(function(){function PricingAdjustmentsViewModel(){}return PricingAdjustmentsViewModel;})();cls.PricingAdjustmentsViewModel=PricingAdjustmentsViewModel;var PricingResultsViewModel=(function(){function PricingResultsViewModel(){}return PricingResultsViewModel;})();cls.PricingResultsViewModel=PricingResultsViewModel;var PriorAdverseRatingViewModel=(function(){function PriorAdverseRatingViewModel(){}return PriorAdverseRatingViewModel;})();cls.PriorAdverseRatingViewModel=PriorAdverseRatingViewModel;var ProductAdjustmentViewModel=(function(){function ProductAdjustmentViewModel(){}return ProductAdjustmentViewModel;})();cls.ProductAdjustmentViewModel=ProductAdjustmentViewModel;var ProductItemViewModel=(function(){function ProductItemViewModel(){}return ProductItemViewModel;})();cls.ProductItemViewModel=ProductItemViewModel;var ProductListViewModel=(function(){function ProductListViewModel(){}return ProductListViewModel;})();cls.ProductListViewModel=ProductListViewModel;var ProductViewModel=(function(){function ProductViewModel(){}return ProductViewModel;})();cls.ProductViewModel=ProductViewModel;var PropertyExpenseViewModel=(function(){function PropertyExpenseViewModel(){}return PropertyExpenseViewModel;})();cls.PropertyExpenseViewModel=PropertyExpenseViewModel;var PropertyViewModel=(function(_super){__extends(PropertyViewModel,_super);function PropertyViewModel(){_super.call(this);}return PropertyViewModel;})(cls.LoanMember);cls.PropertyViewModel=PropertyViewModel;var PublicRecordsViewModel=(function(){function PublicRecordsViewModel(){}return PublicRecordsViewModel;})();cls.PublicRecordsViewModel=PublicRecordsViewModel;var PublicRecordViewModel=(function(){function PublicRecordViewModel(){}return PublicRecordViewModel;})();cls.PublicRecordViewModel=PublicRecordViewModel;var QMCertificationViewModel=(function(){function QMCertificationViewModel(){}return QMCertificationViewModel;})();cls.QMCertificationViewModel=QMCertificationViewModel;var QueueItemViewModel=(function(){function QueueItemViewModel(){}return QueueItemViewModel;})();cls.QueueItemViewModel=QueueItemViewModel;var RealEstateViewModel=(function(){function RealEstateViewModel(){}return RealEstateViewModel;})();cls.RealEstateViewModel=RealEstateViewModel;var RecoupmentPeriodRequest=(function(){function RecoupmentPeriodRequest(){}return RecoupmentPeriodRequest;})();cls.RecoupmentPeriodRequest=RecoupmentPeriodRequest;var RecoupmentPeriodResponse=(function(){function RecoupmentPeriodResponse(){}return RecoupmentPeriodResponse;})();cls.RecoupmentPeriodResponse=RecoupmentPeriodResponse;var RemoveCreditOrDebit=(function(_super){__extends(RemoveCreditOrDebit,_super);function RemoveCreditOrDebit(){_super.call(this);}return RemoveCreditOrDebit;})(cls.TransactionSummaryViewModelReSTOpEnvelopeBase);cls.RemoveCreditOrDebit=RemoveCreditOrDebit;var REOInfoViewModel=(function(){function REOInfoViewModel(){}return REOInfoViewModel;})();cls.REOInfoViewModel=REOInfoViewModel;var RolePrivilegeViewModel=(function(){function RolePrivilegeViewModel(){}return RolePrivilegeViewModel;})();cls.RolePrivilegeViewModel=RolePrivilegeViewModel;var RoleViewModel=(function(){function RoleViewModel(){}return RoleViewModel;})();cls.RoleViewModel=RoleViewModel;var SearchCriteriaViewModel=(function(){function SearchCriteriaViewModel(){}return SearchCriteriaViewModel;})();cls.SearchCriteriaViewModel=SearchCriteriaViewModel;var SectionContainer=(function(){function SectionContainer(){}return SectionContainer;})();cls.SectionContainer=SectionContainer;var SecureLinkAuthenticationViewModel=(function(){function SecureLinkAuthenticationViewModel(){}return SecureLinkAuthenticationViewModel;})();cls.SecureLinkAuthenticationViewModel=SecureLinkAuthenticationViewModel;var SecureLinkBorrowerViewModel=(function(){function SecureLinkBorrowerViewModel(){}return SecureLinkBorrowerViewModel;})();cls.SecureLinkBorrowerViewModel=SecureLinkBorrowerViewModel;var SecureLinkEmailTemplate=(function(){function SecureLinkEmailTemplate(){}return SecureLinkEmailTemplate;})();cls.SecureLinkEmailTemplate=SecureLinkEmailTemplate;var SecureLinkEmailViewModel=(function(){function SecureLinkEmailViewModel(){}return SecureLinkEmailViewModel;})();cls.SecureLinkEmailViewModel=SecureLinkEmailViewModel;var SecureLinkSigningRoom=(function(){function SecureLinkSigningRoom(){}return SecureLinkSigningRoom;})();cls.SecureLinkSigningRoom=SecureLinkSigningRoom;var SecureLinkSigningRoomCompleted=(function(){function SecureLinkSigningRoomCompleted(){}return SecureLinkSigningRoomCompleted;})();cls.SecureLinkSigningRoomCompleted=SecureLinkSigningRoomCompleted;var SecureLinkSigningRoomSent=(function(){function SecureLinkSigningRoomSent(){}return SecureLinkSigningRoomSent;})();cls.SecureLinkSigningRoomSent=SecureLinkSigningRoomSent;var SecureLinkUrlResponse=(function(){function SecureLinkUrlResponse(){}return SecureLinkUrlResponse;})();cls.SecureLinkUrlResponse=SecureLinkUrlResponse;var SelectCostTypeListItem=(function(_super){__extends(SelectCostTypeListItem,_super);function SelectCostTypeListItem(){_super.call(this);}return SelectCostTypeListItem;})(cls.LookupItem);cls.SelectCostTypeListItem=SelectCostTypeListItem;var SellSideInformationViewModel=(function(){function SellSideInformationViewModel(){}return SellSideInformationViewModel;})();cls.SellSideInformationViewModel=SellSideInformationViewModel;var SentEmailItemViewModel=(function(){function SentEmailItemViewModel(){}return SentEmailItemViewModel;})();cls.SentEmailItemViewModel=SentEmailItemViewModel;var SentPreApprovalLetterHistoryViewModel=(function(){function SentPreApprovalLetterHistoryViewModel(){}return SentPreApprovalLetterHistoryViewModel;})();cls.SentPreApprovalLetterHistoryViewModel=SentPreApprovalLetterHistoryViewModel;var ServiceTrackingViewModel=(function(){function ServiceTrackingViewModel(){}return ServiceTrackingViewModel;})();cls.ServiceTrackingViewModel=ServiceTrackingViewModel;var ServiceValidationViewModel=(function(){function ServiceValidationViewModel(){}return ServiceValidationViewModel;})();cls.ServiceValidationViewModel=ServiceValidationViewModel;var SubordinateFinancingDetailsViewModel=(function(){function SubordinateFinancingDetailsViewModel(){}return SubordinateFinancingDetailsViewModel;})();cls.SubordinateFinancingDetailsViewModel=SubordinateFinancingDetailsViewModel;var SubSectionContainer=(function(){function SubSectionContainer(){}return SubSectionContainer;})();cls.SubSectionContainer=SubSectionContainer;var TitleInformationViewModel=(function(){function TitleInformationViewModel(){}return TitleInformationViewModel;})();cls.TitleInformationViewModel=TitleInformationViewModel;var ToleranceCalculatedViewModel=(function(){function ToleranceCalculatedViewModel(){}return ToleranceCalculatedViewModel;})();cls.ToleranceCalculatedViewModel=ToleranceCalculatedViewModel;var TransactionInfo=(function(){function TransactionInfo(){}return TransactionInfo;})();cls.TransactionInfo=TransactionInfo;var TransactionSummarySubSectionInit=(function(){function TransactionSummarySubSectionInit(){}return TransactionSummarySubSectionInit;})();cls.TransactionSummarySubSectionInit=TransactionSummarySubSectionInit;var TransactionSummaryViewModel=(function(){function TransactionSummaryViewModel(){}return TransactionSummaryViewModel;})();cls.TransactionSummaryViewModel=TransactionSummaryViewModel;var UnlinkDoubleEntry=(function(_super){__extends(UnlinkDoubleEntry,_super);function UnlinkDoubleEntry(){_super.call(this);}return UnlinkDoubleEntry;})(cls.TransactionSummaryViewModelReSTOpEnvelopeBase);cls.UnlinkDoubleEntry=UnlinkDoubleEntry;var UpdateCreditOrDebit=(function(_super){__extends(UpdateCreditOrDebit,_super);function UpdateCreditOrDebit(){_super.call(this);}return UpdateCreditOrDebit;})(cls.TransactionSummaryViewModelReSTOpEnvelopeBase);cls.UpdateCreditOrDebit=UpdateCreditOrDebit;var UploadedFileViewModel=(function(){function UploadedFileViewModel(){}return UploadedFileViewModel;})();cls.UploadedFileViewModel=UploadedFileViewModel;var USDAInformationViewModel=(function(){function USDAInformationViewModel(){}return USDAInformationViewModel;})();cls.USDAInformationViewModel=USDAInformationViewModel;var UserAccountViewModel=(function(_super){__extends(UserAccountViewModel,_super);function UserAccountViewModel(){_super.call(this);}return UserAccountViewModel;})(cls.BaseViewModel);cls.UserAccountViewModel=UserAccountViewModel;var UserInfoViewModel=(function(){function UserInfoViewModel(){}return UserInfoViewModel;})();cls.UserInfoViewModel=UserInfoViewModel;var UserSelectedProductCategoriesViewModel=(function(){function UserSelectedProductCategoriesViewModel(){}return UserSelectedProductCategoriesViewModel;})();cls.UserSelectedProductCategoriesViewModel=UserSelectedProductCategoriesViewModel;var VACalculatorRequest=(function(){function VACalculatorRequest(){}return VACalculatorRequest;})();cls.VACalculatorRequest=VACalculatorRequest;var VACalculatorResponse=(function(){function VACalculatorResponse(){}return VACalculatorResponse;})();cls.VACalculatorResponse=VACalculatorResponse;var VaFeesLimitExceededResult=(function(){function VaFeesLimitExceededResult(){}return VaFeesLimitExceededResult;})();cls.VaFeesLimitExceededResult=VaFeesLimitExceededResult;var VAInformationViewModel=(function(){function VAInformationViewModel(){}return VAInformationViewModel;})();cls.VAInformationViewModel=VAInformationViewModel;var VmOpResult=(function(){function VmOpResult(){}return VmOpResult;})();cls.VmOpResult=VmOpResult;})(cls=srv.cls||(srv.cls={}));})(srv||(srv={}));var cls;(function(cls){var TransactionInfoRef=(function(){function TransactionInfoRef(ti){var _this=this;this.getRef=function(){return _this.ticb();};this.ticb=function(){return ti;};}return TransactionInfoRef;})();cls.TransactionInfoRef=TransactionInfoRef;var Map=(function(){function Map(map,keySelector){var _this=this;if(map===void 0){map=[];}if(keySelector===void 0){keySelector=function(s){return null;};}this.keySelector=keySelector;this._map=new Object();this.invalidateValues=function(){_this.values=null;};this.lookup=function(key){return _this._map[key];};this.map=function(value){if(!value){return;}_this.invalidateValues();var key=_this.keySelector(value);_this._map[key]=value;};this.replace=function(value){var key=_this.keySelector(value);var valueExisting=_this.lookup(key);_this.map(value);_this.invalidateValues();return valueExisting;};this.mapAll=function(values){_this.invalidateValues();for(var i=0;i<values.length;i++){var value=values[i];var key=_this.keySelector(value);_this._map[key]=value;}};this.remove=function(value){var key=_this.keySelector(value);var valueRemoved=_this.lookup(key);delete _this._map[key];_this.invalidateValues();return valueRemoved;};this.values=null;this.getValues=function(){if(_this.values!=null){return _this.values;}var values=[];for(var k in _this._map){if(_this._map.hasOwnProperty(k)){values.push(_this._map[k]);}}_this.values=values;return values;};if(map){this.mapAll(map);}}return Map;})();cls.Map=Map;var TransactionInfo=(function(){function TransactionInfo(){var _this=this;this.getLoan=function(){return _this.loanCallback();};this.prepareSave=function(){var loan=_this.loanCallback();if(!loan.transactionInfo){loan.transactionInfo=new srv.cls.TransactionInfo();}if(_this.loanApplication){loan.transactionInfo.loanApplications=_this.loanApplication.getValues();lib.forEach(loan.transactionInfo.loanApplications,function(la){return la.prepareForSubmit();});}if(_this.borrower){loan.transactionInfo.borrowers=_this.borrower.getValues();lib.forEach(loan.transactionInfo.borrowers,function(b){return b.prepareSave();});}if(_this.property){loan.transactionInfo.properties=lib.filter(_this.property.getValues(),function(o){return(!!o.loanId&&o.loanId!=lib.getEmptyGuid());});}if(_this.liability){loan.transactionInfo.liabilities=_this.liability.getValues();}if(_this.incomeInfo){loan.transactionInfo.incomes=_this.incomeInfo.getValues();}if(_this.employmentInfo){loan.transactionInfo.employments=_this.employmentInfo.getValues();}};this.cloneTransactionInfo=function(){var tiCopy=new cls.TransactionInfo();var loanCopyBuff={};lib.copyState(_this.loanCallback(),loanCopyBuff);loanCopyBuff.$filter=_this.loanCallback()["$filter"];loanCopyBuff.transactionInfo=tiCopy;tiCopy.loanCallback=function(){return loanCopyBuff;};TransactionInfo.populateImpl(_this,_this,tiCopy);tiCopy.prepareSave();var loanCopy=new cls.LoanViewModel(loanCopyBuff,null,_this.loanCallback().isWholeSale);tiCopy.loanCallback=function(){return loanCopy;};loanCopy.getTransactionInfo=function(){return tiCopy;};return tiCopy;};this.property=new Map([],function(o){return o.propertyId;});this.liability=new Map([],function(o){return o.liabilityInfoId;});this.incomeInfo=new Map([],function(o){return o.incomeInfoId;});this.loanApplication=new Map([],function(o){return o.loanApplicationId;});this.employmentInfo=new Map([],function(o){return o.employmentInfoId;});this.borrower=new Map([],function(o){return o.borrowerId;});}Object.defineProperty(TransactionInfo.prototype,"borrowers",{get:function(){return this.borrower.getValues();},enumerable:true,configurable:true});Object.defineProperty(TransactionInfo.prototype,"employments",{get:function(){return this.employmentInfo.getValues();},enumerable:true,configurable:true});Object.defineProperty(TransactionInfo.prototype,"incomes",{get:function(){return this.incomeInfo.getValues();},enumerable:true,configurable:true});Object.defineProperty(TransactionInfo.prototype,"liabilities",{get:function(){return this.liability.getValues();},enumerable:true,configurable:true});Object.defineProperty(TransactionInfo.prototype,"loanApplications",{get:function(){return this.loanApplication.getValues();},enumerable:true,configurable:true});Object.defineProperty(TransactionInfo.prototype,"properties",{get:function(){return this.property.getValues();},enumerable:true,configurable:true});Object.defineProperty(TransactionInfo.prototype,"incomeInfo",{get:function(){return this._incomeInfo;},set:function(map){this._incomeInfo=map;},enumerable:true,configurable:true});TransactionInfo.prototype.populate=function(loanCallBack,transactionInfo){this.loanCallback=loanCallBack;if(!!transactionInfo){TransactionInfo.populateImpl(transactionInfo,null,this);}};TransactionInfo.populateImpl=function(srcLst,srcMap,dst){var coll;coll=this.selectSourceList(srcLst,function(s){return s.properties;},srcMap,function(s){return s.property.getValues();});coll.forEach(function(p){return new cls.PropertyViewModel(dst,p);});coll=this.selectSourceList(srcLst,function(s){return s.liabilities;},srcMap,function(s){return s.liability.getValues();});coll.forEach(function(p){return new cls.LiabilityViewModel(dst,p);});coll=this.selectSourceList(srcLst,function(s){return s.borrowers;},srcMap,function(s){return s.borrower.getValues();});coll.forEach(function(p){return new cls.BorrowerViewModel(dst,p);});coll=this.selectSourceList(srcLst,function(s){return s.incomes;},srcMap,function(s){return s.incomeInfo.getValues();});coll.forEach(function(p){return new cls.IncomeInfoViewModel(dst,p);});coll=this.selectSourceList(srcLst,function(s){return s.employments;},srcMap,function(s){return s.employmentInfo.getValues();});coll.forEach(function(p){return cls.EmploymentInfoViewModelFactory.create(dst,p);});coll=this.selectSourceList(srcLst,function(s){return s.loanApplications;},srcMap,function(s){return s.loanApplication.getValues();});coll.forEach(function(p){return new cls.LoanApplicationViewModel(dst,p);});};TransactionInfo.selectSourceList=function(srcLst,selectorList,srcMap,selectorMap){var rslt;if(!!srcLst){rslt=selectorList(srcLst);}else{if(!!srcMap){rslt=selectorMap(srcMap);}else{throw new Error("selectSourceList() requires either List or Map source param");}}return(!!rslt)?rslt:[];};return TransactionInfo;})();cls.TransactionInfo=TransactionInfo;})(cls||(cls={}));var __extends=this.__extends||function(d,b){for(var p in b){if(b.hasOwnProperty(p)){d[p]=b[p];}}function __(){this.constructor=d;}__.prototype=b.prototype;d.prototype=new __();};var cls;(function(cls){cls.lookupsToFlgMapCls=function(lookups){lookups=!!lookups?lookups:[];if(lookups.length>30){throw new Error("ILookupItem[] of greater than 30 is not supported (recieved "+lookups.length+")");}var valueMap=new Object();for(var i=0;i<lookups.length;i++){valueMap[lookups[i].text]=1<<i;}var valueMapFlgCls=lib.createFlaggedEnum(valueMap,1<<lookups.length);return valueMapFlgCls;};cls.lookupToFlgMapItem=function(flgMapCls,lookups){lookups=!!lookups?lookups:[];var flgMapItem=new flgMapCls(0);for(var i=0;i<lookups.length;i++){flgMapItem=flgMapItem.add(lookups[i].text);}return flgMapItem;};var LookupViewModel=(function(_super){__extends(LookupViewModel,_super);function LookupViewModel(lookupVm){var _this=this;_super.call(this);this._pledgetAssetCommentsFlgMapCls=null;this.occupancyTypeListsByNames=function(names){return LookupViewModel.byNames(names,_this.occupancyTypeList);};this.occupancyTypeListsByValues=function(values){return LookupViewModel.byValues(values,_this.occupancyTypeList);};this.pledgetAssetCommentsFlgFromNames=function(names){var pledgetAssetCommentsColl=_this.pledgetAssetCommentsByNames(names);var pledgetAssetCommentsFlg=cls.lookupToFlgMapItem(_this.pledgetAssetCommentsFlgMapCls,pledgetAssetCommentsColl);return pledgetAssetCommentsFlg;};this.pledgetAssetCommentsFlgFromValues=function(values){var pledgetAssetCommentsColl=_this.pledgetAssetCommentsByValues(values);var pledgetAssetCommentsFlg=cls.lookupToFlgMapItem(_this.pledgetAssetCommentsFlgMapCls,pledgetAssetCommentsColl);return pledgetAssetCommentsFlg;};this.pledgetAssetCommentsByNames=function(names){return LookupViewModel.byNames(names,_this.pledgetAssetComments);};this.pledgetAssetCommentsByValues=function(values){return LookupViewModel.byValues(values,_this.pledgetAssetComments);};this.getStringValue=function(lookups,value){var retVal="";lib.forEach(lookups,function(e){if(e.value==value){retVal=e.stringValue;}});return retVal;};lib.copyState(lookupVm,this);}Object.defineProperty(LookupViewModel.prototype,"pledgetAssetCommentsFlgMapCls",{get:function(){if(this._pledgetAssetCommentsFlgMapCls==null){this._pledgetAssetCommentsFlgMapCls=cls.lookupsToFlgMapCls(this.pledgetAssetComments);}return this._pledgetAssetCommentsFlgMapCls;},set:function(readOnly){},enumerable:true,configurable:true});LookupViewModel.byNames=function(names,lookups){return lib.filter(lookups,function(o){return !!lib.findFirst(names,function(n){return n==o.text;});});};LookupViewModel.byValues=function(values,lookups){return lib.filter(lookups,function(o){return !!lib.findFirst(values,function(n){return n==o.value;});});};return LookupViewModel;})(srv.cls.LookupViewModel);cls.LookupViewModel=LookupViewModel;})(cls||(cls={}));var srv;(function(srv){var lazyLoadControllerName=(function(){function lazyLoadControllerName(){}lazyLoadControllerName.loanLockHistory="LoanLockHistory";return lazyLoadControllerName;})();srv.lazyLoadControllerName=lazyLoadControllerName;(function(OwnerTypeEnum){OwnerTypeEnum[OwnerTypeEnum["None"]=0]="None";OwnerTypeEnum[OwnerTypeEnum["Borrower"]=1]="Borrower";OwnerTypeEnum[OwnerTypeEnum["CoBorrower"]=2]="CoBorrower";OwnerTypeEnum[OwnerTypeEnum["Joint"]=3]="Joint";})(srv.OwnerTypeEnum||(srv.OwnerTypeEnum={}));var OwnerTypeEnum=srv.OwnerTypeEnum;var folderName=(function(){function folderName(){}folderName.FeesClosingCorp="Fees - Closing Corp";folderName.LOSEncompass="LOS - Encompass";folderName.PricingOptimalBlue="Pricing - Optimal Blue";folderName.SigningeOriginal="Signing - eOriginal";folderName.DisclosuresApplicationDocument="Disclosures - Application Document";folderName.DisclosuresWetSignature="Disclosures - Wet Signature";folderName.BiDirectionalEncompass="BiDirectional - Encompass";folderName.Credit="Credit";folderName.AppraisalLenderX="Appraisal - LenderX";folderName.CRMLead360="CRM - Lead360";folderName.Audit="Audit";folderName.AusDl="Automated Underwriting Specification - Desktop Underwriter";folderName.AusLp="Automated Underwriting Specification - Loan Prospector";return folderName;})();srv.folderName=folderName;(function(LiabilitiesAccountOwnershipType){LiabilitiesAccountOwnershipType[LiabilitiesAccountOwnershipType["None"]=-1]="None";LiabilitiesAccountOwnershipType[LiabilitiesAccountOwnershipType["AuthorizedUser"]=0]="AuthorizedUser";LiabilitiesAccountOwnershipType[LiabilitiesAccountOwnershipType["Comaker"]=1]="Comaker";LiabilitiesAccountOwnershipType[LiabilitiesAccountOwnershipType["Individual"]=2]="Individual";LiabilitiesAccountOwnershipType[LiabilitiesAccountOwnershipType["JointContractualLiability"]=3]="JointContractualLiability";LiabilitiesAccountOwnershipType[LiabilitiesAccountOwnershipType["JointParticipating"]=4]="JointParticipating";LiabilitiesAccountOwnershipType[LiabilitiesAccountOwnershipType["Maker"]=5]="Maker";LiabilitiesAccountOwnershipType[LiabilitiesAccountOwnershipType["OnBehalfOf"]=6]="OnBehalfOf";LiabilitiesAccountOwnershipType[LiabilitiesAccountOwnershipType["Terminated"]=7]="Terminated";LiabilitiesAccountOwnershipType[LiabilitiesAccountOwnershipType["Undesignated"]=8]="Undesignated";LiabilitiesAccountOwnershipType[LiabilitiesAccountOwnershipType["Deceased"]=9]="Deceased";})(srv.LiabilitiesAccountOwnershipType||(srv.LiabilitiesAccountOwnershipType={}));var LiabilitiesAccountOwnershipType=srv.LiabilitiesAccountOwnershipType;(function(LiabilitiesDebtCommentEnum){LiabilitiesDebtCommentEnum[LiabilitiesDebtCommentEnum["Agree"]=0]="Agree";LiabilitiesDebtCommentEnum[LiabilitiesDebtCommentEnum["Disagree"]=1]="Disagree";LiabilitiesDebtCommentEnum[LiabilitiesDebtCommentEnum["PaidOff"]=3]="PaidOff";LiabilitiesDebtCommentEnum[LiabilitiesDebtCommentEnum["PayoffAtClose"]=4]="PayoffAtClose";LiabilitiesDebtCommentEnum[LiabilitiesDebtCommentEnum["AcctNotMine"]=5]="AcctNotMine";LiabilitiesDebtCommentEnum[LiabilitiesDebtCommentEnum["Duplicate"]=6]="Duplicate";LiabilitiesDebtCommentEnum[LiabilitiesDebtCommentEnum["NotMyLoan"]=7]="NotMyLoan";LiabilitiesDebtCommentEnum[LiabilitiesDebtCommentEnum["SomeoneElsePays"]=8]="SomeoneElsePays";LiabilitiesDebtCommentEnum[LiabilitiesDebtCommentEnum["NonBorrowingSpouse"]=9]="NonBorrowingSpouse";})(srv.LiabilitiesDebtCommentEnum||(srv.LiabilitiesDebtCommentEnum={}));var LiabilitiesDebtCommentEnum=srv.LiabilitiesDebtCommentEnum;(function(PhoneNumberType){PhoneNumberType[PhoneNumberType["None"]=-1]="None";PhoneNumberType[PhoneNumberType["Home"]=0]="Home";PhoneNumberType[PhoneNumberType["Cell"]=1]="Cell";PhoneNumberType[PhoneNumberType["Work"]=2]="Work";PhoneNumberType[PhoneNumberType["Other"]=3]="Other";})(srv.PhoneNumberType||(srv.PhoneNumberType={}));var PhoneNumberType=srv.PhoneNumberType;(function(DocumentClassType){DocumentClassType[DocumentClassType["None"]=0]="None";DocumentClassType[DocumentClassType["IncomeVerification"]=1]="IncomeVerification";DocumentClassType[DocumentClassType["LoanDisclosuresPackage"]=2]="LoanDisclosuresPackage";DocumentClassType[DocumentClassType["AppraisalReport"]=3]="AppraisalReport";DocumentClassType[DocumentClassType["CreditReport"]=4]="CreditReport";DocumentClassType[DocumentClassType["Authorization"]=5]="Authorization";DocumentClassType[DocumentClassType["AuthorizationsPackage"]=6]="AuthorizationsPackage";DocumentClassType[DocumentClassType["OtherDocuments"]=7]="OtherDocuments";DocumentClassType[DocumentClassType["LoanReDisclosuresPackage"]=8]="LoanReDisclosuresPackage";DocumentClassType[DocumentClassType["MiscellaneousDocuments"]=9]="MiscellaneousDocuments";DocumentClassType[DocumentClassType["SmartGFEComplianceCertificate"]=10]="SmartGFEComplianceCertificate";DocumentClassType[DocumentClassType["PreApprovalLetter"]=11]="PreApprovalLetter";DocumentClassType[DocumentClassType["Collateral"]=12]="Collateral";DocumentClassType[DocumentClassType["VariousDocuments"]=13]="VariousDocuments";DocumentClassType[DocumentClassType["AppraisalDocuments"]=14]="AppraisalDocuments";DocumentClassType[DocumentClassType["CounterOfferApprovalLetter"]=15]="CounterOfferApprovalLetter";DocumentClassType[DocumentClassType["CounterOfferApprovalLetterInitialDisclousure"]=16]="CounterOfferApprovalLetterInitialDisclousure";DocumentClassType[DocumentClassType["InitialDisclosuresMailingCoverLetter"]=17]="InitialDisclosuresMailingCoverLetter";DocumentClassType[DocumentClassType["ReDisclosuresMailingCoverLetter"]=18]="ReDisclosuresMailingCoverLetter";DocumentClassType[DocumentClassType["HudBooklet"]=19]="HudBooklet";DocumentClassType[DocumentClassType["LoanDisclosuresDocuments"]=20]="LoanDisclosuresDocuments";DocumentClassType[DocumentClassType["BorrowersNeedsListToBeCompleted"]=21]="BorrowersNeedsListToBeCompleted";DocumentClassType[DocumentClassType["AssetsDocuments"]=22]="AssetsDocuments";DocumentClassType[DocumentClassType["Other"]=99]="Other";})(srv.DocumentClassType||(srv.DocumentClassType={}));var DocumentClassType=srv.DocumentClassType;(function(AddressType){AddressType[AddressType["Default"]=0]="Default";AddressType[AddressType["Present"]=1]="Present";AddressType[AddressType["Former"]=2]="Former";AddressType[AddressType["Mailing"]=3]="Mailing";AddressType[AddressType["Billing"]=4]="Billing";AddressType[AddressType["GovernmentMonitoring"]=5]="GovernmentMonitoring";AddressType[AddressType["RealEstate"]=6]="RealEstate";})(srv.AddressType||(srv.AddressType={}));var AddressType=srv.AddressType;(function(OccupancyType){OccupancyType[OccupancyType["None"]=0]="None";OccupancyType[OccupancyType["PrimaryResidence"]=1]="PrimaryResidence";OccupancyType[OccupancyType["InvestmentProperty"]=2]="InvestmentProperty";OccupancyType[OccupancyType["SecondVacationHome"]=3]="SecondVacationHome";})(srv.OccupancyType||(srv.OccupancyType={}));var OccupancyType=srv.OccupancyType;(function(BorrowerType){BorrowerType[BorrowerType["Borrower"]=0]="Borrower";BorrowerType[BorrowerType["CoBorrower"]=1]="CoBorrower";BorrowerType[BorrowerType["OtherBorrower"]=2]="OtherBorrower";})(srv.BorrowerType||(srv.BorrowerType={}));var BorrowerType=srv.BorrowerType;(function(PreferredPaymentPeriod){PreferredPaymentPeriod[PreferredPaymentPeriod["None"]=0]="None";PreferredPaymentPeriod[PreferredPaymentPeriod["Monthly"]=1]="Monthly";PreferredPaymentPeriod[PreferredPaymentPeriod["Annual"]=2]="Annual";})(srv.PreferredPaymentPeriod||(srv.PreferredPaymentPeriod={}));var PreferredPaymentPeriod=srv.PreferredPaymentPeriod;(function(AmortizationType){AmortizationType[AmortizationType["None"]=0]="None";AmortizationType[AmortizationType["Fixed"]=1]="Fixed";AmortizationType[AmortizationType["ARM"]=2]="ARM";AmortizationType[AmortizationType["GPM"]=3]="GPM";AmortizationType[AmortizationType["Other"]=4]="Other";})(srv.AmortizationType||(srv.AmortizationType={}));var AmortizationType=srv.AmortizationType;(function(MortageType){MortageType[MortageType["Conventional"]=0]="Conventional";MortageType[MortageType["FHA"]=1]="FHA";MortageType[MortageType["ConventionalJumbo"]=2]="ConventionalJumbo";MortageType[MortageType["ConventionalSuperJumbo"]=3]="ConventionalSuperJumbo";MortageType[MortageType["VA"]=4]="VA";MortageType[MortageType["USDA"]=5]="USDA";})(srv.MortageType||(srv.MortageType={}));var MortageType=srv.MortageType;(function(CreditReportStatus){CreditReportStatus[CreditReportStatus["undefined"]=0]="undefined";CreditReportStatus[CreditReportStatus["retrieving"]=1]="retrieving";CreditReportStatus[CreditReportStatus["retrieved"]=2]="retrieved";CreditReportStatus[CreditReportStatus["error"]=3]="error";})(srv.CreditReportStatus||(srv.CreditReportStatus={}));var CreditReportStatus=srv.CreditReportStatus;(function(LienPosition){LienPosition[LienPosition["First"]=1]="First";LienPosition[LienPosition["Second"]=2]="Second";LienPosition[LienPosition["Third"]=3]="Third";LienPosition[LienPosition["Fourth"]=4]="Fourth";LienPosition[LienPosition["Fifth"]=5]="Fifth";})(srv.LienPosition||(srv.LienPosition={}));var LienPosition=srv.LienPosition;(function(LockStatus){LockStatus[LockStatus["NotLocked"]=0]="NotLocked";LockStatus[LockStatus["LockRequested"]=1]="LockRequested";LockStatus[LockStatus["LockPending"]=2]="LockPending";LockStatus[LockStatus["LockExpirationDate"]=3]="LockExpirationDate";LockStatus[LockStatus["Locked"]=4]="Locked";})(srv.LockStatus||(srv.LockStatus={}));var LockStatus=srv.LockStatus;(function(PropertyTaxPayPeriods){PropertyTaxPayPeriods[PropertyTaxPayPeriods["Monthly"]=1]="Monthly";PropertyTaxPayPeriods[PropertyTaxPayPeriods["Annual"]=2]="Annual";})(srv.PropertyTaxPayPeriods||(srv.PropertyTaxPayPeriods={}));var PropertyTaxPayPeriods=srv.PropertyTaxPayPeriods;(function(LoanType){LoanType[LoanType["Purchase"]=1]="Purchase";LoanType[LoanType["Refinance"]=2]="Refinance";})(srv.LoanType||(srv.LoanType={}));var LoanType=srv.LoanType;(function(HomeBuyingType){HomeBuyingType[HomeBuyingType["None"]=0]="None";HomeBuyingType[HomeBuyingType["SignedAPurchaseAgreement"]=1]="SignedAPurchaseAgreement";HomeBuyingType[HomeBuyingType["OfferPendingFoundAHouse"]=2]="OfferPendingFoundAHouse";HomeBuyingType[HomeBuyingType["GetPreApproved"]=3]="GetPreApproved";HomeBuyingType[HomeBuyingType["WhatCanIAfford"]=4]="WhatCanIAfford";})(srv.HomeBuyingType||(srv.HomeBuyingType={}));var HomeBuyingType=srv.HomeBuyingType;(function(PropertyExpenseType){PropertyExpenseType[PropertyExpenseType["propertyTax"]=1]="propertyTax";PropertyExpenseType[PropertyExpenseType["homeOwnerInsurance"]=2]="homeOwnerInsurance";PropertyExpenseType[PropertyExpenseType["mortgageInsurance"]=3]="mortgageInsurance";PropertyExpenseType[PropertyExpenseType["hOADues"]=4]="hOADues";PropertyExpenseType[PropertyExpenseType["floodInsurance"]=5]="floodInsurance";})(srv.PropertyExpenseType||(srv.PropertyExpenseType={}));var PropertyExpenseType=srv.PropertyExpenseType;(function(PhoneTypes){PhoneTypes[PhoneTypes["Cell"]=1]="Cell";PhoneTypes[PhoneTypes["Work"]=2]="Work";})(srv.PhoneTypes||(srv.PhoneTypes={}));var PhoneTypes=srv.PhoneTypes;(function(MiscellaneousDebtTypes){MiscellaneousDebtTypes[MiscellaneousDebtTypes["ChildCareExpensesForVALoansOnly"]=1]="ChildCareExpensesForVALoansOnly";MiscellaneousDebtTypes[MiscellaneousDebtTypes["Expenses2106FromTaxReturns"]=2]="Expenses2106FromTaxReturns";MiscellaneousDebtTypes[MiscellaneousDebtTypes["EmptyDebt"]=-77]="EmptyDebt";})(srv.MiscellaneousDebtTypes||(srv.MiscellaneousDebtTypes={}));var MiscellaneousDebtTypes=srv.MiscellaneousDebtTypes;(function(DebtsAccountOwnershipType){DebtsAccountOwnershipType[DebtsAccountOwnershipType["Borrower"]=0]="Borrower";DebtsAccountOwnershipType[DebtsAccountOwnershipType["CoBorrower"]=1]="CoBorrower";DebtsAccountOwnershipType[DebtsAccountOwnershipType["Joint"]=2]="Joint";DebtsAccountOwnershipType[DebtsAccountOwnershipType["BorrowerWithOther"]=3]="BorrowerWithOther";DebtsAccountOwnershipType[DebtsAccountOwnershipType["CoBorrowerWithOther"]=4]="CoBorrowerWithOther";})(srv.DebtsAccountOwnershipType||(srv.DebtsAccountOwnershipType={}));var DebtsAccountOwnershipType=srv.DebtsAccountOwnershipType;(function(pricingAdjustmentSectionType){pricingAdjustmentSectionType[pricingAdjustmentSectionType["investor"]=1]="investor";pricingAdjustmentSectionType[pricingAdjustmentSectionType["loanOfficer"]=2]="loanOfficer";pricingAdjustmentSectionType[pricingAdjustmentSectionType["investorBasePurchase"]=3]="investorBasePurchase";pricingAdjustmentSectionType[pricingAdjustmentSectionType["adjustment"]=4]="adjustment";})(srv.pricingAdjustmentSectionType||(srv.pricingAdjustmentSectionType={}));var pricingAdjustmentSectionType=srv.pricingAdjustmentSectionType;(function(EmploymentType){EmploymentType[EmploymentType["ActiveMilitaryDuty"]=0]="ActiveMilitaryDuty";EmploymentType[EmploymentType["SalariedEmployee"]=1]="SalariedEmployee";EmploymentType[EmploymentType["SelfEmployed"]=2]="SelfEmployed";EmploymentType[EmploymentType["Retired"]=3]="Retired";EmploymentType[EmploymentType["OtherUnemployed"]=4]="OtherUnemployed";})(srv.EmploymentType||(srv.EmploymentType={}));var EmploymentType=srv.EmploymentType;(function(pledgedAssetCommentType){pledgedAssetCommentType[pledgedAssetCommentType["DoNotPayoff"]=0]="DoNotPayoff";pledgedAssetCommentType[pledgedAssetCommentType["PaidOffFreeAndClear"]=1]="PaidOffFreeAndClear";pledgedAssetCommentType[pledgedAssetCommentType["PayoffAtClose"]=2]="PayoffAtClose";pledgedAssetCommentType[pledgedAssetCommentType["PayoffAtClosingAndDontCloseAccount"]=3]="PayoffAtClosingAndDontCloseAccount";pledgedAssetCommentType[pledgedAssetCommentType["PayoffAtClosingAndCloseAccount"]=4]="PayoffAtClosingAndCloseAccount";pledgedAssetCommentType[pledgedAssetCommentType["Sold"]=5]="Sold";pledgedAssetCommentType[pledgedAssetCommentType["NotMyLoan"]=6]="NotMyLoan";pledgedAssetCommentType[pledgedAssetCommentType["PendingSale"]=7]="PendingSale";pledgedAssetCommentType[pledgedAssetCommentType["NotAMortgage"]=8]="NotAMortgage";pledgedAssetCommentType[pledgedAssetCommentType["Duplicate"]=9]="Duplicate";})(srv.pledgedAssetCommentType||(srv.pledgedAssetCommentType={}));var pledgedAssetCommentType=srv.pledgedAssetCommentType;(function(collectionsDebtComment){collectionsDebtComment[collectionsDebtComment["Agree"]=0]="Agree";collectionsDebtComment[collectionsDebtComment["Disagree"]=1]="Disagree";collectionsDebtComment[collectionsDebtComment["PaidOff"]=3]="PaidOff";collectionsDebtComment[collectionsDebtComment["PayoffAtClose"]=4]="PayoffAtClose";collectionsDebtComment[collectionsDebtComment["Duplicate"]=5]="Duplicate";})(srv.collectionsDebtComment||(srv.collectionsDebtComment={}));var collectionsDebtComment=srv.collectionsDebtComment;(function(pledgedAssetLoanType){pledgedAssetLoanType[pledgedAssetLoanType["None"]=0]="None";pledgedAssetLoanType[pledgedAssetLoanType["Fixed"]=1]="Fixed";pledgedAssetLoanType[pledgedAssetLoanType["Heloc"]=2]="Heloc";})(srv.pledgedAssetLoanType||(srv.pledgedAssetLoanType={}));var pledgedAssetLoanType=srv.pledgedAssetLoanType;(function(propertyExpensesType){propertyExpensesType[propertyExpensesType["None"]=0]="None";propertyExpensesType[propertyExpensesType["Tax"]=1]="Tax";propertyExpensesType[propertyExpensesType["HOI"]=2]="HOI";propertyExpensesType[propertyExpensesType["PMI"]=3]="PMI";propertyExpensesType[propertyExpensesType["HOA"]=4]="HOA";propertyExpensesType[propertyExpensesType["FloodInsurance"]=5]="FloodInsurance";})(srv.propertyExpensesType||(srv.propertyExpensesType={}));var propertyExpensesType=srv.propertyExpensesType;(function(milestoneStatus){milestoneStatus[milestoneStatus["prospect"]=1]="prospect";milestoneStatus[milestoneStatus["incomplete"]=2]="incomplete";milestoneStatus[milestoneStatus["processing"]=3]="processing";milestoneStatus[milestoneStatus["preApproved"]=4]="preApproved";milestoneStatus[milestoneStatus["approved"]=5]="approved";milestoneStatus[milestoneStatus["docsOut"]=6]="docsOut";milestoneStatus[milestoneStatus["funded"]=8]="funded";milestoneStatus[milestoneStatus["cancelled"]=9]="cancelled";milestoneStatus[milestoneStatus["unsubmitted"]=10]="unsubmitted";milestoneStatus[milestoneStatus["registered"]=11]="registered";milestoneStatus[milestoneStatus["submitted"]=12]="submitted";milestoneStatus[milestoneStatus["rejected"]=13]="rejected";milestoneStatus[milestoneStatus["adverse"]=14]="adverse";milestoneStatus[milestoneStatus["appCompleted"]=15]="appCompleted";})(srv.milestoneStatus||(srv.milestoneStatus={}));var milestoneStatus=srv.milestoneStatus;(function(impoundType){impoundType[impoundType["insuranceOnly"]=2]="insuranceOnly";impoundType[impoundType["noImpound"]=3]="noImpound";impoundType[impoundType["taxesAndInsurance"]=0]="taxesAndInsurance";impoundType[impoundType["taxesOnly"]=1]="taxesOnly";})(srv.impoundType||(srv.impoundType={}));var impoundType=srv.impoundType;(function(incomeTypeEnum){incomeTypeEnum[incomeTypeEnum["baseEmploymentIncome"]=0]="baseEmploymentIncome";incomeTypeEnum[incomeTypeEnum["militaryBasePay"]=11]="militaryBasePay";incomeTypeEnum[incomeTypeEnum["partTime"]=13]="partTime";incomeTypeEnum[incomeTypeEnum["selfEmployedIncome"]=16]="selfEmployedIncome";incomeTypeEnum[incomeTypeEnum["netRentalIncome"]=5]="netRentalIncome";})(srv.incomeTypeEnum||(srv.incomeTypeEnum={}));var incomeTypeEnum=srv.incomeTypeEnum;(function(preferredPaymentPeriodsTypeEnum){preferredPaymentPeriodsTypeEnum[preferredPaymentPeriodsTypeEnum["Monthly"]=1]="Monthly";preferredPaymentPeriodsTypeEnum[preferredPaymentPeriodsTypeEnum["Annual"]=2]="Annual";})(srv.preferredPaymentPeriodsTypeEnum||(srv.preferredPaymentPeriodsTypeEnum={}));var preferredPaymentPeriodsTypeEnum=srv.preferredPaymentPeriodsTypeEnum;(function(docDeliveryTypeEnum){docDeliveryTypeEnum[docDeliveryTypeEnum["Mail"]=0]="Mail";docDeliveryTypeEnum[docDeliveryTypeEnum["Electronic"]=1]="Electronic";})(srv.docDeliveryTypeEnum||(srv.docDeliveryTypeEnum={}));var docDeliveryTypeEnum=srv.docDeliveryTypeEnum;(function(accountOption){accountOption[accountOption["JointWithBorrower"]=1]="JointWithBorrower";accountOption[accountOption["separateFromBorrower"]=2]="separateFromBorrower";})(srv.accountOption||(srv.accountOption={}));var accountOption=srv.accountOption;(function(adverseReasons){adverseReasons[adverseReasons["SelectOne"]=0]="SelectOne";adverseReasons[adverseReasons["ApplicationDenied"]=1]="ApplicationDenied";adverseReasons[adverseReasons["ApplicationWithdrawnByBorrower"]=2]="ApplicationWithdrawnByBorrower";adverseReasons[adverseReasons["FileClosedForIncompletenes"]=3]="FileClosedForIncompletenes";adverseReasons[adverseReasons["PreApprovalRequestDenied"]=4]="PreApprovalRequestDenied";adverseReasons[adverseReasons["PreApprovalRequestApprovedButNotAccepted"]=5]="PreApprovalRequestApprovedButNotAccepted";})(srv.adverseReasons||(srv.adverseReasons={}));var adverseReasons=srv.adverseReasons;var manageUserAccountButtonActions=(function(){function manageUserAccountButtonActions(){}manageUserAccountButtonActions.createAccount="Create Account";manageUserAccountButtonActions.updateAccount="Update Account";manageUserAccountButtonActions.connectAccount="Connect Account";return manageUserAccountButtonActions;})();srv.manageUserAccountButtonActions=manageUserAccountButtonActions;var loanDetailsActions=(function(){function loanDetailsActions(){}loanDetailsActions.SaveLoanApplications="Save Loan Application";loanDetailsActions.RunComplianceCheck="Run Compliance Check";loanDetailsActions.CreateInitialDisclosures="Create Initial Disclosures";loanDetailsActions.CreateInitialLockDisclosures="Create Initial Lock Disclosures";return loanDetailsActions;})();srv.loanDetailsActions=loanDetailsActions;})(srv||(srv={}));var __extends=this.__extends||function(d,b){for(var p in b){if(b.hasOwnProperty(p)){d[p]=b[p];}}function __(){this.constructor=d;}__.prototype=b.prototype;d.prototype=new __();};var srv;(function(srv){var cls;(function(cls){var SecureLinkEmailTemplateViewModel=(function(){function SecureLinkEmailTemplateViewModel(){}return SecureLinkEmailTemplateViewModel;})();cls.SecureLinkEmailTemplateViewModel=SecureLinkEmailTemplateViewModel;})(cls=srv.cls||(srv.cls={}));})(srv||(srv={}));var cls;(function(cls){(function(TitleHeldInType){TitleHeldInType[TitleHeldInType["InMyNamesAsIndividuals"]=0]="InMyNamesAsIndividuals";TitleHeldInType[TitleHeldInType["InATrust"]=1]="InATrust";TitleHeldInType[TitleHeldInType["InACorporation"]=2]="InACorporation";})(cls.TitleHeldInType||(cls.TitleHeldInType={}));var TitleHeldInType=cls.TitleHeldInType;var CreditViewModel=(function(_super){__extends(CreditViewModel,_super);function CreditViewModel(credit){var _this=this;_super.call(this);this.isCreditReportValid=function(){if(!_this.creditReportDate||_this.creditStatus!=2){return false;}if(moment(_this.creditReportDate).format("YYYY-MM-DD")<moment().subtract("89","days").format("YYYY-MM-DD")){return false;}else{return true;}};if(credit){common.objects.automap(this,credit);}}return CreditViewModel;})(srv.cls.CreditViewModel);cls.CreditViewModel=CreditViewModel;var CountyLoanLimitViewModel=(function(){function CountyLoanLimitViewModel(){}return CountyLoanLimitViewModel;})();cls.CountyLoanLimitViewModel=CountyLoanLimitViewModel;var DeclarationViewModel=(function(_super){__extends(DeclarationViewModel,_super);function DeclarationViewModel(declaration){_super.call(this);if(declaration){common.objects.automap(this,declaration);}if((!angular.isDefined(this.loanOriginatorSource)||this.loanOriginatorSource==null)&&!declaration){this.loanOriginatorSource=1;}}return DeclarationViewModel;})(srv.cls.DeclarationViewModel);cls.DeclarationViewModel=DeclarationViewModel;var DeclarationInfoViewModel=(function(_super){__extends(DeclarationInfoViewModel,_super);function DeclarationInfoViewModel(declarationInfo){var _this=this;_super.call(this);this.expiredAfterIssued=function(){if(_this.dateIssued!=null){if(_this.dateExpired==null){return true;}var dateBefore=moment(_this.dateIssued).format("MM/DD/YYYY");var dateAfter=moment(_this.dateExpired).format("MM/DD/YYYY");return new Date(dateBefore)<new Date(dateAfter);}else{return true;}};if(declarationInfo){common.objects.automap(this,declarationInfo);}}return DeclarationInfoViewModel;})(srv.cls.DeclarationInfoViewModel);cls.DeclarationInfoViewModel=DeclarationInfoViewModel;var REOInfoViewModel=(function(_super){__extends(REOInfoViewModel,_super);function REOInfoViewModel(reoInfo){_super.call(this);if(reoInfo){common.objects.automap(this,reoInfo);}}Object.defineProperty(REOInfoViewModel.prototype,"NegativeAmortizationFeature",{get:function(){return common.objects.boolToString(this.negativeAmortizationFeature);},set:function(value){this.negativeAmortizationFeature=common.string.toBool(value);},enumerable:true,configurable:true});Object.defineProperty(REOInfoViewModel.prototype,"PrePaymentPenalty",{get:function(){return common.objects.boolToString(this.prePaymentPenalty);},set:function(value){this.prePaymentPenalty=common.string.toBool(value);},enumerable:true,configurable:true});Object.defineProperty(REOInfoViewModel.prototype,"FullyIndexedRate",{get:function(){this.fullyIndexedRate=this.amortizationType==2?this.fullyIndexedRate:this.interestRate;return this.fullyIndexedRate;},set:function(value){this.fullyIndexedRate=value;},enumerable:true,configurable:true});return REOInfoViewModel;})(srv.cls.REOInfoViewModel);cls.REOInfoViewModel=REOInfoViewModel;var CompanyDataViewModel=(function(_super){__extends(CompanyDataViewModel,_super);function CompanyDataViewModel(companyData,getBorrowerFullName){var _this=this;_super.call(this);this.getBorrowerFullName=getBorrowerFullName;this.isCompanyDataFilledIn=function(){return _this.hasVal(_this.companyName)||_this.hasVal(_this.attn)||_this.hasVal(_this.phone)||_this.hasVal(_this.fax)||_this.hasVal(_this.streetAddress1)||_this.hasVal(_this.streetAddress2)||_this.hasVal(_this.addressViewModel&&_this.addressViewModel.cityName)||_this.hasVal(_this.addressViewModel&&_this.addressViewModel.stateName)||_this.hasVal(_this.addressViewModel&&_this.addressViewModel.zipCode);};this.hasVal=function(s){if(s==undefined||s==null||s.trim().length==0){return false;}else{return true;}};if(companyData){common.objects.automap(this,companyData);this.addressViewModel=new cls.PropertyViewModel(null,companyData.addressViewModel);}else{this.addressViewModel=new cls.PropertyViewModel(null);}this.hasChanges=false;}return CompanyDataViewModel;})(srv.cls.CompanyDataViewModel);cls.CompanyDataViewModel=CompanyDataViewModel;var MiscellaneousDebtViewModel=(function(_super){__extends(MiscellaneousDebtViewModel,_super);function MiscellaneousDebtViewModel(miscDebt,debtType,userEntry,borrowerFullName){_super.call(this);if(miscDebt){common.objects.automap(this,miscDebt);}else{this.typeId=debtType||1;this.isUserEntry=(userEntry||userEntry===undefined);this.monthsLeft=null;this.amount=0;this.payee="";this.isRemoved=false;}this.borrowerFullName=borrowerFullName;}Object.defineProperty(MiscellaneousDebtViewModel.prototype,"Amount",{get:function(){return this.amount;},set:function(newAmount){if(newAmount!=0){this.isRemoved=false;}this.amount=newAmount;},enumerable:true,configurable:true});return MiscellaneousDebtViewModel;})(srv.cls.MiscellaneousDebtViewModel);cls.MiscellaneousDebtViewModel=MiscellaneousDebtViewModel;var UserAccountViewModel=(function(_super){__extends(UserAccountViewModel,_super);function UserAccountViewModel(userAccount){var _this=this;_super.call(this);this.isInRole=function(role){for(var i=0;i<_this.roles.length;i++){if(_this.roles[i].roleName===role){return true;}}return false;};this.hasPrivilege=function(privilegeName){var privilegeList=_this.privileges.filter(function(item){return item.name.toLowerCase().trim()==privilegeName.toLowerCase().trim();});return privilegeList.length>0;};if(userAccount){common.objects.automap(this,userAccount);if(userAccount.userAccountId==undefined){this.userAccountId=0;}this.originalUsername=userAccount.username;}else{this.isOnlineUser=false;}if(!this.securityQuestionId){this.securityQuestionId=0;}}Object.defineProperty(UserAccountViewModel.prototype,"isEmailChanged",{get:function(){return this.username!=this.originalUsername;},enumerable:true,configurable:true});Object.defineProperty(UserAccountViewModel.prototype,"isSecurityQuestionChanged",{get:function(){return this.securityQuestionId!=this.originalSecurityQuestionId;},enumerable:true,configurable:true});Object.defineProperty(UserAccountViewModel.prototype,"isSecurityAnswerChanged",{get:function(){return this.securityAnswer!=this.originalSecurityAnswer;},enumerable:true,configurable:true});Object.defineProperty(UserAccountViewModel.prototype,"IsOnlineUser",{get:function(){return this.isOnlineUser;},set:function(newIsOnlineUser){this.isOnlineUser=newIsOnlineUser;if(!newIsOnlineUser){this.securityQuestionId=0;this.securityAnswer="";this.resetPassword=false;this.sendActivationEmail=!this.isActivated;}},enumerable:true,configurable:true});Object.defineProperty(UserAccountViewModel.prototype,"InvalidEmail",{get:function(){return this.isEmailValid=this.username==null||this.username.trim()==="";},enumerable:true,configurable:true});Object.defineProperty(UserAccountViewModel.prototype,"invalidConfirmEmail",{get:function(){var isInvalidConfirmEmail=this.confirmEmail==null||this.confirmEmail.trim()==="";if(!isInvalidConfirmEmail){isInvalidConfirmEmail=this.username.trim().toLowerCase()!==this.confirmEmail.trim().toLowerCase();}return isInvalidConfirmEmail;},enumerable:true,configurable:true});Object.defineProperty(UserAccountViewModel.prototype,"InvalidEmails",{get:function(){return this.isEmailValid||this.isConfirmEmailValid;},enumerable:true,configurable:true});Object.defineProperty(UserAccountViewModel.prototype,"isResetPasswordDisabled",{get:function(){return this.sendActivationEmail||!this.isActivated||this.loanUserAccountId==0||this.isEmailChanged||this.isSecurityQuestionChanged||this.isSecurityAnswerChanged;},enumerable:true,configurable:true});Object.defineProperty(UserAccountViewModel.prototype,"invalidSecurityAnswer",{get:function(){return this.securityAnswer==null||this.securityAnswer.trim()==="";},enumerable:true,configurable:true});Object.defineProperty(UserAccountViewModel.prototype,"isModelValid",{get:function(){return this.isOnlineUser?!this.InvalidEmails&&!this.invalidSecurityAnswer:!this.InvalidEmails;},enumerable:true,configurable:true});Object.defineProperty(UserAccountViewModel.prototype,"fullName",{get:function(){var fullName=(this.firstName?this.firstName.trim():"")+" "+(this.middleName?this.middleName.trim()+" ":"")+(this.lastName?this.lastName.trim():"");return fullName.trim()?fullName:"";},enumerable:true,configurable:true});Object.defineProperty(UserAccountViewModel.prototype,"FilterUsername",{get:function(){if(!common.string.isNullOrWhiteSpace(this.username)&&lib.startsWith("newprospect",this.username)){return"";}return this.username;},enumerable:true,configurable:true});return UserAccountViewModel;})(srv.cls.UserAccountViewModel);cls.UserAccountViewModel=UserAccountViewModel;var PublicRecordViewModel=(function(_super){__extends(PublicRecordViewModel,_super);function PublicRecordViewModel(publicRecord,getBorrowerFullName){var _this=this;_super.call(this);this.getBorrowerFullName=getBorrowerFullName;this.initialize=function(publicRecord){if(publicRecord){common.objects.automap(_this,publicRecord);}if(_this.companyData){_this.companyData=new CompanyDataViewModel(_this.companyData,_this.getBorrowerFullName);}};this.hidden=false;this.includeInTotalAmount=function(publicRecord){if(publicRecord.publicRecordComment==="4"&&(publicRecord.type.indexOf("lien")>-1||publicRecord.type.indexOf("judgment")>-1)){publicRecord.includeInTotal=true;}else{publicRecord.includeInTotal=false;}};this.initialize(publicRecord);}Object.defineProperty(PublicRecordViewModel.prototype,"creditor",{get:function(){return this.companyData.companyName;},set:function(value){this.companyData.companyName=value;},enumerable:true,configurable:true});Object.defineProperty(PublicRecordViewModel.prototype,"balance",{get:function(){return this.amount;},set:function(value){this.amount=value;},enumerable:true,configurable:true});Object.defineProperty(PublicRecordViewModel.prototype,"payoffCommentId",{get:function(){return this.publicRecordComment;},set:function(value){this.publicRecordComment=value;},enumerable:true,configurable:true});Object.defineProperty(PublicRecordViewModel.prototype,"isUserAdded",{get:function(){return this.isUserEntry;},enumerable:true,configurable:true});Object.defineProperty(PublicRecordViewModel.prototype,"isPublicRecord",{get:function(){return true;},enumerable:true,configurable:true});Object.defineProperty(PublicRecordViewModel.prototype,"isLiability",{get:function(){return false;},enumerable:true,configurable:true});Object.defineProperty(PublicRecordViewModel.prototype,"isRemoved",{get:function(){return false;},set:function(value){},enumerable:true,configurable:true});Object.defineProperty(PublicRecordViewModel.prototype,"canEdit",{get:function(){return true;},enumerable:true,configurable:true});Object.defineProperty(PublicRecordViewModel.prototype,"isPayoffItem",{get:function(){return false;},enumerable:true,configurable:true});return PublicRecordViewModel;})(srv.cls.PublicRecordViewModel);cls.PublicRecordViewModel=PublicRecordViewModel;var LookupItem=(function(_super){__extends(LookupItem,_super);function LookupItem(text,value){_super.call(this);this.text=text;this.value=value;}LookupItem.fromLookupItem=function(src){var li=new LookupItem(src.text,src.value);li.selected=src.selected;li.disabled=src.disabled;li.contextFlags=src.contextFlags;return li;};return LookupItem;})(srv.cls.LookupItem);cls.LookupItem=LookupItem;var TitleInformationViewModel=(function(_super){__extends(TitleInformationViewModel,_super);function TitleInformationViewModel(titleInfo){_super.call(this);if(titleInfo){common.objects.automap(this,titleInfo);}else{if(!this.titleHeldIn){this.titleHeldIn=0;}}if(!this.mannerTitleHeld||this.mannerTitleHeld=="-1"){this.mannerTitleHeld="9";}}return TitleInformationViewModel;})(srv.cls.TitleInformationViewModel);cls.TitleInformationViewModel=TitleInformationViewModel;var PricingAdjustmentsViewModel=(function(_super){__extends(PricingAdjustmentsViewModel,_super);function PricingAdjustmentsViewModel(pricingAdjustments){_super.call(this);if(pricingAdjustments){common.objects.automap(this,pricingAdjustments);}}Object.defineProperty(PricingAdjustmentsViewModel.prototype,"InvestorPrice",{get:function(){return this.investorPrice;},set:function(value){this.investorPrice=(!this.isAmountValid(value))?0:value;this.calculateTotals(1);},enumerable:true,configurable:true});Object.defineProperty(PricingAdjustmentsViewModel.prototype,"LoanOfficerPrice",{get:function(){return this.loanOfficerPrice;},set:function(value){this.loanOfficerPrice=(!this.isAmountValid(value))?0:value;this.calculateTotals(2);},enumerable:true,configurable:true});Object.defineProperty(PricingAdjustmentsViewModel.prototype,"InvestorPurchasePrice",{get:function(){return this.investorPurchasePrice;},set:function(value){this.investorPurchasePrice=(!this.isAmountValid(value))?0:value;this.calculateTotals(3);},enumerable:true,configurable:true});Object.defineProperty(PricingAdjustmentsViewModel.prototype,"EnterprisePrice",{get:function(){return this.enterprisePrice;},set:function(value){this.enterprisePrice=value;},enumerable:true,configurable:true});Object.defineProperty(PricingAdjustmentsViewModel.prototype,"FinalLoanOfficerPrice",{get:function(){return this.finalLoanOfficerPrice;},set:function(value){this.finalLoanOfficerPrice=value;},enumerable:true,configurable:true});Object.defineProperty(PricingAdjustmentsViewModel.prototype,"FinalLoanOfficerPriceByLo",{get:function(){return this.finalLoanOfficerPriceByLo;},set:function(value){this.finalLoanOfficerPriceByLo=value;},enumerable:true,configurable:true});Object.defineProperty(PricingAdjustmentsViewModel.prototype,"FinalLoanOfficerPriceByDivision",{get:function(){return this.finalLoanOfficerPriceByDivision;},set:function(value){this.finalLoanOfficerPriceByDivision=value;},enumerable:true,configurable:true});Object.defineProperty(PricingAdjustmentsViewModel.prototype,"FinalLoanOfficerPriceByCompany",{get:function(){return this.finalLoanOfficerPriceByCompany;},set:function(value){this.finalLoanOfficerPriceByCompany=value;},enumerable:true,configurable:true});Object.defineProperty(PricingAdjustmentsViewModel.prototype,"FinalPurchasePrice",{get:function(){return this.finalPurchasePrice;},set:function(value){this.finalPurchasePrice=value;},enumerable:true,configurable:true});Object.defineProperty(PricingAdjustmentsViewModel.prototype,"Adjustments",{get:function(){if(this.adjustments!=null&&this.adjustments.length!=0){var len=this.adjustments.length;for(var i=0;i<len;i++){this.adjustments[i].value=this.isAmountValidOrMinus(this.adjustments[i].value)?this.adjustments[i].value:0;}}this.calculateTotals(4);return this.adjustments;},set:function(adj){if(adj!=null&&adj.length!=0){var len=adj.length;for(var i=0;i<len;i++){adj[i].value=this.isAmountValidOrMinus(adj[i].value)?adj[i].value:0;}}this.adjustments=adj;this.calculateTotals(4);},enumerable:true,configurable:true});PricingAdjustmentsViewModel.prototype.calculateTotals=function(secType){if(secType==4){this.calculateTotals(1);this.calculateTotals(2);this.calculateTotals(3);}var calcTotal=0;var calcTotalByLo=0;var calcTotalByDivision=0;var calcTotalByCompany=0;if(this.adjustments!=null&&this.adjustments.length!=0){var len=this.adjustments.length;for(var i=0;i<len;i++){if(this.adjustments[i].adjustmentSectionType==secType){if(!this.adjustments[i].isDeleted){if(this.isAmountValid(this.adjustments[i].value)){calcTotal+=Number(this.adjustments[i].value);if(secType==2){if(this.adjustments[i].paidBy==1){calcTotalByLo+=(!this.isAmountValid(this.adjustments[i].value))?0:Number(this.adjustments[i].value);}if(this.adjustments[i].paidBy==2){calcTotalByDivision+=(!this.isAmountValid(this.adjustments[i].value))?0:Number(this.adjustments[i].value);}if(this.adjustments[i].paidBy==3){calcTotalByCompany+=(!this.isAmountValid(this.adjustments[i].value))?0:Number(this.adjustments[i].value);}}}}}}}if(secType==1){calcTotal+=(!this.isAmountValid(this.investorPrice))?0:Number(this.investorPrice);this.enterprisePrice=calcTotal;this.loanOfficerPrice=this.enterprisePrice;}if(secType==2){calcTotal+=(!this.isAmountValid(this.loanOfficerPrice))?0:Number(this.loanOfficerPrice);this.finalLoanOfficerPrice=calcTotal;this.finalLoanOfficerPriceByLo=calcTotalByLo;this.finalLoanOfficerPriceByDivision=calcTotalByDivision;this.finalLoanOfficerPriceByCompany=calcTotalByCompany;}if(secType==3){calcTotal+=(!this.isAmountValid(this.investorPurchasePrice))?0:Number(this.investorPurchasePrice);this.finalPurchasePrice=calcTotal;}};PricingAdjustmentsViewModel.prototype.isAmountValidOrMinus=function(amount){return this.isAmountValid(amount)||(amount.toString()=="-");};PricingAdjustmentsViewModel.prototype.isAmountValid=function(amount){return amount!=null&&!isNaN(parseFloat(amount));};return PricingAdjustmentsViewModel;})(srv.cls.PricingAdjustmentsViewModel);cls.PricingAdjustmentsViewModel=PricingAdjustmentsViewModel;var AdjustmentsViewModel=(function(_super){__extends(AdjustmentsViewModel,_super);function AdjustmentsViewModel(adjustment){_super.call(this);this.firstLoad=true;this.orderBy=0;this.newAdjustment=false;this.hasSubType=false;this.hasPaidByType=false;this.orderAdjustmentSet=false;this.sortingNotRequired=false;if(adjustment){common.objects.automap(this,adjustment);}else{this.value=0;this.calculateValue=0;}}Object.defineProperty(AdjustmentsViewModel.prototype,"CalculateValue",{get:function(){return this.calculateValue;},set:function(newValue){this.value=((!this.isAmountValid(newValue))?0:newValue)*100/this.totalLoanAmount;this.calculateValue=newValue;},enumerable:true,configurable:true});AdjustmentsViewModel.prototype.isAmountValid=function(amount){return amount!=null&&!isNaN(parseFloat(amount));};return AdjustmentsViewModel;})(srv.cls.AdjustmentsViewModel);cls.AdjustmentsViewModel=AdjustmentsViewModel;var SellSideViewModel=(function(_super){__extends(SellSideViewModel,_super);function SellSideViewModel(){_super.apply(this,arguments);}return SellSideViewModel;})(srv.cls.SellSideInformationViewModel);cls.SellSideViewModel=SellSideViewModel;var LockingPricingLookupViewModel=(function(_super){__extends(LockingPricingLookupViewModel,_super);function LockingPricingLookupViewModel(){_super.apply(this,arguments);}return LockingPricingLookupViewModel;})(srv.cls.LockingPricingLookupViewModel);cls.LockingPricingLookupViewModel=LockingPricingLookupViewModel;var PhoneViewModel=(function(_super){__extends(PhoneViewModel,_super);function PhoneViewModel(phoneType){_super.call(this);if(phoneType){if(phoneType=="preferred"){this.type="1";this.isPrefrred=true;}else{if(phoneType=="alternate"){this.type="2";this.isPrefrred=false;}}}else{if((this.type==null||this.type==undefined||this.type=="")&&this.isPrefrred){this.type="1";}else{if((this.type==null||this.type==undefined||this.type=="")&&!this.isPrefrred){this.type="2";}}}}return PhoneViewModel;})(srv.cls.PhoneViewModel);cls.PhoneViewModel=PhoneViewModel;var RealEstateViewModel=(function(_super){__extends(RealEstateViewModel,_super);function RealEstateViewModel(realEstate){_super.call(this);if(realEstate){common.objects.automap(this,realEstate);}this.initialize();}RealEstateViewModel.prototype.initialize=function(){this.addressForDropDown=[];};return RealEstateViewModel;})(srv.cls.RealEstateViewModel);cls.RealEstateViewModel=RealEstateViewModel;var AgentContactViewModel=(function(_super){__extends(AgentContactViewModel,_super);function AgentContactViewModel(agentContact){_super.call(this);if(agentContact){common.objects.automap(this,agentContact);}}return AgentContactViewModel;})(srv.cls.AgentContactViewModel);cls.AgentContactViewModel=AgentContactViewModel;var SecureLinkAuthenticationViewModel=(function(_super){__extends(SecureLinkAuthenticationViewModel,_super);function SecureLinkAuthenticationViewModel(){_super.apply(this,arguments);}return SecureLinkAuthenticationViewModel;})(srv.cls.SecureLinkAuthenticationViewModel);cls.SecureLinkAuthenticationViewModel=SecureLinkAuthenticationViewModel;var SecureLinkBorrowerViewModel=(function(_super){__extends(SecureLinkBorrowerViewModel,_super);function SecureLinkBorrowerViewModel(){_super.apply(this,arguments);}return SecureLinkBorrowerViewModel;})(srv.cls.SecureLinkBorrowerViewModel);cls.SecureLinkBorrowerViewModel=SecureLinkBorrowerViewModel;var DocumentsViewModel=(function(_super){__extends(DocumentsViewModel,_super);function DocumentsViewModel(document){_super.call(this);this.isInEditMode=false;this.isItemClicked=false;this.isDeleted=false;this.isUserEntry=false;this.isAdded=false;this.isCompleted=false;if(document){common.objects.automap(this,document);}}return DocumentsViewModel;})(srv.cls.DocumentsViewModel);cls.DocumentsViewModel=DocumentsViewModel;var DocVaultDocumentViewModel=(function(_super){__extends(DocVaultDocumentViewModel,_super);function DocVaultDocumentViewModel(docVaultDocument){_super.call(this);this.shouldImport=false;if(docVaultDocument){common.objects.automap(this,docVaultDocument);}}return DocVaultDocumentViewModel;})(srv.cls.DocVaultDocumentViewModel);cls.DocVaultDocumentViewModel=DocVaultDocumentViewModel;var MilestoneStatus=(function(){function MilestoneStatus(){var _this=this;this.setDefault=function(isWholeSale,homebuyingType){if(homebuyingType==3){return 4;}else{if(isWholeSale){return 10;}else{return 1;}}};this.setStatus=function(isWholeSale,allLoanAppsCompleted,sixPiecesAcquired,homeBuyingType){if(sixPiecesAcquired){if(allLoanAppsCompleted){return 15;}else{return 2;}}else{return _this.setDefault(isWholeSale,homeBuyingType);}};}return MilestoneStatus;})();cls.MilestoneStatus=MilestoneStatus;var ManageUserAccountsViewModel=(function(_super){__extends(ManageUserAccountsViewModel,_super);function ManageUserAccountsViewModel(manageUserAccount){_super.call(this);if(manageUserAccount){common.objects.automap(this,manageUserAccount);}this.verifyBorrowerName=false;this.verifyCoBorrowerName=false;this.verifySubjectPropertyAddress=false;this.verifySecurityQuestion=false;}Object.defineProperty(ManageUserAccountsViewModel.prototype,"isEmailVisible",{get:function(){return !(this.isJointAccount&&this.userAccount.isCoBorrower&&!this.isSeparateAccount)||this.coBorrowerAccountOptionId!=1;},enumerable:true,configurable:true});Object.defineProperty(ManageUserAccountsViewModel.prototype,"isConfirmEmailVisible",{get:function(){return this.isEmailVisible;},enumerable:true,configurable:true});Object.defineProperty(ManageUserAccountsViewModel.prototype,"isJointAccountMessageVisible",{get:function(){return this.isJointAccount&&this.userAccount.isCoBorrower&&!this.isSeparateAccount&&this.coBorrowerAccountOptionId==1;},enumerable:true,configurable:true});Object.defineProperty(ManageUserAccountsViewModel.prototype,"isOnlineUserVisible",{get:function(){return this.isEmailVisible;},enumerable:true,configurable:true});Object.defineProperty(ManageUserAccountsViewModel.prototype,"isPasswordVisible",{get:function(){return false;},enumerable:true,configurable:true});Object.defineProperty(ManageUserAccountsViewModel.prototype,"isQuestionAndAnswerVisible",{get:function(){return this.isSecurityVisible||(this.userAccount.userAccountId==0&&!(this.isJointAccount&&this.userAccount.isCoBorrower))||(this.userAccount.isCoBorrower&&this.isSeparateAccount&&((this.userAccount.jointAccountId!=0&&this.userAccount.jointAccountId!=null&&this.userAccount.jointAccountId==this.borrowerUserAccountId)&&this.userAccount.userAccountId!=0||this.userAccount.userAccountId==0));},enumerable:true,configurable:true});Object.defineProperty(ManageUserAccountsViewModel.prototype,"isResendActivationVisible",{get:function(){return(this.userAccount.userAccountId!=0&&!this.userAccount.isCoBorrower||(this.userAccount.isCoBorrower&&!this.isQuestionAndAnswerVisible&&this.isSeparateAccount))&&!this.userAccount.isActivated&&!this.isSecurityVisible;},enumerable:true,configurable:true});Object.defineProperty(ManageUserAccountsViewModel.prototype,"isResendValidationVisible",{get:function(){return this.userAccount.userAccountId!=0&&this.userAccount.isActivated&&this.sendVerification;},enumerable:true,configurable:true});Object.defineProperty(ManageUserAccountsViewModel.prototype,"isActionButtonVisible",{get:function(){return this.isEmailVisible;},enumerable:true,configurable:true});Object.defineProperty(ManageUserAccountsViewModel.prototype,"isVerifyAccountInformationVisible",{get:function(){return this.userAccount.isActivated&&this.automaticallyOpen&&this.isEmailVisible&&this.userAccount.isOnlineUser;},enumerable:true,configurable:true});Object.defineProperty(ManageUserAccountsViewModel.prototype,"isVerifyBorrowerNameVisible",{get:function(){return this.userAccount.username&&this.userAccount.confirmEmail&&this.userAccount.username.toLowerCase()==this.userAccount.confirmEmail.toLowerCase();},enumerable:true,configurable:true});Object.defineProperty(ManageUserAccountsViewModel.prototype,"isVerifyCoBorrowerNameVisible",{get:function(){return this.verifyBorrowerName&&!common.string.isNullOrWhiteSpace(this.coBorrowerFirstName)&&!common.string.isNullOrWhiteSpace(this.coBorrowerLastName);},enumerable:true,configurable:true});Object.defineProperty(ManageUserAccountsViewModel.prototype,"isVerifySubjectPropertyAddressVisible",{get:function(){return this.recentSubjectPropertyAddress.zipCode!=null&&((this.isVerifyCoBorrowerNameVisible&&this.verifyCoBorrowerName)||(!this.isVerifyCoBorrowerNameVisible&&this.verifyBorrowerName));},enumerable:true,configurable:true});Object.defineProperty(ManageUserAccountsViewModel.prototype,"isVerifySecurityQuestionVisible",{get:function(){return this.isVerifySubjectPropertyAddressVisible&&this.verifySubjectPropertyAddress&&!common.string.isNullOrWhiteSpace(this.userAccount.securityAnswer);},enumerable:true,configurable:true});Object.defineProperty(ManageUserAccountsViewModel.prototype,"VerifyBorrowerName",{get:function(){return this.verifyBorrowerName;},set:function(value){if(!value){this.VerifyCoBorrowerName=value;}this.verifyBorrowerName=value;},enumerable:true,configurable:true});Object.defineProperty(ManageUserAccountsViewModel.prototype,"VerifyCoBorrowerName",{get:function(){return this.verifyCoBorrowerName;},set:function(value){if(!value){this.VerifySubjectPropertyAddress=value;}this.verifyCoBorrowerName=value;},enumerable:true,configurable:true});Object.defineProperty(ManageUserAccountsViewModel.prototype,"VerifySubjectPropertyAddress",{get:function(){return this.verifySubjectPropertyAddress;},set:function(value){if(!value){this.VerifySecurityQuestion=value;}this.verifySubjectPropertyAddress=value;},enumerable:true,configurable:true});Object.defineProperty(ManageUserAccountsViewModel.prototype,"VerifySecurityQuestion",{get:function(){return this.verifySecurityQuestion;},set:function(value){this.verifySecurityQuestion=value;},enumerable:true,configurable:true});Object.defineProperty(ManageUserAccountsViewModel.prototype,"securityQuestion",{get:function(){var self=this;return this.securityQuestions.filter(function(item){return item.value==new String(self.userAccount.securityQuestion);})[0].text;},enumerable:true,configurable:true});Object.defineProperty(ManageUserAccountsViewModel.prototype,"isEmailDisabled",{get:function(){return this.userAccount.userAccountId==this.originalUserAccountId&&this.userAccount.isActivated;},enumerable:true,configurable:true});Object.defineProperty(ManageUserAccountsViewModel.prototype,"actionButtonText",{get:function(){if(this.isVerifyAccountInformationVisible){return srv.manageUserAccountButtonActions.connectAccount;}else{return(!this.userAccount.userAccountId||this.userAccount.userAccountId==0)&&!this.isJointAccount||(this.isJointAccount&&this.userAccount.isCoBorrower)?srv.manageUserAccountButtonActions.createAccount:srv.manageUserAccountButtonActions.updateAccount;}},enumerable:true,configurable:true});return ManageUserAccountsViewModel;})(srv.cls.ManageUserAccountsViewModel);cls.ManageUserAccountsViewModel=ManageUserAccountsViewModel;var DisclosureStatusDetailsViewModel=(function(_super){__extends(DisclosureStatusDetailsViewModel,_super);function DisclosureStatusDetailsViewModel(disclosureStatusDetailsViewModel){_super.call(this);if(disclosureStatusDetailsViewModel){common.objects.automap(this,disclosureStatusDetailsViewModel);}}return DisclosureStatusDetailsViewModel;})(srv.cls.DisclosureStatusDetailsViewModel);cls.DisclosureStatusDetailsViewModel=DisclosureStatusDetailsViewModel;var FHACalculatorRequestViewModel=(function(_super){__extends(FHACalculatorRequestViewModel,_super);function FHACalculatorRequestViewModel(FHAScenarioViewModel,allowableBorrowerPaidClosingCosts,prepaidExpenses,lenderCreditforClosingCostsAndPrepaids,countyLoanLimit,baseLoanAmount,userAccountId){_super.call(this);this.fhaScenario=FHAScenarioViewModel;this.allowableBorrowerPaidClosingCosts=allowableBorrowerPaidClosingCosts;this.prepaidExpenses=prepaidExpenses;this.lenderCreditforClosingCostsAndPrepaids=lenderCreditforClosingCostsAndPrepaids;this.countyLoanLimit=countyLoanLimit;this.baseLoanAmount=baseLoanAmount;this.userAccountId;}return FHACalculatorRequestViewModel;})(srv.cls.FHACalculatorRequest);cls.FHACalculatorRequestViewModel=FHACalculatorRequestViewModel;var VACalculatorRequestViewModel=(function(_super){__extends(VACalculatorRequestViewModel,_super);function VACalculatorRequestViewModel(existingVALoanBalance,eehiCosts,veteranPaymentCash,discountPoints,originationFee,vaFundingFee,totalClosingCosts){_super.call(this);this.existingVALoanBalance=existingVALoanBalance;this.eehiCosts=eehiCosts;this.veteranPaymentCash=veteranPaymentCash;this.discountPoints=discountPoints;this.originationFee=originationFee;this.vaFundingFee=vaFundingFee;this.totalClosingCosts=totalClosingCosts;}return VACalculatorRequestViewModel;})(srv.cls.VACalculatorRequest);cls.VACalculatorRequestViewModel=VACalculatorRequestViewModel;var LoanDateHistoryViewModel=(function(_super){__extends(LoanDateHistoryViewModel,_super);function LoanDateHistoryViewModel(dateHistory){_super.call(this);if(dateHistory){common.objects.automap(this,dateHistory);}}return LoanDateHistoryViewModel;})(srv.cls.LoanDateHistoryViewModel);cls.LoanDateHistoryViewModel=LoanDateHistoryViewModel;var CopyLoanViewModel=(function(_super){__extends(CopyLoanViewModel,_super);function CopyLoanViewModel(_borrowerIds,_copySubjectPropertyFlag,_creditReportIds,_creditReportIncluded,_loanApplicationIds,_loanId,_loanNumber,_newClosingDate,_newLienPositon,_newLoanPurpose,_newMainApplicationId,_subjectPropertyId,_userAccountId){_super.call(this);this.borrowerIds=_borrowerIds;this.copySubjectPropertyFlag=_copySubjectPropertyFlag;this.creditReportIds=_creditReportIds;this.creditReportIncluded=_creditReportIncluded;this.loanApplicationIds=_loanApplicationIds;this.loanId=_loanId;this.loanNumber=_loanNumber;this.newClosingDate=_newClosingDate;this.newLienPosition=_newLienPositon;this.newLoanPurpose=_newLoanPurpose;this.newMainApplicationId=_newMainApplicationId;this.subjectPropertyId=_subjectPropertyId;this.userAccountId=_userAccountId;}return CopyLoanViewModel;})(srv.cls.CopyLoanViewModel);cls.CopyLoanViewModel=CopyLoanViewModel;})(cls||(cls={}));var __extends=this.__extends||function(d,b){for(var p in b){if(b.hasOwnProperty(p)){d[p]=b[p];}}function __(){this.constructor=d;}__.prototype=b.prototype;d.prototype=new __();};var cls;(function(cls){var LoanViewModel=(function(_super){__extends(LoanViewModel,_super);function LoanViewModel(loan,$filter,isWholeSale){var _this=this;if(isWholeSale===void 0){isWholeSale=false;}_super.call(this);this.loan=loan;this.$filter=$filter;this.isWholeSale=isWholeSale;this.recoupmentPeriodCalculated=new srv.cls.RecoupmentPeriodResponse();this.prepareSave=function(){var foo=_this.getTransactionInfo;foo().prepareSave();};this.getPropertyMap=function(){var ti=_this.getTransactionInfo();if(ti&&ti.property){return ti.property;}throw new Error("LoanExtendedViewModel: getPropertyMap is not available");};this.hasTransactionInfo=function(){return(!!_this.getTransactionInfo&&!!_this.getTransactionInfo());};this.getTransactionInfoRef=function(){if(_this.hasTransactionInfo()){return _this.getTransactionInfo();}else{return null;}};this.hasTransactionInfoLoanApplication=function(){return(_this.hasTransactionInfo()&&!!_this.getTransactionInfoRef().loanApplication);};this.getTransactionInfoLoanApplication=function(){if(_this.hasTransactionInfoLoanApplication()){return _this.getTransactionInfoRef().loanApplication;}return new cls.Map();};this.getLoanApplications=function(excludeActive){if(excludeActive===void 0){excludeActive=false;}var loanApplications=[];if(_this.hasTransactionInfoLoanApplication()){loanApplications=_this.getTransactionInfoLoanApplication().getValues();}if(excludeActive){if(!!loanApplications&&loanApplications.length>0){loanApplications=lib.filter(loanApplications,function(la){return la.loanApplicationId!=_this.active.loanApplicationId;});}}return loanApplications;};this.vaTabEnabled=function(){return _this.financialInfo&&_this.financialInfo.mortgageType==4;};this.setLoanApplications=function(loanApplicationList){if(!loanApplicationList||!_this.hasTransactionInfoLoanApplication()){return;}_this.getTransactionInfoLoanApplication().mapAll(loanApplicationList);};this.getActiveApplication=function(){return _this.active;};this.doesYourAgentAlsoRepresentsSeller=false;this.remainingOwnershipCalculation=function(excludeActiveLoanApplication){if(excludeActiveLoanApplication===void 0){excludeActiveLoanApplication=true;}var loanApplications=_this.getLoanApplications(excludeActiveLoanApplication);var investmentPropertyLoanApplications=lib.filter(loanApplications,function(la){return la.OccupancyType==2;});var totalOwnership=0;lib.forEach(investmentPropertyLoanApplications,function(la){return totalOwnership+=la.OwnershipPercentage;});var remainingOwnership=0;remainingOwnership=100-totalOwnership;if(remainingOwnership<0){return 0;}else{return remainingOwnership;}};this.ownershipLastThreeYears=function(){if(_this.active&&_this.active.occupancyType==1&&_this.loanPurposeType==1){return 1;}if(_this.active&&_this.active.occupancyType==1&&_this.loanPurposeType==2){return 0;}return null;};this.getCombinedPledgedAssetsForAll1003s=function(){var loanApplications=_this.getLoanApplications(false);var combinedPledgedAssetsForAll1003s=[];angular.forEach(loanApplications,function(loanApp){if(loanApp){combinedPledgedAssetsForAll1003s=combinedPledgedAssetsForAll1003s.concat(loanApp.getCombinedPledgedAssets());}});return combinedPledgedAssetsForAll1003s;};this.areSixPiecesAcquiredForCurrentLoanApplication=function(){return _this.allPiecesAcquiredForCurrentLoanApplication()&&_this.homeBuyingType!=3;};this.allPiecesAcquiredForCurrentLoanApplication=function(){return _this.active.areSixPiecesOfLoanApplicationCompleted()&&_this.isPropertyPieceAcquired();};this.isLoanApplicationCompleted=function(loanApplication){return loanApplication.isLoanApplicationCompleted(_this.getSubjectProperty(),_this.loanPurposeType,_this.loanAmount,!_this.active.getCoBorrower().getCurrentAddress().isSameAsPrimaryBorrowerCurrentAddress,_this.financialInfo.downPaymentTypeCode,_this.areSixPiecesAcquiredForCurrentLoanApplication());};this.disableRunCreditButton=function(){if(!angular.isDefined(_this.subjectProperty)){return true;}if(_this.subjectProperty.stateId!=46){return false;}if(_this.allPiecesAcquiredForCurrentLoanApplication()&&_this.subjectProperty.stateId==46){return false;}return true;};this.allLoanAppsCompleted=function(){var allLoanAppsCompleted=true;for(var i=0;i<_this.getLoanApplications().length;i++){var loanApplication=_this.getLoanApplications()[i];var loanAppCompleted=_this.isLoanApplicationCompleted(loanApplication);allLoanAppsCompleted=allLoanAppsCompleted&&loanAppCompleted;}return allLoanAppsCompleted;};this.areSixPiecesAcquiredForAllLoanApplications=function(){_this.sixPiecesAcquiredForAllLoanApplications=true;var milestoneStatus=new cls.MilestoneStatus();if(!_this.getLoanApplications()||_this.getLoanApplications().length==0||_this.homeBuyingType==3){_this.sixPiecesAcquiredForAllLoanApplications=false;}else{var isPropertyPieceAcquired=_this.isPropertyPieceAcquired();var allLoanAppsCompleted=true;for(var i=0;i<_this.getLoanApplications().length;i++){var loanApplication=_this.getLoanApplications()[i];var loanAppCompleted=_this.isLoanApplicationCompleted(loanApplication);allLoanAppsCompleted=allLoanAppsCompleted&&loanAppCompleted;if(!(isPropertyPieceAcquired&&loanApplication.isPersonalPieceAcquired()&&loanApplication.isIncomePieceAcquired())){_this.sixPiecesAcquiredForAllLoanApplications=false;}}}_this.checkDisclosureStatusRules();if(!_this.isMilestoneStatusManual&&_this.currentMilestone!=3&&_this.currentMilestone!=9&&_this.currentMilestone!=14){_this.currentMilestone=milestoneStatus.setStatus(_this.isWholeSale,allLoanAppsCompleted,_this.sixPiecesAcquiredForAllLoanApplications,_this.homeBuyingType);}return _this.sixPiecesAcquiredForAllLoanApplications;};this.areLoanAntiSteeringOptionsCompleted=function(model){return model.firstInterestRate&&(model.firstTotalPoints||model.firstTotalPoints==0)&&model.secondInterestRate&&(model.secondTotalPoints||model.secondTotalPoints==0)&&model.thirdInterestRate&&(model.thirdTotalPoints||model.thirdTotalPoints==0);};this.checkDisclosureStatusRules=function(){var loanNumberNotSet=!_this.loanNumber||_this.loanNumber=="Pending";if(loanNumberNotSet&&(!_this.applicationDate||moment("0001-01-01").diff(moment(_this.applicationDate))==0)){var sixPiecesAcquired=_this.sixPiecesAcquiredForAllLoanApplications;var action=function(loanApp){return _this.updateDisclosureStatus(loanApp,sixPiecesAcquired);};lib.forEach(_this.getLoanApplications(),action);}};this.updateDisclosureStatusForAllLoanApplications=function(disclosureStatus){var loanApps=_this.getLoanApplications();for(var i=0;i<loanApps.length;i++){loanApps[i].disclosureStatusDetails.disclosureStatus=disclosureStatus;}};this.updateComplianceCheckStatusForAllLoanApplications=function(complianceCheckStatus){var loanApps=_this.getLoanApplications();for(var i=0;i<loanApps.length;i++){loanApps[i].complianceCheckStatus=complianceCheckStatus;}};this.updateComplianceCheckStatusForLoanApplication=function(complianceCheckStatus,loanApplicationId){var loanApps=_this.getLoanApplications();for(var i=0;i<loanApps.length;i++){if(loanApps[i].loanApplicationId==loanApplicationId){loanApps[i].complianceCheckStatus=complianceCheckStatus;}}};this.updateDisclosureStatus=function(loanApp,sixPiecesAcquired){if(!loanApp.disclosureStatusDetails){loanApp.disclosureStatusDetails={};}if(sixPiecesAcquired){loanApp.disclosureStatusDetails.disclosureStatus=2;loanApp.disclosureStatusDetails.disclosureStatusText="Initial Disclosure Required";loanApp.disclosureStatusDetails.disclosureStatusReasons=["The Loan Application Date will be set for "+moment().format("MM/DD/YY")];loanApp.alertPanelVisible=true;}else{loanApp.disclosureStatusDetails.disclosureStatus=1;loanApp.disclosureStatusDetails.disclosureStatusText="";loanApp.disclosureStatusDetails.disclosureStatusReasons=[];loanApp.alertPanelVisible=false;}};this.isValidForSave=function(){var retVal=true;for(var i=0;i<_this.getLoanApplications().length;i++){if(!_this.getLoanApplications()[i].isValidForSave()){retVal=false;_this.getLoanApplications()[i].isFirstAndLastNameEnteredForBorrowers=false;}else{_this.getLoanApplications()[i].isFirstAndLastNameEnteredForBorrowers=true;}}return retVal;};this.stateExist=function(states){for(var i=0;i<states.length;i++){if(_this.getSubjectProperty().stateId!=null&&states[i].value==(_this.getSubjectProperty().stateId).toString()){return true;}}return false;};this.getLicencedStates=function(appData){if(!_this.conciergeId){return appData.lookup.statesForSkyline;}if(_this.conciergeId==appData.currentUserId){if(_this.getSubjectProperty().stateId!=null&&!_this.stateExist(appData.lookup.statesForCurrentUser)){_this.getSubjectProperty().clearAddress(true);}return appData.lookup.statesForCurrentUser;}var licesesForLO=[];for(var i=0;i<appData.licenses.length;i++){if(appData.licenses[i].userAccountId==_this.conciergeId){licesesForLO.push(appData.licenses[i]);}}var licensedStatesForLO=[];for(var i=0;i<licesesForLO.length;i++){for(var j=0;j<appData.lookup.states.length;j++){if(licesesForLO[i].stateId==appData.lookup.states[j].value){licensedStatesForLO.push(appData.lookup.states[j]);}}}if(!_this.stateExist(licensedStatesForLO)){_this.getSubjectProperty().clearAddress(true);}return licensedStatesForLO;};this.getLoanApplication=function(loanApplicationId){if(_this.getLoanApplications()){for(var i=0;i<_this.getLoanApplications().length;i++){_this.setPrimaryLoanApplication(_this.getLoanApplications()[i]);if(_this.getLoanApplications()[i].loanApplicationId==loanApplicationId){return _this.getLoanApplications()[i];}}}return null;};this.updateLoanApplication=function(loanApplication){if(loanApplication&&_this.hasTransactionInfoLoanApplication()){var loanApplicationExisting=_this.getTransactionInfoLoanApplication().replace(loanApplication);return !!loanApplicationExisting;}return false;};this.downPaymentAmount=function(amount){if(_this.loan.loanPurposeType==1){if(!angular.isDefined(amount)){return _this.primary.getBorrower().filterDownPaymentAsset(_this.getSubjectProperty().purchasePrice-_this.loanAmount)[0].monthlyAmount;}else{_this.primary.getBorrower().filterDownPaymentAsset()[0].monthlyAmount=amount;}}};this.downPaymentPercentage=function(){var retVal;if(_this.loan.loanPurposeType==1){var downPayment=_this.primary.getBorrower().filterDownPaymentAsset(_this.getSubjectProperty().purchasePrice-_this.loanAmount)[0].monthlyAmount;if(_this.getSubjectProperty().purchasePrice&&downPayment){retVal=(downPayment/_this.getSubjectProperty().purchasePrice)*100;}}return retVal;};this.getFirstMortgageHolder=function(){var firstMortgageHolder="";if(_this.primary.getBorrower().getLiabilities()&&_this.primary.getBorrower().getLiabilities().length>0){var asset=_this.primary.getBorrower().getLiabilities().filter(function(liability){return liability.getProperty()&&liability.lienPosition&&liability.lienPosition==1&&liability.getProperty().isSubjectProperty;});if(asset&&asset.length>0&&asset[0].companyData.companyName){firstMortgageHolder=asset[0].companyData.companyName;}}return firstMortgageHolder;};this.getLoanLienPositions=function(){var loanLienPositions="1st";return loanLienPositions;};this.getFinancialsTotal=function(loanApplication,typeOfTotal){return _this.getAssetsTotals(loanApplication.getBorrower().getFinancials(),loanApplication.getCoBorrower().getFinancials(),loanApplication.getCombinedAssetsFinancials(),typeOfTotal);};this.getAssetsTotals=function(borrowerAssets,coBorrowerAssets,combinedAssets,typeOfTotal){var total=0;switch(typeOfTotal){case"borrower":total=_this.calculateAssetsTotal(borrowerAssets);break;case"coborrower":total=_this.calculateAssetsTotal(coBorrowerAssets);break;case"bothForBorrowerAndCoborrower":total=_this.calculateAssetsTotal(combinedAssets);}return total;};this.calculateAssetsTotal=function(assets){var total=0;for(var i=0;i<assets.length;i++){if(!assets[i].isRemoved&&assets[i].monthlyAmount){total+=parseFloat(assets[i].monthlyAmount.toString());}}return total;};this.getMiscExpensesTotal=function(loanApplication,borrower){var total=0,msicExpanses;if(!loanApplication){loanApplication=_this.active;}msicExpanses=borrower?borrower.getMiscDebts():loanApplication.getCombinedMiscDebts();if(!msicExpanses){return total;}for(var i=0;i<msicExpanses.length;i++){if(!msicExpanses[i].isRemoved&&msicExpanses[i].amount){total+=parseFloat(msicExpanses[i].amount);}}return total;};this.isIntentToProceedDateSet=function(){if(!_this.primary){return false;}if(_this.primary.getBorrower().eApprovalConfirmation&&_this.primary.getBorrower().eApprovalConfirmation.confirmationCodeConfirmed){if(_this.primary.isSpouseOnTheLoan){if(_this.primary.getCoBorrower().eApprovalConfirmation&&_this.primary.getCoBorrower().eApprovalConfirmation.confirmationCodeConfirmed){return true;}return false;}return true;}return false;};this.getAutomobilesTotal=function(loanApplication,typeOfTotal){return _this.getAssetsTotals(loanApplication.getBorrower().getAutomobiles(),loanApplication.getCoBorrower().getAutomobiles(),loanApplication.getCombinedAssetsAutomobiles(),typeOfTotal);};this.separateMiscDebts=function(borrowerCheckedYes,coBorrowerCheckedYes){var miscDebtCopy;var newMiscDebt;var groupedMiscDebts=(_.groupByMulti(_this.getActiveApplication().getCombinedMiscDebts().filter(function(item){return !item.isRemoved&&(!item.isDefaultValue||item.isDefaultValue===undefined||item.payee!="");}),["typeId","payee"]))[1];for(var key in groupedMiscDebts){if(groupedMiscDebts[key].length==1){miscDebtCopy=angular.copy(groupedMiscDebts[key][0]);newMiscDebt=new cls.MiscellaneousDebtViewModel();newMiscDebt.isCoBorrower=!miscDebtCopy.isCoBorrower;newMiscDebt.typeId=1;newMiscDebt.amount=0;newMiscDebt.payee=miscDebtCopy.payee;newMiscDebt.isUserEntry=true;newMiscDebt.monthsLeft=miscDebtCopy.monthsLeft;newMiscDebt.isRemoved=true;if(newMiscDebt.isCoBorrower==false&&borrowerCheckedYes){_this.getActiveApplication().getBorrower().addMiscDebts(newMiscDebt);}else{if(newMiscDebt.isCoBorrower==true&&coBorrowerCheckedYes){_this.getActiveApplication().getCoBorrower().addMiscDebts(newMiscDebt);}}groupedMiscDebts[key].push(newMiscDebt);}}return groupedMiscDebts;};this.getDefaultRowChildAlimony=function(){return(_.groupByMulti(_this.getActiveApplication().getCombinedMiscDebts().filter(function(item){return item.isDefaultValue;}),["typeId","payee"]))[1];};this.updateDefaultStatus=function(){var grouped=(_.groupByMulti(_this.getActiveApplication().getCombinedMiscDebts().filter(function(item){return item.isDefaultValue;}),["typeId","payee"]))[1];for(var key in grouped){grouped[key][0].isDefaultValue=false;if(grouped[key][1]!=undefined){grouped[key][1].isDefaultValue=false;}}};this.getLifeInsuranceTotal=function(loanApplication,typeOfTotal){return _this.getAssetsTotals(loanApplication.getBorrower().getLifeInsurance(),loanApplication.getCoBorrower().getLifeInsurance(),loanApplication.getCombinedAssetsLifeInsurence(),typeOfTotal);};this.getTotalLiquidAssets=function(){return _this.getLifeInsuranceTotal(_this.active,"bothForBorrowerAndCoborrower")+_this.getFinancialsTotal(_this.active,"bothForBorrowerAndCoborrower");};this.getTotalAssetsWithoutDownPayment=function(){var flg="bothForBorrowerAndCoborrower";var total=0;total+=_this.getLifeInsuranceTotal(_this.active,flg);total+=_this.getFinancialsTotal(_this.active,flg);total+=_this.getAutomobilesTotal(_this.active,flg);var properties=_this.getPropertyMap().getValues();for(var i=0;i<properties.length;i++){if(!!properties[i]&&!!properties[i].currentEstimatedValue&&properties[i].currentEstimatedValue>0&&(_this.loanPurposeType==2||!properties[i].isSubjectProperty)&&properties[i].loanApplicationId===_this.active.loanApplicationId){total+=properties[i].currentEstimatedValue;}}return total;};this.getHoaPropertyExpense=function(){return _this.$filter("filter")(_this.getSubjectProperty().propertyExpenses,{type:"4"},true)[0];};this.getTotalEstimatedReserves=function(cost){return(cost.noOfMonthlyReserves*Math.round(_this.getMonthlyAmount(cost)*10000)/10000)*(cost.impounded?1:0);};this.getMonthlyAmount=function(cost){if(cost.amount==""){cost.amount=0;}if(cost.factor>0&&_this.loanPurposeType===1){if(cost.hudLineNumber==1002){cost.amount=Math.round(cost.factor*_this.loanAmount/12)*0.12;}else{if(cost.hudLineNumber==1004){cost.amount=Math.round(cost.factor*_this.getSubjectProperty().purchasePrice/12)*0.12;}}}cost.monthlyAmount=cost.paymentType=="Annual"?cost.amount/12:cost.amount;return cost.monthlyAmount;};this.getHomeBuyingTypeText=function(){var retVal;switch(_this.homeBuyingType){case 1:retVal="Offer Accepted";break;case 2:retVal="Offer Pending Found A House";break;case 3:retVal="Get PreApproved";break;case 4:retVal="What Can I Afford";break;default:retVal="";break;}return retVal;};this.getLoanPurposeTypeText=function(){var retVal="None";switch(_this.loanPurposeType){case 1:retVal="Purchase";break;case 2:retVal="Refinance";break;}return retVal;};this.switchActiveLoanApplication=function(loanApp){_this.active=loanApp;};this.isPropertyPieceAcquired=function(){var retVal=false;retVal=(_this.getSubjectProperty()&&_this.getSubjectProperty()&&_this.getSubjectProperty().isValid()&&(!!_this.getSubjectProperty().currentEstimatedValue||!!_this.getSubjectProperty().purchasePrice))&&!!_this.loanAmount;return retVal;};this.checkAgentsDifferences=function(){return _this.doesYourAgentAlsoRepresentsSeller=_this.doesAgentRepresentsSeller(_this.buyersAgentContact,_this.sellersAgentContact);};this.addLoanApplication=function(loanApplication){if(_this.getLoanApplications().length<_this.maxNumberOfLoanApplications||_this.maxNumberOfLoanApplications===0&&_this.hasTransactionInfoLoanApplication()){loanApplication.isUserEntry=true;_this.getTransactionInfoLoanApplication().map(loanApplication);_this.active=loanApplication;_this.setPrimaryLoanApplication(loanApplication);}};this.setPrimaryLoanApplication=function(loanApplication){if(loanApplication.loanApplicationId==_this.loanId){loanApplication.isPrimary==true;}else{loanApplication.isPrimary==false;}};this.removeLoanApplications=function(){};this.populateAndFormatProductClass=function(){_this.product.conforming=_this.financialInfo.conforming;_this.product.name=_this.formatProgramName();};this.calculateLockExpirationNumber=function(){var lockExpirationDate,dateNow;if(!moment(_this.lockingInformation.lockExpirationDate).isValid()){return null;}if(!_this.lockingInformation.lockExpirationDate){return null;}dateNow=moment().startOf("day");var duration=moment(_this.lockingInformation.lockExpirationDate).diff(dateNow,"days");return duration;};this.formatProgramName=function(){var name="";var amortizationType=_this.financialInfo.amortizationType,mortageType=_this.financialInfo.mortgageType,loanAmortizationTerm=_this.financialInfo.term,IsBaloonPayment=_this.financialInfo.isBaloonPayment!=null?_this.financialInfo.isBaloonPayment:false,isHarp=_this.loan.loanIsHarp,loanAmortizationFixedTerm=_this.financialInfo.fixedRateTerm;if(amortizationType===2&&loanAmortizationTerm!==loanAmortizationFixedTerm){if(loanAmortizationFixedTerm!=null){name+=loanAmortizationFixedTerm;}name+=(IsBaloonPayment?" Year Adjustable due in "+0+" years ":(isHarp?" Year Fixed HARP ":" Year Fixed "));if(amortizationType!=null){name+=_this.getObjectKeyFromValue(srv.AmortizationType,amortizationType);}if(mortageType===1||mortageType===4){name+=" "+_this.getObjectKeyFromValue(srv.MortageType,mortageType)+" ";}}else{if(loanAmortizationTerm!=null){name+=loanAmortizationTerm;}name+=(IsBaloonPayment?" Year Fixed due in "+0+" years ":(isHarp?" Year HARP ":" Year "));if(amortizationType!=null){name+=_this.getObjectKeyFromValue(srv.AmortizationType,amortizationType);}if(amortizationType!==2){name+=" "+_this.getObjectKeyFromValue(srv.MortageType,mortageType)+" ";}}return name;};this.getLockExpirationText=function(){var lockExpirationNumber=_this.calculateLockExpirationNumber(),absLockExpirationNumber,name="";if(!lockExpirationNumber){return"";}absLockExpirationNumber=Math.abs(lockExpirationNumber);name+="Expire";if(lockExpirationNumber>=0){name+="s ";name+=(lockExpirationNumber===0)?"Today":"in "+absLockExpirationNumber+" Days";}else{name+="d "+absLockExpirationNumber+" Days Ago";}return name;};this.getLockColor=function(){return(_this.calculateLockExpirationNumber()>=0)?"#1fb25a":"#E73302";};this.getLockStatus=function(){return{isLockExpired:_this.calculateLockExpirationNumber()<0,isLocked:_this.lockingInformation.lockStatus===4};};this.treatDateAsUTC=function(date){var d=new Date(date);return d.setMinutes(d.getMinutes()-d.getTimezoneOffset());};this.getObjectKeyFromValue=function(obj,value){return Object.keys(obj).filter(function(key){return obj[key]===value;})[0];};this.doesAgentRepresentsSeller=function(buyersAgent,sellersAgent){if(buyersAgent!=null&&sellersAgent!=null){if(buyersAgent.firstname==sellersAgent.firstname&&buyersAgent.lastname==sellersAgent.lastname&&buyersAgent.company==sellersAgent.company&&buyersAgent.preferedPhone==sellersAgent.preferedPhone&&buyersAgent.preferedPhoneType==sellersAgent.preferedPhoneType&&buyersAgent.alternatePhoneType==sellersAgent.alternatePhoneType&&buyersAgent.alternatePhone==sellersAgent.alternatePhone&&buyersAgent.email==buyersAgent.email){return true;}else{return false;}}else{return false;}};this.filterUserAddedLoanApplications=function(){return _this.getLoanApplications().filter(function(loanApplication){return loanApplication.isUserEntry;});};this.prepareForSubmit=function(){};this.getTotalMonthlyPropertyObligations=function(){if(!_this.housingExpenses){return 0;}return _this.housingExpenses.newTotalHousingExpenses;};this.returnLoanPurposeType=function(){return _this.loanPurposeType;};this.getPrimaryAppOccupancyType=function(){return angular.isDefined(_this.primary)?_this.primary.occupancyType:1;};this.hasTransactionalInfoOtherIncomes=function(){if(_this.hasTransactionInfo()&&!!_this.getTransactionInfoRef().incomeInfo){return true;}else{return false;}};this.getTransactionInfoOtherIncome=function(){if(_this.hasTransactionalInfoOtherIncomes()){return _this.getTransactionInfoRef().incomeInfo;}return new cls.Map();};this.getOtherIncomes=function(){if(_this.hasTransactionalInfoOtherIncomes){return _this.getTransactionInfoOtherIncome().getValues();}return[];};this.setOtherIncomes=function(incomes){if(!!incomes&&_this.hasTransactionalInfoOtherIncomes){_this.getTransactionInfoOtherIncome().mapAll(incomes);}};this.getReoItemByLienPosition=function(postion){var result=lib.filter(_this.primary.getBorrower().getLiabilities(),function(item){return item.isPledged&&item.lienPosition==postion&&item.property.isSubjectProperty;});if(result&&result.length>0){var reo=result[0];if(!!reo.reoInfo&&!(reo.reoInfo instanceof cls.REOInfoViewModel)){reo.reoInfo=new cls.REOInfoViewModel(reo.reoInfo);}return reo;}else{return null;}};this.hasTransactionalInfoLiabilities=function(){if(_this.hasTransactionInfo()&&!!_this.getTransactionInfoRef().liability){return true;}else{return false;}};this.getTransactionInfoLiabilities=function(){if(_this.hasTransactionalInfoLiabilities){return _this.getTransactionInfoRef().liability;}return new cls.Map();};this.getCurrentLoanOriginationDate=function(){if(_this.hasTransactionalInfoLiabilities){var liabilities=_this.getTransactionInfoLiabilities().getValues();for(var i=0;i<liabilities.length;i++){if(liabilities[i].getProperty()&&liabilities[i].getProperty().isSubjectProperty&&liabilities[i].lienPosition==1){return liabilities[i].loanOriginationDate;}}}return null;};this.setCurrentLoanOriginationDate=function(originationDate){if(!!originationDate&&_this.hasTransactionalInfoLiabilities){var liabilities=_this.getTransactionInfoLiabilities().getValues();for(var i=0;i<liabilities.length;i++){if(liabilities[i].getProperty()&&liabilities[i].getProperty().isSubjectProperty&&liabilities[i].lienPosition==1){liabilities[i].loanOriginationDate=originationDate;break;}}}};this.incomeTotalForBorrower=function(borrower){var total=0;total+=borrower.baseIncomeTotal;total+=_this.getOtherIncomeSumForBorrower(borrower.borrowerId);return total;};this.getCurrentAccountOpenDate=function(){if(_this.hasTransactionalInfoLiabilities){var liabilities=_this.getTransactionInfoLiabilities().getValues();for(var i=0;i<liabilities.length;i++){if(liabilities[i].getProperty()&&liabilities[i].getProperty().isSubjectProperty&&liabilities[i].lienPosition==1){return liabilities[i].accountOpenDate;}}}return null;};this.setCurrentAccountOpenDate=function(accountOpenDate){if(!!accountOpenDate&&_this.hasTransactionalInfoLiabilities){var liabilities=_this.getTransactionInfoLiabilities().getValues();for(var i=0;i<liabilities.length;i++){if(liabilities[i].getProperty()&&liabilities[i].getProperty().isSubjectProperty&&liabilities[i].lienPosition==1){liabilities[i].accountOpenDate=accountOpenDate;break;}}}};this.getCashFromToBorrower=function(){if(_this.detailsOfTransaction.cashFromToBorrower<0){return Math.abs(_this.detailsOfTransaction.cashFromToBorrower);}return 0;};this.incomeTotalForBorrowerWithMiscExpenses=function(borrower,skipMiscExpenses){if(skipMiscExpenses===void 0){skipMiscExpenses=false;}var total=0;total+=borrower.baseIncomeTotal;if(skipMiscExpenses){total+=_this.getOtherIncomeSumForBorrower(borrower.borrowerId);}else{total+=_this.getOtherIncomeSumForBorrowerWithMiscExpenses(borrower);}return total;};this.incomeTotalForCoBorrower=function(borrower){var total=0;total+=borrower.baseIncomeTotal;total+=_this.getOtherIncomeSumForBorrower(borrower.borrowerId);return total;};this.getOtherIncomeSumForBorrower=function(borrowerId){var total=0;var otherIncomes=_this.OtherIncomes.filter(function(i){return(i.borrowerId==borrowerId&&(!i.employmentInfoId||i.employmentInfoId==lib.getEmptyGuid()));});if(otherIncomes){angular.forEach(otherIncomes,function(income){if(income&&!income.isRemoved&&income.manualAmount&&income.incomeTypeId!=5){var amount=Number(income.manualAmount);if(income.preferredPaymentPeriodId==2){amount/=12;}total+=amount;}});}return total;};this.getOtherIncomeSumForBorrowerWithMiscExpenses=function(borrower){var total=_this.getOtherIncomeSumForBorrower(borrower.borrowerId);var miscDebts=borrower.getMiscDebts().filter(function(i){return(i.typeId==2);});return total+=_this.calculateMiscExpenses(miscDebts);};this.calculateMiscExpenses=function(miscDebts){var total=0;var amount=0;angular.forEach(miscDebts,function(debt){if(debt&&!debt.isRemoved&&debt.amount){amount=Number(debt.amount);total-=amount;}});return total;};this.getOtherIncomeTotalForBorrower=function(borrower){return _this.getOtherIncomeSumForBorrowerWithMiscExpenses(borrower)+_this.getCashFlowForNetRentalIncomes(borrower,false);};this.getOtherIncomeTotal=function(borrower){return _this.getOtherIncomeSumForBorrower(borrower.borrowerId)+_this.getCashFlowForNetRentalIncomes(borrower,false);};this.getCombinedOtherIncomeTotal=function(){if(_this.active.isSpouseOnTheLoan){return _this.getOtherIncomeTotal(_this.active.getBorrower())+_this.getOtherIncomeTotal(_this.active.getCoBorrower());}else{return _this.getOtherIncomeTotal(_this.active.getBorrower());}};this.deleteOtherIncome=function(otherIncome){common.deleteItem(common.indexOfItem(otherIncome,_this.otherIncomes),_this.otherIncomes);};this.removeOtherIncome=function(otherIncome){otherIncome.isRemoved=true;};this.getCombinedNonSubjectPropertyIncomeTotal=function(){var retVal=Number(_this.getNonSubjectPropertiesNetRentalIncome(_this.active.getBorrower()));if(_this.active.isSpouseOnTheLoan){retVal+=Number(_this.getNonSubjectPropertiesNetRentalIncome(_this.active.getCoBorrower()));}return retVal;};this.getNonSubjectPropertiesNetRentalIncome=function(borrower){return _this.netRentalIncomeSum(borrower,false);};this.getSubjectPropertiesNetRentalIncome=function(borrower){return _this.netRentalIncomeSum(borrower,true);};this.getCashFlowForNetRentalIncomes=function(borrower,isNegative){var total=0;var subjectPropertyNetRental=_this.getSubjectPropertiesNetRentalIncome(borrower);var nonSubjectPropertiesNetRental=_this.getNonSubjectPropertiesNetRentalIncome(borrower);return _this.getNetRentalAmount(isNegative,subjectPropertyNetRental)+_this.getNetRentalAmount(isNegative,nonSubjectPropertiesNetRental);};this.getNetRentalAmount=function(isNegative,amount){if(isNegative){if(amount<0){return amount;}else{return 0;}}else{if(amount>0){return amount;}else{return 0;}}};this.netRentalIncomeSum=function(borrower,isSubjectProperty){var total=0;var otherIncome=_this.OtherIncomes.filter(function(i){return(i.borrowerId==borrower.borrowerId&&i.isNetRental&&i.isSubjectProperty==isSubjectProperty);});if(otherIncome){angular.forEach(otherIncome,function(income){if(!income.isRemoved){var amount=Number(income.manualAmount);if(income.preferredPaymentPeriodId==2){amount/=12;}total+=amount;}});}return total;};this.processPropertyRules=function(){if(_this.loanPurposeType==2){lib.forEach(_this.getLoanApplications(),function(la){if(la.OccupancyType==1){la.getBorrower().getCurrentAddress().isSameAsPropertyAddress=true;}});}};this.initialize=function(loan){var ti=new cls.TransactionInfo();_this.getTransactionInfo=function(){return ti;};if(loan){ti.populate(function(){return _this;},loan.transactionInfo);if(!LoanViewModel._lookupInfo){LoanViewModel._lookupInfo=loan.lookup;}if(loan.loanId){if(!loan.selectedAppIndex){_this.active=_this.getActiveLoanApplication(_this);}else{_this.active=_this.getActiveLoanApplicationByIndex(_this);if(_this.active===undefined){_this.active=_this.getActiveLoanApplication(_this);}}_this.primary=_this.getPrimaryLoan(_this);}else{var loanApplicationDefault=(loan.getLoanApplications().length>0)?_this.getLoanApplications()[0]:new cls.LoanApplicationViewModel(_this.getTransactionInfoRef(),null);_this.setLoanApplicationsDefaults(loanApplicationDefault);}if(_this.homeBuyingType==3&&!_this.getSubjectProperty().streetName){_this.getSubjectProperty().streetName="TBD";}lib.forEach(loan.otherIncomes,function(p){return(p.isNetRental)?_this.otherIncomes.push(new cls.NetRentalIncomeInfoViewModel(p)):_this.otherIncomes.push(new cls.OtherIncomeInfoViewModel(_this.getTransactionInfoRef(),p));});if(_this.loanPurposeType==1){_this.getSubjectProperty().getNetRentalIncome();}if(_this.pricingAdjustments&&_this.pricingAdjustments.adjustments&&_this.pricingAdjustments.adjustments.length>0){var adjs=_this.pricingAdjustments.adjustments;var newadj=[];for(var i=0;i<adjs.length;i++){newadj.push(new cls.AdjustmentsViewModel(adjs[i]));}_this.pricingAdjustments.adjustments=newadj;}if(!_this.primary){_this.setLoanApplicationsDefaults(ti.loanApplication.getValues()[0]);}_this.populateAndFormatProductClass();_this.populateLockingInformation();_this.processPropertyRules();_this.getLoanApplications().forEach(function(app){app.Borrowers(false,true,false);});}else{if(!_this.transactionInfo){_this.transactionInfo=new srv.cls.TransactionInfo();}ti.populate(function(){return _this;},null);_this.financialInfo=new srv.cls.LoanFinancialInfoViewModel();_this.setLoanApplicationsDefaults(new cls.LoanApplicationViewModel(_this.getTransactionInfoRef(),null));}_this.areSixPiecesAcquiredForAllLoanApplications();_this.isNewProspectSaved=true;};this.getCosts=function(){if(!_this.closingCost||!_this.closingCost.costs){return new Array();}return _this.closingCost.costs;};this.getActiveLoanApplication=function(loan){return _this.$filter("filter")(loan.getLoanApplications(),{loanApplicationId:loan.active.loanApplicationId},true)[0];};this.getPrimaryLoan=function(loan){return _this.$filter("filter")(loan.getLoanApplications(),{isPrimary:true},true)[0];};this.getActiveLoanApplicationByIndex=function(loan){return loan.getLoanApplications()[loan.selectedAppIndex];};this.updateLoanDateHistory=function(dateValue,currentUserName,dateOfChange,impoundSchedules,title){var loanDateHistory=new cls.LoanDateHistoryViewModel();loanDateHistory.dateValue=dateValue;loanDateHistory.dateOfChange=dateOfChange;loanDateHistory.userName=currentUserName;loanDateHistory.isActive=true;loanDateHistory.userCurrentlyEditing=true;if(title=="Closing Date"){if(!_this.closingDate.dateHistory){_this.closingDate.dateHistory=new Array();}else{var userCurrentlyEditnigDateHistories=lib.filter(_this.closingDate.dateHistory,function(dateHistory){return new cls.LoanDateHistoryViewModel(dateHistory).userCurrentlyEditing;});if(userCurrentlyEditnigDateHistories.length>0){_this.closingDate.dateHistory.pop();}}_this.closingDate.dateHistory.push(loanDateHistory);}else{if(title=="Appraisal Due Date"){if(!_this.appraisalContingencyDate.dateHistory){_this.appraisalContingencyDate.dateHistory=new Array();}else{var userCurrentlyEditnigDateHistories=lib.filter(_this.appraisalContingencyDate.dateHistory,function(dateHistory){return new cls.LoanDateHistoryViewModel(dateHistory).userCurrentlyEditing;});if(userCurrentlyEditnigDateHistories.length>0){_this.appraisalContingencyDate.dateHistory.pop();}else{if(_this.appraisalContingencyDate.dateHistory.length>0){lib.filter(_this.appraisalContingencyDate.dateHistory,function(dateHistory){return dateHistory.isActive;})[0].isActive=false;}}}if(loanDateHistory.dateValue){_this.appraisalContingencyDate.dateHistory.push(loanDateHistory);}}}if(title=="Approval Due Date"){if(!_this.approvalContingencyDate.dateHistory){_this.approvalContingencyDate.dateHistory=new Array();}else{var userCurrentlyEditnigDateHistories=lib.filter(_this.approvalContingencyDate.dateHistory,function(dateHistory){return new cls.LoanDateHistoryViewModel(dateHistory).userCurrentlyEditing;});if(userCurrentlyEditnigDateHistories.length>0){_this.approvalContingencyDate.dateHistory.pop();}else{if(_this.approvalContingencyDate.dateHistory.length>0){lib.filter(_this.approvalContingencyDate.dateHistory,function(dateHistory){return dateHistory.isActive;})[0].isActive=false;}}}if(loanDateHistory.dateValue){_this.approvalContingencyDate.dateHistory.push(loanDateHistory);}}};this.getReoItemsForSubjectPropertyOnAllLoanApplications=function(){_this.reoItemsForSubjectPropertyWithLienSecondOrMore=new Array();_this.getLoanApplications().forEach(function(la,idx){_this.reoItemsForSubjectPropertyWithLienSecondOrMore=_this.reoItemsForSubjectPropertyWithLienSecondOrMore.concat(la.getAllLiabilitiesCombined().filter(function(item){return item.isPledged&&item.getProperty()&&item.getProperty().isSubjectProperty&&item.lienPosition>=2;}));});};this.calculateSubordinate=function(){if(_this.loanPurposeType==2){_this.getReoItemsForSubjectPropertyOnAllLoanApplications();if(!_this.reoItemsForSubjectPropertyWithLienSecondOrMore.length){return"";}if(_this.reoItemsForSubjectPropertyWithLienSecondOrMore.filter(function(item){return item.borrowerDebtCommentId==2||item.borrowerDebtCommentId==4;}).length==_this.reoItemsForSubjectPropertyWithLienSecondOrMore.length){return"N/A";}if(_this.reoItemsForSubjectPropertyWithLienSecondOrMore.filter(function(item){return item.borrowerDebtCommentId==3;}).length==_this.reoItemsForSubjectPropertyWithLienSecondOrMore.length){return 0;}return _this.sumBalanceForAllLoanAplication();}return"";};this.isDataValidForAggregateAdjustmentCalculation=function(){var costs=lib.filter(_this.getCosts(),function(c){return c.hudLineNumber==1002||c.hudLineNumber==1004||c.hudLineNumber==1006||(c.isRemoved!=true&&(c.hudLineNumber==1010||c.hudLineNumber==1007||c.hudLineNumber==1012||c.originalHUDLineNumber==1010||c.originalHUDLineNumber==1007||c.originalHUDLineNumber==1012));});for(var i=0;i<costs.length;i++){if(costs[i].amountMethod!=1){if(!costs[i].impounded||!costs[i].amountPerMonth){continue;}if(costs[i].preferredPaymentPeriod!=1&&costs[i].periodPaymentMonths.length==0){_this.totalAggregateAdjustment=0;return false;}for(var j=0;j<costs[i].periodPaymentMonths.length;j++){if(!costs[i].periodPaymentMonths[j].isRemoved&&!costs[i].periodPaymentMonths[j].month){_this.totalAggregateAdjustment=0;return false;}}}else{for(var k=0;k<costs[i].itemizedPropertyTaxes.length;k++){if(costs[i].itemizedPropertyTaxes[k].amount&&!costs[i].itemizedPropertyTaxes[k].month){_this.totalAggregateAdjustment=0;return false;}}}}return true;};this.resetEscrowsMonthsToBePaid=function(){var costs=lib.filter(_this.getCosts(),function(c){return c.hudLineNumber==1002||c.hudLineNumber==1004||c.hudLineNumber==1006||(c.isRemoved!=true&&(c.hudLineNumber==1010||c.hudLineNumber==1007||c.hudLineNumber==1012||c.originalHUDLineNumber==1010||c.originalHUDLineNumber==1007||c.originalHUDLineNumber==1012));});for(var i=0;i<costs.length;i++){if(costs[i].originalMonthsToBePaid!=null&&costs[i].originalMonthsToBePaid>0){costs[i].monthsToBePaid=costs[i].originalMonthsToBePaid;}}};this.sumBalanceForAllLoanAplication=function(){var retVal=0;for(var key in _this.reoItemsForSubjectPropertyWithLienSecondOrMore){if(_this.reoItemsForSubjectPropertyWithLienSecondOrMore[key].borrowerDebtCommentId!=2&&_this.reoItemsForSubjectPropertyWithLienSecondOrMore[key].borrowerDebtCommentId!=4&&_this.reoItemsForSubjectPropertyWithLienSecondOrMore[key].borrowerDebtCommentId!=3){retVal+=_this.reoItemsForSubjectPropertyWithLienSecondOrMore[key].unpaidBalance;}}return retVal;};this.getSubjectProperty=function(){var subjectProperty=lib.findFirst(_this.getPropertyMap().getValues(),function(p){return p.isSubjectProperty;});if(!subjectProperty){console.warn("SUBJECT PROPERTY NOT FOUND");}return subjectProperty;};this.setSubjectProperty=function(subjProp){var subjPropExisting=_this.getSubjectProperty();if(!!subjPropExisting){_this.getPropertyMap().remove(subjPropExisting);}_this.getPropertyMap().map(subjProp);};this.bindSubjectProperty=function(subjProp){if(angular.isDefined(subjProp)){_this.setSubjectProperty(subjProp);}var retVal=_this.getSubjectProperty();return retVal;};this.getProperty=function(propertyId){var property=_this.getPropertyMap().lookup(propertyId);return property;};this.getPropertiesByAddressId=function(propertyId){var properties=lib.filter(_this.getPropertyMap().getValues(),function(p){return p.propertyId==propertyId;});return properties;};this.addOrUpdateProperty=function(property){if(!property||!property.propertyId||property.propertyId==lib.getEmptyGuid()){throw"loanVM::addOrUpdateProperty => input property is null or without id";}property.loanId=_this.loanId;_this.getPropertyMap().map(property);};this.removePropertiesByAddressId=function(property,propertyId){var currentAddressProperties=_this.getPropertiesByAddressId(propertyId);if(currentAddressProperties){lib.forEach(_this.active.getCombinedPledgedAssets(),function(reo){if(lib.contains(currentAddressProperties,function(p){return p.propertyId==reo.propertyId;})){reo.setProperty(property);}});lib.forEach(currentAddressProperties,function(property){var isRemoved=_this.getPropertyMap().remove(property);return isRemoved;});}};this.shouldLoanNumberBeVisible=function(){return(!common.string.isNullOrWhiteSpace(_this.loanNumber)&&_this.loanNumber.toLowerCase()!="pending");};this.getActiveDisclosureDetailsViewModel=function(){var activeDisclosureModel=new srv.cls.DisclosuresDetailsViewModel();if(_this.closingCost&&_this.closingCost.disclosuresDetailsViewModel){lib.forEach(_this.closingCost.disclosuresDetailsViewModel,function(disclosureDetail){if(disclosureDetail.active){activeDisclosureModel=disclosureDetail;}});}return activeDisclosureModel;};this.cashFlowBorrower=function(){return Math.abs(_this.getCashFlowForNetRentalIncomes(_this.primary.getBorrower(),true));};this.cashFlowCoBorrower=function(){return Math.abs(_this.getCashFlowForNetRentalIncomes(_this.primary.getCoBorrower(),true));};this.totalIncomeForBorrower=function(){return _this.getTotalBorrowerIncome(_this.primary.getBorrower());};this.totalIncomeForCoBorrower=function(){return !_this.primary.isSpouseOnTheLoan?0:_this.getTotalCoBorrowerIncome(_this.primary.getCoBorrower());};this.getTotalBorrowerIncome=function(borrower){return borrower.baseIncomeTotal+_this.getOtherIncomeSumForBorrowerWithMiscExpenses(borrower)+_this.getCashFlowForNetRentalIncomes(borrower,false);};this.getTotalCoBorrowerIncome=function(borrower){return borrower.baseIncomeTotal+_this.getOtherIncomeSumForBorrowerWithMiscExpenses(borrower)+_this.getCashFlowForNetRentalIncomes(borrower,false);};this.populateLockingInformation=function(){var lockStatus=_this.getLockStatus();_this.lockingInformation.isLocked=lockStatus.isLocked;_this.lockingInformation.isLockExpired=lockStatus.isLockExpired;_this.lockingInformation.lockExpirationDate=moment(_this.lockingInformation.lockExpirationDate).isValid()?moment(_this.lockingInformation.lockExpirationDate).toDate():null;_this.lockingInformation.lockExpirationNumber=Math.abs(_this.calculateLockExpirationNumber()).toString();};this.updateGovermentEligibility=function(calculatorType,isEligible){if(_this.financialInfo.mortgageType==calculatorType){switch(calculatorType){case 1:if(isEligible){_this.govermentEligibility=1;}else{_this.govermentEligibility=2;}break;case 4:if(isEligible){_this.govermentEligibility=3;}else{_this.govermentEligibility=4;}break;case 5:if(isEligible){_this.govermentEligibility=5;}else{_this.govermentEligibility=6;}break;}}};if(loan){lib.copyState(loan,this);var loanCls=loan;if(!this.$filter&&!!loanCls.$filter){this.$filter=loanCls.$filter;}}this.isWholeSale=isWholeSale;this.initialize(loan);}Object.defineProperty(LoanViewModel.prototype,"NegativeAmortization",{get:function(){return common.objects.boolToString(this.negativeAmortization);},set:function(value){this.negativeAmortization=common.string.toBool(value);},enumerable:true,configurable:true});Object.defineProperty(LoanViewModel.prototype,"PrePaymentPenalty",{get:function(){return common.objects.boolToString(this.prePaymentPenalty);},set:function(value){this.prePaymentPenalty=common.string.toBool(value);},enumerable:true,configurable:true});LoanViewModel.getLookups=function(){return LoanViewModel._lookupInfo;};LoanViewModel.prototype.isSubordinateFinancing=function(){var _this=this;var items=lib.filter(this.primary.getCombinedPledgedAssets(),function(item){return _this.loanPurposeType==2&&(item.lienPosition>1&&item.getProperty().isSubjectProperty&&(item.borrowerDebtCommentId==2||item.borrowerDebtCommentId==4||item.borrowerDebtCommentId==3));});return items.length>0||this.otherInterviewData.secondMortgageRefinanceComment!=String(1);};Object.defineProperty(LoanViewModel.prototype,"active",{get:function(){return this._active?this._active:(this._active=this.getLoanApplications()[0]);},set:function(active){this.selectedAppIndex=this.getLoanApplications().indexOf(active);this._active=active;},enumerable:true,configurable:true});Object.defineProperty(LoanViewModel.prototype,"otherIncomes",{get:function(){return this.getOtherIncomes();},set:function(incomes){this.setOtherIncomes(incomes);},enumerable:true,configurable:true});Object.defineProperty(LoanViewModel.prototype,"OtherIncomes",{get:function(){return this.getOtherIncomes();},set:function(incomes){this.setOtherIncomes(incomes);},enumerable:true,configurable:true});Object.defineProperty(LoanViewModel.prototype,"CurrentLoanOriginationDate",{get:function(){return this.getCurrentLoanOriginationDate();},set:function(originationDate){this.setCurrentLoanOriginationDate(originationDate);},enumerable:true,configurable:true});Object.defineProperty(LoanViewModel.prototype,"FirstLienReoItem",{get:function(){return this.getReoItemByLienPosition(1);},enumerable:true,configurable:true});Object.defineProperty(LoanViewModel.prototype,"JuniorLienReoItem",{get:function(){return this.getReoItemByLienPosition(2);},enumerable:true,configurable:true});Object.defineProperty(LoanViewModel.prototype,"CurrentAccountOpenDate",{get:function(){return this.getCurrentAccountOpenDate();},set:function(accountOpenDate){this.setCurrentAccountOpenDate(accountOpenDate);},enumerable:true,configurable:true});Object.defineProperty(LoanViewModel.prototype,"CashFromToBorrower",{get:function(){return this.getCashFromToBorrower();},enumerable:true,configurable:true});LoanViewModel.prototype.setLoanApplicationsDefaults=function(loanApplication){this.setLoanApplications([loanApplication]);this.active=loanApplication;this.primary=loanApplication;this.primary.isPrimary=true;this.loanPurposeType=2;};Object.defineProperty(LoanViewModel.prototype,"subjectProperty",{get:function(){return this.getSubjectProperty();},set:function(subjProp){console.warn("LoanViewModel::<set subjectProperty> should not be called ; use setSubjectProperty() instead.");},enumerable:true,configurable:true});return LoanViewModel;})(srv.cls.LoanViewModel);cls.LoanViewModel=LoanViewModel;})(cls||(cls={}));var __extends=this.__extends||function(d,b){for(var p in b){if(b.hasOwnProperty(p)){d[p]=b[p];}}function __(){this.constructor=d;}__.prototype=b.prototype;d.prototype=new __();};var cls;(function(cls){(function(CollectionType){CollectionType[CollectionType["BORROWERS_COLLECTION"]=0]="BORROWERS_COLLECTION";CollectionType[CollectionType["COBORROWERS_COLLECTION"]=1]="COBORROWERS_COLLECTION";CollectionType[CollectionType["JOINTACCOUNT_COLLECTION"]=2]="JOINTACCOUNT_COLLECTION";})(cls.CollectionType||(cls.CollectionType={}));var CollectionType=cls.CollectionType;var LoanApplicationViewModel=(function(_super){__extends(LoanApplicationViewModel,_super);function LoanApplicationViewModel(ti,loanApplication){var _this=this;_super.call(this);this.hasTransactionInfo=function(){return(!!_this.ticb&&!!_this.ticb());};this.getTransactionInfo=function(){if(_this.hasTransactionInfo()){return _this.ticb();}else{return null;}};this.setTransactionInfo=function(ti){_this.ticb=function(){return ti;};};this.incrementSnoozeOrder=function(){_this.snoozeOrder+=1;_this.isSnoozed=true;};this.hasTransactionalInfoBorrower=function(){return _this.hasTransactionInfo()&&!!_this.getTransactionInfo().borrower;};this.getTransactionInfoBorrower=function(){if(_this.hasTransactionalInfoBorrower()){return _this.getTransactionInfo().borrower;}return new cls.Map();};this.getBorrowerOrCoBorrower=function(isCoBorrower){if(_this.hasTransactionalInfoBorrower()){var itemBorrower=lib.findFirst(_this.getTransactionInfoBorrower().getValues(),function(o){return o.loanApplicationId==_this.loanApplicationId&&o.isCoBorrower==isCoBorrower;});return itemBorrower;}return null;};this.setBorrowerOrCoBorrower=function(borrower){if(!!borrower&&_this.hasTransactionalInfoBorrower()){var be=_this.getBorrowerOrCoBorrower(borrower.isCoBorrower);if(!!be){_this.getTransactionInfoBorrower().remove(be);}borrower.loanApplicationId=_this.loanApplicationId;_this.getTransactionInfoBorrower().map(borrower);}};this.getBorrower=function(){return _this.getBorrowerOrCoBorrower(false);};this.setBorrower=function(borrower){borrower.isCoBorrower=false;_this.setBorrowerOrCoBorrower(borrower);};this.bindBorrower=function(b){if(angular.isDefined(b)){_this.setBorrower(b);}return _this.getBorrower();};this.getCoBorrower=function(){return _this.getBorrowerOrCoBorrower(true);};this.setCoBorrower=function(coBorrower){coBorrower.isCoBorrower=true;_this.setBorrowerOrCoBorrower(coBorrower);};this.bindCoBorrower=function(b){if(angular.isDefined(b)){_this.setCoBorrower(b);}return _this.getCoBorrower();};this.getPrimaryAppOccupancyType=function(){return 0;};this.excludeProperties=["isLicensedStates","propertyId","counties","states","isAddressEqual","isEmpty","initialize","addressTypeId","countyName"];this.getTotalAssetsAmount=function(){var total=0;var assets=_this.getBorrower().assets.concat(_this.getCoBorrower().assets);for(var i=0;i<assets.length;i++){if(!assets[i].isRemoved&&!assets[i].isDownPayment&&assets[i].monthlyAmount){total+=parseFloat(String(assets[i].monthlyAmount));}}return total;};this.filterPropertiesByAddressTypeId=function(borrower){return borrower.reoPropertyList.filter(function(item){return item.addressTypeId==borrower.getCurrentAddress().addressTypeId;});};this.filterPropertiesByAddressId=function(borrower){return borrower.reoPropertyList.filter(function(item){return item.propertyId==borrower.getCurrentAddress().propertyId;});};this.getLiabilitesBalanceTotal=function(borrower){var list;if(!borrower){list=_this.getCombinedLiability();}else{list=_this.getLiabilitiesForBorrower(borrower);}var total=0;angular.forEach(list,function(liability){if(liability.includeInLiabilitiesTotal&&!liability.isRemoved&&liability.unpaidBalance){var amount=parseFloat(liability.unpaidBalance.toString());if(!amount||isNaN(amount)){amount=0;}total+=parseFloat(String(amount));}});return total;};this.getPublicRecordsTotalAmount=function(){var total=0;angular.forEach(_this.getCombinedPublicRecords(),function(publicRecord){var amount=parseFloat(String(publicRecord.amount));if(!amount||isNaN(amount)||publicRecord.publicRecordComment=="4"){amount=0;}total+=parseFloat(String(amount));});return total;};this.getCombinedReoPropertyList=function(){return _this.getBorrower().reoPropertyList.concat(_this.getCoBorrower().reoPropertyList);};this.isResidenceValidForReoList=function(borrower){if(!borrower){return false;}var addr=borrower.getCurrentAddress();if(!addr){return false;}if(addr.ownership!=0){return false;}if(addr.isSameAsPropertyAddress){return false;}if(borrower.isCoBorrower&&addr.isSameAsPrimaryBorrowerCurrentAddress){return false;}return true;};this.getUniqueProperties=function(getSubjectPropertiesForPurchase){var loan=_this.getTransactionInfo().getLoan();var reoPropertyList=[];if(loan.loanPurposeType==2||getSubjectPropertiesForPurchase){reoPropertyList.push(loan.getSubjectProperty());}var residences=[];if(_this.isResidenceValidForReoList(_this.getBorrower())){residences.push(_this.getBorrower().getCurrentAddress());}if(_this.isResidenceValidForReoList(_this.getCoBorrower())){residences.push(_this.getCoBorrower().getCurrentAddress());}reoPropertyList=reoPropertyList.concat(residences);var allReoProperties=lib.filter(loan.getPropertyMap().getValues(),function(p){return !p.isSubjectProperty&&p.addressTypeId==6&&p.loanApplicationId==_this.loanApplicationId;});allReoProperties=lib.filter(allReoProperties,function(o){return !lib.findFirst(reoPropertyList,function(p){return o.isAddressEqual(p);});});reoPropertyList=reoPropertyList.concat(allReoProperties);reoPropertyList=lib.filter(reoPropertyList,function(o){return(!!o.streetName&&!!o.cityName&&!!o.stateName);});return reoPropertyList;};this.getAllProperties=function(){var loan=_this.getTransactionInfo().getLoan();var subjProp=loan.getSubjectProperty();return lib.filter(_this.getTransactionInfo().property.getValues(),function(p){return p.loanApplicationId==_this.loanApplicationId;}).concat([subjProp]);};this.getMiscExpensesTotal=function(){var total=0,miscExpanses=_this.getCombinedMiscDebts();for(var i=0;i<miscExpanses.length;i++){if(!miscExpanses[i].isRemoved&&miscExpanses[i].amount){total+=parseFloat(String(miscExpanses[i].amount));}}return total;};this.handleJointWithCoBorrowerLiability=function(originalItem){var childItem=_this.getChildItemFromLiabilityLists(originalItem);if(!childItem){return;}childItem.companyData=originalItem.companyData;childItem.debtType=originalItem.debtType;childItem.accountNumber=originalItem.accountNumber;childItem.monthsLeft=originalItem.monthsLeft;childItem.unpaidBalance=originalItem.unpaidBalance;childItem.minPayment=originalItem.minPayment;childItem.debtCommentId=originalItem.debtCommentId;};this.deleteLiability=function(liability){throw new Error("loanApplication::deleteLiability() is OBSOLETE");};this.removeLiablity=function(liability){throw new Error("loanApplication::removeLiablity() is OBSOLETE");};this.getChildItemFromLiabilityLists=function(originalItem){for(var i=0;i<_this.getBorrower().getLiabilities().length;i++){if(_this.getBorrower().getLiabilities()[i].originalClientId===originalItem.clientId){return _this.getBorrower().getLiabilities()[i];}}for(var i=0;i<_this.getCoBorrower().getLiabilities().length;i++){if(_this.getCoBorrower().getLiabilities()[i].originalClientId===originalItem.clientId){return _this.getCoBorrower().getLiabilities()[i];}}return null;};this.areSixPiecesOfLoanApplicationCompleted=function(){return _this.isPersonalPieceAcquired()&&_this.isIncomePieceAcquired();};this.isLoanApplicationCompleted=function(subjectProperty,loanType,loanAmount,coBorrowerAddressDifferent,downPaymentTypeCode,isSixPieceCompletedForCurrentApp){_this.isCompleted=_this.isPersonalCompleted()&&_this.isPropertyCompleted(subjectProperty,loanType,loanAmount,coBorrowerAddressDifferent,downPaymentTypeCode)&&_this.isAssetsCompleted()&&_this.isCreditTabCompleted(isSixPieceCompletedForCurrentApp)&&_this.isDeclarationsCompleted()&&_this.isIncomeCompleted();return _this.isCompleted;};this.isPersonalCompleted=function(){if(!_this.validatePersonalCompletedForBorrower(_this.getBorrower())||(_this.titleInfo.titleHeldIn==0&&(common.string.isNullOrWhiteSpace(_this.titleInfo.namesOnTitle)||!(_this.titleInfo.mannerTitleHeld&&_this.titleInfo.mannerTitleHeld!="-1")))||common.string.isNullOrWhiteSpace(_this.howDidYouHearAboutUs)||(_this.getCoBorrower()&&_this.isSpouseOnTheLoan&&!_this.validatePersonalCompletedForBorrower(_this.getCoBorrower()))||(!_this.isSpouseOnTheLoan&&_this.getBorrower().maritalStatus.toString()=="0"&&common.string.isNullOrWhiteSpace(_this.titleInfo.nameOfPartner))){return false;}return true;};this.isPersonalPieceAcquired=function(){var retVal=false;retVal=_this.validatePersonalPieceForBorrower(_this.getBorrower());if(_this.getCoBorrower()&&_this.isSpouseOnTheLoan){retVal=retVal&&_this.validatePersonalPieceForBorrower(_this.getCoBorrower());}return retVal;};this.validatePersonalPieceForBorrower=function(borrower){return(_this.isBorrowerFirstAndLastNameEntered(borrower)&&!!borrower.ssn);};this.isBorrowerFirstAndLastNameEntered=function(borrower){return !common.string.isNullOrWhiteSpace(borrower.firstName)&&!common.string.isNullOrWhiteSpace(borrower.lastName);};this.isValidForSave=function(){if(_this.isSpouseOnTheLoan){return _this.isBorrowerFirstAndLastNameEntered(_this.getBorrower())&&_this.isBorrowerFirstAndLastNameEntered(_this.getCoBorrower());}return _this.isBorrowerFirstAndLastNameEntered(_this.getBorrower());};this.validatePersonalCompletedForBorrower=function(borrower){var emailProvided=(borrower.userAccount.isOnlineUser&&!common.string.isNullOrWhiteSpace(borrower.userAccount.username))||!borrower.userAccount.isOnlineUser;var usCitizenIndicatorProvided=borrower.usCitizen||borrower.permanentAlien;var yearsAgo=moment().diff(moment(borrower.dateOfBirth),"years");return(_this.validatePersonalPieceForBorrower(borrower)&&emailProvided&&usCitizenIndicatorProvided&&!common.string.isNullOrWhiteSpace(borrower.preferredPhone.number)&&borrower.yearsOfSchool&&borrower.yearsOfSchool!=0&&borrower.dateOfBirth&&yearsAgo>=18&&(borrower.maritalStatus||borrower.maritalStatus==0)&&borrower.maritalStatus.toString()!="-1");};this.getCheckColor=function(tabCompleted,sixPiecesCompleted){if(tabCompleted){return"#49E88A";}else{if(sixPiecesCompleted){return"#ef1126 ";}}};this.isCheckAvailable=function(tabCompleted,sixPiecesCompleted){return !(!tabCompleted&&!sixPiecesCompleted);};this.isPropertyCompleted=function(subjectProperty,loanType,loanAmount,coBorrowerAddressDifferent,downPaymentTypeCode){var result;result=_this.isSubjectPropertySectionCompleted(subjectProperty,loanType,loanAmount,downPaymentTypeCode)&&_this.isBorrowerCoBorrowerAddressSectionsCompleted(_this.getBorrower());if(coBorrowerAddressDifferent&&_this.isSpouseOnTheLoan){result=result&&_this.isBorrowerCoBorrowerAddressSectionsCompleted(_this.getCoBorrower());}return result;};this.updateOccupancyTypeForSubjectPropertyPledgeAssets=function(){var subjectPropertyPledgeAssets=_this.getCombinedPledgedAssets().filter(function(e){return e.getProperty().isSubjectProperty;});for(var i=0;i<subjectPropertyPledgeAssets.length;i++){subjectPropertyPledgeAssets[i].getProperty().occupancyType=_this.occupancyType;}};this.isAssetsCompleted=function(){var financilas=_this.getCombinedAssetsFinancials();if(financilas.length!=0){for(var i=0;i<financilas.length;i++){if((!common.string.isNullOrWhiteSpace(financilas[i].accountNumber)&&!common.string.isNullOrWhiteSpace(financilas[i].institiutionContactInfo.companyName)&&financilas[i].monthlyAmount&&financilas[i].monthlyAmount!=0)||financilas[i].assetType==99){return true;}}}return false;};this.isCreditTabCompleted=function(areSixPiecesCompleted){if(!_this.credit||!_this.credit.isCreditReportValid()){return false;}var realEstates=_this.getCombinedPledgedAssets();if(realEstates.length){for(var i=0;i<realEstates.length;i++){if(!realEstates[i].isValid()){return false;}}return true;}return true;};this.isDeclarationsCompleted=function(){var result=_this.isBorrowerDecalarationsCompleted(_this.getBorrower());if(_this.isSpouseOnTheLoan){result=result&&_this.isBorrowerDecalarationsCompleted(_this.getCoBorrower());}return result;};this.isIncomeCompleted=function(){var retVal=_this.isBorrowerIncomeCompleted(_this.getBorrower());if(_this.isSpouseOnTheLoan){retVal=retVal&&_this.isBorrowerIncomeCompleted(_this.getCoBorrower());}return retVal;};this.isBorrowerIncomeCompleted=function(borrower){var combinedIncomes=borrower.getCombinedCurrentAndAdditionalEmployments();if(!combinedIncomes||!combinedIncomes.length){return false;}var retVal=true;var otherIncomes=_this.getTransactionInfo().incomeInfo.getValues().filter(function(i){return(i.borrowerId==borrower.borrowerId);});for(var i in combinedIncomes){retVal=retVal&&combinedIncomes[i].isCompleted();}if(borrower.getCurrentEmploymentInfo().EmploymentTypeId==3||borrower.getCurrentEmploymentInfo().EmploymentTypeId==4){retVal=retVal&&_this.validateRetiredAndUnemployedEmploymentTypes(borrower,otherIncomes);}return retVal;};this.validateRetiredAndUnemployedEmploymentTypes=function(borrower,otherIncomes){if(borrower.getCurrentEmploymentInfo().EmploymentTypeId==3){return(otherIncomes.filter(function(income){return !income.isRemoved&&(income.amount!=0);}).length>0)?true:false;}return true;};this.isIncomePieceAcquired=function(){var retVal=false;retVal=_this.validateIncomePieceForBorrower(_this.getBorrower());if(_this.getCoBorrower()&&_this.isSpouseOnTheLoan){retVal=retVal&&_this.validateIncomePieceForBorrower(_this.getCoBorrower());}return retVal;};this.validateCreditTabForBorrower=function(borrower){if(borrower.reoPropertyList&&borrower.reoPropertyList.length>0){for(var key in borrower.reoPropertyList){if(!_this.validateRealEstateItem(borrower.reoPropertyList[key])){return false;}}}return true;};this.validateRealEstateItem=function(reoPropertyItem){return true;};this.validateIncomePieceForBorrower=function(borrower){var hasOtherIncomes=_this.getTransactionInfo().incomeInfo.getValues().filter(function(i){return(i.borrowerId==borrower.borrowerId&&!i.isRemoved&&!!i.amount);}).length>0;if(!borrower.getCurrentEmploymentInfo()){return false;}return borrower&&borrower.getCurrentEmploymentInfo()&&borrower.getCurrentEmploymentInfo().getIncomeInformation()&&borrower.getCurrentEmploymentInfo().getIncomeInformation().length>0&&(borrower.getCurrentEmploymentInfo().EmploymentTypeId==0&&borrower.getCurrentEmploymentInfo().incomeInfoByTypeId(11)&&borrower.getCurrentEmploymentInfo().incomeInfoByTypeId(11).amount!=0)||(borrower.getCurrentEmploymentInfo().EmploymentTypeId==2&&(borrower.getCurrentEmploymentInfo().incomeInfoByTypeId(16)&&borrower.getCurrentEmploymentInfo().incomeInfoByTypeId(16).amount!=0||borrower.getCurrentEmploymentInfo().incomeInfoByTypeId(13)&&borrower.getCurrentEmploymentInfo().incomeInfoByTypeId(13).amount!=0))||(borrower.getCurrentEmploymentInfo().EmploymentTypeId==1&&(borrower.getCurrentEmploymentInfo().incomeInfoByTypeId(0)&&borrower.getCurrentEmploymentInfo().incomeInfoByTypeId(0).amount!=0||borrower.getCurrentEmploymentInfo().incomeInfoByTypeId(13)&&borrower.getCurrentEmploymentInfo().incomeInfoByTypeId(13).amount!=0))||((borrower.getCurrentEmploymentInfo().EmploymentTypeId==3)&&hasOtherIncomes)||(borrower.getCurrentEmploymentInfo().EmploymentTypeId==4);};this.areFieldsEntered=function(borrower){return common.string.isNullOrWhiteSpace(borrower.firstName)||common.string.isNullOrWhiteSpace(borrower.lastName);};this.areTabsDisabled=function(){return(_this.isSpouseOnTheLoan?(_this.areFieldsEntered(_this.getBorrower())||_this.areFieldsEntered(_this.getCoBorrower())):_this.areFieldsEntered(_this.getBorrower()));};this.getCombinedMiscDebts=function(){var rslt=[];var b;if(!!(b=_this.getBorrower())){rslt=rslt.concat(_this.getMiscDebtsForBorrower(b));}if(_this.isSpouseOnTheLoan&&!!(b=_this.getCoBorrower())){rslt=rslt.concat(_this.getMiscDebtsForBorrower(b));}return rslt;};this.getCombinedCollections=function(){if(_this.isSpouseOnTheLoan){return _this.getCollectionsForBorrower(_this.getBorrower()).concat(_this.getCollectionsForBorrower(_this.getCoBorrower()));}else{return _this.getCollectionsForBorrower(_this.getBorrower());}};this.getAllLiabilitiesCombined=function(){var liabilities=_this.getBorrower().getLiabilities();if(_this.isSpouseOnTheLoan){liabilities=liabilities.concat(_this.getCoBorrower().getLiabilities());}return liabilities;};this.getCombinedLiability=function(){if(_this.isSpouseOnTheLoan){return _this.getLiabilitiesForBorrower(_this.getBorrower()).concat(_this.getLiabilitiesForBorrower(_this.getCoBorrower()));}else{return _this.getLiabilitiesForBorrower(_this.getBorrower());}};this.getGroupedLiabilities=function(){return{"Borrower":_this.getLiabilitiesForBorrower(_this.getBorrower()),"Co-Borrower":_this.isSpouseOnTheLoan?_this.getLiabilitiesForBorrower(_this.getCoBorrower()):null};};this.refreshLiabilityLists=function(){};this.getCombinedPledgedAssets=function(){var pred=function(l){return !l.isRemoved&&l.isPledged&&!l.isSecondaryPartyRecord;};var reos=lib.filter(_this.getBorrower().getLiabilities(),pred);if(_this.isSpouseOnTheLoan){reos=reos.concat(lib.filter(_this.getCoBorrower().getLiabilities(),pred));}return reos;};this.getCombinedPublicRecords=function(){if(_this.combinedPublicRecordList==null){if(_this.isSpouseOnTheLoan){_this.combinedPublicRecordList=_this.getPublicRecordsForBorrower(_this.getBorrower()).concat(_this.getPublicRecordsForBorrower(_this.getCoBorrower()));}else{_this.combinedPublicRecordList=_this.getPublicRecordsForBorrower(_this.getBorrower());}}return _this.combinedPublicRecordList;};this.toggleBorrowerForItem=function(item,collectionOnBorrower,collectionOnCoBorrower,isJointAccount,deleteFromList){var result=_this.getProperCollection(item,collectionOnBorrower,collectionOnCoBorrower);if(result){if(result.collection===0){if(!isJointAccount){common.moveItemTo(result.index,collectionOnBorrower,collectionOnCoBorrower);_this.handleToggleBorrowerForItem(collectionOnBorrower,result.index,deleteFromList);}}else{if(result.collection===1){common.moveItemTo(result.index,collectionOnCoBorrower,collectionOnBorrower);_this.handleToggleBorrowerForItem(collectionOnCoBorrower,result.index,deleteFromList);}}}};this.handleToggleBorrowerForItem=function(collection,index,deleteFromList){if(deleteFromList){common.deleteItem(index,collection);}else{collection[index].isRemoved=true;}};this.switchBorrowerForMiscItem=function(item,collectionOnBorrower,collectionOnCoBorrower,isJointAccount){var newMisc=angular.copy(item);newMisc.miscellaneousDebtId=null;var index=common.indexOfItem(item,collectionOnBorrower);if(index!=-1){var borrowerMisc=collectionOnBorrower[index];borrowerMisc.isRemoved=true;collectionOnCoBorrower.push(newMisc);}var coIndex=common.indexOfItem(item,collectionOnCoBorrower);if(coIndex!=-1){var coBorrowerMisc=collectionOnCoBorrower[coIndex];coBorrowerMisc.isRemoved=true;collectionOnBorrower.push(newMisc);}};this.toggleLiabilitiesByDebtsAccountOwnershipType=function(item,borrowerCol,coBorrowerCol,accountType){var itemInCollection=_this.getProperCollection(item,borrowerCol,coBorrowerCol);if(accountType){if(itemInCollection.collection==0){common.deleteItem(common.indexOfItem(item,borrowerCol),borrowerCol);}if(itemInCollection.collection==1){common.deleteItem(common.indexOfItem(item,coBorrowerCol),coBorrowerCol);}switch(parseInt(accountType)){case 2:borrowerCol.push(item);break;case 0:case 3:borrowerCol.push(item);break;case 1:case 4:coBorrowerCol.push(item);break;default:borrowerCol.push(item);break;}}};this.deleteFromCollection=function(item,borrowersCollection,coBorrowersCollection){var result=_this.getProperCollection(item,borrowersCollection,coBorrowersCollection);if(result){if(result.collection===0){common.deleteItem(result.index,borrowersCollection);}else{if(result.collection===1){common.deleteItem(result.index,coBorrowersCollection);}}}};this.removeFromCollection=function(item,borrowersCollection,coBorrowersCollection){var result=_this.getProperCollection(item,borrowersCollection,coBorrowersCollection);if(result){if(result.collection===0){borrowersCollection[result.index].isRemoved=true;}else{if(result.collection===1){coBorrowersCollection[result.index].isRemoved=true;}}}};this.getCombinedAssetsCollection=function(){return _this.getCombinedAssets(_this.getBorrower(),_this.getCoBorrower());};this.getCombinedAssetsAutomobiles=function(){var automobilesFunction=_this.getCombinedAutomobilesByBorrower;if(_this.isSpouseOnTheLoan==true){return automobilesFunction(_this.getBorrower()).concat(automobilesFunction(_this.getCoBorrower()));}return automobilesFunction(_this.getBorrower());};this.getCombinedAssetsFinancials=function(){var financialsFunction=_this.getCombinedFinancialsByBorrower;if(_this.isSpouseOnTheLoan==true){return financialsFunction(_this.getBorrower()).concat(financialsFunction(_this.getCoBorrower()));}return financialsFunction(_this.getBorrower());};this.getCombinedAssetsLifeInsurence=function(){var lifeInsurenceFunction=_this.getCombinedLifeInsurenceByBorrower;if(_this.isSpouseOnTheLoan==true){return lifeInsurenceFunction(_this.getBorrower()).concat(lifeInsurenceFunction(_this.getCoBorrower()));}return lifeInsurenceFunction(_this.getBorrower());};this.collapseExpand=function(sectionName){switch(sectionName){case"BorrowerSection":_this.isBorrowerSectionShown=!_this.isBorrowerSectionShown;break;case"CoBorrowerSection":_this.isCoBorrowerSectionShown=!_this.isCoBorrowerSectionShown;break;case"TitleSection":_this.isTitleSectionShown=!_this.isTitleSectionShown;break;}_this.isSwitchBorrowerCoBorrowerShown=_this.isCoBorrowerSectionShown&&_this.isSpouseOnTheLoan;};this.triggerMaritalStatusRules=function(){var sectionName="";if(!_this.getBorrower()){return;}switch(_this.getBorrower().maritalStatus.toString()){case"0":_this.isSpouseOnTheLoan=true;_this.isSwitchBorrowerCoBorrowerShown=true;_this.isSpouseOnTheTitle=false;if(!_this.isCoBorrowerSectionShown){sectionName="CoBorrowerSection";}break;case"1":_this.isSpouseOnTheLoan=false;_this.isSwitchBorrowerCoBorrowerShown=false;if(!_this.isCoBorrowerSectionShown){sectionName="CoBorrowerSection";}break;case"2":_this.isSwitchBorrowerCoBorrowerShown=false;_this.isSpouseOnTheLoan=false;if(_this.isCoBorrowerSectionShown){sectionName="CoBorrowerSection";}break;case"-1":if(_this.isCoBorrowerSectionShown){sectionName="CoBorrowerSection";}break;default:if(_this.isCoBorrowerSectionShown&&!_this.isSpouseOnTheLoan&&!_this.isSpouseOnTheTitle){sectionName="CoBorrowerSection";_this.isSwitchBorrowerCoBorrowerShown=true;}break;}_this.collapseExpand(sectionName);};this.getUserAccountTooltipMessage=function(userAccount,spouseUsername,isSpouseOnline,isSpouseActivated){var tooltipMassage="";if(userAccount.username&&_this.isSpouseOnTheLoan&&userAccount.username==spouseUsername){if(!userAccount.username){return tooltipMassage+="Joint Offline - No eMail address";}else{if(!userAccount.isOnlineUser&&!isSpouseOnline){return tooltipMassage+="Joint  Offline - With eMail address";}else{if(!userAccount.isActivated&&!isSpouseActivated){return tooltipMassage+="Joint Online - Not Activated";}else{return tooltipMassage+="Joint Online - Activated";}}}}else{if(!userAccount.username){return tooltipMassage+="Offline - No eMail address";}else{if(!userAccount.isOnlineUser){return tooltipMassage+="Offline - With eMail address";}else{if(!userAccount.isActivated){return tooltipMassage+="Online - Not Activated";}else{return tooltipMassage+="Online - Activated";}}}}};this.onIsSpouseOnTheLoanChange=function(triggerTitleChange){if(_this.isSpouseOnTheLoan){_this.isSwitchBorrowerCoBorrowerShown=true;_this.isSpouseOnTheTitle=false;_this.initializeCoBorrowerAddresses();}else{_this.isSpouseOnTheTitle=false;_this.isSwitchBorrowerCoBorrowerShown=false;}};this.initializeCoBorrowerAddresses=function(){};this.isBorrowerCoBorrowerAddressSectionsCompleted=function(borrower){var result;var currentAddress=borrower.getCurrentAddress();var mailingAddress=borrower.getMailingAddress();if(currentAddress.isSameAsPropertyAddress){currentAddress=_this.getTransactionInfo().getLoan().getSubjectProperty();}if(mailingAddress.isSameMailingAsBorrowerCurrentAddress){mailingAddress=currentAddress;}result=currentAddress.isValid()&&borrower.getCurrentAddress().isOwnershipValid()&&mailingAddress.isValid();if(borrower.getCurrentAddress().timeAtAddressYears<2){var previousAddress=borrower.getPreviousAddress();if(previousAddress.isSameAsPrimaryBorrowerCurrentAddress){previousAddress=currentAddress;}result=result&&previousAddress.isValid()&&previousAddress.isOwnershipValid();}return result;};this.isBorrowerDecalarationsCompleted=function(borrower){var result;result=(_this.declarations.loanOriginatorSource!=null&&_this.declarations.loanOriginatorSource.toString()!="")&&(borrower.declarationsInfo.additionalInformationCheckboxIndicator==false||borrower.declarationsInfo.additionalInformationCheckboxIndicator==true);if(borrower.declarationsInfo.additionalInformationCheckboxIndicator==false){result=result&&(borrower.declarationsInfo.ethnicityId!=null&&borrower.declarationsInfo.ethnicityId.toString()!="")&&(borrower.declarationsInfo.race!=null&&borrower.declarationsInfo.race.toString()!="")&&(borrower.declarationsInfo.sexId!=null&&borrower.declarationsInfo.sexId.toString()!="");}result=result&&(borrower.declarationsInfo.outstandingJudgmentsIndicator==0||borrower.declarationsInfo.outstandingJudgmentsIndicator==1)&&(borrower.declarationsInfo.bankrupcyIndicator==0||borrower.declarationsInfo.bankrupcyIndicator==1)&&(borrower.declarationsInfo.propertyForeclosedIndicator==0||borrower.declarationsInfo.propertyForeclosedIndicator==1)&&(borrower.declarationsInfo.partyToLawsuitIndicator==0||borrower.declarationsInfo.partyToLawsuitIndicator==1)&&(borrower.declarationsInfo.obligatedLoanIndicator==0||borrower.declarationsInfo.obligatedLoanIndicator==1)&&(borrower.declarationsInfo.presentlyDelinquentIndicator==0||borrower.declarationsInfo.presentlyDelinquentIndicator==1)&&(borrower.declarationsInfo.alimonyChildSupportObligation==0||borrower.declarationsInfo.alimonyChildSupportObligation==1)&&(borrower.declarationsInfo.downPaymentIndicator==0||borrower.declarationsInfo.downPaymentIndicator==1)&&(borrower.declarationsInfo.noteEndorserIndicator==0||borrower.declarationsInfo.noteEndorserIndicator==1)&&(borrower.usCitizen==true||borrower.usCitizen==false)&&(borrower.permanentAlien==true||borrower.permanentAlien==false)&&(borrower.declarationsInfo.propertyAsPrimaryResidence==0||borrower.declarationsInfo.propertyAsPrimaryResidence==1)&&(borrower.declarationsInfo.ownershipInterestLastThreeYears==0||borrower.declarationsInfo.ownershipInterestLastThreeYears==1);if(borrower.declarationsInfo.ownershipInterestLastThreeYears==0){result=result&&(borrower.declarationsInfo.typeOfProperty!=null&&borrower.declarationsInfo.typeOfProperty.toString()!="")&&(borrower.declarationsInfo.priorPropertyTitleType!=null&&borrower.declarationsInfo.priorPropertyTitleType.toString()!="");}if(_this.declarations.loanOriginatorSource==0){var dateBefore,dateAfter;if(borrower.declarationsInfo.dateIssued!=null){dateBefore=moment(borrower.declarationsInfo.dateIssued).format("MM/DD/YYYY");}if(borrower.declarationsInfo.dateExpired!=null){dateAfter=moment(borrower.declarationsInfo.dateExpired).format("MM/DD/YYYY");}result=result&&borrower.declarationsInfo.certificationId!=null&&result&&borrower.declarationsInfo.certificationId!=14&&borrower.declarationsInfo.numberId!=null&&borrower.declarationsInfo.stateId!=null&&new Date(dateBefore)<new Date(dateAfter)&&new Date(dateBefore).getFullYear()>=1900&&new Date(dateAfter).getFullYear()>=1900||borrower.declarationsInfo.certificationId==14&&borrower.declarationsInfo.otherInformation!="";}return result;};this.isSubjectPropertySectionCompleted=function(subjectProperty,loanType,loanAmount,downPaymentTypeCode){var result;if(!subjectProperty){return false;}result=(!common.string.isNullOrWhiteSpace(subjectProperty.cityName)&&!common.string.isNullOrWhiteSpace(subjectProperty.countyName)&&!common.string.isNullOrWhiteSpace(subjectProperty.stateName)&&!common.string.isNullOrWhiteSpace(subjectProperty.streetName)&&!common.string.isNullOrWhiteSpace(subjectProperty.zipCode)&&subjectProperty.purchasePrice>0&&subjectProperty.monthlyHOAdues>=0&&loanAmount>0);if(+subjectProperty.propertyType==2){result=result&&subjectProperty.numberOfStories>0;}if(loanType===1){result=result&&subjectProperty.downPayment>=0&&!!downPaymentTypeCode;if(_this.occupancyType==2){result=result&&subjectProperty.grossRentalIncome>=0&&subjectProperty.OwnershipPercentage>0&&subjectProperty.vacancyPercentage>0;}}else{if(loanType==2){result=result&&subjectProperty.purchaseDate&&(subjectProperty.currentEstimatedValue>0&&subjectProperty.purchaseDate!=null);}}return result;};this.getBorrowerDebtAccountOwnershipTypes=function(loanApplication){var debtAccountOwnershipTypes=new Array();debtAccountOwnershipTypes.push(new cls.LookupItem(loanApplication.getBorrower().fullName,String(0)));if(loanApplication.isSpouseOnTheLoan){debtAccountOwnershipTypes.push(new cls.LookupItem(loanApplication.getBorrower().fullName+", "+loanApplication.getCoBorrower().fullName,String(2)));}else{debtAccountOwnershipTypes.push(new cls.LookupItem(loanApplication.getBorrower().fullName+" with Other",String(3)));}return debtAccountOwnershipTypes;};this.Borrowers=function(includeJointAccount,useBorrowerId,useFullNamesForJointAccount){if(includeJointAccount===void 0){includeJointAccount=true;}_this.borrowers=[];_this.borrowers.push(_this.populateBorrowerLookup(_this.getBorrower(),useBorrowerId));if(_this.isSpouseOnTheLoan){_this.borrowers.push(_this.populateBorrowerLookup(_this.getCoBorrower(),useBorrowerId));if(includeJointAccount){var jointAccountText="Joint Account";if(useFullNamesForJointAccount){jointAccountText=_this.getBorrower().fullName+", "+_this.getCoBorrower().fullName;}_this.borrowers.push({value:"JointAccount",text:jointAccountText,selected:false,disabled:false,stringValue:null,description:null});}}_this.borrowerLookupList=_this.borrowers;return _this.borrowers;};this.LiabilitiesFor=function(){_this.liabilitiesFor=[];_this.liabilitiesFor.push({value:"Borrower",text:_this.getBorrower().fullName,selected:true,disabled:false,stringValue:null,description:null});if(_this.isSpouseOnTheLoan){_this.liabilitiesFor.push({value:"CoBorrower",text:_this.getCoBorrower().fullName,selected:false,disabled:false,stringValue:null,description:null});var jointAccountText=_this.getBorrower().fullName+", "+_this.getCoBorrower().fullName;_this.liabilitiesFor.push({value:"Joint",text:jointAccountText,selected:false,disabled:false,stringValue:null,description:null});}return _this.liabilitiesFor;};this.borrowerList=function(useBorrowerId){_this._borrowerList=[];_this._borrowerList.push(_this.populateBorrowerLookup(_this.getBorrower(),useBorrowerId));if(_this.isSpouseOnTheLoan){_this._borrowerList.push(_this.populateBorrowerLookup(_this.getCoBorrower(),useBorrowerId));}return _this._borrowerList;};this.borrowerJointList=function(){_this._borrowerJointList=[];_this._borrowerJointList.push({value:_this.getBorrower().fullName,text:_this.getBorrower().fullName,selected:false,disabled:false,stringValue:null,description:null});if(_this.isSpouseOnTheLoan){_this._borrowerJointList.push({value:_this.getCoBorrower().fullName,text:_this.getCoBorrower().fullName,selected:false,disabled:false,stringValue:null,description:null});_this._borrowerJointList.push({value:_this.getBorrower().fullName+", "+_this.getCoBorrower().fullName,text:_this.getBorrower().fullName+", "+_this.getCoBorrower().fullName,selected:false,disabled:false,stringValue:null,description:null});}return _this._borrowerJointList;};this.getProperCollection=function(item,borrowersCollection,coBorrowersCollection){var collectionType=0;var index=common.indexOfItem(item,borrowersCollection);if(index===-1){index=common.indexOfItem(item,coBorrowersCollection);collectionType=1;}if(index===-1){return null;}return{collection:collectionType,index:index};};this.getOtherIncomeForBorrower=function(borrower){return borrower.getOtherIncome();};this.getCombinedAutomobilesByBorrower=function(borrower){return borrower.getAutomobiles();};this.getCombinedFinancialsByBorrower=function(borrower){return borrower.getFinancials();};this.getCombinedLifeInsurenceByBorrower=function(borrower){return borrower.getLifeInsurance();};this.getCombinedAssets=function(borrower,coBorrower){var borrowerAssets=borrower.getAssets(),coBorrowerAssets=coBorrower.getAssets();return borrowerAssets.concat(coBorrowerAssets);};this.getMiscDebtsForBorrower=function(borrower){return borrower.populateBorrowerId(borrower.getMiscDebts());};this.getCollectionsForBorrower=function(borrower){return borrower.populateBorrowerId(borrower.getCollections());};this.getLiabilitiesForBorrower=function(borrower){return borrower.populateBorrowerId(borrower.getLiability());};this.getPublicRecordsForBorrower=function(borrower){return borrower.getPublicRecords();};this.refreshRealEstate=function(updatedLoanApplication){_this.realEstate.addressForDropDown=updatedLoanApplication.realEstate.addressForDropDown;};this.prepareForSubmit=function(){_this.getBorrower().prepareForSubmit();_this.getCoBorrower().prepareForSubmit();};this.initialize=function(loanApplication){if(loanApplication){if(loanApplication.documents){for(var i=0;i<_this.documents.length;i++){_this.documents[i]=new cls.DocumentsViewModel(_this.documents[i]);}}_this.titleInfo=new cls.TitleInformationViewModel(loanApplication.titleInfo);_this.credit=new cls.CreditViewModel(_this.credit);if(_this.disclosureStatusDetails&&_this.disclosureStatusDetails.disclosureStatus){_this.setDisclosureStatusTitle();}else{_this.disclosureStatusDetails={};}}else{_this.setBorrower(new cls.BorrowerViewModel(_this.getTransactionInfo(),null));_this.setCoBorrower(new cls.BorrowerViewModel(_this.getTransactionInfo(),null));if(_this.hasTransactionInfo()){_this.getBorrower().setCurrentEmploymentInfo(new cls.CurrentEmploymentInfoViewModel(_this.getTransactionInfo(),null));_this.getCoBorrower().setCurrentEmploymentInfo(new cls.CurrentEmploymentInfoViewModel(_this.getTransactionInfo(),null));_this.getCoBorrower().isEmployedTwoYears=true;_this.getBorrower().isEmployedTwoYears=true;}_this.isPrimary=false;_this.isCoBorrowerSectionShown=false;_this.triggerMaritalStatusRules();_this.onIsSpouseOnTheLoanChange(false);_this.credit=new cls.CreditViewModel();}if(!_this.titleInfo){_this.titleInfo=new cls.TitleInformationViewModel();}if(!_this.miscDebts){_this.miscDebts=[];}if(!_this.collections){_this.collections=[];}if(!_this.realEstate){_this.realEstate=new cls.RealEstateViewModel();}if(!_this.declarations){_this.declarations=new cls.DeclarationViewModel();}if(!_this.appraisedValueHistories){_this.appraisedValueHistories=[];}var miscDebtsCombined=_this.getCombinedMiscDebts();if(miscDebtsCombined){if(miscDebtsCombined.length===0){var b=_this.getBorrower();if(!!b){var fullNameBorrower=b.getFullName();var childAlimonyDefault=new cls.MiscellaneousDebtViewModel(null,1,false,fullNameBorrower);var jobExpenseDefault=new cls.MiscellaneousDebtViewModel(null,2,false,fullNameBorrower);childAlimonyDefault.isDefaultValue=true;jobExpenseDefault.isDefaultValue=true;jobExpenseDefault.clientIdForOrder=-1;childAlimonyDefault.clientIdForOrder=-2;b.miscellaneousDebt.push(childAlimonyDefault,jobExpenseDefault);}}else{var childAlimony=miscDebtsCombined.filter(function(item){return item.typeId===1;});var jobRelatedExpense=miscDebtsCombined.filter(function(item){return item.typeId===2;});if(childAlimony.length===0){var childAlimonyDefault=new cls.MiscellaneousDebtViewModel(null,1,false,_this.getBorrower().getFullName());childAlimonyDefault.isDefaultValue=true;childAlimonyDefault.clientIdForOrder=-2;_this.getBorrower().miscellaneousDebt.push(childAlimonyDefault);}if(jobRelatedExpense.length===0){var jobExpenseDefault=new cls.MiscellaneousDebtViewModel(null,2,false,_this.getBorrower().getFullName());jobExpenseDefault.isDefaultValue=true;jobExpenseDefault.clientIdForOrder=-1;_this.getBorrower().miscellaneousDebt.push(jobExpenseDefault);}}}if(!_this.occupancyType){_this.occupancyType=1;}_this.defaultCurrentAddress(_this.getBorrower());_this.defaultMailingAddress(_this.getBorrower());_this.defaultCurrentAddress(_this.getCoBorrower());_this.defaultMailingAddress(_this.getCoBorrower());_this.isFirstAndLastNameEnteredForBorrowers=true;_this.isBorrowerSectionShown=true;_this.isCoBorrowerSectionShown=((!!_this.getBorrower()&&(_this.getBorrower().maritalStatus==0||_this.getBorrower().maritalStatus==1))||_this.isSpouseOnTheLoan||_this.isSpouseOnTheTitle)?true:false;_this.isTitleSectionShown=true;_this.isSwitchBorrowerCoBorrowerShown=_this.isCoBorrowerSectionShown&&_this.isSpouseOnTheLoan;_this.howDidYouHearAboutUsEnabled=_this.howDidYouHearAboutUs==null;if(_this.titleInfo&&_this.titleInfo.titleHeldIn==0){_this.showNamesAndManner=true;}else{_this.showNamesAndManner=false;}_this.initializeCredit();};this.defaultCurrentAddress=function(borrower){if(borrower.isCoBorrower&&(!angular.isDefined(borrower.getCurrentAddress().isSameAsPrimaryBorrowerCurrentAddress)||borrower.getCurrentAddress().isSameAsPrimaryBorrowerCurrentAddress==null)){borrower.getCurrentAddress().isSameAsPrimaryBorrowerCurrentAddress=true;}if(borrower.isCoBorrower&&borrower.getCurrentAddress().isSameAsPrimaryBorrowerCurrentAddress){borrower.getCurrentAddress().timeAtAddressYears=null;borrower.getCurrentAddress().timeAtAddressMonths=null;borrower.getMailingAddress().isSameMailingAsBorrowerCurrentAddress=true;}if(!borrower.getCurrentAddress().ownership){borrower.getCurrentAddress().ownership=0;}};this.defaultMailingAddress=function(borrower){if(!angular.isDefined(borrower.getMailingAddress().isSameMailingAsBorrowerCurrentAddress)||borrower.getMailingAddress().isSameMailingAsBorrowerCurrentAddress==null){borrower.getMailingAddress().isSameMailingAsBorrowerCurrentAddress=true;}};this.setDisclosureStatusTitle=function(){switch(_this.disclosureStatusDetails.disclosureStatus){case 2:case 4:_this.disclosureStatusDetails.disclosureStatusText="Initial Disclosure Required";break;case 3:_this.disclosureStatusDetails.disclosureStatusText="Re-Disclosure Required";break;case 5:_this.disclosureStatusDetails.disclosureStatusText="Disclosures Created";break;default:_this.disclosureStatusDetails.disclosureStatusText="Not Needed";break;}};this.setCompanyDataName=function(source){var action=function(liability){return liability.companyData.companyName=(liability.typeId==2||liability.typeId==3)&&!liability.companyData.companyName&&!liability.isNewRow?"Not specified":liability.companyData.companyName;};lib.forEach(source,action);};this.createBorrowersLiabilities=function(borrower,coBorrower){var borrowersLiabilities=[];if(borrower){borrowersLiabilities.push({borrowerFullName:borrower.fullName,isBorrower:true,liabilities:borrower.getLiabilities()});}if(coBorrower&&_this.isSpouseOnTheLoan){borrowersLiabilities.push({borrowerFullName:coBorrower.fullName,isBorrower:false,liabilities:coBorrower.getLiabilities()});}return borrowersLiabilities;};this.initializeCredit=function(){if(!_this.getBorrower()){return;}var allLiabilities=_this.getBorrower().getLiabilities();_this.setCompanyDataName(allLiabilities);if(_this.isSpouseOnTheLoan&&_this.getCoBorrower()&&_this.getCoBorrower().getLiabilities()){allLiabilities=allLiabilities.concat(_this.getCoBorrower().getLiabilities());}var allPublicRecords=_this.getBorrower().publicRecords;if(_this.isSpouseOnTheLoan&&_this.getCoBorrower()&&_this.getCoBorrower().publicRecords){allPublicRecords=allPublicRecords.concat(_this.getCoBorrower().publicRecords);}_this.publicRecords=allPublicRecords;_this.collections=lib.filter(allLiabilities,function(liability){return !liability.isRemoved&&liability.typeId==3&&!liability.isPledged;});_this.reos=lib.filter(allLiabilities,function(liability){return !liability.isRemoved&&liability.isPledged;});_this.borrowerLiabilities=_this.createBorrowersLiabilities(_this.getBorrower(),_this.getCoBorrower());};this.borrowerHasChildAlimony=function(){return _this.getMiscDebtsForBorrower(_this.getBorrower()).filter(function(item){return item.typeId==1&&(!item.isDefaultValue||item.isDefaultValue===undefined||item.payee!="")&&!item.isRemoved;}).length>0;};this.coBorrowerHasChildAlimony=function(){return _this.getMiscDebtsForBorrower(_this.getCoBorrower()).filter(function(item){return item.typeId==1&&(!item.isDefaultValue||item.isDefaultValue===undefined||item.payee!="")&&!item.isRemoved;}).length>0;};this.addDefaultChildAlimonyIfLastRemoved=function(){if(_this.getBorrower().miscellaneousDebt){var childAlimonyBorrower=_this.getBorrower().miscellaneousDebt.filter(function(item){return item.typeId==1&&!item.isRemoved;});var childAlimonyCoBorrower=_this.getCoBorrower().miscellaneousDebt.filter(function(item){return item.typeId==1&&!item.isRemoved;});if(childAlimonyBorrower.length===0&&childAlimonyCoBorrower.length===0){var childAlimonyDefault=new cls.MiscellaneousDebtViewModel(null,1,false,_this.getBorrower().getFullName());childAlimonyDefault.isDefaultValue=true;childAlimonyDefault.clientIdForOrder=-2;_this.getBorrower().miscellaneousDebt.push(childAlimonyDefault);}}};this.validateEmail=function(email){var reg=/^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;return reg.test(email)||email==null||email==undefined;};if(!!loanApplication){lib.copyState(loanApplication,this);}if(!this.loanApplicationId||this.loanApplicationId==lib.getEmptyGuid()){this.loanApplicationId=util.IdentityGenerator.nextGuid();}if(!!ti){this.setTransactionInfo(ti);ti.loanApplication.map(this);}this.initialize(loanApplication);}Object.defineProperty(LoanApplicationViewModel.prototype,"OccupancyType",{get:function(){return this.occupancyType;},set:function(value){this.occupancyType=value;if(this.isPrimary){var loan=this.getTransactionInfo().getLoan();if(loan&&loan.fhaScenarioViewModel&&value!=2){loan.fhaScenarioViewModel.isPropertyAdjacent=false;}}},enumerable:true,configurable:true});Object.defineProperty(LoanApplicationViewModel.prototype,"groupedLiabilities",{get:function(){if(!this._groupedLiabilities){this._groupedLiabilities=this.getGroupedLiabilities();}return this._groupedLiabilities;},set:function(groupedLiabilities){this._groupedLiabilities=groupedLiabilities;},enumerable:true,configurable:true});Object.defineProperty(LoanApplicationViewModel.prototype,"getReoEstimatedValueTotal",{get:function(){var total=0;angular.forEach(this.getCombinedPledgedAssets(),function(reoItem){if(!reoItem.notMyLoan&&reoItem.borrowerDebtCommentId!=9&&!reoItem.isRemoved&&reoItem.getProperty()&&reoItem.getProperty().currentEstimatedValue&&(!reoItem.lienPosition||reoItem.lienPosition==-1||reoItem.lienPosition==1)){var amount=parseFloat(reoItem.getProperty().currentEstimatedValue.toString());if(!amount||isNaN(amount)){amount=0;}total+=parseFloat(String(amount));}});return total;},enumerable:true,configurable:true});LoanApplicationViewModel.prototype.getLiabilitesPaymentTotal=function(borrower){var list;if(!borrower){list=this.getCombinedLiability();}else{list=this.getLiabilitiesForBorrower(borrower);}var total=0;angular.forEach(list,function(liability){if(liability.includeInDTI&&!liability.isRemoved&&liability.minPayment){var amount=parseFloat(String(liability.minPayment));if(!amount||isNaN(amount)){amount=0;}total+=parseFloat(String(amount));}});return total;};LoanApplicationViewModel.prototype.getCollectionsTotalUnpaidBalance=function(){var total=0;angular.forEach(this.getCombinedCollections(),function(collection){if(collection.includeInLiabilitiesTotal&&!collection.isRemoved&&collection.unpaidBalance){var amount=parseFloat(collection.unpaidBalance.toString());if(!amount||isNaN(amount)){amount=0;}total+=parseFloat(String(amount));}});return total;};LoanApplicationViewModel.prototype.getCollectionsTotalPayment=function(){var total=0;angular.forEach(this.getCombinedCollections(),function(collection){if(collection.includeInLiabilitiesTotal&&!collection.isRemoved&&collection.minPayment){var amount=parseFloat(collection.minPayment.toString());if(!amount||isNaN(amount)){amount=0;}total+=parseFloat(String(amount));}});return total;};Object.defineProperty(LoanApplicationViewModel.prototype,"OwnershipPercentage",{get:function(){if(!this.ownershipPercentage){return 0;}else{return this.ownershipPercentage;}},set:function(value){if(!value){this.ownershipPercentage=0;}else{this.ownershipPercentage=value;}},enumerable:true,configurable:true});LoanApplicationViewModel.prototype.populateBorrowerLookup=function(borrower,useBorrowerId){return{value:useBorrowerId?borrower.borrowerId:borrower.firstName+" "+borrower.lastName,text:borrower.firstName+" "+borrower.lastName,selected:false,disabled:false,stringValue:null,description:null};};return LoanApplicationViewModel;})(srv.cls.LoanApplicationViewModel);cls.LoanApplicationViewModel=LoanApplicationViewModel;})(cls||(cls={}));var __extends=this.__extends||function(d,b){for(var p in b){if(b.hasOwnProperty(p)){d[p]=b[p];}}function __(){this.constructor=d;}__.prototype=b.prototype;d.prototype=new __();};var cls;(function(cls){(function(LiablitityTypeEnum){LiablitityTypeEnum[LiablitityTypeEnum["REO"]=1]="REO";LiablitityTypeEnum[LiablitityTypeEnum["Liability"]=2]="Liability";LiablitityTypeEnum[LiablitityTypeEnum["Collection"]=3]="Collection";LiablitityTypeEnum[LiablitityTypeEnum["PublicRecord"]=4]="PublicRecord";LiablitityTypeEnum[LiablitityTypeEnum["MiscExpense"]=5]="MiscExpense";})(cls.LiablitityTypeEnum||(cls.LiablitityTypeEnum={}));var LiablitityTypeEnum=cls.LiablitityTypeEnum;var BorrowerViewModel=(function(_super){__extends(BorrowerViewModel,_super);function BorrowerViewModel(ti,borrower){var _this=this;_super.call(this);this.defaultName="New Application";this.hasTransactionalInfo=function(){return(!!_this.ticb&&!!_this.ticb());};this.getTransactionalInfo=function(){if(_this.hasTransactionalInfo()){return _this.ticb();}else{return null;}};this.setTransactionalInfo=function(ti){_this.ticb=function(){return ti;};};this.hasTransactionalInfoLiability=function(){if(_this.hasTransactionalInfo()&&!!_this.getTransactionalInfo().liability){return true;}else{return false;}};this.getTransactionInfoLiability=function(){if(_this.hasTransactionalInfoLiability()){return _this.getTransactionalInfo().liability;}return new cls.Map();};this.getLiabilities=function(){if(_this.hasTransactionalInfoLiability()){return lib.filter(_this.getTransactionInfoLiability().getValues(),function(o){return !o.isRemoved&&o.borrowerId==_this.borrowerId;});}return[];};this.addLiability=function(liability){if(!!liability&&_this.hasTransactionalInfoLiability()){liability.borrowerId=_this.borrowerId;_this.getLiabilities().push(liability);}};this.hasTransactionalInfoOtherIncomes=function(){if(_this.hasTransactionalInfo()&&!!_this.getTransactionalInfo().incomeInfo){return true;}else{return false;}};this.getTransactionInfoOtherIncome=function(){if(_this.hasTransactionalInfoOtherIncomes()){return _this.getTransactionalInfo().incomeInfo;}return new cls.Map([],function(o){return o.incomeInfoId;});};this.getTransactionInfoAddress=function(){return new cls.Map([],function(o){return o.borrowerId;});};this.getOtherIncomes=function(){if(_this.hasTransactionalInfoOtherIncomes()){var incomes=lib.filter(_this.getTransactionInfoOtherIncome().getValues(),function(o){return o.borrowerId==_this.borrowerId&&!o.isRemoved&&(!o.employmentInfoId||o.employmentInfoId==lib.getEmptyGuid());});return incomes;}return[];};this.setOtherIncomes=function(incomes){if(!!incomes&&_this.hasTransactionalInfoOtherIncomes()){incomes.forEach(function(o){o.borrowerId=_this.borrowerId;o.employmentInfoId=null;});_this.getTransactionInfoOtherIncome().mapAll(incomes);}};this.addOtherIncome=function(){var otherIncomeNew=new cls.IncomeInfoViewModel(_this.getTransactionalInfo());otherIncomeNew.isCurrentlyAdded=true;_this.setOtherIncomes([otherIncomeNew]);return otherIncomeNew;};this.removeIncomeInfoViewModel=function(incomeInfoViewModelVm){return incomeInfoViewModelVm.isRemoved=true;};this.deleteIncomeInfoViewModel=function(incomeInfoViewModelVm){var incomeInfoExisting=_this.getTransactionInfoOtherIncome().remove(incomeInfoViewModelVm);return(!!incomeInfoExisting);};this.removeOrDeleteIncomeInfoViewModel=function(incomeInfoViewModelVm){if(!incomeInfoViewModelVm||incomeInfoViewModelVm.isNetRental){return false;}else{if(incomeInfoViewModelVm.isCurrentlyAdded){return _this.deleteIncomeInfoViewModel(incomeInfoViewModelVm);}else{return _this.removeIncomeInfoViewModel(incomeInfoViewModelVm);}}};this.addNewAddress=function(){var otherIncomeNew=new cls.IncomeInfoViewModel(_this.getTransactionalInfo());otherIncomeNew.isCurrentlyAdded=true;_this.setOtherIncomes([otherIncomeNew]);return otherIncomeNew;};this.hasTransactionalInfoEmployment=function(){if(_this.hasTransactionalInfo()&&!!_this.getTransactionalInfo().employmentInfo){return true;}else{return false;}};this.getTransactionInfoEmployment=function(){if(_this.hasTransactionalInfoEmployment()){return _this.getTransactionalInfo().employmentInfo;}return new cls.Map();};this.getEmploymentInfoes=function(){if(_this.hasTransactionalInfoEmployment()){if(!_this._employmentInfoes||!_this._employmentInfoes.length){_this._employmentInfoes=lib.filter(_this.getTransactionInfoEmployment().getValues(),function(o){return !o.isRemoved&&o.borrowerId==_this.borrowerId;});}return _this._employmentInfoes;}return[];};this.setEmploymentInfoes=function(employmentInfoes){if(!!employmentInfoes&&_this.hasTransactionalInfoEmployment()){employmentInfoes.forEach(function(o){o.borrowerId=_this.borrowerId;if(!o.employmentInfoId||o.employmentInfoId==lib.getEmptyGuid()){o.employmentInfoId=util.IdentityGenerator.nextGuid();}});_this.getTransactionInfoEmployment().mapAll(employmentInfoes);_this.invalidateEmployeeInfoes();}};this.removeEmploymentInfo=function(employmentInfoVm){employmentInfoVm.isRemoved=true;_this.invalidateEmployeeInfoes();return true;};this.deleteEmploymentInfo=function(employmentInfoVm){var employmentInfoExisting=_this.getTransactionInfoEmployment().remove(employmentInfoVm);_this.invalidateEmployeeInfoes();return(!!employmentInfoExisting);};this.removeOrDeleteEmploymentInfo=function(employmentInfoVm){if(!employmentInfoVm){return false;}else{if(employmentInfoVm.isAdded){return _this.deleteEmploymentInfo(employmentInfoVm);}else{return _this.removeEmploymentInfo(employmentInfoVm);}}};this.invalidateEmployeeInfoes=function(){_this._employmentInfoes=null;_this.getEmploymentInfoes();};this.getCurrentEmploymentInfo=function(){var cei=lib.findFirst(_this.getEmploymentInfoes(),function(o){return !o.isAdditional;});return cei;};this.setCurrentEmploymentInfo=function(employmentInfo){if(!employmentInfo||!_this.hasTransactionalInfoEmployment()){return;}var employmentInfoOrig=_this.getCurrentEmploymentInfo();if(!!employmentInfoOrig){_this.deleteEmploymentInfo(employmentInfoOrig);}employmentInfo.isAdditional=false;employmentInfo.isPresent=true;_this.setEmploymentInfoes([employmentInfo]);};this.getAdditionalEmploymentInfo=function(){return _this.getEmploymentInfoes().filter(function(o){return o.isAdditional;});};this.setAdditionalEmploymentInfo=function(employmentInfoes){if(!employmentInfoes||!_this.hasTransactionalInfoEmployment()){return;}employmentInfoes.forEach(function(o){return o.isAdditional=true;});_this.setEmploymentInfoes(employmentInfoes);};this.replaceAdditionalEmploymentInfo=function(employmentInfoes){if(!employmentInfoes||!_this.hasTransactionalInfoEmployment()){return;}var existing=_this.getAdditionalEmploymentInfo();existing.forEach(function(o){return _this.getTransactionInfoEmployment().remove(o);});_this.setAdditionalEmploymentInfo(employmentInfoes);};this.addAdditionalEmploymentInfo=function(isPrevious){var employmentInfo=new cls.AdditionalEmploymentInfoViewModel(_this.getTransactionalInfo(),null,isPrevious);employmentInfo.isAdded=true;_this.setEmploymentInfoes([employmentInfo]);return employmentInfo;};this.hasTransactionalInfoProperty=function(){if(_this.hasTransactionalInfo()&&!!_this.getTransactionalInfo().property){return true;}else{return false;}};this.getTransactionInfoProperty=function(){if(_this.hasTransactionalInfoProperty()){return _this.getTransactionalInfo().property;}return new cls.Map();};this.getProperty=function(propertyId,bindAction){if(_this.hasTransactionalInfoProperty()){var property=_this.getTransactionInfoProperty().lookup(propertyId);if(!property){property=new cls.PropertyViewModel(_this.getTransactionalInfo());property.borrowerId=_this.borrowerId;property.isSubjectProperty=false;property.isSameAsPropertyAddress=false;if(!property.loanId||property.loanId==lib.getEmptyGuid()){property.loanId=_this.loanApplicationId;}bindAction(property);_this.getTransactionInfoProperty().map(property);}return property;}return null;};this.getCurrentAddress=function(){return _this.getProperty(_this.currentAddressId,function(p){p.addressTypeId=1;_this.currentAddressId=p.propertyId;p.isSameAsPrimaryBorrowerCurrentAddress=angular.isDefined(p.isSameAsPrimaryBorrowerCurrentAddress)&&p.isSameAsPrimaryBorrowerCurrentAddress!=null?p.isSameAsPrimaryBorrowerCurrentAddress:true;});};this.setCurrentAddress=function(currentAddress){if(!currentAddress){_this.getTransactionInfoAddress().map(currentAddress);}};this.saveCurrentAddress=function(){var caNew=new cls.PropertyViewModel(_this.getTransactionalInfo());_this.setCurrentAddress(caNew);return caNew;};this.getMailingAddress=function(){return _this.getProperty(_this.mailingAddressId,function(p){p.addressTypeId=3;_this.mailingAddressId=p.propertyId;});};this.getPreviousAddress=function(){return _this.getProperty(_this.previousAddressId,function(p){p.addressTypeId=2;_this.previousAddressId=p.propertyId;});};this.emailFieldDisabled=false;this.getFullName=function(){return _this.fullName;};this.getCombinedCurrentAndAdditionalEmployments=function(){var combinedIncomes=[];var employmentCurrent=_this.getCurrentEmploymentInfo();if(!!employmentCurrent){combinedIncomes.push(employmentCurrent);}combinedIncomes=combinedIncomes.concat(_this.getAdditionalEmploymentInfo());return combinedIncomes;};this.initialize=function(borrower){if(borrower){var publicRecords=[];if(borrower.publicRecords&&borrower.publicRecords.length>0){for(var i=0,j=(borrower.publicRecords?borrower.publicRecords.length:0);i<j;i++){var publicRecord=new cls.PublicRecordViewModel(borrower.publicRecords[i],_this.getFullName);publicRecords.push(publicRecord);}_this.publicRecords=publicRecords;}var miscellaneousDebts=[];if(borrower.miscellaneousDebt&&borrower.miscellaneousDebt.length>0){for(var i=0,j=(borrower.miscellaneousDebt?borrower.miscellaneousDebt.length:0);i<j;i++){var miscDebt=new cls.MiscellaneousDebtViewModel(borrower.miscellaneousDebt[i],null,null,_this.getFullName());miscellaneousDebts.push(miscDebt);}_this.miscellaneousDebt=miscellaneousDebts;}var assets=[];if(borrower.assets&&borrower.assets.length>0){for(var i=0;i<borrower.assets.length;i++){var asset=new cls.AssetViewModel(borrower.assets[i]);assets.push(asset);}_this.assets=assets;}_this.getCurrentAddress().addressTypeId=1;_this.getMailingAddress().addressTypeId=3;_this.getPreviousAddress().addressTypeId=2;}if(!_this.userAccount){_this.userAccount=new cls.UserAccountViewModel();}else{_this.userAccount=new cls.UserAccountViewModel(_this.userAccount);}if(!_this.assets){_this.assets=[];}if(!_this.publicRecords){_this.publicRecords=[];}if(!_this.miscellaneousDebt){_this.miscellaneousDebt=[];}if(!_this.reoPropertyList){_this.reoPropertyList=[];}if(!_this.ficoScore){_this.ficoScore=new srv.cls.FicoScoreViewModel();}if(!_this.preferredPhone){_this.preferredPhone=new cls.PhoneViewModel("preferred");}else{if(!_this.preferredPhone.type){_this.preferredPhone.type="1";_this.preferredPhone.isPrefrred=true;}}if(!_this.alternatePhone){_this.alternatePhone=new cls.PhoneViewModel("alternate");}else{if(!_this.alternatePhone.type){_this.alternatePhone.type="2";_this.alternatePhone.isPrefrred=false;}}if(!_this.declarationsInfo){_this.declarationsInfo=new srv.cls.DeclarationInfoViewModel();}if(_this.maritalStatus==null||_this.maritalStatus==undefined){_this.maritalStatus=-1;}if(_this.usCitizen==null||_this.usCitizen==undefined){if(_this.permanentAlien==null||_this.permanentAlien==undefined){_this.usCitizen=true;_this.permanentAlien=false;}else{if(_this.permanentAlien==true){_this.usCitizen=false;}if(_this.permanentAlien==false){_this.usCitizen=true;}}}else{if(_this.usCitizen!=null&&_this.usCitizen!=undefined&&(_this.permanentAlien==null||_this.permanentAlien==undefined)){if(_this.usCitizen==true){_this.permanentAlien=false;}if(_this.usCitizen==false){_this.permanentAlien=true;}}}};this.filterDownPaymentAsset=function(downPayment){var downPaymentAssets=_this.getAssetsWithDownPayment();if(downPaymentAssets.length===0){var downPaymentAsset=new cls.DownPaymentAssetViewModel();downPaymentAsset.monthlyAmount=downPayment;_this.addAssets(downPaymentAsset);downPaymentAssets=_this.getAssetsWithDownPayment();}return downPaymentAssets;};this.getAssetsWithDownPayment=function(){return lib.filter(_this.getAssets(),function(a){return a.isDownPayment;});};this.handleSelfEmployedIncome=function(incomes){var selfEmployedIncomes=_this.filterIncomeByType(incomes,16);if(selfEmployedIncomes&&selfEmployedIncomes.length>0){var selfEmployedIncome=selfEmployedIncomes[0];var index=common.indexOfItem(selfEmployedIncome,incomes);var baseEmploymentIncomes=_this.filterIncomeByType(incomes,0);if(baseEmploymentIncomes&&baseEmploymentIncomes.length>0){var baseEmploymentIncome=baseEmploymentIncomes[0];baseEmploymentIncome.amount=selfEmployedIncome.amount;baseEmploymentIncome.calculatedMonthlyAmount=selfEmployedIncome.calculatedMonthlyAmount;baseEmploymentIncome.canProvideDocumentation=true;baseEmploymentIncome.preferredPaymentPeriodId=selfEmployedIncome.preferredPaymentPeriodId;common.deleteItem(index,incomes);}return incomes;}};this.calculateIncomeTotal=function(incomeInformationVm,performCalculation){var total=0;if(incomeInformationVm){for(var i=0;i<incomeInformationVm.length;i++){var income=incomeInformationVm[i];if(!income.isRemoved&&performCalculation){var amount=income.amount;if(income.preferredPaymentPeriodId==2){amount/=12;}total+=parseFloat(String(amount));}}}return total;};this.calculateCurrentIncomeTotal=function(){var total=0;if(_this.getCurrentEmploymentInfo()){total+=_this.calculateIncomeTotal(_this.getCurrentEmploymentInfo().getIncomeInformation(),_this.getCurrentEmploymentInfo().EmploymentStatusId!=2);}return total;};this.calculateAdditionalIncomeTotal=function(){var total=0;if(_this.getAdditionalEmploymentInfo()){for(var i=0;i<_this.getAdditionalEmploymentInfo().length;i++){var employmentInfo=_this.getAdditionalEmploymentInfo()[i];if(!employmentInfo.isRemoved){total+=_this.calculateIncomeTotal(employmentInfo.getIncomeInformation(),employmentInfo.EmploymentStatusId!=2);}}}return total;};this.addAssets=function(asset){asset.borrowerFullName=_this.fullName;if(asset.accountNumber==null||asset.accountNumber.trim().length===0){asset.accountNumber="";}_this.assets.push(asset);};this.deleteAssets=function(obj){var itemPosition=common.indexOfItem(obj,_this.assets);common.deleteItem(itemPosition,_this.assets);};this.addMiscDebts=function(miscDebt){_this.miscellaneousDebt.push(miscDebt);};this.removeMiscDebts=function(miscDept){var itemPostion=_this.miscellaneousDebt.indexOf(miscDept);if(itemPostion>=0){_this.miscellaneousDebt[itemPostion].isRemoved=true;}};this.getAssets=function(){_this.populateBorrowerId(_this.assets);return _this.assets;};this.getTotalEmploymentYears=function(employmentStart){var totalYears=0;if(_this.areEmploymentDatesValid(employmentStart)){totalYears=moment.duration({from:employmentStart.employmentStartDate,to:_this.getCurrentEmploymentInfo().employmentEndDate}).asYears();}return totalYears;};this.areEmploymentDatesValid=function(employmentInfo){if(!employmentInfo||employmentInfo.employmentStartDate==null||employmentInfo.employmentEndDate==null){return false;}var empInfoStartDate=moment(employmentInfo.employmentStartDate);var empInfoEndDate=moment(employmentInfo.employmentEndDate);var currentEmpInfoEndDate=moment(_this.getCurrentEmploymentInfo().employmentEndDate);if(!empInfoStartDate.isValid()||!empInfoEndDate.isValid()||!currentEmpInfoEndDate.isValid()){return false;}var currentTime=moment();var isStartDateAfterCurrent=empInfoStartDate.isAfter(currentTime);var isStartDateAfterEndDate=empInfoStartDate.isAfter(empInfoEndDate);var isEndDateAfterCurrent=empInfoEndDate.isAfter(currentTime);if(isStartDateAfterCurrent||isEndDateAfterCurrent||isStartDateAfterEndDate){return false;}return true;};this.getMiscDebts=function(){return _this.miscellaneousDebt;};this.getCollections=function(){return _this.filterByLiabilityType(3);};this.getLiability=function(){return _this.filterByLiabilityType(2);};this.getPledgedAssets=function(){return _this.getLiabilities().filter(function(liability){return liability.isPledged;});};this.getMilitaryIncome=function(){return _this.filterIncomeByType(_this.getOtherIncomes(),1);};this.getPublicRecords=function(){return _this.publicRecords;};this.getRegularIncome=function(){return _this.filterIncomeByType(_this.getOtherIncomes(),2);};this.getOtherIncome=function(){return _this.getOtherIncomes().filter(function(income){return(income.canProvideDocumentation==null||income.canProvideDocumentation==true)&&(common.string.isNullOrWhiteSpace(income.employmentInfoId)||common.string.isEmptyGuid(income.employmentInfoId));});};this.getAutomobiles=function(){return _this.filterByAssetsType([15],false);};this.getFinancials=function(){return _this.filterByAssetsType([13,15],true);};this.getLifeInsurance=function(){return _this.filterByAssetsType([13],false);};this.populateBorrowerId=function(collection){for(var i in collection){collection[i].borrowerId=_this.borrowerId;collection[i].isCoBorrower=_this.isCoBorrower;}return collection;};this.buildNetRentalIncome=function(property,isSubjectProperty){if(isSubjectProperty===void 0){isSubjectProperty=false;}var netRentalIncome;netRentalIncome.isSubjectProperty=isSubjectProperty;return netRentalIncome;};this.filterByLiabilityType=function(liabilityType){return _this.getLiabilities().filter(function(liability){liability.companyData.companyName=(liability.typeId==3||liability.typeId==2)&&(liability.companyData.companyName==""||!liability.companyData.companyName)&&!liability.isNewRow?"Not specified":liability.companyData.companyName;return liability.typeId==liabilityType&&!liability.isRemoved&&!liability.isPledged;});};this.filterIncomeByType=function(incomeCollection,incomeType){if(incomeCollection&&incomeCollection.length>0){return incomeCollection.filter(function(income){return income.incomeTypeId==incomeType;});}return[];};this.filterPropertiesByType=function(propertyCollection,propertyType){if(propertyCollection&&propertyCollection.length>0){return propertyCollection.filter(function(property){return property.occupancyType==propertyType;});}return[];};this.filterByAssetsType=function(assetsType,financials){if(_this.assets.length===0){return _this.assets;}return _this.assets.filter(function(asset){if(!asset.borrowerFullName){asset.borrowerFullName=asset.jointAccount?"JointAccount":_this.fullName;}if(financials){return(asset.assetType!==undefined&&assetsType[0]!==asset.assetType&&assetsType[1]!==asset.assetType&&asset.assetType!==-1&&!asset.isDownPayment&&!asset.isRemoved);}return(asset.assetType!==undefined&&assetsType[0]===asset.assetType&&!asset.isDownPayment&&!asset.isRemoved);});};this.prepareSave=function(){_this.getCurrentAddress();_this.getMailingAddress();_this.getPreviousAddress();};this.prepareForSubmit=function(){_this.getCurrentEmploymentInfo().prepareForSubmit();};this.getLiabilitesPayment=function(){var total=0;angular.forEach(_this.getLiability(),function(liability){if(liability.includeInDTI&&!liability.isRemoved&&liability.minPayment){var amount=parseFloat(String(liability.minPayment));if(!amount||isNaN(amount)){amount=0;}total+=amount;}});angular.forEach(_this.getPledgedAssets(),function(pledgedAsset){if((pledgedAsset.getProperty()&&pledgedAsset.getProperty().occupancyType==3)&&!pledgedAsset.isRemoved&&pledgedAsset.totalPaymentDisplayValue){var amount=parseFloat(String(pledgedAsset.totalPaymentDisplayValue));if(!amount||isNaN(amount)){amount=0;}total+=amount;}});return total;};if(!!borrower){lib.copyState(borrower,this);this.addressReferenced=false;this.confirmSsn=this.ssn||null;this.ssn=this.ssn||null;}if(!this.borrowerId||this.borrowerId==lib.getEmptyGuid()){this.borrowerId=util.IdentityGenerator.nextGuid();}if(!!ti){this.setTransactionalInfo(ti);ti.borrower.map(this);}this.initialize(borrower);}Object.defineProperty(BorrowerViewModel.prototype,"AdditionalEmploymentInfoCollection",{get:function(){return this.getAdditionalEmploymentInfo();},enumerable:true,configurable:true});Object.defineProperty(BorrowerViewModel.prototype,"currentAddrBind",{get:function(){return this.getCurrentAddress();},set:function(addr){},enumerable:true,configurable:true});Object.defineProperty(BorrowerViewModel.prototype,"mailingAddrBind",{get:function(){return this.getMailingAddress();},set:function(addr){},enumerable:true,configurable:true});Object.defineProperty(BorrowerViewModel.prototype,"previousAddrBind",{get:function(){return this.getPreviousAddress();},set:function(addr){},enumerable:true,configurable:true});Object.defineProperty(BorrowerViewModel.prototype,"DependentsError",{get:function(){if((!this.numberOfDependents&&!this.agesOfDependents)||(this.numberOfDependents==0&&!this.agesOfDependents)){this.dependentsError=false;}else{if((this.numberOfDependents!=0&&!this.agesOfDependents)||(this.agesOfDependents!=""&&!this.numberOfDependents)){this.dependentsError=true;}else{if(this.numberOfDependents&&this.numberOfDependents!=0&&this.agesOfDependents&&this.agesOfDependents!=""){var ages=this.agesOfDependents.split(",").length;this.dependentsError=this.numberOfDependents!=ages?true:false;}}}return this.dependentsError;},set:function(newDependentsError){this.dependentsError=newDependentsError;},enumerable:true,configurable:true});Object.defineProperty(BorrowerViewModel.prototype,"wrongSsn",{get:function(){return this.ssn!=this.confirmSsn&&!(!this.ssn&&!this.confirmSsn);},enumerable:true,configurable:true});Object.defineProperty(BorrowerViewModel.prototype,"fullName",{get:function(){var fullName=(this.firstName?this.firstName.trim():"")+(this.middleName?(" "+this.middleName.trim()):"")+" "+(this.lastName?this.lastName.trim():"");return fullName.trim()?fullName:this.defaultName;},enumerable:true,configurable:true});BorrowerViewModel.prototype.hasValidName=function(){return this.fullName!=this.defaultName;};Object.defineProperty(BorrowerViewModel.prototype,"incomeTypes",{get:function(){return cls.LoanViewModel.getLookups().incomeTypesOther.filter(function(i){return i.value!="16";});},enumerable:true,configurable:true});Object.defineProperty(BorrowerViewModel.prototype,"baseIncomeTotal",{get:function(){var total=0;if(this.getCurrentEmploymentInfo()&&angular.isDefined(this.getCurrentEmploymentInfo().EmploymentTypeId)){if(!(this.getCurrentEmploymentInfo().EmploymentTypeId==3||this.getCurrentEmploymentInfo().EmploymentTypeId==4)){total+=this.calculateCurrentIncomeTotal();}total+=this.calculateAdditionalIncomeTotal();}return total;},enumerable:true,configurable:true});Object.defineProperty(BorrowerViewModel.prototype,"isTotalEmploymentTwoYears",{get:function(){var years=0;if(!this.getCurrentEmploymentInfo()){return(this.isEmployedTwoYears=false);}else{if(this.getCurrentEmploymentInfo().employmentStartDate==null){return;}}years=this.getTotalEmploymentYears(this.getCurrentEmploymentInfo());this.getCurrentEmploymentInfo().yearsOnThisJob=parseInt(String(years));if(years>=2){return(this.isEmployedTwoYears=true);}if(this.getAdditionalEmploymentInfo()&&this.getAdditionalEmploymentInfo().length>0){for(var i=0;i<this.getAdditionalEmploymentInfo().length;i++){var additionalEmploymentInfo=this.getAdditionalEmploymentInfo()[i];if(!additionalEmploymentInfo.isRemoved){years=this.getTotalEmploymentYears(additionalEmploymentInfo);additionalEmploymentInfo.yearsOnThisJob=parseInt(String(years));if(years>=2){return(this.isEmployedTwoYears=true);}}}}return(this.isEmployedTwoYears=false);},enumerable:true,configurable:true});return BorrowerViewModel;})(srv.cls.BorrowerViewModel);cls.BorrowerViewModel=BorrowerViewModel;})(cls||(cls={}));var __extends=this.__extends||function(d,b){for(var p in b){if(b.hasOwnProperty(p)){d[p]=b[p];}}function __(){this.constructor=d;}__.prototype=b.prototype;d.prototype=new __();};var cls;(function(cls){var EmploymentInfoViewModelFactory=(function(){function EmploymentInfoViewModelFactory(){}EmploymentInfoViewModelFactory.create=function(dst,p){if(!p.isAdditional){return new CurrentEmploymentInfoViewModel(dst,p);}return new AdditionalEmploymentInfoViewModel(dst,p);};return EmploymentInfoViewModelFactory;})();cls.EmploymentInfoViewModelFactory=EmploymentInfoViewModelFactory;var EmploymentInfoViewModel=(function(_super){__extends(EmploymentInfoViewModel,_super);function EmploymentInfoViewModel(ti,employmentInfo){var _this=this;_super.call(this);this.hasTransactionInfo=function(){return(!!_this.ticb&&!!_this.ticb());};this.getTransactionInfo=function(){if(_this.hasTransactionInfo()){return _this.ticb();}else{return null;}};this.setTransactionInfo=function(ti){_this.ticb=function(){return ti;};};this.hasTransactionalInfoIncomes=function(){if(_this.hasTransactionInfo()&&!!_this.getTransactionInfo().incomeInfo){return true;}else{return false;}};this.getTransactionInfoIncomes=function(){if(_this.hasTransactionalInfoIncomes()){return _this.getTransactionInfo().incomeInfo;}return new cls.Map();};this.getIncomeInformation=function(){if(_this.hasTransactionalInfoIncomes()){if(!_this._incomeMatrix){var incomeMatrix=lib.filter(_this.getTransactionInfoIncomes().getValues(),function(o){return o.employmentInfoId==_this.employmentInfoId;});incomeMatrix=_this.buildIncomeInformation(incomeMatrix);for(var i=0;i<incomeMatrix.length;i++){incomeMatrix[i]=new cls.IncomeInfoViewModel(_this.getTransactionInfo(),incomeMatrix[i]);}_this.setIncomeInformation(incomeMatrix);_this._incomeMatrix=incomeMatrix;}return _this._incomeMatrix;}return[];};this.setIncomeInformation=function(incomes){if(!!incomes&&_this.hasTransactionalInfoIncomes()){incomes.forEach(function(o){return o.employmentInfoId=_this.employmentInfoId;});_this.getTransactionInfoIncomes().mapAll(incomes);_this._incomeMatrix=null;}};this.incomeInfoByTypeId=function(typeId){var incomeInfos=_this.incomeInformationCollection.filter(function(i){return i.incomeTypeId==typeId;});return incomeInfos.length>0?incomeInfos[0]:null;};this.isCompleted=function(){switch(String(_this.employmentTypeId)){case String(3):return _this.validateRetired();case String(0):return _this.validateActiveMilitaryDuty();case String(1):return _this.validateSelfOrSalariedEmployee();case String(2):return _this.validateSelfOrSalariedEmployee();case String(4):return true;}};this.validateRetired=function(){return !common.objects.isNullOrUndefined(_this.employmentStartDate);};this.validateActiveMilitaryDuty=function(){var basePay=_this.incomeInfoByTypeId(11);return _this.validateJointRules()&&basePay&&basePay.amount&&_this.branchOfService!="-1";};this.validateSelfOrSalariedEmployee=function(){var basePay=_this.EmploymentTypeId==2?_this.incomeInfoByTypeId(16):_this.incomeInfoByTypeId(0);var partTime=_this.incomeInfoByTypeId(13);var retVal=_this.validateJointRules()&&(basePay&&basePay.amount||partTime&&partTime.amount)&&!common.string.isNullOrWhiteSpace(_this.name)&&!common.string.isNullOrWhiteSpace(_this.typeOfBusiness);return _this.EmploymentStatusId==2?retVal&&!common.objects.isNullOrUndefined(_this.employmentEndDate):retVal;};this.validateJointRules=function(){return !common.string.isNullOrWhiteSpace(_this.positionDescription)&&!common.objects.isNullOrUndefined(_this.employmentStartDate)&&!common.string.isNullOrWhiteSpace(_this.businessPhone)&&!common.string.isNullOrWhiteSpace(_this.address.cityName)&&!common.string.isNullOrWhiteSpace(_this.address.stateName)&&!common.string.isNullOrWhiteSpace(_this.address.streetName)&&!common.string.isNullOrWhiteSpace(_this.address.zipCode)&&!!_this.yearsInThisProfession;};this.buildIncomeInformation=function(incomeInformationVm){var dict=[];for(var i=0;i<incomeInformationVm.length;i++){dict[incomeInformationVm[i].incomeTypeId.toString()]=incomeInformationVm[i];}var list=[];var incomeTypes=EmploymentInfoViewModel.getIncomeTypes();for(var i=0;i<incomeTypes.length;i++){var k=incomeTypes[i].value;var incomeInfo=dict[k]?dict[k]:cls.IncomeInfoViewModel.newIncomeInfo(_this.getTransactionInfo(),parseInt(k));incomeInfo.incomeType=incomeTypes[i].text;var baseIncomes=incomeTypes.filter(function(i){return i.value=="0";});if(baseIncomes&&baseIncomes.length>0){var baseIncome=baseIncomes[0];if(incomeInfo.incomeTypeId==16){incomeInfo.incomeType=baseIncome.text;}}list.push(incomeInfo);}return list;};this.convertIncomeZeroToRemovedForSubmit=function(){if(!_this.getIncomeInformation()){return;}_this.getIncomeInformation().filter(function(i){return i.amount===0;}).map(function(i){i.isRemoved=true;});};this.filterIncomeInfoForSubmit=function(){if(_this.EmploymentTypeId==3){_this.resetIncomeAmounts(_this.getIncomeInformation());}else{var diff=lib.diff(_this.getIncomeInformation(),_this.incomeInformationCollection,function(i,j){return i.incomeTypeId==j.incomeTypeId;});_this.resetIncomeAmounts(diff);}};this.resetIncomeAmounts=function(incomeCollection){if(!!incomeCollection){lib.forEach(incomeCollection,function(i){return i.Amount=0;});}};this.cleanUpRetirementData=function(){if(_this.EmploymentTypeId==3){_this.businessPhone=null;_this.positionDescription=null;_this.name=null;_this.typeOfBusiness=null;_this.yearsInThisProfession=null;_this.initializeAddress();}};this.prepareForSubmit=function(){_this.convertIncomeZeroToRemovedForSubmit();_this.filterIncomeInfoForSubmit();_this.cleanUpRetirementData();};this.initialize=function(employmentInfo){_this.initializeAddress(employmentInfo);};this.initializeAddress=function(employmentInfo){var address;if(!!employmentInfo){address=employmentInfo.address;}else{address=null;}_this.address=new cls.PropertyViewModel(_this.getTransactionInfo(),address);};if(!!employmentInfo){lib.copyState(employmentInfo,this);}if(!this.employmentInfoId||this.employmentInfoId==lib.getEmptyGuid()){this.employmentInfoId=util.IdentityGenerator.nextGuid();}if(!!ti){this.setTransactionInfo(ti);ti.employmentInfo.map(this);}this.initialize(employmentInfo);}Object.defineProperty(EmploymentInfoViewModel.prototype,"EmploymentStatusId",{get:function(){return this.employmentStatusId;},set:function(value){this.employmentStatusId=value;this.isPresent=(this.employmentStatusId==1);},enumerable:true,configurable:true});Object.defineProperty(EmploymentInfoViewModel.prototype,"totalMonthlyAmount",{get:function(){var total=0;if(this.getIncomeInformation()){for(var i=0;i<this.getIncomeInformation().length;i++){var income=this.getIncomeInformation()[i];if(!income.isRemoved){total+=parseFloat(String(income.calculatedMonthlyAmount));}}}return total;},enumerable:true,configurable:true});EmploymentInfoViewModel.getIncomeTypes=function(){var lookups=cls.LoanViewModel.getLookups();var incomeTypes=lookups.incomeTypesRegular.concat(lookups.incomeTypesMilitary);var selfEmployedIncome=cls.LoanViewModel.getLookups().incomeTypesOther.filter(function(i){return i.value=="16";});if(selfEmployedIncome&&selfEmployedIncome.length>0){incomeTypes=incomeTypes.concat(selfEmployedIncome);}return incomeTypes;};Object.defineProperty(EmploymentInfoViewModel.prototype,"EmploymentTypeId",{get:function(){return this.employmentTypeId;},set:function(value){this.employmentTypeId=value;this.isMilitary=this.employmentTypeId==0;},enumerable:true,configurable:true});Object.defineProperty(EmploymentInfoViewModel.prototype,"incomeInformationCollection",{get:function(){if(!this.getIncomeInformation()){return[];}var incomeTypes;if(this.isMilitary){incomeTypes=cls.LoanViewModel.getLookups().incomeTypesMilitary;}else{incomeTypes=cls.LoanViewModel.getLookups().incomeTypesRegular;}if(this.EmploymentTypeId==2){var selfEmployedIncome=cls.LoanViewModel.getLookups().incomeTypesOther.filter(function(i){return i.value=="16";});if(selfEmployedIncome&&selfEmployedIncome.length>0){incomeTypes=incomeTypes.concat(selfEmployedIncome);}}var dict=[];if(incomeTypes&&incomeTypes.length>0){var filteredIncomes=incomeTypes.filter(function(i){return i.value=="16";});var filteredBaseIncome=incomeTypes.filter(function(i){return i.value=="0";});if(filteredIncomes&&filteredIncomes.length>0){var selfEmployed=filteredIncomes[0];}if(filteredBaseIncome&&filteredBaseIncome.length>0){var baseIncome=filteredBaseIncome[0];}}for(var i=0;i<incomeTypes.length;i++){var income=incomeTypes[i];if(income.value=="0"&&this.EmploymentTypeId==2){income=selfEmployed;}dict[incomeTypes[i].value]=income;}for(var i=0;i<this.getIncomeInformation().length;i++){this.getIncomeInformation()[i].isRemoved=true;}var list=this.getIncomeInformation().filter(function(i){if(dict[i.incomeTypeId.toString()]&&i.incomeTypeId==dict[i.incomeTypeId.toString()].value){i.isRemoved=false;return true;}else{return false;}});list.sort(function(a,b){if((a.incomeTypeId==16)!=(b.incomeTypeId==16)){return a.incomeTypeId==16?-1:1;}});return list;},enumerable:true,configurable:true});return EmploymentInfoViewModel;})(srv.cls.EmploymentInfoViewModel);cls.EmploymentInfoViewModel=EmploymentInfoViewModel;var CurrentEmploymentInfoViewModel=(function(_super){__extends(CurrentEmploymentInfoViewModel,_super);function CurrentEmploymentInfoViewModel(ti,employmentInfo){_super.call(this,ti,employmentInfo);this.EmploymentStatusId=1;if(!employmentInfo){this.EmploymentTypeId=1;}this.isAdditional=false;}Object.defineProperty(CurrentEmploymentInfoViewModel.prototype,"isRetiredOrUnemployed",{get:function(){return this.EmploymentTypeId==3||this.EmploymentTypeId==4;},enumerable:true,configurable:true});Object.defineProperty(CurrentEmploymentInfoViewModel.prototype,"isSalariedEmployeeOrSelfEmployed",{get:function(){return this.EmploymentTypeId==1||this.EmploymentTypeId==2;},enumerable:true,configurable:true});Object.defineProperty(CurrentEmploymentInfoViewModel.prototype,"isRetired",{get:function(){return this.EmploymentTypeId==3;},enumerable:true,configurable:true});Object.defineProperty(CurrentEmploymentInfoViewModel.prototype,"isOtherOrUnemployed",{get:function(){return this.EmploymentTypeId==4;},enumerable:true,configurable:true});Object.defineProperty(CurrentEmploymentInfoViewModel.prototype,"isActiveMilitaryDuty",{get:function(){return this.EmploymentTypeId==0;},enumerable:true,configurable:true});return CurrentEmploymentInfoViewModel;})(EmploymentInfoViewModel);cls.CurrentEmploymentInfoViewModel=CurrentEmploymentInfoViewModel;var AdditionalEmploymentInfoViewModel=(function(_super){__extends(AdditionalEmploymentInfoViewModel,_super);function AdditionalEmploymentInfoViewModel(ti,additionalEmploymentInfo,isPrevious){_super.call(this,ti,additionalEmploymentInfo);if(!additionalEmploymentInfo){this.EmploymentTypeId=1;this.isAdditional=true;}if(isPrevious){this.EmploymentStatusId=2;}}Object.defineProperty(AdditionalEmploymentInfoViewModel.prototype,"EmploymentStatusId",{get:function(){return this.employmentStatusId;},set:function(value){this.employmentStatusId=value;this.isPresent=(this.employmentStatusId==1);this.isAdditional=true;},enumerable:true,configurable:true});Object.defineProperty(AdditionalEmploymentInfoViewModel.prototype,"isSalariedEmployeeOrSelfEmployed",{get:function(){return this.EmploymentTypeId==1||this.EmploymentTypeId==2;},enumerable:true,configurable:true});return AdditionalEmploymentInfoViewModel;})(EmploymentInfoViewModel);cls.AdditionalEmploymentInfoViewModel=AdditionalEmploymentInfoViewModel;})(cls||(cls={}));var __extends=this.__extends||function(d,b){for(var p in b){if(b.hasOwnProperty(p)){d[p]=b[p];}}function __(){this.constructor=d;}__.prototype=b.prototype;d.prototype=new __();};var cls;(function(cls){var AssetViewModel=(function(_super){__extends(AssetViewModel,_super);function AssetViewModel(asset){_super.call(this);this.checkIteminstitiutionContactInfoModified=function(item){if(!item){return false;}var result=item.attn||item.phone||item.fax||item.email||(item.addressViewModel&&(item.addressViewModel.streetName||item.addressViewModel.cityName||item.addressViewModel.stateName||item.addressViewModel.zipCode));return !result?false:true;};if(asset){common.objects.automap(this,asset);}else{this.financialInstitutionName="";this.accountNumber="";this.jointAccount=false;this.institiutionContactInfo=new cls.CompanyDataViewModel();this.institiutionContactInfo.companyName=this.financialInstitutionName;}if(!this.institiutionContactInfo){this.institiutionContactInfo=new cls.CompanyDataViewModel();this.institiutionContactInfoModified=false;}else{this.institiutionContactInfoModified=this.checkIteminstitiutionContactInfoModified(this.institiutionContactInfo);}this.isRemoved=false;}return AssetViewModel;})(srv.cls.AssetViewModel);cls.AssetViewModel=AssetViewModel;var AutomobileAssetViewModel=(function(_super){__extends(AutomobileAssetViewModel,_super);function AutomobileAssetViewModel(){_super.call(this);this.isUserEntry=true;this.assetType=15;}return AutomobileAssetViewModel;})(AssetViewModel);cls.AutomobileAssetViewModel=AutomobileAssetViewModel;var DownPaymentAssetViewModel=(function(_super){__extends(DownPaymentAssetViewModel,_super);function DownPaymentAssetViewModel(){_super.call(this);this.isDownPayment=true;this.monthlyAmount=0;this.assetType=14;}return DownPaymentAssetViewModel;})(AssetViewModel);cls.DownPaymentAssetViewModel=DownPaymentAssetViewModel;var FinancialsAssetViewModel=(function(_super){__extends(FinancialsAssetViewModel,_super);function FinancialsAssetViewModel(){_super.call(this);this.isUserEntry=true;this.institiutionContactInfoModified=false;this.assetType=0;}return FinancialsAssetViewModel;})(AssetViewModel);cls.FinancialsAssetViewModel=FinancialsAssetViewModel;var LifeInsuranceAssetViewModel=(function(_super){__extends(LifeInsuranceAssetViewModel,_super);function LifeInsuranceAssetViewModel(){_super.call(this);this.isUserEntry=true;this.assetType=13;}return LifeInsuranceAssetViewModel;})(AssetViewModel);cls.LifeInsuranceAssetViewModel=LifeInsuranceAssetViewModel;})(cls||(cls={}));var __extends=this.__extends||function(d,b){for(var p in b){if(b.hasOwnProperty(p)){d[p]=b[p];}}function __(){this.constructor=d;}__.prototype=b.prototype;d.prototype=new __();};var cls;(function(cls){var PropertyViewModelBase=(function(_super){__extends(PropertyViewModelBase,_super);function PropertyViewModelBase(){var _this=this;_super.call(this);this.initializePropertyExpenses=function(){if(!_this.propertyExpenses||_this.propertyExpenses.length==0){_this.propertyExpenses=[];lib.forEach(PropertyViewModel.propertyExpenseDefaults,function(pe){_this.propertyExpenses.push(new cls.PropertyExpenseViewModel(pe.type,pe.preferredPayPeriod,pe.monthlyAmount,pe.impounded));});}else{if(_this.propertyExpenses.length<5){lib.forEach(PropertyViewModel.propertyExpenseDefaults,function(pe){var index=lib.findIndex(_this.propertyExpenses,function(existingPE){return pe.type==existingPE.type;},-1);if(index==-1){_this.propertyExpenses.push(new cls.PropertyExpenseViewModel(pe.type,pe.preferredPayPeriod,pe.monthlyAmount,pe.impounded));}else{var inputPE=_this.propertyExpenses[index];if(!inputPE.monthlyAmount||inputPE.monthlyAmount==0){lib.replace(_this.propertyExpenses,new cls.PropertyExpenseViewModel(pe.type,pe.preferredPayPeriod,pe.monthlyAmount,pe.impounded),function(pe){return pe.type==inputPE.type;});}else{if(!(inputPE instanceof (cls.PropertyExpenseViewModel))){lib.replace(_this.propertyExpenses,new cls.PropertyExpenseViewModel(inputPE.type,inputPE.preferredPayPeriod,inputPE.monthlyAmount,inputPE.impounded),function(pe){return pe.type==inputPE.type;});}}}});}}};this.occupancyType=1;}Object.defineProperty(PropertyViewModelBase.prototype,"fullAddressString",{get:function(){var fullAddress="";if(this.isSubjectProperty){fullAddress=fullAddress.concat("*");}fullAddress=fullAddress.concat(this.streetName?this.streetName:"").concat(", ");if(this&&this.unitNumber){fullAddress+="#"+this.unitNumber+", ";}fullAddress=fullAddress.concat(this.cityName?this.cityName:"").concat(", ").concat(this.stateName?this.stateName:"").concat(" ").concat(this.zipCode?this.zipCode:"");return fullAddress;},enumerable:true,configurable:true});PropertyViewModelBase.prototype.formatAddress=function(){var fullAddress="";fullAddress=fullAddress.concat(this.streetName?this.streetName:"").concat(", ").concat(this.cityName?this.cityName:"");return fullAddress;};PropertyViewModelBase.propertyExpenseDefaults=[{type:(1).toString(),preferredPayPeriod:(2).toString(),monthlyAmount:0,impounded:true},{type:(2).toString(),preferredPayPeriod:(2).toString(),monthlyAmount:0,impounded:true},{type:(3).toString(),preferredPayPeriod:(1).toString(),monthlyAmount:0,impounded:true},{type:(4).toString(),preferredPayPeriod:(1).toString(),monthlyAmount:0,impounded:false},{type:(5).toString(),preferredPayPeriod:(1).toString(),monthlyAmount:0,impounded:true},];PropertyViewModelBase.findActiveLoanApplication=function(ti){var active=ti.getLoan().active;if(!!active){var loanApplicationId=active.loanApplicationId;var currentActive=lib.findSingle(ti.loanApplications,function(la){return la.loanApplicationId==loanApplicationId;});}return currentActive;};PropertyViewModelBase.setOwnershipPercentage=function(ownershipPercentage,isSubjectProperty,getTi){if(isSubjectProperty&&!!getTi){var ownershipPercentageTemp=ownershipPercentage;if(ownershipPercentage>getTi().getLoan().remainingOwnershipCalculation()||ownershipPercentage>100){ownershipPercentageTemp=getTi().getLoan().remainingOwnershipCalculation();}var active=PropertyViewModelBase.findActiveLoanApplication(getTi());if(!!active){active.ownershipPercentage=ownershipPercentageTemp;}}return ownershipPercentage;};PropertyViewModelBase.getOwnershipPercentage=function(defaultOwnershipPercentage,isSubjectProperty,getTi){if(isSubjectProperty&&getTi){var active=PropertyViewModelBase.findActiveLoanApplication(getTi());if(!!active){return active.ownershipPercentage;}}else{return defaultOwnershipPercentage;}};return PropertyViewModelBase;})(srv.cls.PropertyViewModel);var PropertySnapshot=(function(_super){__extends(PropertySnapshot,_super);function PropertySnapshot(property,ti){var _this=this;_super.call(this);this.hasTransactionInfo=function(){return(!!_this.ticb&&!!_this.ticb());};this.getTransactionInfo=function(){if(_this.hasTransactionInfo()){return _this.ticb();}else{throw new Error("TransactionInfo not available");}};this.setTransactionInfo=function(ti){_this.ticb=function(){return ti;};};if(property){lib.copyState(property,this);this.propertyExpenses=angular.copy(property.propertyExpenses);this.occupancyType=property.occupancyType;this.OccupancyType=property.OccupancyType;}else{this.propertyId=util.IdentityGenerator.nextGuid();this.initializePropertyExpenses();}if(!!ti){this.setTransactionInfo(ti);if(property){ti.property.map(property);}}}Object.defineProperty(PropertySnapshot.prototype,"OccupancyType",{get:function(){return this.occupancyType;},set:function(occupancyType){this.occupancyType=occupancyType;},enumerable:true,configurable:true});Object.defineProperty(PropertySnapshot.prototype,"OwnershipPercentage",{get:function(){return PropertyViewModelBase.getOwnershipPercentage(this.ownershipPercentage,this.isSubjectProperty,this.getTransactionInfo);},set:function(ownershipPercentage){this.ownershipPercentage=PropertyViewModelBase.setOwnershipPercentage(ownershipPercentage,this.isSubjectProperty,this.getTransactionInfo);},enumerable:true,configurable:true});return PropertySnapshot;})(PropertyViewModelBase);cls.PropertySnapshot=PropertySnapshot;var PropertyViewModel=(function(_super){__extends(PropertyViewModel,_super);function PropertyViewModel(ti,property,homeBuyingType){var _this=this;_super.call(this);this.hasTransactionInfo=function(){return(!!_this.ticb&&!!_this.ticb());};this.getTransactionInfo=function(){if(_this.hasTransactionInfo()){return _this.ticb();}else{throw new Error("TransactionInfo not available");}};this.setTransactionInfo=function(ti){_this.ticb=function(){return ti;};};this.getHasTransactionalInfoIncome=function(){if(_this.hasTransactionInfo()&&!!_this.getTransactionInfo().incomeInfo){return true;}else{return false;}};this.getTransactionInfoIncome=function(){if(_this.getHasTransactionalInfoIncome()){return _this.getTransactionInfo().incomeInfo;}return new cls.Map();};this.getIncome=function(){if(_this.getHasTransactionalInfoIncome()){var item=lib.findFirst(_this.getTransactionInfoIncome().getValues(),function(o){return o.propertyId==_this.propertyId;});return item;}return null;};this.setIncome=function(income){if(_this.getHasTransactionalInfoIncome()){income.propertyId=_this.propertyId;_this.getTransactionInfoIncome().map(income);}};this.getHasTransactionalInfoLiability=function(){if(_this.hasTransactionInfo()&&!!_this.getTransactionInfo().liability){return true;}else{return false;}};this.getTransactionInfoLiability=function(){if(_this.getHasTransactionalInfoLiability()){return _this.getTransactionInfo().liability;}return new cls.Map();};this.getLiability=function(){if(_this.getHasTransactionalInfoLiability()){return lib.filter(_this.getTransactionInfoLiability().getValues(),function(o){return o.propertyId==_this.propertyId;});}return[];};this.setLiability=function(liability){if(!!liability&&_this.getHasTransactionalInfoLiability()){_this.getTransactionInfoLiability().mapAll(liability);}};this.getfullAddress=function(){return _this.fullAddress;};this.isAddressEqual=function(property){if(!property){return false;}if(property.propertyId==_this.propertyId){return true;}return _this.cityName==property.cityName&&_this.stateName==property.stateName&&_this.streetName==property.streetName&&_this.zipCode==property.zipCode;};this.isOwnedPrimaryResidence=function(){return _this.OccupancyType==1&&_this.isPropertyOwned;};this.isEmpty=function(){return false;};this.clearAddress=function(b){_this.streetName="";_this.cityName="";_this.stateId=null;_this.stateName="";_this.countyName="";_this.unitNumber="";_this.zipCode="";_this.timeAtAddressMonths=null;_this.timeAtAddressYears=null;return true;};this.isValid=function(validateCounty){if(validateCounty===void 0){validateCounty=true;}var isValid=true;if(validateCounty){isValid=!common.string.isNullOrWhiteSpace(_this.countyName);}if(isValid&&!common.string.isNullOrWhiteSpace(_this.cityName)&&!common.string.isNullOrWhiteSpace(_this.stateName)&&!common.string.isNullOrWhiteSpace(_this.streetName)&&!common.string.isNullOrWhiteSpace(_this.zipCode)){return true;}return false;};this.areExpensesValid=function(){return(_this.propertyTaxExpense.monthlyAmount&&_this.propertyTaxExpense.monthlyAmount!=0&&(_this.homeOwnerExpense.monthlyAmount||_this.homeOwnerExpense.monthlyAmount==0)&&((_this.propertyType==String(2)||_this.propertyType==String(3))&&_this.monthlyHOAdues!=0||_this.propertyType!=String(2)&&_this.propertyType!=String(3)));};this.isOwnershipValid=function(){if((!common.string.isNullOrWhiteSpace(String(_this.ownership))&&!(_this.timeAtAddressMonths>0||_this.timeAtAddressYears>0))){return false;}if(_this.ownership==1){return _this.monthlyRent>0;}return true;};this.initialize=function(property,homeBuyingType){if(homeBuyingType&&homeBuyingType==3&&_this.isSubjectProperty&&_this&&_this.streetName==""){_this.streetName="TBD";}if(_this.isSubjectProperty){if(!_this.grossRentalIncome){_this.grossRentalIncome=0;}if(!_this.vacancyPercentage){_this.vacancyPercentage=75;}if(!_this.downPaymentSource){_this.downPaymentSource=19;}}if(!_this.propertyId||_this.propertyId==lib.getEmptyGuid()){_this.propertyId=util.IdentityGenerator.nextGuid();}if(!angular.isDefined(_this.isSubjectProperty)){_this.isSubjectProperty=false;}_this.initializePropertyExpenses();};this.getHOADisplayAmount=function(){return _this.getPropertyExpenseDisplayAmount(_this.hoaDuesExpense);};this.getPropertyTaxDisplayAmount=function(){return _this.getPropertyExpenseDisplayAmount(_this.propertyTaxExpense);};this.getHomeOwnerDisplayAmount=function(){return _this.getPropertyExpenseDisplayAmount(_this.homeOwnerExpense);};this.getMortgageInsuranceDisplayAmount=function(){return _this.getPropertyExpenseDisplayAmount(_this.mortgageInsuranceExpense);};this.getFloodInsuranceDisplayAmount=function(){return _this.getPropertyExpenseDisplayAmount(_this.floodInsuranceExpense);};this.getPropertyExpenseDisplayAmount=function(propertyExpense){return +propertyExpense.preferredPayPeriod==1?propertyExpense.monthlyAmount:propertyExpense.monthlyAmount*12;};this.getDownPaymentSourceText=function(downPaymentSourceValue,downPaymentSourceList){for(var i=0;i<downPaymentSourceList.length;i++){if(downPaymentSourceList[i].value==downPaymentSourceValue.toString()){return downPaymentSourceList[i].text;}}};this.getNetRentalIncome=function(){if(!_this.hasTransactionInfo()){return null;}if(_this.OccupancyType!=2){return null;}if(_this.getHasTransactionalInfoIncome()){var nri=_this.getNetRentalIncomeExisting(_this.getActiveBorrower().borrowerId);if(nri==null){nri=_this.createNetRentalIncome();}return nri;}else{return null;}};this.sumPropertyExpenses=function(){var total=0;if(_this.propertyExpenses){for(var k=0;k<_this.propertyExpenses.length;k++){total+=_this.roundToFourDecimalPlaces(_this.propertyExpenses[k].monthlyAmount);}}return total;};this.roundToFourDecimalPlaces=function(value){return value?Math.round(value*10000)/10000:0;};this.getActiveLoanApplication=function(){return _this.getTransactionInfo().getLoan().active;};this.getActiveBorrower=function(){return _this.getTransactionInfo().getLoan().active.getBorrower();};this.getNetRentalIncomeExisting=function(borrowerId){if(!_this.hasTransactionInfo()){return null;}var nri=lib.findSingle(_this.getTransactionInfoIncome().getValues(),function(o){return o.propertyId==_this.propertyId&&o.borrowerId==borrowerId;});return nri;};this.createNetRentalIncome=function(){if(!_this.getHasTransactionalInfoIncome()){return null;}var nri=new cls.IncomeInfoViewModel(_this.getTransactionInfo());_this.assignIncomeViewModelDefaultsForNewlyCreatedNetRentalIncome(nri);_this.assignPropertyViewModelDefaultsForNewlyCreatedNetRentalIncome();return nri;};this.assignIncomeViewModelDefaultsForNewlyCreatedNetRentalIncome=function(nri){var borrowerPredId;if(_this.isSubjectProperty){borrowerPredId=function(b){return !b.isCoBorrower&&b.loanApplicationId==_this.getActiveLoanApplication().loanApplicationId;};}else{borrowerPredId=function(b){return b.borrowerId==_this.getActiveBorrower().borrowerId;};}var borrowerPred=function(b){return borrowerPredId(b);};var borrowerLoanApp=lib.findSingle(_this.getTransactionInfo().borrower.getValues(),function(o){return borrowerPred(o);});nri.isNetRental=true;nri.incomeTypeId=5;nri.manualChange=false;nri.isNegativeIncome=false;nri.propertyId=_this.propertyId;nri.isSubjectProperty=_this.isSubjectProperty;nri.isRemoved=false;nri.Amount=0;if(!!borrowerLoanApp){nri.borrowerId=borrowerLoanApp.borrowerId;}};this.assignPropertyViewModelDefaultsForNewlyCreatedNetRentalIncome=function(){if(angular.isUndefined(_this.grossRentalIncome)){_this.grossRentalIncome=0;}if(angular.isUndefined(_this.OwnershipPercentage)){_this.OwnershipPercentage=100;}if(angular.isUndefined(_this.vacancyPercentage)){_this.vacancyPercentage=75;}};this.manageNetRentalIncome=function(){if(_this.OccupancyType==2){var nri=_this.getNetRentalIncome();nri.isRemoved=false;}else{var nri=_this.getNetRentalIncomeExisting(_this.getActiveBorrower().borrowerId);if(!!nri){_this.assignIncomeViewModelDefaultsForNewlyCreatedNetRentalIncome(nri);_this.assignPropertyViewModelDefaultsForNewlyCreatedNetRentalIncome();var nriCls=nri;nriCls.remove();}}};if(!!property){lib.copyState(property,this);}if(!this.propertyId||this.propertyId==lib.getEmptyGuid()){this.propertyId=util.IdentityGenerator.nextGuid();}if(!!ti){this.setTransactionInfo(ti);ti.property.map(this);}this.initialize(property,homeBuyingType);}Object.defineProperty(PropertyViewModel.prototype,"fullAddress",{get:function(){var fullAddress=(this.streetName?this.streetName.trim():"")+(this.cityName?(" "+this.cityName.trim()):"")+" "+(this.stateName?this.stateName.trim():"")+" "+(this.zipCode?this.zipCode.trim():"");return fullAddress.trim();},enumerable:true,configurable:true});Object.defineProperty(PropertyViewModel.prototype,"isPropertyOwned",{get:function(){return this.ownership==0;},set:function(isPropertyOwned){},enumerable:true,configurable:true});Object.defineProperty(PropertyViewModel.prototype,"PropertyType",{get:function(){return this.propertyType;},set:function(pType){if(pType=="1"){this.numberOfStories=1;}else{if(pType=="0"||pType=="6"||pType=="14"){this.numberOfUnits=1;}}this.propertyType=pType;},enumerable:true,configurable:true});Object.defineProperty(PropertyViewModel.prototype,"NeedPreApproval",{get:function(){return this.needPreApproval;},set:function(needPreApproval){this.needPreApproval=needPreApproval;},enumerable:true,configurable:true});Object.defineProperty(PropertyViewModel.prototype,"monthlyHOAdues",{get:function(){return this.hoaDuesExpense.monthlyAmount;},set:function(value){this.hoaDuesExpense.monthlyAmount=value;},enumerable:true,configurable:true});Object.defineProperty(PropertyViewModel.prototype,"propertyTaxExpense",{get:function(){return lib.findFirst(this.propertyExpenses,function(pe){return +pe.type==1;});},enumerable:true,configurable:true});Object.defineProperty(PropertyViewModel.prototype,"hoaDuesExpense",{get:function(){return lib.findFirst(this.propertyExpenses,function(pe){return +pe.type==4;});},enumerable:true,configurable:true});Object.defineProperty(PropertyViewModel.prototype,"homeOwnerExpense",{get:function(){return lib.findFirst(this.propertyExpenses,function(pe){return +pe.type==2;});},enumerable:true,configurable:true});Object.defineProperty(PropertyViewModel.prototype,"mortgageInsuranceExpense",{get:function(){return lib.findFirst(this.propertyExpenses,function(pe){return +pe.type==3;});},enumerable:true,configurable:true});Object.defineProperty(PropertyViewModel.prototype,"floodInsuranceExpense",{get:function(){return lib.findFirst(this.propertyExpenses,function(pe){return +pe.type==5;});},enumerable:true,configurable:true});Object.defineProperty(PropertyViewModel.prototype,"OccupancyType",{get:function(){return this.isSubjectProperty?this.getTransactionInfo().getLoan().active.occupancyType:this.occupancyType;},set:function(occupancyType){if(this.isSubjectProperty){var active=this.getTransactionInfo().getLoan().active;if(!!active){active.OccupancyType=occupancyType;}}else{this.occupancyType=occupancyType;}if(this.isSubjectProperty){if(occupancyType==2&&!this.ownershipPercentage){this.OwnershipPercentage=100;}else{if(occupancyType!=2){this.OwnershipPercentage=0;}}}this.manageNetRentalIncome();},enumerable:true,configurable:true});Object.defineProperty(PropertyViewModel.prototype,"OwnershipPercentage",{get:function(){return PropertyViewModelBase.getOwnershipPercentage(this.ownershipPercentage,this.isSubjectProperty,this.getTransactionInfo);},set:function(ownershipPercentage){this.ownershipPercentage=PropertyViewModelBase.setOwnershipPercentage(ownershipPercentage,this.isSubjectProperty,this.getTransactionInfo);},enumerable:true,configurable:true});return PropertyViewModel;})(PropertyViewModelBase);cls.PropertyViewModel=PropertyViewModel;var PropertyExpenseViewModel=(function(_super){__extends(PropertyExpenseViewModel,_super);function PropertyExpenseViewModel(typeExpense,preferredPayPeriod,monthlyAmount,impound){if(impound===void 0){impound=false;}_super.call(this);this.type=typeExpense;this.preferredPayPeriod=preferredPayPeriod;this.monthlyAmount=monthlyAmount;this.impounded=impound;}return PropertyExpenseViewModel;})(srv.cls.PropertyExpenseViewModel);cls.PropertyExpenseViewModel=PropertyExpenseViewModel;})(cls||(cls={}));var __extends=this.__extends||function(d,b){for(var p in b){if(b.hasOwnProperty(p)){d[p]=b[p];}}function __(){this.constructor=d;}__.prototype=b.prototype;d.prototype=new __();};var cls;(function(cls){var IncomeInfoViewModel=(function(_super){__extends(IncomeInfoViewModel,_super);function IncomeInfoViewModel(ti,incomeInfo){var _this=this;_super.call(this);this.hasTransactionInfo=function(){return(!!_this.ticb&&!!_this.ticb());};this.getTransactionInfo=function(){if(_this.hasTransactionInfo()){return _this.ticb();}else{return null;}};this.setTransactionInfo=function(ti){_this.ticb=function(){return ti;};};this.getHasTransactionalInfoProperty=function(){if(_this.hasTransactionInfo()&&!!_this.getTransactionInfo().property){return true;}else{return false;}};this.getTransactionInfoProperty=function(){if(_this.getHasTransactionalInfoProperty()){return _this.getTransactionInfo().property;}return new cls.Map();};this.getProperty=function(){if(_this.getHasTransactionalInfoProperty()){var item=_this.getTransactionInfoProperty().lookup(_this.propertyId);return item;}return null;};this.setProperty=function(property){if(_this.getHasTransactionalInfoProperty()){_this.getTransactionInfoProperty().map(property);}};this.remove=function(){_this.isRemoved=true;if(_this.isCurrentlyAdded&&_this.hasTransactionInfo()){_this.getTransactionInfo().incomeInfo.remove(_this);}};this.isNegativeIncome=false;this.isNetRental=false;this.getNetRentalDisplayName=function(loanPurposeType,isAdjusted,properties,propertyId){var properties=properties.filter(function(property){return property.propertyId==propertyId;});var property;if(properties.length>0){property=properties[0];}isAdjusted=isAdjusted||(property&&(property.OwnershipPercentage!=100||property.vacancyPercentage!=75));if(isAdjusted){if(String(loanPurposeType)=="1"&&_this.isSubjectProperty){return"Adjusted Anticipated Net Rental Income";}return"Adjusted Net Rental Income ";}if(String(loanPurposeType)=="1"&&_this.isSubjectProperty){return"Anticipated Net Rental Income";}return"Net Rental Income ";};this.setDefaults=function(){_this.PreferredPaymentPeriodId=1;};this.initialize=function(incomeInfo){if(!!_this.getProperty()){_this.setProperty(new cls.PropertyViewModel(_this.getTransactionInfo(),null));}if(_this.incomeTypeId==5){_this.isNetRental=true;_this.canProvideDocumentation=null;_this.isNegativeIncome=_this.amount<0;}};this.setDefaults();if(!!incomeInfo){lib.copyState(incomeInfo,this);}if(!this.incomeInfoId||this.incomeInfoId==lib.getEmptyGuid()){this.incomeInfoId=util.IdentityGenerator.nextGuid();this.isCurrentlyAdded=true;}if(!!ti){this.setTransactionInfo(ti);ti.incomeInfo.map(this);}this.initialize(incomeInfo);}Object.defineProperty(IncomeInfoViewModel.prototype,"amount",{get:function(){return this._amount;},set:function(amount){if(!angular.isDefined(amount)){amount=0;}this._amount=amount;},enumerable:true,configurable:true});Object.defineProperty(IncomeInfoViewModel.prototype,"manualAmount",{get:function(){return this._amount;},set:function(manualAmount){this.amount=manualAmount;if(this.isNetRental){this.manualChange=true;}},enumerable:true,configurable:true});Object.defineProperty(IncomeInfoViewModel.prototype,"calculatedAmount",{get:function(){return this.amount;},set:function(calculatedAmount){if(!this.manualChange){this.amount=calculatedAmount;}},enumerable:true,configurable:true});Object.defineProperty(IncomeInfoViewModel.prototype,"Amount",{get:function(){return this.amount;},set:function(value){this.amount=value;},enumerable:true,configurable:true});Object.defineProperty(IncomeInfoViewModel.prototype,"PreferredPaymentPeriodId",{get:function(){return this.preferredPaymentPeriodId;},set:function(value){this.preferredPaymentPeriodId=value;},enumerable:true,configurable:true});Object.defineProperty(IncomeInfoViewModel.prototype,"calculatedMonthlyAmount",{get:function(){var amount=0;if(!this.isRemoved){amount=this.PreferredPaymentPeriodId==2?parseFloat((this.Amount/12).toFixed(4)):this.Amount;}return amount;},enumerable:true,configurable:true});Object.defineProperty(IncomeInfoViewModel.prototype,"fullAddressString",{get:function(){if(this.getProperty()){return this.getProperty().fullAddressString;}else{return"";}},enumerable:true,configurable:true});IncomeInfoViewModel.newIncomeInfo=function(ti,typeid){var incomeInfo=new cls.IncomeInfoViewModel(ti);incomeInfo.amount=0;incomeInfo.incomeTypeId=typeid;return incomeInfo;};return IncomeInfoViewModel;})(srv.cls.IncomeInfoViewModel);cls.IncomeInfoViewModel=IncomeInfoViewModel;var OtherIncomeInfoViewModel=(function(_super){__extends(OtherIncomeInfoViewModel,_super);function OtherIncomeInfoViewModel(ti,otherIncome){_super.call(this,ti);if(otherIncome){common.objects.automap(this,otherIncome);}else{this.amount=0;this.preferredPaymentPeriodId=1;}this.canProvideDocumentation=true;}return OtherIncomeInfoViewModel;})(IncomeInfoViewModel);cls.OtherIncomeInfoViewModel=OtherIncomeInfoViewModel;var NetRentalIncomeInfoViewModel=(function(_super){__extends(NetRentalIncomeInfoViewModel,_super);function NetRentalIncomeInfoViewModel(netRentalIncome){_super.call(this);if(netRentalIncome){common.objects.automap(this,netRentalIncome);}else{this.amount=0;this.preferredPaymentPeriodId=1;this.isRemoved=false;}this.isNetRental=true;this.incomeTypeId=5;this.canProvideDocumentation=null;}return NetRentalIncomeInfoViewModel;})(IncomeInfoViewModel);cls.NetRentalIncomeInfoViewModel=NetRentalIncomeInfoViewModel;})(cls||(cls={}));var __extends=this.__extends||function(d,b){for(var p in b){if(b.hasOwnProperty(p)){d[p]=b[p];}}function __(){this.constructor=d;}__.prototype=b.prototype;d.prototype=new __();};var cls;(function(cls){var LiabilityViewModel=(function(_super){__extends(LiabilityViewModel,_super);function LiabilityViewModel(ti,liability,borrowerFullName){var _this=this;_super.call(this);this.borrowerFullName=borrowerFullName;this.assignSubjectPropertyId=function(){if(!_this.ticb||!_this.ticb()){return;}var loanVm=_this.ticb().getLoan();if(!loanVm){return;}var subjectProperty=loanVm.getSubjectProperty();if(!subjectProperty){return;}_this.subjectPropertyId=subjectProperty.propertyId;};this.isRemoved=false;this.getTotalPayments=function(){var propertyExpensesExist=(_this.getProperty()&&_this.getProperty().propertyExpenses);var isFirstLienPosition=_this.lienPosition==1;var isPledgedAssetPaidOff=_this.borrowerDebtCommentId==1||_this.borrowerDebtCommentId==6;if(isPledgedAssetPaidOff||!propertyExpensesExist||!isFirstLienPosition){return _this.minPayment;}if(_this.getProperty().propertyExpenses.length>0){var filteredPropertyExpenses=_this.getProperty().propertyExpenses.filter(function(e){return !e.impounded&&e.monthlyAmount!=0;});if(filteredPropertyExpenses&&filteredPropertyExpenses.length>0){for(var i=0;i<filteredPropertyExpenses.length;i++){_this.minPayment+=parseFloat(String(filteredPropertyExpenses[i].monthlyAmount));}}}return _this.minPayment;};this.handleCommentChange=function(){if(_this.debtCommentId==9){_this.companyData.attn="Non-Borrowing Spouse Liability";}else{_this.companyData.attn="";}if(_this.isSecondaryPartyRecord){_this.setDTIAndTotalLiabilityFlags(false,false);return;}if(_this.debtCommentId==4){_this.setDTIAndTotalLiabilityFlags(false,true);return;}if(_this.debtCommentId==5||_this.debtCommentId==6||_this.debtCommentId==7||_this.debtCommentId==3||_this.debtCommentId==8){_this.setDTIAndTotalLiabilityFlags(false,false);}else{_this.setDTIAndTotalLiabilityFlags(true,true);}};this.setDTIAndTotalLiabilityFlags=function(includeInDTI,includeInTotalLiabilites){_this.includeInDTI=includeInDTI;_this.includeInLiabilitiesTotal=includeInTotalLiabilites;_this.liabilityDisabled=!_this.includeInLiabilitiesTotal||_this.isSecondaryPartyRecord;};this.isValid=function(){if(_this.borrowerDebtCommentId!=6){if(!_this.getProperty()||!_this.getProperty().propertyId||!_this.getProperty().isValid(false)||!_this.getProperty().propertyType||!_this.getProperty().currentEstimatedValue||!_this.getProperty().occupancyType||(_this.getProperty().occupancyType==2&&(!_this.getProperty().OwnershipPercentage||!_this.getProperty().grossRentalIncome))){return false;}if(_this.borrowerDebtCommentId!=1){if(!_this.lienPosition||!_this.companyData.companyName||!_this.unpaidBalance||!_this.minPayment||(_this.pledgedAssetLoanType==2&&!_this.maximumCreditLine)||(_this.lienPosition==1&&!_this.getProperty().areExpensesValid())){return false;}}}return true;};this.hidden=false;this.includeCollectionInLiabilitesTotalAmount=function(collection){if(collection.debtCommentId===1){collection.includeInLiabilitiesTotal=true;}else{if(collection.debtCommentId===4){collection.includeInLiabilitiesTotal=false;}}};this.hasTransactionInfo=function(){return(!!_this.ticb&&!!_this.ticb());};this.getTransactionInfo=function(){if(_this.hasTransactionInfo()){return _this.ticb();}else{return null;}};this.setTransactionInfo=function(ti){_this.ticb=function(){return ti;};};this.getHasTransactionalInfoProperty=function(){if(_this.hasTransactionInfo()&&!!_this.getTransactionInfo().property){return true;}else{return false;}};this.getTransactionInfoProperty=function(){if(_this.getHasTransactionalInfoProperty()){return _this.getTransactionInfo().property;}return new cls.Map();};this.hasProperty=function(){return !!_this.getProperty();};this.getProperty=function(){if(!!_this.propertyId&&_this.getHasTransactionalInfoProperty()){var item=_this.getTransactionInfoProperty().lookup(_this.propertyId);return item;}return null;};this.setProperty=function(property){if(!!property&&_this.getHasTransactionalInfoProperty()){_this.propertyId=property.propertyId;_this.getTransactionInfoProperty().map(property);}else{_this.propertyId=null;}};this.bindProperty=function(propertyVm){if(angular.isDefined(propertyVm)){_this.setProperty(propertyVm);}return _this.getProperty();};if(!!liability){lib.copyState(liability,this);if(this.companyData||angular.isUndefined(this.companyData.hasChanges)){this.companyData.hasChanges=false;}}else{this.debtCommentId=0;this.companyData=new cls.CompanyDataViewModel();this.reoInfo=new cls.REOInfoViewModel();}if(!this.liabilityInfoId||this.liabilityInfoId==lib.getEmptyGuid()){this.liabilityInfoId=util.IdentityGenerator.nextGuid();}if(!!ti){this.setTransactionInfo(ti);ti.liability.map(this);}if(!!borrowerFullName){this.borrowerFullName=borrowerFullName;}this.setAccountsOwnershipType();try{this.assignSubjectPropertyId();}catch(e){}}Object.defineProperty(LiabilityViewModel.prototype,"isAllocatedSubjProp",{get:function(){if(!this.propertyId){return false;}else{if(!this.subjectPropertyId){return false;}else{return this.propertyId==this.subjectPropertyId;}}},set:function(isAllocatedSubjProp){if(isAllocatedSubjProp){if(!!this.subjectPropertyId){this.propertyId=this.subjectPropertyId;}}else{this.propertyId=null;this.lienPosition=null;}},enumerable:true,configurable:true});Object.defineProperty(LiabilityViewModel.prototype,"isLenderSectionVisible",{get:function(){return this.borrowerDebtCommentId!=1;},enumerable:true,configurable:true});Object.defineProperty(LiabilityViewModel.prototype,"collectionColumnsDisabled",{get:function(){return this.debtCommentId==5||this.debtCommentId==3||this.debtCommentId==4;},enumerable:true,configurable:true});Object.defineProperty(LiabilityViewModel.prototype,"creditor",{get:function(){if(this.payoffLender!=undefined&&this.payoffLender!=null){return this.payoffLender;}else{return this.companyData.companyName;}},set:function(value){if(value!=this.companyData.companyName){this.payoffLender=value;}else{this.payoffLender=null;}},enumerable:true,configurable:true});Object.defineProperty(LiabilityViewModel.prototype,"balance",{get:function(){return this.unpaidBalance;},set:function(value){this.unpaidBalance=value;},enumerable:true,configurable:true});Object.defineProperty(LiabilityViewModel.prototype,"payoffCommentId",{get:function(){return this.isPledged?String(this.borrowerDebtCommentId):String(this.debtCommentId);},set:function(value){if(this.isPledged){this.borrowerDebtCommentId=parseInt(value);}else{this.debtCommentId=parseInt(value);}},enumerable:true,configurable:true});Object.defineProperty(LiabilityViewModel.prototype,"isUserAdded",{get:function(){return this.isUserEntry;},enumerable:true,configurable:true});Object.defineProperty(LiabilityViewModel.prototype,"isPublicRecord",{get:function(){return false;},enumerable:true,configurable:true});Object.defineProperty(LiabilityViewModel.prototype,"isLiability",{get:function(){return !this.isPledged;},enumerable:true,configurable:true});Object.defineProperty(LiabilityViewModel.prototype,"canEdit",{get:function(){return true;},enumerable:true,configurable:true});Object.defineProperty(LiabilityViewModel.prototype,"isPayoffItem",{get:function(){return false;},enumerable:true,configurable:true});Object.defineProperty(LiabilityViewModel.prototype,"lienPositionDisplayValue",{get:function(){if(this.borrowerDebtCommentId&&this.borrowerDebtCommentId==9){return"Duplicate";}if(this.lienPosition&&this.lienPosition!=-1&&this.lienPosition!=0){switch(this.lienPosition){case 1:return"First";case 2:return"Second";case 3:return"Third";case 4:return"Fourth";case 5:return"Fifth";}return"";}},enumerable:true,configurable:true});Object.defineProperty(LiabilityViewModel.prototype,"estimatedValueDisplayValue",{get:function(){if(this.getProperty()&&this.getProperty().currentEstimatedValue&&(!this.lienPosition||this.lienPosition==-1||this.lienPosition==1)){return this.getProperty().currentEstimatedValue.toString();}return"";},enumerable:true,configurable:true});Object.defineProperty(LiabilityViewModel.prototype,"payoffDisplayValue",{get:function(){return this.borrowerDebtCommentId==2||this.borrowerDebtCommentId==4||this.borrowerDebtCommentId==3;},enumerable:true,configurable:true});Object.defineProperty(LiabilityViewModel.prototype,"excludeDisplayValue",{get:function(){return this.borrowerDebtCommentId==9;},enumerable:true,configurable:true});Object.defineProperty(LiabilityViewModel.prototype,"propertyAddressDisplayValue",{get:function(){var propertyAddress="";if(this.getProperty()){if(this.borrowerDebtCommentId!=6){propertyAddress=this.getProperty().fullAddressString;}else{propertyAddress="Not my loan";}}else{propertyAddress="Not specified";}return propertyAddress;},enumerable:true,configurable:true});Object.defineProperty(LiabilityViewModel.prototype,"isNotMyLoan",{get:function(){return this.borrowerDebtCommentId==6;},enumerable:true,configurable:true});Object.defineProperty(LiabilityViewModel.prototype,"includeInTotalPayment",{get:function(){return this.borrowerDebtCommentId!=2&&this.borrowerDebtCommentId!=4&&this.borrowerDebtCommentId!=3&&this.borrowerDebtCommentId!=6&&this.borrowerDebtCommentId!=9;},enumerable:true,configurable:true});Object.defineProperty(LiabilityViewModel.prototype,"debtsAccountOwnershipType",{get:function(){return this._debtsAccountOwnershipType;},set:function(debtsAccountOwnershipType){this._debtsAccountOwnershipType=debtsAccountOwnershipType;this.setAccountsOwnershipType();},enumerable:true,configurable:true});Object.defineProperty(LiabilityViewModel.prototype,"DebtsAccountOwnershipType",{get:function(){return this.debtsAccountOwnershipType;},set:function(newVal){this.debtsAccountOwnershipType=newVal;},enumerable:true,configurable:true});LiabilityViewModel.prototype.setAccountsOwnershipType=function(){switch(this.liabilitiesAccountOwnershipType){case String(0):this.accountOwnershipTypeToolTipText="Authorized User";this.accountOwnershipTypeIndicator="a";break;case String(2):if(this.isSecondaryPartyRecord){this.accountOwnershipTypeToolTipText="Authorized User";this.accountOwnershipTypeIndicator="a";}else{this.accountOwnershipTypeToolTipText="";this.accountOwnershipTypeIndicator="";}break;case String(3):case String(4):this.accountOwnershipTypeToolTipText=this.isJointWithSingleBorrowerID?"Joint Account w/ Someone Else":"Joint Account w/ Co-Borrower";this.accountOwnershipTypeIndicator=this.isJointWithSingleBorrowerID?"j-other":"j";break;case String(-1):default:this.accountOwnershipTypeToolTipText="";this.accountOwnershipTypeIndicator="";break;}};Object.defineProperty(LiabilityViewModel.prototype,"property",{get:function(){return this.getProperty();},set:function(propertyVm){console.warn("LiabilityViewModel::<set property> should not be called ; use setProperty() instead.");},enumerable:true,configurable:true});return LiabilityViewModel;})(srv.cls.LiabilityViewModel);cls.LiabilityViewModel=LiabilityViewModel;})(cls||(cls={}));var __extends=this.__extends||function(d,b){for(var p in b){if(b.hasOwnProperty(p)){d[p]=b[p];}}function __(){this.constructor=d;}__.prototype=b.prototype;d.prototype=new __();};var cls;(function(cls){var HousingExpensesViewModel=(function(_super){__extends(HousingExpensesViewModel,_super);function HousingExpensesViewModel(housingExpenses,getPropertyList,getCosts,loanType,getPledgedAssets,subjectProperty){var _this=this;_super.call(this);this.getPropertyList=getPropertyList;this.getCosts=getCosts;this.loanType=loanType;this.getPledgedAssets=getPledgedAssets;this.subjectProperty=subjectProperty;this.getPropertyExpenses=function(){if(!_this.getPropertyList){return;}var properties=_this.getPropertyList();var property;if(properties&&properties.length>0){var primaryResidences=properties.filter(function(p){return(p.occupancyType==1||p.addressTypeId==1);});if(_this.loanType==1){property=primaryResidences.filter(function(p){return !p.isSubjectProperty;})[0];if(property){return property.propertyExpenses;}property=primaryResidences.filter(function(p){return p.addressTypeId==1;})[0];if(property){return property.propertyExpenses;}}}return _this.subjectProperty.propertyExpenses;};this.getPropertyExpensesForProperty=function(properties){if(properties&&properties.length>0){var property;var primaryResidences=properties.filter(function(p){return(p.occupancyType==String(1)||p.addressTypeId==1);});if(_this.loanType==1){property=primaryResidences.filter(function(p){return !p.isSubjectProperty;})[0];if(property){return property.propertyExpenses;}property=primaryResidences.filter(function(p){return p.addressTypeId==1;})[0];if(property){return property.propertyExpenses;}}return properties[0].propertyExpenses;}else{return null;}};this.getCost=function(hudLineNumber){if(_this.getCosts){var costs=_this.getCosts();var cost;if(costs.length>0){var filteredCosts=costs.filter(function(c){return c["hudLineNumber"]==hudLineNumber;});if(filteredCosts&&filteredCosts.length>0){cost=filteredCosts[0];}}}return cost?cost:new srv.cls.CostViewModel();};this.getTax=function(){return _this.getCost(1004);};this.getHoi=function(){return _this.getCost(1002);};this.getMi=function(){return _this.getCost(1003);};this.getFlood=function(){return _this.getCost(1006);};this.isExpenseImpounded=function(expenses,propertyExpenseType){if(!expenses){return false;}var filteredExpenses=expenses.filter(function(i){return i.type==String(propertyExpenseType);});if(filteredExpenses&&filteredExpenses.length>0){var expense=filteredExpenses[0];return expense.impounded&&expense.monthlyAmount>0;}return false;};if(housingExpenses){common.objects.automap(this,housingExpenses);}}Object.defineProperty(HousingExpensesViewModel.prototype,"newTotalHousingExpenses",{get:function(){return this.newMonthlyPayment;},enumerable:true,configurable:true});Object.defineProperty(HousingExpensesViewModel.prototype,"currentMonthlyPayment",{get:function(){return Number(this.floodInsurance)+Number(this.taxes)+Number(this.firstMtgPi)+Number(this.rent)+Number(this.mtgInsurance)+Number(this.hoa)+Number(this.hazardInsurance)+Number(this.secondMtgPi);},enumerable:true,configurable:true});Object.defineProperty(HousingExpensesViewModel.prototype,"newMonthlyPayment",{get:function(){return Number(this.newFloodInsurance)+Number(this.newTaxes)+Number(this.newFirstMtgPi)+Number(this.newMtgInsurance)+Number(this.newHoa)+Number(this.newHazardInsurance)+Number(this.newSecondMtgPi);},enumerable:true,configurable:true});Object.defineProperty(HousingExpensesViewModel.prototype,"totalHousingExpenses",{get:function(){return this.currentMonthlyPayment;},enumerable:true,configurable:true});Object.defineProperty(HousingExpensesViewModel.prototype,"floodInsuranceImpounded",{get:function(){return this.isPropertyExpenseImpounded(5);},enumerable:true,configurable:true});Object.defineProperty(HousingExpensesViewModel.prototype,"newFloodInsuranceImpounded",{get:function(){return this.getFlood().impounded;},enumerable:true,configurable:true});Object.defineProperty(HousingExpensesViewModel.prototype,"newHazardInsuranceImpounded",{get:function(){return this.getHoi().impounded;},enumerable:true,configurable:true});Object.defineProperty(HousingExpensesViewModel.prototype,"hazardInsuranceImpounded",{get:function(){return this.isPropertyExpenseImpounded(2);},enumerable:true,configurable:true});Object.defineProperty(HousingExpensesViewModel.prototype,"hoaImpounded",{get:function(){return this.isPropertyExpenseImpounded(4);},enumerable:true,configurable:true});Object.defineProperty(HousingExpensesViewModel.prototype,"newHoaImpounded",{get:function(){return false;},enumerable:true,configurable:true});Object.defineProperty(HousingExpensesViewModel.prototype,"mtgInsuranceImpounded",{get:function(){return this.isPropertyExpenseImpounded(3);},enumerable:true,configurable:true});Object.defineProperty(HousingExpensesViewModel.prototype,"newMtgInsuranceImpounded",{get:function(){return this.getMi().impounded;},enumerable:true,configurable:true});Object.defineProperty(HousingExpensesViewModel.prototype,"taxesImpounded",{get:function(){return this.isPropertyExpenseImpounded(1);},enumerable:true,configurable:true});Object.defineProperty(HousingExpensesViewModel.prototype,"newTaxesImpounded",{get:function(){return this.getTax().impounded;},enumerable:true,configurable:true});HousingExpensesViewModel.prototype.isPropertyExpenseImpounded=function(propertyExpenseType){return this.isExpenseImpounded(this.getPropertyExpenses(),propertyExpenseType);};Object.defineProperty(HousingExpensesViewModel.prototype,"totalImpounds",{get:function(){return(this.getHoi().impounded?Number(this.newHazardInsurance):0)+(this.getTax().impounded?Number(this.newTaxes):0)+(this.getMi().impounded?Number(this.newMtgInsurance):0)+(this.getFlood().impounded?Number(this.newFloodInsurance):0);},enumerable:true,configurable:true});return HousingExpensesViewModel;})(srv.cls.HousingExpensesViewModel);cls.HousingExpensesViewModel=HousingExpensesViewModel;})(cls||(cls={}));var global;(function(global){var regExClassName=/^function\s+([^ (]+)/g;function getClassName(cls){var results=regExClassName.exec(cls.toString());if(results.length==2){return cls.varName=results[1];}else{throw"setClassName() could not find constructor function name";}}global.getClassName=getClassName;})(global||(global={}));var moduleNames;(function(moduleNames){moduleNames.services="generated.services";moduleNames.controllers="controllers";moduleNames.directives="directives";moduleNames.providers="providers";moduleNames.filters="filters";moduleNames.common="common";})(moduleNames||(moduleNames={}));var moduleRegistration;(function(moduleRegistration){angular.module(moduleNames.controllers,[]);angular.module(moduleNames.services,["app.services","ngResource","blockUI"]);angular.module(moduleNames.directives,[]);angular.module(moduleNames.providers,[]);angular.module(moduleNames.filters,[]);function registerController(moduleName,cls){injectCheck(cls);classNameCheck(cls);return angular.module(moduleName).controller(cls.className,cls);}moduleRegistration.registerController=registerController;function registerService(moduleName,cls){injectCheck(cls);classNameCheck(cls);return angular.module(moduleName).service(cls.className,cls);}moduleRegistration.registerService=registerService;function registerProvider(moduleName,cls){injectCheck(cls);classNameCheck(cls);return angular.module(moduleName).provider(cls.className,cls);}moduleRegistration.registerProvider=registerProvider;function registerFilter(moduleName,cls){injectCheck(cls);classNameCheck(cls);return angular.module(moduleName).filter(cls.className,cls.factory);}moduleRegistration.registerFilter=registerFilter;function registerDirective(moduleName,cls){classNameCheck(cls);return angular.module(moduleName).directive(cls.className,directiveFactory(cls));}moduleRegistration.registerDirective=registerDirective;function classNameCheck(cls){validateStaticElementCheck(function(cls){return cls.className;},cls,"className");}function injectCheck(cls){validateStaticElementCheck(function(cls){return cls.$inject;},cls,"$inject");}function createNewCheck(cls){validateStaticElementCheck(function(cls){return cls.createNew;},cls,"createNew");}function factoryCheck(cls){validateStaticElementCheck(function(cls){return cls.factory;},cls,"factory");}function validateStaticElementCheck(elementValidationCheck,cls,missingElement){if(!elementValidationCheck(cls)){throw"static function '"+missingElement+"' was not defined on "+global.getClassName(cls);}}function directiveFactory(cls){injectCheck(cls);createNewCheck(cls);var directiveFactory=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i-0]=arguments[_i];}return cls.createNew(args);};directiveFactory.$inject=cls.$inject;return directiveFactory;}moduleRegistration.directiveFactory=directiveFactory;})(moduleRegistration||(moduleRegistration={}));var util;(function(util){(function(ServiceResponseStatus){ServiceResponseStatus[ServiceResponseStatus["Succeeded"]=0]="Succeeded";ServiceResponseStatus[ServiceResponseStatus["Failed"]=1]="Failed";})(util.ServiceResponseStatus||(util.ServiceResponseStatus={}));var ServiceResponseStatus=util.ServiceResponseStatus;(function(ServiceEventStatus){ServiceEventStatus[ServiceEventStatus["beforeCall"]=0]="beforeCall";ServiceEventStatus[ServiceEventStatus["afterCall"]=1]="afterCall";})(util.ServiceEventStatus||(util.ServiceEventStatus={}));var ServiceEventStatus=util.ServiceEventStatus;var httpMethod;(function(httpMethod){httpMethod[httpMethod["get"]=0]="get";httpMethod[httpMethod["post"]=1]="post";httpMethod[httpMethod["put"]=2]="put";httpMethod[httpMethod["delete"]=3]="delete";})(httpMethod||(httpMethod={}));var httpUtil=(function(){function httpUtil(httpUIBlockService,$http,apiRoot){var _this=this;this.httpUIBlockService=httpUIBlockService;this.$http=$http;this.apiRoot=apiRoot;this.request=function(callBack,serviceEventOrMesssge,errorHandler,config,successHandler){return callBack(successHandler,errorHandler);};this.post=function(methodPath,data,serviceEventOrMesssge,errorHandler,config,successHandler){var postFunc=function(){return _this.$http.post(_this.apiRoot+methodPath,data,_this.setServiceHeader(config));};return _this.call(postFunc,serviceEventOrMesssge,errorHandler,config,successHandler);};this.defaultSuccessHandler=function(sr){return sr.data.response;};this.get=function(methodPath,queryParams,serviceEventOrMesssge,errorHandler,config,successHandler){var getFunc=function(){return _this.$http.get(_this.apiRoot+methodPath,_this.setServiceHeader(config,queryParams));};return _this.call(getFunc,serviceEventOrMesssge,errorHandler,config,successHandler);};this.call=function(promiseFunc,serviceEventOrMesssge,errorHandler,config,successHandler){var serviceEvent=_this.getServiceEventHandler(serviceEventOrMesssge);var successHandlerWrapper=_this.getInternalSuccessHandler(serviceEvent,successHandler);var errorHandlerWrapper=_this.getInternalErrorHandler(serviceEvent,errorHandler);serviceEvent(0);return promiseFunc().then(function(response){return successHandlerWrapper(response);},function(response){return errorHandlerWrapper(response);});};this.getServiceEventHandler=function(serviceEventOrMesssge){if(!serviceEventOrMesssge){return function(serviceEvent){};}else{if(typeof serviceEventOrMesssge==="string"){return _this.httpUIBlockService.getServiceEventMethod(serviceEventOrMesssge);}else{return serviceEventOrMesssge;}}};this.getInternalSuccessHandler=function(serviceEvent,successHandler){return function(serviceResponse){serviceEvent(1);return successHandler(serviceResponse);};};this.getInternalErrorHandler=function(serviceEvent,errorHandler){var errorHandler=errorHandler||_this.defaultErrorHandler;return function(data){serviceEvent(1);return errorHandler(data);};};this.defaultErrorHandler=function(data){return data;};this.setServiceHeader=function(config,queryParams){queryParams=queryParams||{};config=config||{};config.params=queryParams;queryParams.CallTimestamp=Date.now();queryParams.UserID="Joker";return config;};this.getServiceHeader=function(){return{CallTimestamp:Date.now(),UserID:"Joker"};};}httpUtil.$inject=["HttpUIBlockService","$http","apiRoot"];httpUtil.className="httpUtil";return httpUtil;})();util.httpUtil=httpUtil;moduleRegistration.registerService(moduleNames.services,httpUtil);})(util||(util={}));var util;(function(util){var HttpUIBlockService=(function(){function HttpUIBlockService(blockUI){var _this=this;this.blockUI=blockUI;this.getServiceEventMethod=function(message){return function(status){if(status==0){_this.blockUI.start(message);}else{if(status==1){_this.blockUI.stop();}}};};this.getWrappedEventMethod=function(message,serviceEvent){return function(status){if(status==0){_this.blockUI.start(message);}else{if(status==1){_this.blockUI.stop();}}serviceEvent(status);};};}HttpUIBlockService.$inject=["blockUI"];HttpUIBlockService.className="HttpUIBlockService";return HttpUIBlockService;})();util.HttpUIBlockService=HttpUIBlockService;moduleRegistration.registerService(moduleNames.services,HttpUIBlockService);})(util||(util={}));var lib;(function(lib){var referenceWrapper=(function(){function referenceWrapper(ref){this.ref=ref;}return referenceWrapper;})();lib.referenceWrapper=referenceWrapper;function mergeContext(value,context){return angular.extend(value,context);}lib.mergeContext=mergeContext;})(lib||(lib={}));var lib;(function(lib){var emptyGuid="00000000-0000-0000-0000-000000000000";var noCopyFlagPfx="$$";function getEmptyGuid(){return emptyGuid;}lib.getEmptyGuid=getEmptyGuid;function IdIsNullOrDefault(id){return !id||id==emptyGuid;}lib.IdIsNullOrDefault=IdIsNullOrDefault;function assert(obj,error){if(common.objects.isNullOrUndefined(obj)){throw new Error(error);}}lib.assert=assert;function getNumericValue(value,defaultVal){if(defaultVal===void 0){defaultVal=0;}return isNaN(+value)?defaultVal:+value;}lib.getNumericValue=getNumericValue;function reduceNumeric(func){var numbers=[];for(var _i=1;_i<arguments.length;_i++){numbers[_i-1]=arguments[_i];}if(numbers.length==0){return 0;}var rslt=getNumericValue(numbers[0]);for(var i=1;i<numbers.length;i++){rslt=func(rslt,getNumericValue(numbers[i]));}return rslt;}lib.reduceNumeric=reduceNumeric;function copyState(source,target,respectNoCopyFlag){if(respectNoCopyFlag===void 0){respectNoCopyFlag=false;}for(var key in source){if(respectNoCopyFlag){var keyString=key.toString();if(!!keyString&&keyString.length>noCopyFlagPfx.length&&noCopyFlagPfx==keyString.substr(0,noCopyFlagPfx.length)){continue;}}if(source.hasOwnProperty(key)&&typeof source[key]!="function"){target[key]=source[key];}}}lib.copyState=copyState;function filterWithProjection(source,pred,accessor){var items=[];if(source){source.forEach(function(item){if(pred(item)){items.push(accessor(item));}});}return items;}lib.filterWithProjection=filterWithProjection;function filter(source,pred){var items=[];if(source){source.forEach(function(item){if(pred(item)){items.push(item);}});}return items;}lib.filter=filter;function diff(a,b,eq){var retVal=[];if(!a){return retVal;}if(!b){return a;}retVal=filter(a,function(aItem){return filter(b,function(bItem){return eq(bItem,aItem);}).length==0;});return retVal;}lib.diff=diff;function findIndex(source,pred,defaultValue){if(defaultValue===void 0){defaultValue=-1;}if(source){for(var i=0;i<source.length;i++){if(pred(source[i])){return i;}}}return defaultValue;}lib.findIndex=findIndex;function findFirst(source,pred,defaultValue){if(source){for(var i=0;i<source.length;i++){if(pred(source[i])){return source[i];}}}return defaultValue;}lib.findFirst=findFirst;function findSingle(source,pred,defaultValue){if(source){var results=new Array();for(var i=0;i<source.length;i++){var item=source[i];if(pred(item)){results.push(item);}if(results.length>1){throw new Error("More than one matching element found");}}if(results.length===1){return results[0];}}return defaultValue;}lib.findSingle=findSingle;function max(source,accessor,defaultReturn){var max=defaultReturn?defaultReturn:0;if(source){source.forEach(function(item){var val=accessor(item);max=val>max?val:max;});}return max;}lib.max=max;function removeFirst(source,pred){if(source){for(var i=0;i<source.length;i++){if(pred(source[i])){source.splice(i,1);return true;}}}return false;}lib.removeFirst=removeFirst;function replace(source,item,pred){if(source){for(var i=0;i<source.length;i++){if(pred(source[i])){source[i]=item;return true;}}}return false;}lib.replace=replace;function update(source,item,pred){if(source){for(var i=0;i<source.length;i++){if(pred(source[i])){angular.extend(source[i],item);return true;}}}return false;}lib.update=update;function move(source,dest,pred){if(source&&dest){var item=lib.findFirst(source,pred);if(item){lib.removeFirst(source,pred);dest.push(item);return true;}}return false;}lib.move=move;function forEach(source,action){if(source){source.forEach(function(item){return action(item);});}}lib.forEach=forEach;function conditionalForEach(source,pred,action){if(source){source.forEach(function(item){if(pred(item)){action(item);}});}}lib.conditionalForEach=conditionalForEach;function summate(source,pred,accessor){var total=0;if(source){source.forEach(function(item){if(pred(item)){total+=accessor(item);}});}return total;}lib.summate=summate;function summateAll(source,accessor){var total=0;if(source){source.forEach(function(item){total+=accessor(item);});}return total;}lib.summateAll=summateAll;function shallowCopy(items){var list=[];if(items){list=[].concat(items);}return list;}lib.shallowCopy=shallowCopy;function contains(items,pred){if(items){for(var i=0;i<items.length;i++){if(pred(items[i])){return true;}}}return false;}lib.contains=contains;function distinct(items,eq){var indicesToRemove=[];var distinctItems=[];if(items){for(var index=0;index<items.length;index++){var item=items[index];var pred=function(currentItem){return eq(currentItem,item);};for(var i=index+1;i<items.length;i++){if(!indicesToRemove.some(function(idx){return idx==i;})&&pred(items[i])){indicesToRemove.push(i);}}}if(indicesToRemove.length==0){distinctItems=shallowCopy(items);}else{indicesToRemove=indicesToRemove.sort();var idxToSkip=indicesToRemove.shift();for(var i=0;i<items.length;i++){if(i!=idxToSkip){distinctItems.push(items[i]);}else{idxToSkip=indicesToRemove.length>0?indicesToRemove.shift():-1;}}}}return distinctItems;}lib.distinct=distinct;function updateAndReturnNonMatching(srcList,destList,equality,classFactory){var nonMatching=[];if(srcList&&destList){srcList.forEach(function(srcItem){var pred=function(destItem){return equality(srcItem,destItem);};var index=findIndex(destList,pred,-1);if(index!=-1){destList[index]=classFactory(srcItem);}else{nonMatching.push(classFactory(srcItem));}});}return nonMatching;}lib.updateAndReturnNonMatching=updateAndReturnNonMatching;function startsWith(prefix,text){if(prefix&&text){return text.slice(0,prefix.length)==prefix;}return false;}lib.startsWith=startsWith;function getLookupStrings(lookup){if(!lookup){throw new Error("Lookup not defined");}var retVal=[];lib.forEach(lookup,function(item){return retVal.push(item.text);});return retVal;}lib.getLookupStrings=getLookupStrings;function getLookupStringsByEnum(lookup,enumTypes){var _this=this;if(!lookup){throw new Error("Lookup not defined");}if(!enumTypes){throw new Error("enumTypes not defined");}var retVal=[];lib.forEach(enumTypes,function(enumType){return retVal.push(_this.getLookupStringByEnum(lookup,enumType));});return retVal;}lib.getLookupStringsByEnum=getLookupStringsByEnum;function getLookupStringByEnum(lookup,enumType){if(!lookup){throw new Error("Lookup not defined");}if(angular.isUndefined(enumType)){throw new Error("enumType not defined");}var typ=lib.findFirst(lookup,function(o){return o.value==String(enumType);});if(!!typ){return typ.text;}}lib.getLookupStringByEnum=getLookupStringByEnum;function isNumber(value){return typeof(value)==="number";}lib.isNumber=isNumber;})(lib||(lib={}));var lib;(function(lib){function enumToLookupList(e){if(e==null){return[];}var enumList=[];var enumMapped=getNamesAndValues(e);for(var i=0;i<enumMapped.length;i++){enumList.push(new cls.LookupItem(enumMapped[i].name,enumMapped[i].value.toString()));}return enumList;}lib.enumToLookupList=enumToLookupList;function getValues(e){return Object.keys(e).map(function(v){return parseInt(v,10);}).filter(function(v){return !isNaN(v);});}function getNamesAndValues(e){return getValues(e).map(function(v){return{name:e[v],value:v};});}})(lib||(lib={}));var lib;(function(lib){function createClassArray(cls,interfaces){var classes=[];if(interfaces){interfaces.forEach(function(intf){return classes.push(new cls(intf));});}return classes;}lib.createClassArray=createClassArray;function cast(item){return item;}lib.cast=cast;})(lib||(lib={}));var lib;(function(lib){lib.createFlaggedEnum=function(_enum,_max){var base=_enum,max=_max;var Base=function(val){if(typeof(val)==="string"){val=base[val];}this.value=val+0;};var proto=Base.prototype;proto.valueOf=function(){return this.value;};proto.toString=function(){var list=[];for(var i=1;i<max;i=i<<1){if((this.value&i)!==0){list.push(base[i]);}}return list.toString();};proto.toArray=function(){var list=[];for(var i=1;i<max;i=i<<1){if((this.value&i)!==0){list.push(new Base(i));}}return list;};proto.contains=function(val){if(typeof(val)==="string"){val=base[val];}return(this.value&val)===(val+0);};proto.add=function(val){if(typeof(val)==="string"){val=base[val];}return new Base(this.value|val);};proto.remove=function(val){if(typeof(val)==="string"){val=this.base[val];}return new Base((this.value^val)&this.value);};proto.intersect=function(val){if(typeof(val)==="string"){val=base[val];}var final_=0;for(var i=1;i<max;i=(i<<1)){if((this.value&i)!==0&&(val&i)!==0){final_+=i;}}return new Base(final_);};proto.equals=function(val){if(typeof(val)==="string"){val=base[val];}return this.value===(val+0);};return Base;};})(lib||(lib={}));var srv;(function(srv){var MegaLoanService=(function(){function MegaLoanService(httpUtil){var _this=this;this.httpUtil=httpUtil;this.EagerLoadGeneric=function(loanId,userAccountId,successHandler,serviceEventOrMessage,errorHandler,methodPath,config){if(methodPath===void 0){methodPath="MegaLoanService/EagerLoad";}return _this.httpUtil.get(methodPath,{loanId:loanId,userAccountId:userAccountId},serviceEventOrMessage,errorHandler,config,successHandler);};this.EagerLoad=function(loanId,userAccountId,serviceEventOrMessage,successHandler,errorHandler,methodPath,config){if(methodPath===void 0){methodPath="MegaLoanService/EagerLoad";}return _this.EagerLoadGeneric(loanId,userAccountId,successHandler||_this.httpUtil.defaultSuccessHandler,serviceEventOrMessage,errorHandler,methodPath,config);};this.SaveGeneric=function(loan,userAccountId,successHandler,serviceEventOrMessage,errorHandler,methodPath,config){if(methodPath===void 0){methodPath="MegaLoanService/Save";}return _this.httpUtil.post(methodPath,{loan:loan,userAccountId:userAccountId},serviceEventOrMessage,errorHandler,config,successHandler);};this.Save=function(loan,userAccountId,serviceEventOrMessage,successHandler,errorHandler,methodPath,config){if(methodPath===void 0){methodPath="MegaLoanService/Save";}return _this.SaveGeneric(loan,userAccountId,successHandler||_this.httpUtil.defaultSuccessHandler,serviceEventOrMessage,errorHandler,methodPath,config);};}MegaLoanService.className="MegaLoanService";MegaLoanService.$inject=["httpUtil"];return MegaLoanService;})();srv.MegaLoanService=MegaLoanService;})(srv||(srv={}));moduleRegistration.registerService(moduleNames.services,srv.MegaLoanService);var events;(function(events){var EventHander=(function(){function EventHander(eventName,$rootScope){var _this=this;this.eventName=eventName;this.$rootScope=$rootScope;this.callbackEvents=new Array();this.registerForEvent=function(registrationId,caller,callback){var eventCallBackEntry=_this.getEventCallbackEntry(registrationId);if(!eventCallBackEntry){_this.callbackEvents.push({registrationId:registrationId,isActive:true,caller:caller,callback:callback});}else{eventCallBackEntry.caller=caller;eventCallBackEntry.isActive=true;eventCallBackEntry.callback=callback;}};this.setCallbackActivity=function(registrationId,isActive){var eventCallBackEntry=_this.getEventCallbackEntry(registrationId);if(eventCallBackEntry){eventCallBackEntry.isActive=isActive;return true;}return false;};this.onEvent=function(event,customEvent){_this.callbackEvents.forEach(function(callBackEntry){if(callBackEntry.isActive){callBackEntry.callback.call(callBackEntry.caller,customEvent);}});};this.$rootScope.$on(eventName,this.onEvent);}EventHander.prototype.broadcastEvent=function(eventId,context){this.$rootScope.$broadcast(this.eventName,{eventHandler:this,eventId:eventId,value:context});};EventHander.prototype.getEventCallbackEntry=function(registrationId){for(var i=0;i<this.callbackEvents.length;i++){if(this.callbackEvents[i].registrationId==registrationId){return this.callbackEvents[i];}}return null;};return EventHander;})();events.EventHander=EventHander;})(events||(events={}));angular.module("loan.events",[]);var events;(function(events){var EventTypes=(function(){function EventTypes(){}Object.defineProperty(EventTypes,"OnPropertyChangedEvent",{get:function(){return"OnPropertyChanged";},enumerable:true,configurable:true});Object.defineProperty(EventTypes,"OnSystemEvent",{get:function(){return"OnSystemEvent";},enumerable:true,configurable:true});return EventTypes;})();(function(SystemEventIdentifier){SystemEventIdentifier[SystemEventIdentifier["creditCheckComplete"]=0]="creditCheckComplete";SystemEventIdentifier[SystemEventIdentifier["creditCheckError"]=1]="creditCheckError";})(events.SystemEventIdentifier||(events.SystemEventIdentifier={}));var SystemEventIdentifier=events.SystemEventIdentifier;(function(LoanFieldIdentifier){LoanFieldIdentifier[LoanFieldIdentifier["LoanAmount"]=0]="LoanAmount";LoanFieldIdentifier[LoanFieldIdentifier["BorrowerIncome"]=1]="BorrowerIncome";LoanFieldIdentifier[LoanFieldIdentifier["PurchasePrice"]=2]="PurchasePrice";LoanFieldIdentifier[LoanFieldIdentifier["EstimatedValue"]=3]="EstimatedValue";LoanFieldIdentifier[LoanFieldIdentifier["LiabilityType"]=4]="LiabilityType";LoanFieldIdentifier[LoanFieldIdentifier["AppraisedValue"]=5]="AppraisedValue";LoanFieldIdentifier[LoanFieldIdentifier["LiabilityMonthsLeft"]=6]="LiabilityMonthsLeft";LoanFieldIdentifier[LoanFieldIdentifier["LiabilityUnpaidBalance"]=7]="LiabilityUnpaidBalance";LoanFieldIdentifier[LoanFieldIdentifier["LiabilityMinPayment"]=8]="LiabilityMinPayment";LoanFieldIdentifier[LoanFieldIdentifier["LiabilityCommentID"]=9]="LiabilityCommentID";LoanFieldIdentifier[LoanFieldIdentifier["LiabilityOwnershipType"]=10]="LiabilityOwnershipType";LoanFieldIdentifier[LoanFieldIdentifier["PublicRecordCommentID"]=11]="PublicRecordCommentID";LoanFieldIdentifier[LoanFieldIdentifier["MiscellaneousDebtMonthsChanged"]=12]="MiscellaneousDebtMonthsChanged";LoanFieldIdentifier[LoanFieldIdentifier["MiscellaneousDebtAmountChanged"]=13]="MiscellaneousDebtAmountChanged";LoanFieldIdentifier[LoanFieldIdentifier["PropertyOccupancyTypeChanged"]=14]="PropertyOccupancyTypeChanged";LoanFieldIdentifier[LoanFieldIdentifier["IncomeAmountChanged"]=15]="IncomeAmountChanged";LoanFieldIdentifier[LoanFieldIdentifier["IncomePeriodChanged"]=16]="IncomePeriodChanged";LoanFieldIdentifier[LoanFieldIdentifier["OtherIncomeAmount"]=17]="OtherIncomeAmount";LoanFieldIdentifier[LoanFieldIdentifier["OtherIncomeType"]=18]="OtherIncomeType";LoanFieldIdentifier[LoanFieldIdentifier["OtherIncomePaymentPeriod"]=19]="OtherIncomePaymentPeriod";LoanFieldIdentifier[LoanFieldIdentifier["RealEstate"]=20]="RealEstate";LoanFieldIdentifier[LoanFieldIdentifier["Impound"]=21]="Impound";LoanFieldIdentifier[LoanFieldIdentifier["SubordinateFinancing"]=22]="SubordinateFinancing";LoanFieldIdentifier[LoanFieldIdentifier["AdjustedPointsChanged"]=23]="AdjustedPointsChanged";LoanFieldIdentifier[LoanFieldIdentifier["downPaymentPercentageToFixed"]=24]="downPaymentPercentageToFixed";LoanFieldIdentifier[LoanFieldIdentifier["downPaymentValue"]=25]="downPaymentValue";LoanFieldIdentifier[LoanFieldIdentifier["Recalculate"]=26]="Recalculate";LoanFieldIdentifier[LoanFieldIdentifier["DebtType"]=27]="DebtType";LoanFieldIdentifier[LoanFieldIdentifier["AggregateAdjustment"]=28]="AggregateAdjustment";LoanFieldIdentifier[LoanFieldIdentifier["SubjectPropertyZipCode"]=29]="SubjectPropertyZipCode";LoanFieldIdentifier[LoanFieldIdentifier["todo"]=30]="todo";})(events.LoanFieldIdentifier||(events.LoanFieldIdentifier={}));var LoanFieldIdentifier=events.LoanFieldIdentifier;var LoanEventService=(function(){function LoanEventService($rootScope){var _this=this;this.$rootScope=$rootScope;this.registerForPropertyChangeEvent=function(registrationId,caller,propertyChangedEventCallback){_this.propertyChangeEventService.registerForEvent(registrationId,caller,propertyChangedEventCallback);};this.deactivatePropertyChangeEventHandler=function(registrationId){return _this.propertyChangeEventService.setCallbackActivity(registrationId,false);};this.activatePropertyChangeEventHandler=function(registrationId){return _this.propertyChangeEventService.setCallbackActivity(registrationId,true);};this.registerForSystemEvent=function(registrationId,caller,systemEventCallback){_this.systemEventService.registerForEvent(registrationId,caller,systemEventCallback);};this.deactivateSystemEventHandler=function(registrationId){return _this.systemEventService.setCallbackActivity(registrationId,false);};this.activateSystemEventHandler=function(registrationId){return _this.systemEventService.setCallbackActivity(registrationId,true);};this.propertyChangeEventService=new events.EventHander(EventTypes.OnPropertyChangedEvent,$rootScope);this.systemEventService=new events.EventHander(EventTypes.OnSystemEvent,$rootScope);}LoanEventService.prototype.broadcastPropertyChangedEvent=function(loanFieldId,currentValue){this.propertyChangeEventService.broadcastEvent(loanFieldId,currentValue);};LoanEventService.prototype.broadcastSystemEvent=function(eventId,value){this.systemEventService.broadcastEvent(eventId,value);};LoanEventService.$inject=["$rootScope"];LoanEventService.className="loanEvent";return LoanEventService;})();events.LoanEventService=LoanEventService;moduleRegistration.registerService("loan.events",LoanEventService);})(events||(events={}));var calc;(function(calc){var LoanCalculator=(function(){function LoanCalculator(LoanCalculatorService,$resource,apiRoot,loanEvent,$rootScope,commonCalculatorSvc,BroadcastSvc,costDetailsHelpers,loanDetailsSvc,enums,commonService,costDetailsSvc,ntbCenterService){var _this=this;this.LoanCalculatorService=LoanCalculatorService;this.$resource=$resource;this.apiRoot=apiRoot;this.$rootScope=$rootScope;this.commonCalculatorSvc=commonCalculatorSvc;this.BroadcastSvc=BroadcastSvc;this.costDetailsHelpers=costDetailsHelpers;this.loanDetailsSvc=loanDetailsSvc;this.enums=enums;this.commonService=commonService;this.costDetailsSvc=costDetailsSvc;this.ntbCenterService=ntbCenterService;this.currentRequestId=0;this.bindToCalculator=function(wrappedLoan,appData){_this.wrappedLoan=wrappedLoan;_this.applicationData=appData;_this.onPropertyChange(null);};this.requestCount=0;this.recalculating=false;this.incrementRequestCount=function(){_this.requestCount++;_this.recalculating=true;};this.decrementRequestCount=function(){if(_this.requestCount--){_this.recalculating=false;}};this.onPropertyChange=function(propertyChangedEvent){_this.incrementRequestCount();var requestContext=++_this.currentRequestId;var calculatorRequest=_this.getCalculatorRequest(requestContext);if(calculatorRequest.clientContextIdentifier!=_this.currentRequestId){return;}var self=_this;_this.calculatorService.UpdateCalculatedValues(calculatorRequest).$promise.then(function(sr){self.decrementRequestCount();if(sr.status==0&&sr.response.clientContextIdentifier==self.currentRequestId){self.updateSummaryValue(sr.response,self.calculatedSummaryValues);}if(sr.status==1){console.log("Error processing request context "+requestContext+": "+sr.errorMsg);}},function(error){self.decrementRequestCount();});};this.getBranchDataForLoan=function(){var defaultBrokerCompensationPercent=0;if(!!_this.applicationData&&!!_this.applicationData.companyProfile){var channelId=Boolean(_this.wrappedLoan.ref.channelId)?_this.wrappedLoan.ref.channelId:_this.applicationData.currentUser.channelId;var divisionId=Boolean(_this.wrappedLoan.ref.divisionId)?_this.wrappedLoan.ref.divisionId:_this.applicationData.currentUser.divisionId;var branchId=Boolean(_this.wrappedLoan.ref.branchId)?_this.wrappedLoan.ref.branchId:_this.applicationData.currentUser.branchId;var channel=lib.findFirst(_this.applicationData.companyProfile.channels,function(c){return c.channelId==channelId;});if(channel&&!!channel.isWholesale){var division=lib.findFirst(channel.divisions,function(d){return d.divisionId==divisionId;});if(division&&!!division){var branch=lib.findFirst(division.branches,function(b){return b.branchId==branchId;});if(branch&&!!branch){defaultBrokerCompensationPercent=branch.defaultBrokerCompensationPercent;}}}}return defaultBrokerCompensationPercent;};this.getNtbRequest=function(){var ntbRequiredRequest=new srv.cls.NtbRequiredRequest();ntbRequiredRequest.loanAmount=_this.wrappedLoan.ref.loanAmount;ntbRequiredRequest.loanPurposeType=_this.wrappedLoan.ref.loanPurposeType;ntbRequiredRequest.propertyUsageType=_this.wrappedLoan.ref.active.occupancyType;ntbRequiredRequest.geoStateUS=_this.wrappedLoan.ref.subjectProperty.stateId;ntbRequiredRequest.closingDate=_this.wrappedLoan.ref.closingDate.dateValue;ntbRequiredRequest.accountOpenDate=_this.wrappedLoan.ref.CurrentAccountOpenDate;return ntbRequiredRequest;};this.getPrimaryLoanAppCb=function(){return _this.wrappedLoan.ref.primary;};this.getCalculatorRequest=function(requestContext){var calculatorRequest=new srv.cls.CalculatorRequest();calculatorRequest.loan=_this.wrappedLoan.ref;calculatorRequest.clientContextIdentifier=requestContext;calculatorRequest.defaultBrokerCompensationPercent=_this.getBranchDataForLoan();calculatorRequest.fico=_this.commonCalculatorSvc.GetFicoScore(_this.wrappedLoan,_this.applicationData);calculatorRequest.totalClosingCostsBorrower=_this.getTotalClosingCosts()-_this.costDetailsHelpers.calculateSectionTotal(5)-_this.costDetailsHelpers.calculateSectionTotal(6)+_this.costDetailsHelpers.getCostsTotalByHUDLineNumber(901);if(_this.wrappedLoan.ref.isDataValidForAggregateAdjustmentCalculation()){var stateName=_this.wrappedLoan.ref.getSubjectProperty().stateName;var impoundSchedulers=_this.applicationData.impoundSchedules.filter(function(c){if(c.state==stateName){return c;}});if(impoundSchedulers.length>0){calculatorRequest.monthsOfCushion=impoundSchedulers[0].cushion;calculatorRequest.calculateAggregateAdjustment=true;}}else{_this.wrappedLoan.ref.resetEscrowsMonthsToBePaid();}calculatorRequest.ntbRequiredRequest=_this.getNtbRequest();calculatorRequest.ntbBenefitActivationRequest=_this.ntbCenterService.getNtbBenefitActivationRequest(_this.wrappedLoan);calculatorRequest.stateImpoundLimit=_this.getStateImpoundLimit();calculatorRequest.recoupmentPeriodRequest=_this.getRecoupmentPeriodRequest();calculatorRequest.allowableBorrowerPaidClosingCosts=_this.costDetailsHelpers.calculateAllowableBorrowerPaidClosingCost();calculatorRequest.prepaidExpenses=_this.costDetailsHelpers.calculateSectionTotal(5),calculatorRequest.lenderCreditforClosingCostsAndPrepaids=_this.wrappedLoan.ref.closingCost.totals.lenderCredits,calculatorRequest.fhaCountyLoanLimit=_this.wrappedLoan.ref.fhaCountyLoanLimit,_this.wrappedLoan.ref.prepareSave();return calculatorRequest;};this.getRecoupmentPeriodRequest=function(){var recoupmentRequest=new srv.cls.RecoupmentPeriodRequest();recoupmentRequest.costOfNewLoan=_this.getTotalClosingCosts();recoupmentRequest.currentPaymentAndMI=_this.getCurrentPaymentAndMi(true);if(!!_this.wrappedLoan.ref.FirstLienReoItem&&!!_this.wrappedLoan.ref.FirstLienReoItem.reoInfo){recoupmentRequest.prepaymentPenaltyAmount=_this.wrappedLoan.ref.FirstLienReoItem.reoInfo.prePaymentAmount;}recoupmentRequest.proposedPaymentAndMI=_this.wrappedLoan.ref.loanLock.newMonthlyPayment;return recoupmentRequest;};this.getCurrentPaymentAndMi=function(includeAdditionalMortgagees){if(includeAdditionalMortgagees===void 0){includeAdditionalMortgagees=false;}if(includeAdditionalMortgagees){return _this.loanDetailsSvc.totalCurrentExpenses(_this.wrappedLoan.ref.housingExpenses.rent,_this.wrappedLoan.ref.housingExpenses.firstMtgPi,_this.wrappedLoan.ref.housingExpenses.secondMtgPi,_this.wrappedLoan.ref.loanPurposeType,_this.wrappedLoan.ref.getSubjectProperty().OccupancyType,_this.wrappedLoan.ref.getSubjectProperty,_this.wrappedLoan.ref.primary.getBorrower().getCurrentAddress,_this.wrappedLoan.ref.housingExpenses.addlMortgagees);}else{return _this.loanDetailsSvc.totalCurrentExpenses(_this.wrappedLoan.ref.housingExpenses.rent,_this.wrappedLoan.ref.housingExpenses.firstMtgPi,_this.wrappedLoan.ref.housingExpenses.secondMtgPi,_this.wrappedLoan.ref.loanPurposeType,_this.wrappedLoan.ref.getSubjectProperty().OccupancyType,_this.wrappedLoan.ref.getSubjectProperty,_this.wrappedLoan.ref.primary.getBorrower().getCurrentAddress);}};this.getMIAmount=function(isNewLoan){return _this.loanDetailsSvc.getMIAmount(isNewLoan,function(){return _this.wrappedLoan.ref.closingCost.costs;},_this.wrappedLoan.ref.loanPurposeType,_this.wrappedLoan.ref.getSubjectProperty().occupancyType,_this.wrappedLoan.ref.getSubjectProperty,_this.wrappedLoan.ref.primary.getBorrower().getCurrentAddress,3);};this.updateSummaryValue=function(calcResponse,calculatedSummaryValues){if(calcResponse.calculatedValueTypes){calcResponse.calculatedValueTypes.forEach(function(calcValueType){return _this.updateSummaryField(calcValueType,calcResponse,calculatedSummaryValues);});}_this.wrappedLoan.ref.fhaCountyLoanLimit=_this.commonService.getFHAOrVALoanLimit(_this.applicationData.fhaLoanLimits,_this.wrappedLoan.ref.getSubjectProperty().stateName,_this.wrappedLoan.ref.getSubjectProperty().countyName,_this.wrappedLoan.ref.getSubjectProperty().numberOfUnits);_this.wrappedLoan.ref.vaCountyLoanLimit=_this.commonService.getFHAOrVALoanLimit(_this.applicationData.vaLoanLimits,_this.wrappedLoan.ref.getSubjectProperty().stateName,_this.wrappedLoan.ref.getSubjectProperty().countyName,_this.wrappedLoan.ref.getSubjectProperty().numberOfUnits);};this.getStateImpoundLimit=function(){var ltvLimit=lib.filter(_this.applicationData.impoundLimit,function(item){return item.stateId==_this.wrappedLoan.ref.getSubjectProperty().stateName;});if(ltvLimit&&ltvLimit.length>0){return ltvLimit[0].ltvLimit;}return 0;};this.updateSummaryField=function(calcValueType,calcResponse,calculatedSummaryValues){switch(calcValueType){case 3:_this.updateCltv(calcResponse.cltv,calculatedSummaryValues);break;case 2:_this.updateDTIAndHousingRatio(calcResponse.dtiAndHousingRatio,calculatedSummaryValues);break;case 4:_this.updateHcltv(calcResponse.hcltv,calculatedSummaryValues);break;case 1:_this.updateLtv(calcResponse.ltv,calculatedSummaryValues);break;case 13:_this.recalculateCosts(calcResponse.recalculatedCosts);_this.costDetailsHelpers.getCostDetailsData();_this.BroadcastSvc.broadcastCostsRecalculated();break;case 9:_this.updateLoanCosts(calcResponse.hud801And802Costs);_this.updateLoanCosts(calcResponse.hud801And802Costs);break;case 10:_this.updateSectionV(calcResponse.housingExpenses);break;case 11:_this.updateInterestAmountPerDiem(calcResponse.interestAmountPerDiem);break;case 12:_this.updateSectionVII(calcResponse.detailsOfTransaction);break;case 7:_this.updateNetRental(calcResponse.netRentalIncomes);break;case 14:_this.updateSubordinateFee(calcResponse.subordinateFee);break;case 6:_this.updateApr(calcResponse.apr);break;case 15:_this.wrappedLoan.ref.firstPaymentDate=calcResponse.firstPaymentDate;break;case 16:_this.wrappedLoan.ref.totalAggregateAdjustment=calcResponse.agregateAdjustment;break;case 20:_this.wrappedLoan.ref.vaInformation.qmCertification=calcResponse.qmCertification;break;case 18:_this.wrappedLoan.ref.loanLock.newMonthlyPayment=calcResponse.newMonthlyPayment;break;case 21:_this.wrappedLoan.ref.financialInfo.ficoScore=calcResponse.loanDecisionScore;break;case 22:_this.wrappedLoan.ref.fullyIndexedRate=calcResponse.fullyIndexedRate;break;case 23:_this.wrappedLoan.ref.stateLtvLimit=calcResponse.stateLtvLimit;_this.wrappedLoan.ref.otherInterviewData.selectedImpoundsOption=String(0);break;case 24:_this.wrappedLoan.ref.recoupmentPeriodCalculated=calcResponse.recoupmentPeriodResponse;break;case 19:_this.updateLoanNTB(calcResponse.ntbRequiredResponse,calcResponse.ntbBenefitActivationResponse);break;case 25:_this.updateFHA(calcResponse.fhaCalculatorResponse);break;}};this.updateNetRental=function(netRentalIncomes){if(!_this.wrappedLoan.ref.getTransactionInfoRef()){return;}if(!netRentalIncomes){netRentalIncomes=new Array();}netRentalIncomes.forEach(function(nriItem){var income=_this.wrappedLoan.ref.getTransactionInfoRef().incomeInfo.lookup(nriItem.incomeInfoId);if(!!income){income.calculatedAmount=nriItem.amount;}});};this.updateApr=function(apr){if(_this.wrappedLoan&&_this.wrappedLoan.ref&&_this.wrappedLoan.ref.financialInfo){_this.wrappedLoan.ref.financialInfo.apr=apr;}};this.updateSubordinateFee=function(subordinateFee){if(!subordinateFee){return;}if(!lib.replace(_this.wrappedLoan.ref.closingCost.costs,subordinateFee,function(i){return i.hudLineNumber==subordinateFee.hudLineNumber;})){_this.wrappedLoan.ref.closingCost.costs.push(subordinateFee);}};this.updateSectionV=function(housingExpenses){if(_this.wrappedLoan&&_this.wrappedLoan.ref&&_this.wrappedLoan.ref.housingExpenses){_this.wrappedLoan.ref.housingExpenses.firstMtgPi=housingExpenses.firstMtgPi;_this.wrappedLoan.ref.housingExpenses.floodInsurance=housingExpenses.floodInsurance;_this.wrappedLoan.ref.housingExpenses.hazardInsurance=housingExpenses.hazardInsurance;_this.wrappedLoan.ref.housingExpenses.hoa=housingExpenses.hoa;_this.wrappedLoan.ref.housingExpenses.mtgInsurance=housingExpenses.mtgInsurance;_this.wrappedLoan.ref.housingExpenses.newFirstMtgPi=housingExpenses.newFirstMtgPi;_this.wrappedLoan.ref.housingExpenses.newFloodInsurance=housingExpenses.newFloodInsurance;_this.wrappedLoan.ref.housingExpenses.newHazardInsurance=housingExpenses.newHazardInsurance;_this.wrappedLoan.ref.housingExpenses.newHoa=housingExpenses.newHoa;_this.wrappedLoan.ref.housingExpenses.newMtgInsurance=housingExpenses.newMtgInsurance;_this.wrappedLoan.ref.housingExpenses.newSecondMtgPi=housingExpenses.newSecondMtgPi;_this.wrappedLoan.ref.housingExpenses.newTaxes=housingExpenses.newTaxes;_this.wrappedLoan.ref.housingExpenses.other=housingExpenses.other;_this.wrappedLoan.ref.housingExpenses.rent=housingExpenses.rent;_this.wrappedLoan.ref.housingExpenses.secondMtgPi=housingExpenses.secondMtgPi;_this.wrappedLoan.ref.housingExpenses.taxes=housingExpenses.taxes;_this.wrappedLoan.ref.housingExpenses.addlMortgagees=housingExpenses.addlMortgagees;}};this.updateSectionVII=function(detailOfTransaction){_this.wrappedLoan.ref.detailsOfTransaction.alterationImprovementsRepairs=detailOfTransaction.alternationsImprovementsRepairs;_this.wrappedLoan.ref.detailsOfTransaction.borrowerClosingCostPaidBySeller=detailOfTransaction.borrowerClosingCostPaidBySeller;_this.wrappedLoan.ref.detailsOfTransaction.cashFromToBorrower=detailOfTransaction.castFromToBorrower;_this.wrappedLoan.ref.detailsOfTransaction.discount=detailOfTransaction.discount;_this.wrappedLoan.ref.detailsOfTransaction.estimatedClosingCosts=detailOfTransaction.estimatedClosingCosts;_this.wrappedLoan.ref.detailsOfTransaction.estimatedPrepaidItems=detailOfTransaction.estimatedPrepaidItems;_this.wrappedLoan.ref.detailsOfTransaction.land=detailOfTransaction.land;_this.wrappedLoan.ref.detailsOfTransaction.otherCredits=detailOfTransaction.otherCredits;_this.wrappedLoan.ref.detailsOfTransaction.pmiMipFundingFee=detailOfTransaction.pmI_MPI_FundingFee;_this.wrappedLoan.ref.detailsOfTransaction.pmiMipFundingFeeFinanced=detailOfTransaction.pmI_MIP_FundingFeeFinanced;_this.wrappedLoan.ref.detailsOfTransaction.refinance=detailOfTransaction.refinance;_this.wrappedLoan.ref.detailsOfTransaction.subordinateFinancing=detailOfTransaction.subordinateFinancing;_this.wrappedLoan.ref.detailsOfTransaction.totalCosts=detailOfTransaction.totalCosts;_this.wrappedLoan.ref.detailsOfTransaction.totalLoanAmount=detailOfTransaction.totalLoanAmount;_this.wrappedLoan.ref.detailsOfTransaction.refinanceWithDebts=detailOfTransaction.refinanceWithDebts;_this.wrappedLoan.ref.detailsOfTransaction.mLoanAmount=detailOfTransaction.mLoanAmount;_this.wrappedLoan.ref.detailsOfTransaction.oLoanAmount=detailOfTransaction.oLoanAmount;};this.updateMonthlyPayment=function(monthlyPayment){if(_this.wrappedLoan&&_this.wrappedLoan.ref&&_this.wrappedLoan.ref.financialInfo){_this.wrappedLoan.ref.financialInfo.monthlyPayment=monthlyPayment;}};this.updateCltv=function(cltv,calculatedSummaryValues){if(calculatedSummaryValues){calculatedSummaryValues.Cltv=cltv;}if(_this.wrappedLoan&&_this.wrappedLoan.ref&&_this.wrappedLoan.ref.getSubjectProperty()){_this.wrappedLoan.ref.getSubjectProperty().cltv=cltv.toString();}};this.updateInterestAmountPerDiem=function(interestAmountPerDiem){for(var i=0;i<_this.wrappedLoan.ref.closingCost.costs.length;i++){var cost=_this.wrappedLoan.ref.closingCost.costs[i];if(cost.hudLineNumber=="901"){_this.wrappedLoan.ref.closingCost.costs[i].amount=interestAmountPerDiem;}}};this.updateDTIAndHousingRatio=function(dtiAndHousingRatio,calculatedSummaryValues){if(calculatedSummaryValues){calculatedSummaryValues.Dti=dtiAndHousingRatio.combinedDTIDU;calculatedSummaryValues.HousingExpense=dtiAndHousingRatio.combinedHousingRatioDU;}if(_this.wrappedLoan&&_this.wrappedLoan.ref&&_this.wrappedLoan.ref.financialInfo&&_this.wrappedLoan.ref.loanId){_this.wrappedLoan.ref.financialInfo.dti=dtiAndHousingRatio.combinedDTIDU;_this.wrappedLoan.ref.financialInfo.dtiDu=dtiAndHousingRatio.combinedDTIDU;_this.wrappedLoan.ref.financialInfo.dtiLp=dtiAndHousingRatio.combinedDTILP;_this.wrappedLoan.ref.financialInfo.dtiFha=dtiAndHousingRatio.combinedDTIFHA;_this.wrappedLoan.ref.financialInfo.qualifyingDtiDu=dtiAndHousingRatio.qualCombinedDTIDU;_this.wrappedLoan.ref.financialInfo.qualifyingDtiLp=dtiAndHousingRatio.qualCombinedDTILP;_this.wrappedLoan.ref.financialInfo.qualifyingDtiFha=dtiAndHousingRatio.qualCombinedDTIFHA;_this.wrappedLoan.ref.financialInfo.housingRatioDu=dtiAndHousingRatio.combinedHousingRatioDU;_this.wrappedLoan.ref.financialInfo.housingRatioLp=dtiAndHousingRatio.combinedHousingRatioLP;_this.wrappedLoan.ref.financialInfo.housingRatioFha=dtiAndHousingRatio.combinedHousingRatioFHA;console.log("Updating DTI: "+dtiAndHousingRatio.combinedDTIDU);console.log("Updating HousingRatio: "+dtiAndHousingRatio.combinedHousingRatioDU);}};this.updateHcltv=function(hcltv,calculatedSummaryValues){if(calculatedSummaryValues){calculatedSummaryValues.Hcltv=hcltv;}if(_this.wrappedLoan&&_this.wrappedLoan.ref&&_this.wrappedLoan.ref.getSubjectProperty()){_this.wrappedLoan.ref.getSubjectProperty().hcltv=hcltv.toString();}};this.updateLtv=function(ltv,calculatedSummaryValues){if(calculatedSummaryValues){calculatedSummaryValues.Ltv=ltv;}if(_this.wrappedLoan&&_this.wrappedLoan.ref&&_this.wrappedLoan.ref.getSubjectProperty()){_this.wrappedLoan.ref.getSubjectProperty().ltv=ltv.toString();}};this.recalculateCosts=function(hudCosts){if(hudCosts&&_this.wrappedLoan.ref&&_this.wrappedLoan.ref.closingCost&&_this.wrappedLoan.ref.closingCost.costs){_this.wrappedLoan.ref.closingCost.costs=hudCosts;}};this.updateLoanCost=function(hudCost){if(!_this.wrappedLoan.ref.closingCost.costs){_this.wrappedLoan.ref.closingCost.costs=[hudCost];}else{for(var i=0;i<_this.wrappedLoan.ref.closingCost.costs.length;i++){var cost=_this.wrappedLoan.ref.closingCost.costs[i];if(hudCost.hudLineNumber===cost.hudLineNumber&&hudCost.subHUDLineNumber===cost.subHUDLineNumber&&hudCost.originalHUDLineNumber===cost.originalHUDLineNumber&&hudCost.originalSubHUDLineNumber===cost.originalSubHUDLineNumber){_this.wrappedLoan.ref.closingCost.costs[i]=hudCost;if(cost.hudLineNumber=="802"&&cost.subHUDLineNumber==="a"){_this.wrappedLoan.ref.closingCost.totalLenderRebate=cost.amount;}return;}}_this.wrappedLoan.ref.closingCost.costs.push(hudCost);}};this.updateLoanCosts=function(hudCosts){if(hudCosts&&_this.wrappedLoan.ref&&_this.wrappedLoan.ref.closingCost&&_this.wrappedLoan.ref.closingCost.costs){hudCosts.forEach(function(hudCost){return _this.updateLoanCost(hudCost);});}};this.getTotalClosingCosts=function(){if(!_this.wrappedLoan.ref.closingCost||!_this.wrappedLoan.ref.closingCost.totals||!_this.wrappedLoan.ref.closingCost.totals.closingCosts){return 0;}return _this.wrappedLoan.ref.closingCost.totals.closingCosts.borrowerTotal;};this.updateLoanNTB=function(ntbRequiredResponse,ntbBenefitActivationResponse){_this.wrappedLoan.ref.ntbRequired=ntbRequiredResponse.ntbRequired;if(ntbRequiredResponse.ntbRequired){_this.ntbCenterService.updateLoanNTB(_this.wrappedLoan,ntbBenefitActivationResponse);}};this.updateFHA=function(fhaCalculatorResponse){_this.wrappedLoan.ref.fhaScenarioViewModel.fhaCalculatorResults=fhaCalculatorResponse;if(fhaCalculatorResponse.isEligible){_this.wrappedLoan.ref.govermentEligibility=1;}else{_this.wrappedLoan.ref.govermentEligibility=2;}};loanEvent.registerForPropertyChangeEvent(LoanCalculator.className,this,this.onPropertyChange);this.calculatorService=$resource(this.apiRoot+"LoanCalculatorService/",{},{UpdateCalculatedValues:{method:"POST",params:{request:"@request"}}});}LoanCalculator.prototype.setCalculatedValues=function(calculatedSummaryValues){this.calculatedSummaryValues=calculatedSummaryValues;this.onPropertyChange(null);};LoanCalculator.className="LoanCalculator";LoanCalculator.$inject=["LoanCalculatorService","$resource","apiRoot","loanEvent","$rootScope","commonCalculatorSvc","BroadcastSvc","costDetailsHelpers","loanDetailsSvc","enums","commonService","costDetailsSvc","ntbCenterService"];return LoanCalculator;})();calc.LoanCalculator=LoanCalculator;angular.module("loan.calculator",["CalculatorModule"]).service(LoanCalculator.className,LoanCalculator);})(calc||(calc={}));var srv;(function(srv){var LoanCalculatorService=(function(){function LoanCalculatorService(httpUtil){var _this=this;this.httpUtil=httpUtil;this.UpdateCalculatedValuesGeneric=function(request,successHandler,serviceEventOrMessage,errorHandler,methodPath,config){if(methodPath===void 0){methodPath="LoanCalculatorService/UpdateCalculatedValues";}return _this.httpUtil.post(methodPath,{request:request},serviceEventOrMessage,errorHandler,config,successHandler);};this.UpdateCalculatedValues=function(request,serviceEventOrMessage,successHandler,errorHandler,methodPath,config){if(methodPath===void 0){methodPath="LoanCalculatorService/UpdateCalculatedValues";}return _this.UpdateCalculatedValuesGeneric(request,successHandler||_this.httpUtil.defaultSuccessHandler,serviceEventOrMessage,errorHandler,methodPath,config);};this.CalculateProposedImpoundDataGeneric=function(costVMs,propertyExpenses,labilitiesViewModels,subordinateFinancing,loanPurposeType,successHandler,serviceEventOrMessage,errorHandler,methodPath,config){if(methodPath===void 0){methodPath="LoanCalculatorService/CalculateProposedImpoundData";}return _this.httpUtil.post(methodPath,{costVMs:costVMs,propertyExpenses:propertyExpenses,labilitiesViewModels:labilitiesViewModels,subordinateFinancing:subordinateFinancing,loanPurposeType:loanPurposeType},serviceEventOrMessage,errorHandler,config,successHandler);};this.CalculateProposedImpoundData=function(costVMs,propertyExpenses,labilitiesViewModels,subordinateFinancing,loanPurposeType,serviceEventOrMessage,successHandler,errorHandler,methodPath,config){if(methodPath===void 0){methodPath="LoanCalculatorService/CalculateProposedImpoundData";}return _this.CalculateProposedImpoundDataGeneric(costVMs,propertyExpenses,labilitiesViewModels,subordinateFinancing,loanPurposeType,successHandler||_this.httpUtil.defaultSuccessHandler,serviceEventOrMessage,errorHandler,methodPath,config);};this.CalculateCashOutResultGeneric=function(secondMortgageInfo,withdrawnFromHelocInLast12Months,payingOffSecondMortgage,secondMortgageAmortizationType,newLoanAmount,existingMortgagesAmount,propertyValue,outstandingBalance,comment,loanLimit,propertyPurchasedWithinYear,firstMortgage,maxCreditLine,successHandler,serviceEventOrMessage,errorHandler,methodPath,config){if(methodPath===void 0){methodPath="LoanCalculatorService/CalculateCashOutResult";}return _this.httpUtil.get(methodPath,{secondMortgageInfo:secondMortgageInfo,withdrawnFromHelocInLast12Months:withdrawnFromHelocInLast12Months,payingOffSecondMortgage:payingOffSecondMortgage,secondMortgageAmortizationType:secondMortgageAmortizationType,newLoanAmount:newLoanAmount,existingMortgagesAmount:existingMortgagesAmount,propertyValue:propertyValue,outstandingBalance:outstandingBalance,comment:comment,loanLimit:loanLimit,propertyPurchasedWithinYear:propertyPurchasedWithinYear,firstMortgage:firstMortgage,maxCreditLine:maxCreditLine},serviceEventOrMessage,errorHandler,config,successHandler);};this.CalculateCashOutResult=function(secondMortgageInfo,withdrawnFromHelocInLast12Months,payingOffSecondMortgage,secondMortgageAmortizationType,newLoanAmount,existingMortgagesAmount,propertyValue,outstandingBalance,comment,loanLimit,propertyPurchasedWithinYear,firstMortgage,maxCreditLine,serviceEventOrMessage,successHandler,errorHandler,methodPath,config){if(methodPath===void 0){methodPath="LoanCalculatorService/CalculateCashOutResult";}return _this.CalculateCashOutResultGeneric(secondMortgageInfo,withdrawnFromHelocInLast12Months,payingOffSecondMortgage,secondMortgageAmortizationType,newLoanAmount,existingMortgagesAmount,propertyValue,outstandingBalance,comment,loanLimit,propertyPurchasedWithinYear,firstMortgage,maxCreditLine,successHandler||_this.httpUtil.defaultSuccessHandler,serviceEventOrMessage,errorHandler,methodPath,config);};this.CalculateCostsToAdjustPtcGeneric=function(productCosts,allCosts,successHandler,serviceEventOrMessage,errorHandler,methodPath,config){if(methodPath===void 0){methodPath="LoanCalculatorService/CalculateCostsToAdjustPtc";}return _this.httpUtil.post(methodPath,{productCosts:productCosts,allCosts:allCosts},serviceEventOrMessage,errorHandler,config,successHandler);};this.CalculateCostsToAdjustPtc=function(productCosts,allCosts,serviceEventOrMessage,successHandler,errorHandler,methodPath,config){if(methodPath===void 0){methodPath="LoanCalculatorService/CalculateCostsToAdjustPtc";}return _this.CalculateCostsToAdjustPtcGeneric(productCosts,allCosts,successHandler||_this.httpUtil.defaultSuccessHandler,serviceEventOrMessage,errorHandler,methodPath,config);};this.CalculatePurchaseCostGeneric=function(factor,purchasePrice,loanAmount,type,period,months,total,successHandler,serviceEventOrMessage,errorHandler,methodPath,config){if(methodPath===void 0){methodPath="LoanCalculatorService/CalculatePurchaseCost";}return _this.httpUtil.get(methodPath,{factor:factor,purchasePrice:purchasePrice,loanAmount:loanAmount,type:type,period:period,months:months,total:total},serviceEventOrMessage,errorHandler,config,successHandler);};this.CalculatePurchaseCost=function(factor,purchasePrice,loanAmount,type,period,months,total,serviceEventOrMessage,successHandler,errorHandler,methodPath,config){if(methodPath===void 0){methodPath="LoanCalculatorService/CalculatePurchaseCost";}return _this.CalculatePurchaseCostGeneric(factor,purchasePrice,loanAmount,type,period,months,total,successHandler||_this.httpUtil.defaultSuccessHandler,serviceEventOrMessage,errorHandler,methodPath,config);};this.CalculateValuesForTrackingToleranceGeneric=function(disclosuresDetails,currentCosts,defaultCosts,successHandler,serviceEventOrMessage,errorHandler,methodPath,config){if(methodPath===void 0){methodPath="LoanCalculatorService/CalculateValuesForTrackingTolerance";}return _this.httpUtil.post(methodPath,{disclosuresDetails:disclosuresDetails,currentCosts:currentCosts,defaultCosts:defaultCosts},serviceEventOrMessage,errorHandler,config,successHandler);};this.CalculateValuesForTrackingTolerance=function(disclosuresDetails,currentCosts,defaultCosts,serviceEventOrMessage,successHandler,errorHandler,methodPath,config){if(methodPath===void 0){methodPath="LoanCalculatorService/CalculateValuesForTrackingTolerance";}return _this.CalculateValuesForTrackingToleranceGeneric(disclosuresDetails,currentCosts,defaultCosts,successHandler||_this.httpUtil.defaultSuccessHandler,serviceEventOrMessage,errorHandler,methodPath,config);};this.CalculateCominedDTIandCombineHousingRatioGeneric=function(loanVM,successHandler,serviceEventOrMessage,errorHandler,methodPath,config){if(methodPath===void 0){methodPath="LoanCalculatorService/CalculateCominedDTIandCombineHousingRatio";}return _this.httpUtil.post(methodPath,{loanVM:loanVM},serviceEventOrMessage,errorHandler,config,successHandler);};this.CalculateCominedDTIandCombineHousingRatio=function(loanVM,serviceEventOrMessage,successHandler,errorHandler,methodPath,config){if(methodPath===void 0){methodPath="LoanCalculatorService/CalculateCominedDTIandCombineHousingRatio";}return _this.CalculateCominedDTIandCombineHousingRatioGeneric(loanVM,successHandler||_this.httpUtil.defaultSuccessHandler,serviceEventOrMessage,errorHandler,methodPath,config);};this.CalculateDetailsOfTransactionGeneric=function(loanVM,successHandler,serviceEventOrMessage,errorHandler,methodPath,config){if(methodPath===void 0){methodPath="LoanCalculatorService/CalculateDetailsOfTransaction";}return _this.httpUtil.post(methodPath,{loanVM:loanVM},serviceEventOrMessage,errorHandler,config,successHandler);};this.CalculateDetailsOfTransaction=function(loanVM,serviceEventOrMessage,successHandler,errorHandler,methodPath,config){if(methodPath===void 0){methodPath="LoanCalculatorService/CalculateDetailsOfTransaction";}return _this.CalculateDetailsOfTransactionGeneric(loanVM,successHandler||_this.httpUtil.defaultSuccessHandler,serviceEventOrMessage,errorHandler,methodPath,config);};this.CalculateQualifyingRateGeneric=function(loanVM,successHandler,serviceEventOrMessage,errorHandler,methodPath,config){if(methodPath===void 0){methodPath="LoanCalculatorService/CalculateQualifyingRate";}return _this.httpUtil.post(methodPath,{loanVM:loanVM},serviceEventOrMessage,errorHandler,config,successHandler);};this.CalculateQualifyingRate=function(loanVM,serviceEventOrMessage,successHandler,errorHandler,methodPath,config){if(methodPath===void 0){methodPath="LoanCalculatorService/CalculateQualifyingRate";}return _this.CalculateQualifyingRateGeneric(loanVM,successHandler||_this.httpUtil.defaultSuccessHandler,serviceEventOrMessage,errorHandler,methodPath,config);};this.CalculateFHAGeneric=function(request,successHandler,serviceEventOrMessage,errorHandler,methodPath,config){if(methodPath===void 0){methodPath="LoanCalculatorService/CalculateFHA";}return _this.httpUtil.post(methodPath,{request:request},serviceEventOrMessage,errorHandler,config,successHandler);};this.CalculateFHA=function(request,serviceEventOrMessage,successHandler,errorHandler,methodPath,config){if(methodPath===void 0){methodPath="LoanCalculatorService/CalculateFHA";}return _this.CalculateFHAGeneric(request,successHandler||_this.httpUtil.defaultSuccessHandler,serviceEventOrMessage,errorHandler,methodPath,config);};this.CalculateVAGeneric=function(request,successHandler,serviceEventOrMessage,errorHandler,methodPath,config){if(methodPath===void 0){methodPath="LoanCalculatorService/CalculateVA";}return _this.httpUtil.post(methodPath,{request:request},serviceEventOrMessage,errorHandler,config,successHandler);};this.CalculateVA=function(request,serviceEventOrMessage,successHandler,errorHandler,methodPath,config){if(methodPath===void 0){methodPath="LoanCalculatorService/CalculateVA";}return _this.CalculateVAGeneric(request,successHandler||_this.httpUtil.defaultSuccessHandler,serviceEventOrMessage,errorHandler,methodPath,config);};this.CalculateMIGeneric=function(request,successHandler,serviceEventOrMessage,errorHandler,methodPath,config){if(methodPath===void 0){methodPath="LoanCalculatorService/CalculateMI";}return _this.httpUtil.post(methodPath,{request:request},serviceEventOrMessage,errorHandler,config,successHandler);};this.CalculateMI=function(request,serviceEventOrMessage,successHandler,errorHandler,methodPath,config){if(methodPath===void 0){methodPath="LoanCalculatorService/CalculateMI";}return _this.CalculateMIGeneric(request,successHandler||_this.httpUtil.defaultSuccessHandler,serviceEventOrMessage,errorHandler,methodPath,config);};}LoanCalculatorService.className="LoanCalculatorService";LoanCalculatorService.$inject=["httpUtil"];return LoanCalculatorService;})();srv.LoanCalculatorService=LoanCalculatorService;})(srv||(srv={}));moduleRegistration.registerService(moduleNames.services,srv.LoanCalculatorService);var util;(function(util){var IdentityGenerator;(function(_IdentityGenerator){function nextGuid(){return IdentityGenerator.nextGuid();}_IdentityGenerator.nextGuid=nextGuid;function setGuids(guids){IdentityGenerator.setGuids(guids);}_IdentityGenerator.setGuids=setGuids;var IdentityGenerator=(function(){function IdentityGenerator(){}IdentityGenerator.getInstance=function(){if(!IdentityGenerator.instance){IdentityGenerator.instance=new IdentityGenerator();}return IdentityGenerator.instance;};IdentityGenerator.setGuids=function(guids){if(!guids||guids.length==0){console.log("setGuids: guids is empty");}IdentityGenerator.getInstance().guids=guids;};IdentityGenerator.nextGuid=function(){if(!IdentityGenerator.getInstance().guids||IdentityGenerator.getInstance().guids.length==0){console.log("nextGuid: guids is empty");}if(IdentityGenerator.getInstance().guids.length%1000==0){console.log("guid count = "+IdentityGenerator.getInstance().guids.length);}var id=IdentityGenerator.getInstance().guids.pop();if(!id){console.log("id is undefined");}return id;};return IdentityGenerator;})();})(IdentityGenerator=util.IdentityGenerator||(util.IdentityGenerator={}));})(util||(util={}));var srv;(function(srv){var DocVaultService=(function(){function DocVaultService(httpUtil){var _this=this;this.httpUtil=httpUtil;this.FilterByLoanNumberGeneric=function(loanNumber,counter,currentUserId,successHandler,serviceEventOrMessage,errorHandler,methodPath,config){if(methodPath===void 0){methodPath="DocVaultService/FilterByLoanNumber";}return _this.httpUtil.get(methodPath,{loanNumber:loanNumber,counter:counter,currentUserId:currentUserId},serviceEventOrMessage,errorHandler,config,successHandler);};this.FilterByLoanNumber=function(loanNumber,counter,currentUserId,serviceEventOrMessage,successHandler,errorHandler,methodPath,config){if(methodPath===void 0){methodPath="DocVaultService/FilterByLoanNumber";}return _this.FilterByLoanNumberGeneric(loanNumber,counter,currentUserId,successHandler||_this.httpUtil.defaultSuccessHandler,serviceEventOrMessage,errorHandler,methodPath,config);};this.GetDocVaultDocumentsGeneric=function(loanNumber,currentUserId,successHandler,serviceEventOrMessage,errorHandler,methodPath,config){if(methodPath===void 0){methodPath="DocVaultService/GetDocVaultDocuments";}return _this.httpUtil.get(methodPath,{loanNumber:loanNumber,currentUserId:currentUserId},serviceEventOrMessage,errorHandler,config,successHandler);};this.GetDocVaultDocuments=function(loanNumber,currentUserId,serviceEventOrMessage,successHandler,errorHandler,methodPath,config){if(methodPath===void 0){methodPath="DocVaultService/GetDocVaultDocuments";}return _this.GetDocVaultDocumentsGeneric(loanNumber,currentUserId,successHandler||_this.httpUtil.defaultSuccessHandler,serviceEventOrMessage,errorHandler,methodPath,config);};}DocVaultService.className="DocVaultService";DocVaultService.$inject=["httpUtil"];return DocVaultService;})();srv.DocVaultService=DocVaultService;})(srv||(srv={}));moduleRegistration.registerService(moduleNames.services,srv.DocVaultService);(function(){angular.module("common",["modalPopover","simpleModalWindow"]);})();var common;(function(common){var Guid=(function(){function Guid(){this.isResolved=false;}return Guid;})();common.Guid=Guid;var GuidService=(function(){function GuidService($http,apiRoot){var _this=this;this.$http=$http;this.apiRoot=apiRoot;this.newGuid=function(){var guid=new Guid();var newGuidUrl=_this.url+"/NewGuid";var promise=_this.$http.get(newGuidUrl).then(function(response){if(response&&response.status==200&&response.data!=null){guid.value=String(response.data);guid.isResolved=true;}});return guid;};this.url=apiRoot+"Common";}GuidService.prototype.getNewGuid=function(){var newGuidUrl=this.url+"/NewGuid";return this.$http.get(newGuidUrl,{cache:false});};return GuidService;})();guidService.$inject=["$http","apiRoot"];function guidService($http,apiRoot){return new GuidService($http,apiRoot);}angular.module("common").service("guidService",guidService);})(common||(common={}));var common;(function(common){var services;(function(services){var CommonService=(function(){function CommonService(enums){var _this=this;this.enums=enums;this.recalculateMonths=function(years,months){if(!months){months=0;}years+=Math.floor(months/12);months%=12;return{years:years===0?null:years,months:months===0?null:months};};this.compareDates=function(a,b){return moment.duration({from:a,to:b});};this.compareDatesCustom=function(date1,date2,interval){if(date1==null||date2==null||date1==undefined||date2==undefined){return NaN;}var second=1000;var minute=second*60;var hour=minute*60;var day=hour*24;var week=day*7;date1=new Date(date1);date2=new Date(date2);var timediff=date2-date1;if(isNaN(timediff)){return NaN;}switch(interval){case _this.enums.timeInterval.years:return date2.getFullYear()-date1.getFullYear();case _this.enums.timeInterval.months:return((date2.getFullYear()*12+date2.getMonth())-(date1.getFullYear()*12+date1.getMonth()));case _this.enums.timeInterval.weeks:return Math.floor(timediff/week);case _this.enums.timeInterval.days:var days=timediff/day;return days>Math.floor(days)?Math.floor(days+1):Math.floor(days);case _this.enums.timeInterval.hours:return Math.floor(timediff/hour);case _this.enums.timeInterval.minutes:return Math.floor(timediff/minute);case _this.enums.timeInterval.seconds:return Math.floor(timediff/second);default:return undefined;}};this.getFHAOrVALoanLimit=function(listOfLimits,stateName,countyName,numberOfUnits){var result=lib.filter(listOfLimits,function(item){return item.countyName.toLowerCase()==countyName.toLowerCase()&&item.stateName.toLowerCase()==stateName.toLowerCase();});if(result.length>0){switch(Number(numberOfUnits)){case 1:return result[0].oneFamilyUnit;case 2:return result[0].twoFamilyUnit;case 3:return result[0].threeFamilyUnit;case 4:return result[0].fourFamilyUnit;default:console.warn("getFHAOrVALoanLimit:: Number of units is not allowed. [[ "+numberOfUnits+" ]]");return 0;}}else{console.warn("getFHAOrVALoanLimit:: Could not find any limit for provided parameters.");return 0;}};this.getYearsOutOfDate=function(date){var today=new Date();var providedDate=new Date(date);var age=today.getFullYear()-providedDate.getFullYear();var age_month=today.getMonth()-providedDate.getMonth();var age_day=today.getDate()-providedDate.getDate();if(age_month<0||(age_month==0&&age_day<0)){age=age-1;}return age;};}CommonService.$inject=["enums"];return CommonService;})();services.CommonService=CommonService;angular.module("common").service("commonService",CommonService);})(services=common.services||(common.services={}));})(common||(common={}));var common;(function(common){var ui;(function(ui){var ImpDdl=(function(){function ImpDdl(){this.restrict="E";this.replace=false;this.scope={ngModel:"=",items:"=",ngChange:"=",ngModelOptions:"=",ngClass:"="};this.templateUrl="/angular/common/directives/templates/impddl.html";}ImpDdl.createNew=function(args){return new ImpDdl();};ImpDdl.className="impDdl";ImpDdl.$inject=[];return ImpDdl;})();ui.ImpDdl=ImpDdl;moduleRegistration.registerDirective(moduleNames.common,ImpDdl);var ImpInputCurrency=(function(){function ImpInputCurrency(){this.restrict="E";this.replace=true;this.scope=false;this.templateUrl="/angular/common/directives/templates/impinputcurrency.html";}ImpInputCurrency.createNew=function(args){return new ImpInputCurrency();};ImpInputCurrency.className="impInputCurrency";ImpInputCurrency.$inject=[];return ImpInputCurrency;})();ui.ImpInputCurrency=ImpInputCurrency;moduleRegistration.registerDirective(moduleNames.common,ImpInputCurrency);var ImpInput=(function(){function ImpInput(){this.restrict="E";this.replace=true;this.scope=false;this.templateUrl="/angular/common/directives/templates/impinput.html";}ImpInput.createNew=function(args){return new ImpInput();};ImpInput.className="impInput";ImpInput.$inject=[];return ImpInput;})();ui.ImpInput=ImpInput;moduleRegistration.registerDirective(moduleNames.common,ImpInput);})(ui=common.ui||(common.ui={}));})(common||(common={}));var common;(function(common){function moveItemTo(index,src,dest){if(src){dest.push(angular.copy(src[index]));}}common.moveItemTo=moveItemTo;function deleteItem(itemIndex,items){items.splice(itemIndex,1);}common.deleteItem=deleteItem;function indexOfItem(obj,items,fromIndex){if(fromIndex==null){fromIndex=0;}else{if(fromIndex<0){fromIndex=Math.max(0,items.length+fromIndex);}}for(var i=fromIndex,j=items.length;i<j;i++){if(items[i]===obj){return i;}}return -1;}common.indexOfItem=indexOfItem;})(common||(common={}));(function(){angular.module("common").directive("impNumeric",impNumeric);function impNumeric(){return{restrict:"A",require:"?ngModel",link:function(scope,element,attrs,ctrl){if(!ctrl){return;}ctrl.$parsers.push(function(val){if(!(val)){var val="";}var clean=val.replace(/[^0-9]+/g,"");if(val!==clean){ctrl.$setViewValue(clean);ctrl.$render();}return clean;});element.bind("keypress",function(event){if(event.keyCode===32){event.preventDefault();}});}};}})();angular.module("common").directive("impEmail",function(){return{restrict:"E",bindToController:true,scope:{username:"=",isEmailValid:"=?",fieldsDisabled:"=?",onEmailBlur:"&?",isValid:"=?",hasError:"&?",isAutofocus:"=?",performValidation:"=?"},link:function(scope,el,attrs,controller){if(!angular.isDefined(controller.performValidation)){controller.performValidation=true;}},controller:function(){var vm=this;vm.blur=blur;if(!vm.isAutofocus){vm.isAutofocus=false;}function blur(){validate();vm.onEmailBlur();}function validate(){if(!vm.performValidation){vm.hasErrors=false;vm.isEmailValid=false;vm.isEmailAddressNotValid=false;return;}vm.hasErrors=vm.hasError();var reg=/^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-]{2,})+\.)+([a-zA-Z0-9]{2,4})+$/;if(!common.string.isNullOrWhiteSpace(vm.username)){vm.isEmailAddressNotValid=!(reg.test(vm.username)||vm.username==null||vm.username==undefined);vm.hasErrors=!!vm.hasErrors||!!vm.isEmailAddressNotValid||!!vm.isEmailValid&&!!vm.username.$dirty;}}},controllerAs:"vm",templateUrl:"angular/common/emailcontrol/email.html"};});(function(){angular.module("common").directive("impDurationYearsMonths",impDurationYearsMonths);function impDurationYearsMonths(){return{restrict:"E",template:['<div class="col-lg-5">','<div class="imp-psection-label">{{::controller.label}}</div>',"</div>",'<div style="width: 28%;" class="col-lg-3 imp-psection-placeholder">','<div class="imp-property-visible-placeholder">Years</div>','<input style="width: 94%;" type="text" maxlength="2" ng-model="controller.internal.years" ng-blur="controller.recalculate()" imp-numeric ',"ng-class=\"{'imp-has-error': (controller.validation.sixPicesCompleted && controller.validation.validate && ((!controller.internal.years && !controller.internal.months) || (controller.internal.years == 0 && controller.internal.months == 0)))}\"","/>","</div>",'<div style="width: 28%;" class="col-lg-3 imp-psection-placeholder">','<div style="right:0px;" class="imp-property-visible-placeholder">Months</div>','<input class="imp-psection-left-borderadius" type="text" maxlength="2" ng-model="controller.internal.months" ng-blur="controller.recalculate()" imp-numeric ',"ng-class=\"{'imp-has-error': (controller.validation.sixPicesCompleted && controller.validation.validate && ((!controller.internal.years && !controller.internal.months) || (controller.internal.years == 0 && controller.internal.months == 0)))}\"","/>","</div>"].join(""),scope:{years:"=",months:"=",label:"@",validation:"="},link:link,controller:controller,controllerAs:"controller",bindToController:true};function link(scope,element,attrs,controller){controller.internal={years:controller.years,months:controller.months,sixPicesCompleted:controller.validation.sixPicesCompleted,validate:controller.validation.validate};if(controller.months>=12){controller.recalculate();}}function controller(commonService){var self=this;self.internal={};self.recalculate=recalculate;self.updateModel=updateModel;function updateModel(){self.years=self.internal.years;self.months=self.internal.months;}function recalculate(){var time=commonService.recalculateMonths(Number(self.internal.years),Number(self.internal.months));self.internal.years=time.years;self.internal.months=time.months;self.updateModel();}}}})();(function(){angular.module("modalPopover",["ui.bootstrap","ui.bootstrap.transition"]);})();(function(){angular.module("modalPopover").run(["$templateCache",function($templateCache){$templateCache.put("template/modalpopover/window.html",'<div class="tooltip bottom" ng-class="{in: animate}" ng-style="{\'z-index\': modalPosition.zindex, position: modalPosition.position, top: modalPosition.top, left: modalPosition.left, display: \'block\' }">\n'+'  <div class="tooltip-arrow" ng-class="className"   ng-style="{\'z-index\': 9999, top: modalPosition.arrowPosition}"></div>\n'+'  <div class="tooltip-inner" modalpopover-transclude></div>\n'+"</div>");}]);})();(function(){angular.module("modalPopover").directive("modalpopoverWindow",["$modalpopoverStack","$timeout","$document",function($modalpopoverStack,$timeout,$document){var templateUrl="template/modalpopover/window.html";return{restrict:"EA",scope:{index:"@",animate:"=",left:"@",top:"@",zIndex:"@",height:"@",width:"@",arrowRight:"@",className:"@",position:"@",verticalPopupPositionPerHeight:"@",horisontalPopupPositionPerWidth:"@",calculateVerticalPositionFromTopBorder:"@"},replace:true,transclude:true,templateUrl:templateUrl,link:function(scope,element,attrs){scope.modalPosition={};scope.isOpen=false;$timeout(function(){scope.animate=true;if(scope.verticalPopupPositionPerHeight==undefined){scope.verticalPopupPositionPerHeight=0;}if(scope.horisontalPopupPositionPerWidth==undefined){scope.horisontalPopupPositionPerWidth=0.5;}if(scope.calculateVerticalPositionFromTopBorder=="true"){scope.modalPosition.top=parseFloat(scope.top)-(parseFloat(element[0].offsetHeight)*scope.verticalPopupPositionPerHeight);scope.modalPosition.arrowPosition=parseFloat(element[0].offsetHeight)-5;}if(!angular.isUndefined(scope.position)&&scope.position=="fixed"){scope.modalPosition.top=27;}else{scope.modalPosition.top=parseFloat(scope.top)+parseFloat(scope.height)-(parseFloat(element[0].offsetHeight)*scope.verticalPopupPositionPerHeight);}if(scope.arrowRight){scope.modalPosition.left=parseFloat(scope.left)+(parseFloat(scope.width)/2)-(parseFloat(element[0].offsetWidth)*scope.horisontalPopupPositionPerWidth);}else{scope.modalPosition.left=parseFloat(scope.left)+(parseFloat(scope.width)/2)-(parseFloat(element[0].offsetWidth)*scope.horisontalPopupPositionPerWidth);}scope.modalPosition.top+="px";scope.modalPosition.left+="px";scope.modalPosition.arrowPosition+="px";scope.modalPosition.zindex=(!angular.isUndefined(scope.zIndex)&&parseFloat(scope.zIndex)>0?parseFloat(scope.zIndex):1080)+parseFloat(scope.index)*10;scope.modalPosition.position=angular.isUndefined(scope.position)?"absolute":scope.position;});function onDocumentClick(event){var isChild=$(element).find(event.target).length>0;var isOnDocument=$(document).find(event.target).length>0;if(!isChild&&isOnDocument&&(scope.isOpen)){scope.close();}}$document.on("click",onDocumentClick);element.on("$destroy",function(){var modal=$modalpopoverStack.getTop();if(modal){$modalpopoverStack.dismiss(modal.key,"backdrop click");scope.isOpen=false;$document.off("click",onDocumentClick);}});scope.close=function(){element.remove();};$timeout(function(){scope.isOpen=true;});}};}]).directive("modalpopoverTransclude",function(){return{link:function($scope,$element,$attrs,controller,$transclude){$transclude($scope.$parent,function(clone){$element.empty();$element.append(clone);});}};}).factory("$modalpopoverStack",["$transition","$timeout","$document","$compile","$rootScope","$$stackedMap",function($transition,$timeout,$document,$compile,$rootScope,$$stackedMap){var backdropDomEl,backdropScope;var openedWindows=$$stackedMap.createNew();var $modalpopoverStack={};function backdropIndex(){var topBackdropIndex=-1;var opened=openedWindows.keys();for(var i=0;i<opened.length;i++){if(openedWindows.get(opened[i]).value.backdrop){topBackdropIndex=i;}}return topBackdropIndex;}$rootScope.$watch(backdropIndex,function(newBackdropIndex){if(backdropScope){backdropScope.index=newBackdropIndex;}});function removeModalWindow(modalInstance){var modalWindow=openedWindows.get(modalInstance).value;openedWindows.remove(modalInstance);removeAfterAnimate(modalWindow.modalDomEl,modalWindow.modalScope,300,function(){modalWindow.modalScope.$destroy();checkRemoveBackdrop();});}function checkRemoveBackdrop(){if(backdropDomEl&&backdropIndex()==-1){var backdropScopeRef=backdropScope;removeAfterAnimate(backdropDomEl,backdropScope,150,function(){backdropScopeRef.$destroy();backdropScopeRef=null;});backdropDomEl=undefined;backdropScope=undefined;}}function removeAfterAnimate(domEl,scope,emulateTime,done){scope.animate=false;var transitionEndEventName=$transition.transitionEndEventName;if(transitionEndEventName){var timeout=$timeout(afterAnimating,emulateTime);domEl.bind(transitionEndEventName,function(){$timeout.cancel(timeout);afterAnimating();scope.$apply();});}else{$timeout(afterAnimating);}function afterAnimating(){if(afterAnimating.done){return;}afterAnimating.done=true;domEl.remove();if(done){done();}}}$document.bind("keydown",function(evt){var modal;if(evt.which===27){modal=openedWindows.top();if(modal&&modal.value.keyboard){evt.preventDefault();$rootScope.$apply(function(){$modalpopoverStack.dismiss(modal.key,"escape key press");});}}});$modalpopoverStack.open=function(modalInstance,modal){openedWindows.add(modalInstance,{deferred:modal.deferred,modalScope:modal.scope,backdrop:modal.backdrop,keyboard:modal.keyboard});var body=$document.find("body").eq(0),currBackdropIndex=backdropIndex();var bodyRect=document.body.getBoundingClientRect(),elemRect=modal.scope.event.target.getBoundingClientRect(),offsetTop=elemRect.top-bodyRect.top,offsetLeft=elemRect.left-bodyRect.left;var angularDomEl=angular.element("<div modalpopover-window></div>");angularDomEl.attr({"template-url":modal.windowTemplateUrl,"window-class":modal.windowClass,"size":modal.size,"index":openedWindows.length()-1,"animate":"animate","left":offsetLeft,"top":offsetTop,"z-index":modal.zindex,"position":modal.position,"height":modal.scope.event.target.offsetHeight,"width":modal.scope.event.target.offsetWidth,"arrow-right":modal.arrowRight,"class-name":modal.className,"vertical-popup-position-per-height":modal.verticalPopupPositionPerHeight,"horisontal-popup-position-per-width":modal.horisontalPopupPositionPerWidth,"calculate-vertical-position-from-top-border":modal.calculateVerticalPositionFromTopBorder,}).html(modal.content);var modalDomEl=$compile(angularDomEl)(modal.scope);openedWindows.top().value.modalDomEl=modalDomEl;body.append(modalDomEl);};$modalpopoverStack.close=function(modalInstance,result){var modalWindow=openedWindows.get(modalInstance);if(modalWindow){modalWindow.value.deferred.resolve(result);removeModalWindow(modalInstance);}};$modalpopoverStack.dismiss=function(modalInstance,reason){var modalWindow=openedWindows.get(modalInstance);if(modalWindow){modalWindow.value.deferred.reject(reason);removeModalWindow(modalInstance);}};$modalpopoverStack.dismissAll=function(reason){var topModal=this.getTop();while(topModal){this.dismiss(topModal.key,reason);topModal=this.getTop();}};$modalpopoverStack.getTop=function(){return openedWindows.top();};return $modalpopoverStack;}]).provider("$modalpopover",function(){var $modalpopoverProvider={options:{backdrop:true,keyboard:true},$get:["$injector","$rootScope","$q","$http","$templateCache","$controller","$modalpopoverStack",function($injector,$rootScope,$q,$http,$templateCache,$controller,$modalpopoverStack){var $modalpopover={};function getTemplatePromise(options){return options.template?$q.when(options.template):$http.get(angular.isFunction(options.templateUrl)?(options.templateUrl)():options.templateUrl,{cache:$templateCache}).then(function(result){return result.data;});}function getResolvePromises(resolves){var promisesArr=[];angular.forEach(resolves,function(value){if(angular.isFunction(value)||angular.isArray(value)){promisesArr.push($q.when($injector.invoke(value)));}});return promisesArr;}$modalpopover.open=function(modalOptions,event){var modalResultDeferred=$q.defer();var modalOpenedDeferred=$q.defer();var modalInstance={result:modalResultDeferred.promise,opened:modalOpenedDeferred.promise,close:function(result){$modalpopoverStack.close(modalInstance,result);},dismiss:function(reason){$modalpopoverStack.dismiss(modalInstance,reason);}};modalOptions=angular.extend({},$modalpopoverProvider.options,modalOptions);modalOptions.resolve=modalOptions.resolve||{};if(!modalOptions.template&&!modalOptions.templateUrl){throw new Error("One of template or templateUrl options is required.");}var templateAndResolvePromise=$q.all([getTemplatePromise(modalOptions)].concat(getResolvePromises(modalOptions.resolve)));templateAndResolvePromise.then(function resolveSuccess(tplAndVars){var modalScope=(modalOptions.scope||$rootScope).$new();modalScope.$close=modalInstance.close;modalScope.$dismiss=modalInstance.dismiss;modalScope.event=event;var ctrlInstance,ctrlLocals={};var resolveIter=1;if(modalOptions.controller){ctrlLocals.$scope=modalScope;ctrlLocals.$modalInstance=modalInstance;angular.forEach(modalOptions.resolve,function(value,key){ctrlLocals[key]=tplAndVars[resolveIter++];});ctrlInstance=$controller(modalOptions.controller,ctrlLocals);if(modalOptions.controllerAs){modalScope[modalOptions.controllerAs]=ctrlInstance;}}$modalpopoverStack.open(modalInstance,{scope:modalScope,zindex:modalOptions.zindex,position:modalOptions.position,deferred:modalResultDeferred,content:tplAndVars[0],backdrop:modalOptions.backdrop,keyboard:modalOptions.keyboard,backdropClass:modalOptions.backdropClass,windowClass:modalOptions.windowClass,windowTemplateUrl:modalOptions.windowTemplateUrl,size:modalOptions.size,arrowRight:modalOptions.arrowRight,className:modalOptions.className,verticalPopupPositionPerHeight:modalOptions.verticalPopupPositionPerHeight,horisontalPopupPositionPerWidth:modalOptions.horisontalPopupPositionPerWidth,calculateVerticalPositionFromTopBorder:modalOptions.calculateVerticalPositionFromTopBorder});},function resolveError(reason){modalResultDeferred.reject(reason);});templateAndResolvePromise.then(function(){modalOpenedDeferred.resolve(true);},function(){modalOpenedDeferred.reject(false);});return modalInstance;};return $modalpopover;}]};return $modalpopoverProvider;});})();(function(){angular.module("modalPopover").factory("modalPopoverFactory",modalPopoverFactory);function modalPopoverFactory($modalpopover){var factory={};factory.openModalPopover=openModalPopover;function openModalPopover(templateUrl,extCtrl,extModel,event,modalOptions){if(!modalOptions){modalOptions={};}return $modalpopover.open({templateUrl:templateUrl,controller:modalpopoverCtrl,controllerAs:"modalpopoverCtrl",resolve:resolve(extCtrl,extModel,modalOptions.refExtModelAndCtrl),zindex:modalOptions.zindex,position:modalOptions.position,arrowRight:modalOptions.arrowRight,className:modalOptions.className,verticalPopupPositionPerHeight:modalOptions.verticalPopupPositionPerHeight,horisontalPopupPositionPerWidth:modalOptions.horisontalPopupPositionPerWidth,calculateVerticalPositionFromTopBorder:modalOptions.calculateVerticalPositionFromTopBorder},event);}function resolve(extCtrl,extModel,refExtModelAndCtrl){var resolve={intCtrl:function(){return extCtrl;},inModel:function(){return extModel;},refExtModelAndCtrl:function(){return refExtModelAndCtrl;}};return resolve;}function modalpopoverCtrl(intCtrl,inModel,refExtModelAndCtrl,$modalInstance){var self=this;if(refExtModelAndCtrl){self.model=inModel;self.ctrl=intCtrl;self.done=done;self.cancel=cancel;}else{self.ctrl=angular.copy(intCtrl);self.model=angular.copy(inModel);self.done=done;self.cancel=cancel;}function done(model){angular.extend(inModel,model);angular.extend(intCtrl,self.ctrl);self.model=angular.copy(inModel);self.ctrl=angular.copy(intCtrl);$modalInstance.close(model);}function cancel(){$modalInstance.dismiss("cancel");}}return factory;}})();(function(){angular.module("modalWindowConfig",[]).constant({"TEMPLATES_LOCATIONS":{"ERROR_SAVE_MODAL":"angular/common/simplemodalwindow/simplemodalwindow.errorsave.html","ERROR_LOAD_MODAL":"angular/common/simplemodalwindow/simplemodalwindow.loadsave.html","ERROR_INTEGRATION_MODAL":"angular/common/simplemodalwindow/simplemodalwindow.errorintegration.html"}});})();(function(){angular.module("simpleModalWindow",["ui.bootstrap","ui.utils","ui.bootstrap.transition","modalWindowConfig"]);angular.module("simpleModalWindow").run(function($templateCache,$http){$http.get("/angular/common/simplemodalwindow/simplemodalwindow.errorsave.html",{cache:$templateCache});});})();(function(){angular.module("simpleModalWindow").factory("simpleModalWindowFactory",["$modal","$modalStack","TEMPLATES_LOCATIONS",function($modal,$modalStack,TEMPLATES_LOCATIONS){return{trigger:function(template,customWindowClass,size){var templateLocation=TEMPLATES_LOCATIONS.hasOwnProperty(template)?TEMPLATES_LOCATIONS[template]:template;$modal.open({templateUrl:templateLocation,windowClass:customWindowClass||"imp-center-modal",backdrop:"static",controller:"SimpleModalWindowController",size:size||""});},close:function(reason){$modalStack.dismissAll(reason);}};}]);})();(function(){angular.module("simpleModalWindow").controller("SimpleModalWindowController",["$modalStack",function($modalStack){var modal=this;modal.close=function(){$modalStack.dismissAll("cancel");};modal.goTo=function(URL){window.location(URL);$modalStack.dismissAll("cancel");};}]);})();(function(){angular.module("common").factory("anchorSmoothScroll",function(){return function(eID,offset){var startY=currentYPosition();var stopY=elmYPosition(eID);var distance=stopY>startY?stopY-startY:startY-stopY;if(distance<100){scrollTo(0,stopY);return;}var speed=Math.round(distance/100);if(speed>=20){speed=20;}var step=Math.round(distance/25);var leapY=stopY>startY?startY+step:startY-step;var timer=0;if(stopY>startY){for(var i=startY;i<stopY;i+=step){setTimeout("window.scrollTo(0, "+leapY+")",timer*speed);leapY+=step;if(leapY>stopY){leapY=stopY;}timer++;}return;}for(var i=startY;i>stopY;i-=step){setTimeout("window.scrollTo(0, "+leapY+")",timer*speed);leapY-=step;if(leapY<stopY){leapY=stopY;}timer++;}function currentYPosition(){if(self.pageYOffset){return self.pageYOffset;}if(document.documentElement&&document.documentElement.scrollTop){return document.documentElement.scrollTop;}if(document.body.scrollTop){return document.body.scrollTop;}return 0;}function elmYPosition(eID){var elm=document.getElementById(eID)||document.querySelector(eID);var y=elm.offsetTop;var node=elm;while(node.offsetParent&&node.offsetParent!=document.body){node=node.offsetParent;y+=node.offsetTop;}return(offset)?y-offset:y;}};});})();(function(){angular.module("iMP.Filters",[]);angular.module("iMP.Filters").filter("impExcerpt",impExcerpt).filter("impPercentage",impPercentage).filter("impRound",impRound).filter("impRoundPrecision",impRoundPrecision).filter("impAbs",impAbs).filter("impNegativeParenthesis",impNegativeParenthesis).filter("impGroupBy",["$parse",impGroupBy]).filter("getByProperty",getByProperty).filter("impCurrency",impCurrency).filter("numberFixedLength",numberFixedLength).filter("hideZero",hideZero).filter("impFormatTelephone",impFormatTelephone).filter("impCurrencyAllowCustomStringValues",impCurrencyAllowCustomStringValues).filter("creditCardType",creditCardType);function impExcerpt(){return function(input,length){if(!length){length=60;}if(input&&input.toString().length>length+3){return input.toString().substring(0,length)+"...";}return input;};}function hideZero(){return function(input){if(input!=null&&!isNaN(input)){var value=parseFloat(input);}if(value!=null&&value==0){return null;}return input;};}function impPercentage(){return function(input){var retVal="";if($.trim(input).length>0){retVal=input+" %";}return retVal;};}function impRound(){return function(input,decimalPlaces){var retVal="";if($.trim(input).length>0&&!isNaN(input)){retVal=parseFloat(input).toFixed(decimalPlaces);}return retVal;};}function impRoundPrecision(){return function(input,digits){var retVal="";if($.trim(input).length>0&&!isNaN(input)){var multiplicator=Math.pow(10,digits);retVal=parseFloat(Math.round(input*multiplicator)/multiplicator);}return retVal;};}function impAbs(){return function(input){var retVal="";if($.trim(input).length>0&&!isNaN(input)){retVal=Math.abs(parseFloat(input));}return retVal;};}function impNegativeParenthesis(){return function(input,suffix){if(suffix==undefined||suffix==null){suffix="";}if($.trim(input).length>0&&!isNaN(input)&&input<0){return"("+Math.abs(input)+suffix+")";}else{return input+suffix;}};}function impGroupBy($parse){return function(list,group_by){var filtered=[];var prev_item=null;var group_changed=false;var new_field="group_by_CHANGED";angular.forEach(list,function(item){group_changed=false;if(prev_item!==null){group_by=angular.isArray(group_by)?group_by:[group_by];for(var i=0,len=group_by.length;i<len;i++){if($parse(group_by[i])(prev_item)!==$parse(group_by[i])(item)){group_changed=true;}}}else{group_changed=true;}if(group_changed){item[new_field]=true;}else{item[new_field]=false;}filtered.push(item);prev_item=item;});return filtered;};}function getByProperty(){return function(propertyName,propertyValue,collection){var i=0,len=collection.length;for(;i<len;i++){if(collection[i][propertyName]==+propertyValue){return collection[i];}}return null;};}function impCurrency($filter){return function(value,currencySymbol,decimalPlaces){var retVal="";var currencySym=(currencySymbol===undefined)?"$":currencySymbol;var decPlaces=(decimalPlaces===undefined)?"2":decimalPlaces;if($.trim(value).length>0){if(value<0){retVal=$filter("currency")(value,currencySym,decPlaces).replace("(","-").replace(")","");}else{retVal=$filter("currency")(value,currencySym,decPlaces);}}return retVal;};}function impCurrencyAllowCustomStringValues($filter){return function(value,currencySymbol,decimalPlaces){if(isNaN(value)||value===""){return value;}return impCurrency($filter)(value,currencySymbol,decimalPlaces);};}function numberFixedLength(){return function(input,minNumberOfDigits){var num=parseInt(input,10);minNumberOfDigits=parseInt(minNumberOfDigits,10);if(isNaN(num)||isNaN(minNumberOfDigits)){return n;}num=""+num;while(num.length<minNumberOfDigits){num="0"+num;}return num;};}function impFormatTelephone(){return function(tel){if(!tel){return"";}var value=tel.toString().trim().replace(/^\+/,"");if(value.match(/[^0-9]/)){return tel;}var country,city,number;switch(value.length){case 10:country=1;city=value.slice(0,3);number=value.slice(3);break;case 11:country=value[0];city=value.slice(1,4);number=value.slice(4);break;case 12:country=value.slice(0,3);city=value.slice(3,5);number=value.slice(5);break;default:return tel;}if(country==1){country="";}number=number.slice(0,3)+"-"+number.slice(3);return(country+" ("+city+") "+number).trim();};}function creditCardType(){return function(ccnumber){if(!ccnumber){return"";}ccnumber=ccnumber.toString().replace(/\s+/g,"");if(/^(6011)|^(622(1(2[6-9]|[3-9][0-9])|[2-8][0-9]{2}|9([01][0-9]|2[0-5])))|^(64[4-9])|^65/.test(ccnumber)){cardType="discover";}if(/^5[1-5]/.test(ccnumber)){cardType="masterCard";}if(/^4/.test(ccnumber)){cardType="visa";}return cardType;};}})();var impDirectives=angular.module("iMP.Directives",["common","ui.bootstrap.dateparser"]);angular.module("iMP.Directives").directive("impCreditCardCheck",impCreditCardCheck);function impCreditCardCheck(){return{restrict:"A",require:"ngModel",link:function(scope,element,attributes,ngModel){function creditCardCheck(creditCardNumber){var isValidCreditCard=function(ccNumber){var ccNumberLength=ccNumber.length,mul=0,prodArr=[[0,1,2,3,4,5,6,7,8,9],[0,2,4,6,8,1,3,5,7,9]],sum=0;if(ccNumberLength<16||ccNumberLength>16){return false;}while(ccNumberLength--){sum+=prodArr[mul][parseInt(ccNumber.charAt(ccNumberLength),10)];mul^=1;}return sum%10===0&&sum>0;};ngModel.$setValidity("imp-credit-card-check",isValidCreditCard(creditCardNumber));return creditCardNumber;}ngModel.$parsers.push(creditCardCheck);ngModel.$formatters.push(creditCardCheck);},};}angular.module("iMP.Directives").directive("impAutofocus",impAutofocus);function impAutofocus($timeout){return{restrict:"A",link:function(scope,element,attrs){if(attrs.impAutofocus!=="false"){$timeout(function(){element[0].focus();});}}};}angular.module("iMP.Directives").directive("impRefocus",impRefocus);function impRefocus($timeout){return{restrict:"A",terminal:true,transclude:true,link:function(scope,element,attrs){var refocus=scope.$eval(attrs.impRefocus);var isminus=scope.$eval(attrs.impIsMinus);if(!refocus){return;}$timeout(function(){var strLength=element[0].value.length*2;element[0].focus();element[0].setSelectionRange(strLength,strLength);if(isminus){element[0].value="-";}});}};}impDirectives.directive("setBodyContainerPosition",function($timeout,NavigationSvc){return{restrict:"A",scope:{},link:function(scope,element){NavigationSvc.setBodyPosition();}};});impDirectives.directive("impIconInfo",function(){return{restrict:"E",scope:{hasValue:"=?"},link:function(scope,element){if(angular.isUndefined(scope.hasValue)){scope.hasValue=true;}scope.flag=scope.hasValue;},template:"<div ng-class=\"{'imp-icon-info-on': hasValue, 'imp-icon-info-off': !hasValue}\"></div>"};});impDirectives.directive("impPopover",function($http,$templateCache,$compile,$timeout){return{restrict:"A",scope:true,compile:function(tElem,tAttrs){if(!tElem.attr("tooltip-html-unsafe")){tElem.attr("tooltip-html-unsafe","{{tooltip}}");}return function(scope,element,attrs){function loadTemplate(){var factory=angular.element("<div></div>");$http.get(attrs.impPopover,{cache:$templateCache}).success(function(result){factory.html(result);$compile(factory)(scope);$timeout(function(){scope.tooltip=factory.html();});});}element.removeAttr("imp-popover");$compile(element)(scope);if(attrs.hasOwnProperty("watch")){scope.$watch(attrs.watch,function(){loadTemplate();},true);}else{loadTemplate();}};}};});impDirectives.directive("impLockPopup",function(modalPopoverFactory,loanService){return{restrict:"E",bindToController:true,controller:function(){this.getLock=function(loanId,userAccountId,event){loanService.lazyLoad(srv.lazyLoadControllerName.loanLockHistory,loanId,userAccountId).success(function(data){loan.lockHistory=data.loanLockHistoryList;modalPopoverFactory.openModalPopover("angular/contextualbar/details/lockhistory.html",{},loan.lockHistory,event);}).error(function(error){console.error("Error on lock history lazy load. Error: "+String(error));});};},link:function(scope,element,attrs,controller){element.on("click",function(event){controller.getLock(attrs.loanid,attrs.useraccountid,event);});}};});impDirectives.directive("impNavSearch",function(){return{restrict:"E",replace:true,scope:{model:"=",submit:"&",clear:"&"},templateUrl:"angular/navigation/search.html"};});impDirectives.directive("impOptions",function(){return{restrict:"E",scope:{options:"=",model:"=",change:"&",focus:"&",disabled:"=",},template:'<select ng-model="model" ng-change="change()" ng-focus="focus()" ng-disabled="disabled" class="imp-ddl" style="width:135px;">'+'<option ng-repeat="option in options | orderBy:\'Code\'" ng-disabled="option.isDisabled" ng-selected="model.EnumerationValueId == option.EnumerationValueId" ng-value="option">{{ option.Description }}</option>'+"</select>"};});impDirectives.directive("impLoanPositionBanner",function(){return{restrict:"E",replace:true,scope:{color:"@",number:"@"},link:function(scope,element){var ctx=element[0].getContext("2d");drawLoanPositionBanner(ctx,scope.color,scope.number);},template:'<canvas class="imp-loan-position-banner" width="27" height="18"></canvas>'};});impDirectives.directive("impLock",function(){return{restrict:"E",replace:true,scope:{color:"@",number:"@"},link:function(scope,element){var ctx=element[0].getContext("2d");scope.$watch(function(scope){return scope.number;},function(newValue){drawLock(ctx,scope.color,newValue);});scope.$watch(function(scope){return scope.color;},function(newValue){drawLock(ctx,newValue,scope.number);});},template:'<canvas class="imp-lock" width="25" height="25" ></canvas>'};});impDirectives.directive("impCircle",function(){return{restrict:"E",replace:true,scope:{size:"@",color:"@",lineColor:"@",isPlus:"@",hoverColor:"@"},link:function(scope,element){var ctx=element[0].getContext("2d");drawMinusPlus(ctx,scope.color,scope.lineColor,scope.isPlus,scope.size);if(scope.isPlus==="false"&&scope.hoverColor){element.bind("mouseover",function(){drawMinusPlus(ctx,scope.hoverColor,scope.lineColor,scope.isPlus,scope.size);});element.bind("mouseout",function(){drawMinusPlus(ctx,scope.color,scope.lineColor,scope.isPlus,scope.size);});}},template:'<canvas width="26" height="26" class="imp-circle"></canvas>'};});impDirectives.directive("impTriangle",function(){return{restrict:"E",replace:true,link:function(scope,element){var ctx=element[0].getContext("2d");drawSubTabTriangle(ctx,"#1FAC58");},template:'<canvas class="canvas" style="display: block;"  height="15" width="15"></canvas>'};});impDirectives.directive("impTabset",function(){return{restrict:"E",replace:true,transclude:true,controller:function($scope){$scope.templateUrl="";var tabs=$scope.tabs=[];var controller=this;this.selectTab=function(tab){if(tab.manageSelectedState){if(tab.isDisabled!==true){angular.forEach(tabs,function(t){t.isSelected=false;});tab.isSelected=true;}}};this.setTabTemplate=function(templateUrl){$scope.templateUrl=templateUrl;};this.addTab=function(tab){if(tab.manageSelectedState){if(tab.isSelected===true){controller.selectTab(tab);}else{if(tabs.length===0){controller.selectTab(tab);}}}tabs.push(tab);};},templateUrl:function(tElement,tAttrs){return tAttrs.tabsetTemplateUrl;}};});impDirectives.directive("impTab",function(){return{restrict:"E",replace:true,require:"^impTabset",scope:{id:"@",title:"@",templateUrl:"@",specificClass:"@",showMark:"=?",isSelected:"=?",isDisabled:"=?",checkColor:"=?",isCheckAvailable:"=?",manageSelectedState:"=?"},link:function(scope,element,attrs,tabsetController){scope.manageSelectedState=scope.manageSelectedState==null||scope.manageSelectedState==undefined?true:scope.manageSelectedState;tabsetController.addTab(scope);scope.select=function(){if(scope.manageSelectedState){tabsetController.selectTab(scope);}};scope.$watch("isSelected",function(){if(scope.isSelected){tabsetController.setTabTemplate(scope.templateUrl);}});},templateUrl:function(tElement,tAttrs){return tAttrs.tabTemplateUrl;}};});impDirectives.directive("impPrintPdf",function($timeout,$compile,$log,mailroomService){return{restrict:"E",bindToController:true,scope:{},controller:function(){this.printPdf=function(fileItemId,userAccountId){mailroomService.getPDFFile(fileItemId,userAccountId).success(function(data){if(data){var file=new Blob([data],{type:"application/pdf"});var fileURL=URL.createObjectURL(file);var iframe=document.frames?document.frames["printf"]:document.getElementById("printf");var ifWin=iframe.contentWindow||iframe;iframe.focus();iframe.src=fileURL;$timeout(function(){ifWin.print();},1000);}else{$log.error("Failed to retrieve file data.");}}).error(function(error){$log.error("Failed to retrieve file data.",error);});};},link:function(scope,element,attrs,controller){var iframePrint="<div class='imp-workbench-icon-print'>                                    <iframe name='printf' id='printf' style='display:none'></iframe>                                </div>";element.append($compile(iframePrint)(scope));element.on("click",function(event){controller.printPdf(attrs.fileitemid,attrs.useraccountid);});}};});impDirectives.directive("impContextualButton",function(){return{restrict:"E",bindToController:true,controllerAs:"ctrl",scope:{executeCommand:"=?",items:"=?",selectedItem:"=?",cssClassAction:"@",cssClassDropdown:"@",cssClassDropdownMenu:"@"},controller:function(){this.select=function(item){this.selectedItem=item;};},templateUrl:"angular/common/contextualbutton.html"};});impDirectives.directive("sortable",function($timeout){return function(scope,element,attributes){$(element).sortable({stop:function(event,ui){scope.$apply(function(){scope.syncOrder($(element).sortable("toArray"));});}});};});impDirectives.directive("impValRequired",function($http,$compile,$templateCache){return{restrict:"A",scope:{impValRequired:"@"},link:function(scope,element,attrs){var elem=$(element).parent().find("select"),corners=["top center","bottom center"],flipIt=elem.parents("span.top").length>0;if(scope.impValRequired!=""){elem.qtip({content:"<span>"+scope.impValRequired+"</span>",overwrite:false,position:{my:corners[flipIt?0:1],at:corners[flipIt?1:0],viewport:$(window)},show:"focus",hide:{when:{event:"unfocus"}},style:{classes:"ui-tooltip-red"}}).qtip("option","content.text","<span>"+scope.impValRequired+"</span>");}else{elem.qtip("destroy");}}};});impDirectives.directive("impTooltip",function($http,$compile,$templateCache){return{restrict:"A",link:function(scope,element,attrs){var content="<div>LockedOn</div><br/><div>02/02/2014</div>";var elem=$(element),corners=["top center","bottom center"],flipIt=elem.parents("span.top").length>0;if(content!=""){elem.qtip({content:content,position:{my:corners[flipIt?0:1],at:corners[flipIt?1:0],viewport:$(window)},show:"click",hide:{when:{event:"click"},effect:{type:"slide"}}});}else{elem.qtip("destroy");}}};});impDirectives.directive("impContextMenu",function($compile){var contextMenus={pdfMenu:"<ul id='contextmenu-node' class='condition-arrow-box'>                        <li class='contextmenu-item' ng-click='downloadDocument($event)'> <span>Download a copy</span> </li>                        <li class='contextmenu-item' ng-click='unassignFromItem($event)'> <span>Unassign from item</span> </li>                        <li class='contextmenu-item' ng-click='rejectDocument($event)' style='color: grey'> <span>Reject document</span> </li>                        <li class='contextmenu-item' ng-click='deleteFromDocVault($event)' style='color: grey'><span>Delete from DocVault</span> </li>                        <li class='contextmenu-item' ng-click='browseDocVault($event)'> <span>Browse DocVault</span> </li>                       </ul>",docVaultMenu:"<ul id='contextmenu-node' class='condition-arrow-box'>                                <li class='contextmenu-item' ng-click='browseDocVault($event)'> <span>Browse DocVault</span> </li>                                <li class='contextmenu-item' ng-repeat='doc in filteredDocuments' ng-click='assignDocument(doc)'> <span> {{ doc.Name }} </span> </li>                            </ul>",documentclassificationMenu:"<ul id='contextmenu-node' class='condition-arrow-box'>                <li class='contextmenu-item' ng-click='classifyDocument(document)'> Classify Document </li>                <li class='contextmenu-item' ng-click='rejectDocument(document)'> Reject Document </li>                <li class='contextmenu-item-disabled' ng-click='deleteFromDocVault()'> Delete from DocVault </li>                </ul>",exampleMenu:"<ul id='contextmenu-node' class='condition-arrow-box'>                                <li class='contextmenu-item'> <span>Example</span> </li>                                <li class='contextmenu-item'> <span>Example Option</span> </li>                            </ul>"};impContextMenu={};impContextMenu.restrict="A";impContextMenu.link=function(lScope,lElem,lAttr){lElem.on("contextmenu",function(e){if($("#contextmenu-node")){$("#contextmenu-node").remove();}var selectedmenu=$(contextMenus[lScope[lAttr.impContextMenu]]);e.preventDefault();e.stopPropagation();lElem.append($compile(selectedmenu)(lScope));return false;});};return impContextMenu;});impDirectives.directive("impDate",function($filter,dateParser,$timeout){return{require:"ngModel",scope:{onBlurFn:"&?",dateFormatPatterns:"@"},link:function(scope,element,attrs,ngModelCtrl){var dateFormat="MM/dd/yyyy";if(scope.dateFormatPatterns!=null&&scope.dateFormatPatterns!=undefined){dateFormat=scope.dateFormatPatterns;}var listener=function(){if(ngModelCtrl.$modelValue==null){return;}var value=element.val();if(!common.date.isValidDate(value,true)||value==""||value==null||value==undefined){return;}var modelDate=new Date(parseDate(ngModelCtrl.$modelValue));if(isNaN(modelDate.getDate())||modelDate.getYear()>3000){if(!isNaN(new Date(attrs.min))){value=attrs.min;element.val($filter("date")(value,dateFormat));}else{value="01/01/1900";element.val(value);}}else{element.val($filter("date")(value,dateFormat));}};function parseDate(viewValue){if(!viewValue){return null;}else{if(angular.isDate(viewValue)&&!isNaN(viewValue)){return viewValue;}else{if(angular.isString(viewValue)){var date=dateParser.parse(moment(viewValue).format("MM/DD/YYYY"),dateFormat);if(isNaN(date)){return undefined;}else{return date;}}else{return undefined;}}}}ngModelCtrl.$parsers.push(parseDate);ngModelCtrl.$formatters.push(function(value){return $filter("date")(value,dateFormat);});ngModelCtrl.$render=function(){element.val($filter("date")(ngModelCtrl.$viewValue,dateFormat));};var onBlur=function(){listener();if(angular.isDefined(attrs.onBlurFn)){scope.onBlurFn();}if(!common.date.isValidDate(element.val(),true)){$timeout(function(){element.val(null);});}};element.bind("blur",onBlur);element.bind("keydown",function(event){var key=event.keyCode;var defaultKeys=key==8||key==9||key==37||key==39;if(key==8){return;}if(key<48||key>105){if(!defaultKeys){event.preventDefault();}}else{if(key>57&&key<96){event.preventDefault();}}if(element.val().length>9&&!defaultKeys){event.preventDefault();}var dateSpacerOccurance=dateFormat.split("/").length-1;value=element.val();if(dateSpacerOccurance==1){if((value.length==2)&&!defaultKeys){value=value+"/";}}else{if(dateSpacerOccurance==2){if((value.length==2||value.length==5)&&!defaultKeys){value=value+"/";}}}if(attrs.min&&!defaultKeys){var numberEntered=isNaN(String.fromCharCode(event.keyCode))?String.fromCharCode(event.keyCode-48):String.fromCharCode(event.keyCode);var minimalDate=attrs.min.split("/");switch(minimalDate.length){case 2:if(value.split("/").length==1){var typedMonth=value.split("/")[0]+numberEntered;var minMonth=minimalDate[0];if(parseInt(typedMonth)<parseInt(minMonth.substring(0,typedMonth.length))){event.preventDefault();}}else{if(value.split("/").length>1){var typedYear=value.split("/")[1]+numberEntered;var minYear=minimalDate[1];if(parseInt(typedYear)<parseInt(minYear.substring(0,typedYear.length))){event.preventDefault();}}}break;case 3:if(value.split("/").length==1){var typedMonth=value.split("/")[0]+numberEntered;var minMonth=minimalDate[0];if(parseInt(typedMonth)<parseInt(minMonth.substring(0,typedMonth.length))){event.preventDefault();}}else{if(value.split("/").length==2){var typedDay=value.split("/")[1]+numberEntered;var minDay=minimalDate[1];if(parseInt(typedDay)<parseInt(minDay.substring(0,typedDay.length))){event.preventDefault();}}else{if(value.split("/").length==3){var typedYear=value.split("/")[2]+numberEntered;var minYear=minimalDate[2];if(parseInt(typedYear)<parseInt(minYear.substring(0,typedYear.length))){event.preventDefault();}}}}break;}}element.val(value);});element.bind("focus",function(){this.select();element.bind("mouseup",function(event){event.preventDefault();element.unbind("mouseup");});});}};});impDirectives.directive("impCurrency",function($filter,$browser){return{require:"ngModel",link:function(scope,element,attrs,ngModelCtrl){var listenerOnChange=function(){var value=element.val().replace(/,/g,"").replace("$","");if(attrs.negativeValues){element.val($filter("impCurrency")(value));}else{element.val($filter("currency")(value));}if(attrs.displayCurrencySign=="false"){element.val(element.val().replace("$",""));}if(attrs.required){if(value==0&&attrs.canBeZero!="1"){ngModelCtrl.$invalid=true;element.removeClass("ng-pristine").removeClass("ng-valid-parse").removeClass("ng-valid").removeClass("ng-valid-required");element.addClass("ng-invalid ng-invalid-required");}else{ngModelCtrl.$invalid=false;element.removeClass("ng-invalid ng-invalid-required");element.addClass("ng-valid-parse").addClass("ng-valid").addClass("ng-valid-required");}}if(attrs.isLiability=="1"&&angular.element(document.getElementById("divCreditTabContent")).controller()!=undefined){angular.element(document.getElementById("divCreditTabContent")).controller().ProcessJointLiabilityRecords(attrs.liabilityInfoId);}if(attrs.decimalPlaces!==undefined){var decPlaces=(attrs.decimalPlaces===undefined)?"2":attrs.decimalPlaces;var currencySign=attrs.displayCurrencySign!="false"?"$":"";element.val($filter("impCurrency")(ngModelCtrl.$viewValue,currencySign,decPlaces));}};var decPlaces=(attrs.decimalPlaces===undefined)?"2":attrs.decimalPlaces;var listenerOnKey=function(key){var value=element.val().replace(/,/g,"").replace("$","");if(attrs.negativeValues=="true"&&element.val().substr(0,1)=="-"&&(key==109||key==189)){return;}if(key==109||key==189){value=value.replace("-","");}element.val($filter("number")(value));};ngModelCtrl.$parsers.push(function(viewValue){if(viewValue==null||viewValue==undefined){return 0;}var valStr=String(viewValue).replace(/,/g,"").replace("$","");var valRet=0;try{if(valStr=="-"||valStr==""){return 0;}var valNum=parseFloat(valStr);if(isNaN(valNum)){console.error("imp-currency directive [View -> Model] binding fail to parse:"+valStr+"for:"+viewValue);}else{valRet=valNum;}}catch(e){console.error("imp-currency directive [View -> Model] binding fail to parse:"+valStr+"for:"+viewValue);}return valRet;});ngModelCtrl.$render=function(){var currencySign=attrs.displayCurrencySign!="false"?"$":"";var viewValue=ngModelCtrl.$viewValue;if(attrs.negativeValues!="true"&&viewValue!=undefined&&viewValue!=null){viewValue=String(viewValue).replace("-","");}if((element.val().length>2||(element.val().substr(0,1)!="."&&element.val().substr(0,1)!="-"))){element.val($filter("impCurrency")(viewValue,currencySign,decPlaces));}};element.bind("blur",listenerOnChange);element.bind("keydown",function(event){var key=event.keyCode;if(key==91||(15<key&&key<19)||(37<=key&&key<=40)||key==67||key==86||key==9||key==8||key==46||key==190||key==110){return;}var isSelected=this.selectionStart==0&&this.selectionEnd==this.value.length;var allowNegativeValues=(key==109||key==189)&&attrs.negativeValues=="true"&&(element.val().substr(0,1)!="-"||isSelected==true);if((0<=key&&key<13)||(13<key&&key<48)||(key>105&&!allowNegativeValues)){event.preventDefault();}else{if(key>57&&key<96){event.preventDefault();}}if((element.val().substr(element.val().length-1)!="."||(key!=96&&key!=48))&&(element.val().substr(0,1)!="-"||element.val().length>2)){$browser.defer(function(){listenerOnKey(key);});}});element.bind("focus",function(){var value=element.val().replace(/,/g,"").replace("$","");element.val($filter("number")(value));this.select();element.bind("mouseup",function(event){event.preventDefault();element.unbind("mouseup");});});}};});impDirectives.directive("impPercentage",function($parse,$browser,$filter){return{restrict:"A",require:"?ngModel",scope:{returnFloat:"=",roundThreeDecimals:"=",noDecimals:"=",additionalSpace:"=",alwaysThreeDecimals:"="},link:function(scope,element,attrs,ctrl){var percentChar="%";if(scope.additionalSpace){percentChar=" "+percentChar;}ctrl.$formatters.push(function(value){if(scope.alwaysThreeDecimals){if(scope.returnFloat){return parseFloat(Math.round(value*1000)/1000).toFixed(3)+percentChar;}else{return parseInt(value).toFixed(3)+percentChar;}}if(scope.returnFloat&&scope.roundThreeDecimals){return parseFloat(Math.round(value*1000)/1000)+percentChar;}if(scope.returnFloat){return parseFloat((value/100)*100).toFixed(2)+percentChar;}return parseInt(value)+percentChar;});ctrl.$parsers.push(function(viewValue){if(scope.returnFloat&&viewValue!=undefined&&viewValue!=null){return parseFloat(String(viewValue).replace(" %","").replace("%",""));}return parseInt(String(viewValue).replace(" %","").replace("%",""));});var listenerOnChange=function(){var value=parseFloat(element.val());if(scope.alwaysThreeDecimals&&value){value=((value/1000)*1000).toFixed(3);value=value.replace(" %","").replace("%","")+percentChar;element.val(value);}else{if(value%1==0&&!scope.noDecimals){if(scope.roundThreeDecimals){value=((value/1000)*1000).toFixed(3);}else{value=((value/100)*100).toFixed(2);}value=value.replace(" %","").replace("%","")+percentChar;element.val(value);}else{value=element.val().replace(" %","").replace("%","")+percentChar;element.val(value);}}};element.bind("focus",function(){this.select();element.bind("mouseup",function(event){event.preventDefault();element.unbind("mouseup");});});element.bind("blur",listenerOnChange);element.bind("keydown",function(event){var key=event.keyCode;if(key==91||(15<key&&key<19)||(37<=key&&key<=40)||key==67||key==86||key==9||key==8||key==46||key==190||key==110){return;}$browser.defer(listenerOnKey);});var listenerOnKey=function(){var value=element.val().replace(/,/g,"").replace("%","");if(value.indexOf(".")>0&&(value.length-value.indexOf(".")<=3)){return;}else{element.val($filter("number")(value));}};element.bind("change",listenerOnChange);}};});impDirectives.directive("optionsDisabled",function($parse){var disableOptions=function(scope,attr,element,data,fnDisableIfTrue){if(!data){return;}$("option[value!=''][value!='?']",element).each(function(i,e){var locals={};locals[attr]=data[i];$(this).attr("disabled",fnDisableIfTrue(scope,locals));});};return{priority:0,require:"ngModel",restrict:"A",link:function(scope,iElement,iAttrs,ctrl){var expElements=iAttrs.optionsDisabled.match(/^\s*(.+)\s+for\s+(.+)\s+in\s+(.+)?\s*/);var attrToWatch=expElements[3];var fnDisableIfTrue=$parse(expElements[1]);scope.$watch(attrToWatch,function(newValue,oldValue){if(newValue){disableOptions(scope,expElements[2],iElement,newValue,fnDisableIfTrue);}},true);scope.$watch(iAttrs.ngModel,function(newValue,oldValue){var disOptions=$parse(attrToWatch)(scope);if(newValue){disableOptions(scope,expElements[2],iElement,disOptions,fnDisableIfTrue);}});}};});impDirectives.directive("impPhone",function($filter,$browser,$compile){return{restrict:"E",scope:{customFilters:"=?",phoneNumber:"=",selectedPhoneType:"=?",phoneTypesOptions:"=?",numberRequired:"=?",fieldsDisabled:"=?",triggerValidationOnInit:"=?",disablePhoneTypeOptions:"=?"},link:function(scope,element,attrs,ngModelCtrl){scope.disablePhoneTypeOptions=(scope.disablePhoneTypeOptions==null||scope.disablePhoneTypeOptions==false)?false:true;var phoneUI="<div class='col-md-4'>                               <input type='text' ui-mask='(999) 999-9999' ng-model='phoneNumber' ng-disabled='fieldsDisabled' ng-class=\"{'imp-has-error': validatePhoneNumber()}\"/>                           </div>                           <div class='col-md-3' ng-hide='disablePhoneTypeOptions'>                                <div class='imp-span-ddl-container medium fleft' ng-class=\"{'imp-is-disabled': fieldsDisabled, 'imp-has-error': validatePhoneNumber()}\">                                   <select class='imp-ddl imp-psection-left-borderadius'                                    ng-model='selectedPhoneType'                                    ng-options='phoneType.value as phoneType.text for phoneType in phoneTypesOptions'                                    ng-disabled='fieldsDisabled'                                    ng-class=\"{'imp-has-error': validatePhoneNumber()}\">                                    </select>                                </div>                            </div>";element.append($compile(phoneUI)(scope));scope.innerCustomFilters=scope.customFilters?scope.customFilters:[];scope.validatePhoneNumber=function(){return(!scope.phoneNumber||scope.phoneNumber.length<10)&&scope.numberRequired;};scope.colorErrors=function(selectedElement,dropdownElement,dropdownParentElement,selectedElementValue){selectedElementNumbers=selectedElementValue?selectedElementValue.replace("(","").replace(")","").replace("-","").replace(" ","").replace(/_/g,""):"0";};var selectedElement=element.find("input");var dropdownElement=element.find("select");var dropdownParentElement=dropdownElement.parent();if(scope.fieldsDisabled){dropdownParentElement.addClass("imp-is-disabled");}else{dropdownParentElement.removeClass("imp-is-disabled");}if(scope.numberRequired){scope.colorErrors(selectedElement,dropdownElement,dropdownParentElement,scope.phoneNumber);}var onBlur=function(){if(scope.innerCustomFilters){for(i=0;i<scope.innerCustomFilters.length;i++){if((scope.innerCustomFilters[i].executeOn=="blur"||!scope.innerCustomFilters[i].executeOn)&&!scope.innerCustomFilters[i].ruleFunction(selectedElement.val())){scope.innerCustomFilters[i].callBackFunction();return;}}}if(scope.numberRequired){scope.colorErrors(selectedElement,dropdownElement,dropdownParentElement,scope.phoneNumber);}};var onKeyUp=function(){if(scope.innerCustomFilters){for(i=0;i<scope.innerCustomFilters.length;i++){if(scope.innerCustomFilters[i].executeOn=="onkeyup"&&!scope.innerCustomFilters[i].ruleFunction(selectedElement.val())){scope.innerCustomFilters[i].callBackFunction();return;}}}};selectedElement.bind("blur",onBlur);selectedElement.bind("keyup",onKeyUp);}};});impDirectives.directive("impDatePicker",function($filter,dateFilter,datepickerPopupConfig,$timeout){return{restrict:"E",scope:{displayPicker:"=",model:"=ngModel",dateSettings:"=?",customFilters:"=?",triggerValidationOnInit:"=?",hasError:"=",setDefaultDate:"=?"},templateUrl:"angular/common/datecontrol.html",link:function(scope,element,attrs,ngModelController){scope.minDate="01/01/1900";scope.maxDate="01/01/2050";scope.dateFormat="MM/dd/yyyy";scope.adultsOnly=true;scope.minAdultsAge=18;scope.defaultDateSettings={};scope.innerCustomFilters=[];scope.dateRegEx=new RegExp("^((0?[1-9]|1[012])[- /.](0?[1-9]|[12][0-9]|3[01])[- /.](17|18|19|20|21|22)?[0-9]{2})*$");scope.placeholder="__/__/____";scope.hideErrorMessage=false;scope.customErrorMessage="";scope.validateOnFocus=false;scope.disabled=false;scope.validateIsDate=false;scope.width="100%";scope.innerCustomFilters=scope.customFilters?scope.customFilters:[];scope.defaultDateSettings=scope.dateSettings=scope.dateSettings?scope.dateSettings:{minDate:"",maxDate:"",dateFormat:"",adultsOnly:"",minAdultsAge:"",dateRegEx:"",placeholder:"",hideErrorMessage:"",customErrorMessage:"",validateOnFocus:"",disabled:""};scope.defaultDateSettings.minDate=scope.dateSettings.minDate?scope.dateSettings.minDate:scope.minDate;scope.defaultDateSettings.maxDate=scope.dateSettings.maxDate?scope.dateSettings.maxDate:scope.maxDate;scope.defaultDateSettings.dateFormat=scope.dateSettings.dateFormat?scope.dateSettings.dateFormat:scope.dateFormat;scope.defaultDateSettings.adultsOnly=scope.dateSettings.adultsOnly!==""?scope.dateSettings.adultsOnly:scope.adultsOnly;scope.defaultDateSettings.minAdultsAge=scope.dateSettings.minAdultsAge?scope.dateSettings.minAdultsAge:scope.minAdultsAge;scope.defaultDateSettings.dateRegEx=scope.dateSettings.dateRegEx?scope.dateSettings.dateRegEx:scope.dateRegEx;scope.defaultDateSettings.placeholder=scope.dateSettings.placeholder?scope.dateSettings.placeholder:scope.placeholder;scope.defaultDateSettings.hideErrorMessage=scope.dateSettings.hideErrorMessage?scope.dateSettings.hideErrorMessage:scope.hideErrorMessage;scope.defaultDateSettings.customErrorMessage=scope.dateSettings.customErrorMessage?scope.dateSettings.customErrorMessage:scope.customErrorMessage;scope.defaultDateSettings.validateOnFocus=scope.dateSettings.validateOnFocus?scope.dateSettings.validateOnFocus:scope.validateOnFocus;scope.defaultDateSettings.disabled=scope.dateSettings.disabled?scope.dateSettings.disabled:scope.disabled;scope.defaultDateSettings.validateIsDate=scope.dateSettings.validateIsDate?scope.dateSettings.validateIsDate:scope.validateIsDate;scope.defaultDateSettings.width=scope.dateSettings.width?scope.dateSettings.width:scope.width;scope.$watch("model",function(value){if(value&&value.length>11){if(scope.defaultDateSettings.dateFormat=="MM/dd/yyyy"){scope.model=value.substring(5,7)+"/"+value.substring(8,10)+"/"+value.substring(0,4);}else{if(scope.defaultDateSettings.dateFormat=="MM/yyyy"){scope.model=value.substring(5,7)+"/"+value.substring(0,4);}}}});scope.expandTheDate=function(value){if(!!value&&value.length<8){return value.substring(0,value.indexOf("/")+1)+"01"+value.substring(value.indexOf("/"),value.length);}return value;};scope.shrinkTheDate=function(value){if(!!value&&value.length>8){return value.replace(/\/([0-9]\w)\//g,"/");}};if(scope.defaultDateSettings.dateFormat=="MM/dd/yyyy"||scope.defaultDateSettings.dateFormat=="MM/dd/yy"){scope.model=scope.expandTheDate(scope.model);}else{if(scope.defaultDateSettings.dateFormat=="MM/yyyy"){scope.model=scope.shrinkTheDate(scope.model);}}scope.model=dateFilter(scope.model,scope.defaultDateSettings.dateFormat);var defaultValidationEnabled=true;var closingDate=scope.minDate;if(scope.dateSettings.defaultValidationEnabled!=undefined&&scope.dateSettings.defaultValidationEnabled!=null&&scope.dateSettings.defaultValidationEnabled==false){defaultValidationEnabled=scope.dateSettings.defaultValidationEnabled;}var closingDateValidationEnabled=false;if(scope.dateSettings.closingDateValidationEnabled!=null&&scope.dateSettings.closingDateValidationEnabled==true){closingDateValidationEnabled=scope.dateSettings.closingDateValidationEnabled;}if(scope.dateSettings.closingDate!=null&&scope.dateSettings.closingDate!="0001-01-01T00:00:00"){closingDate=scope.dateSettings.closingDate;}else{if(scope.setDefaultDate){scope.model=moment().format("MM/DD/YYYY");}}scope.defaultDateSettings.defaultValidationEnabled=defaultValidationEnabled;scope.defaultDateSettings.closingDateValidationEnabled=closingDateValidationEnabled;scope.defaultDateSettings.closingDate=closingDate;scope.isOpened=false;scope.open=function(event){event.preventDefault();event.stopPropagation();scope.isOpened=true;};scope.colorErrors=function(selectedElement,button){$(selectedElement).addClass("imp-has-error");if(button){$(button).addClass("imp-has-error");}};scope.getAge=function(birth){var today=new Date();var age=today.getFullYear()-birth.getFullYear();var age_month=today.getMonth()-birth.getMonth();var age_day=today.getDate()-birth.getDate();if(age_month<0||(age_month==0&&age_day<0)){age=parseInt(age)-1;}return age;};var index=scope.displayPicker?1:0;var selectedElement=element.find("input").eq(index);var errorLabel=$(element).find("span.imp-error-label");var button=element.find("button");var enteredDate=new Date(selectedElement.val());if(scope.triggerValidationOnInit){if(!scope.model||((isNaN(new Date(scope.model))||!scope.defaultDateSettings.dateRegEx.test(scope.model))&&scope.model.indexOf("_")===-1)){scope.colorErrors(selectedElement,button);}}var onBlur=function(){var value=selectedElement.val();if(value&&value.length==10){scope.model=value;}if(scope.innerCustomFilters){for(i=0;i<scope.innerCustomFilters.length;i++){if((scope.innerCustomFilters[i].executeOn=="blur"||!scope.innerCustomFilters[i].executeOn)&&!scope.innerCustomFilters[i].ruleFunction(selectedElement.val())){scope.innerCustomFilters[i].callBackFunction(scope.$parent);scope.$apply();}}if(!common.date.isValidDate(scope.model,true)){$timeout(function(){scope.model=null;});}}if(scope.defaultDateSettings.defaultValidationEnabled){$(selectedElement).removeClass("imp-has-error");if(button){$(button).removeClass("imp-has-error");}$(errorLabel).html("");if((new Date(selectedElement.val())<new Date(scope.defaultDateSettings.minDate))||(new Date(selectedElement.val())>new Date(scope.defaultDateSettings.maxDate))){scope.colorErrors(selectedElement,button);if(!scope.defaultDateSettings.hideErrorMessage){$(errorLabel).html("Invalid birthday");}}else{if(scope.defaultDateSettings.adultsOnly&&scope.getAge(new Date(selectedElement.val()))<scope.defaultDateSettings.minAdultsAge){scope.colorErrors(selectedElement,button);if(!scope.defaultDateSettings.hideErrorMessage){$(errorLabel).html("Must be over "+scope.defaultDateSettings.minAdultsAge);}}}}if(scope.dateSettings.closingDateValidationEnabled){if(new Date(scope.model)<new Date(scope.defaultDateSettings.minDate)){scope.model=scope.defaultDateSettings.closingDate;}}};var onFocus=function(){if(scope.defaultDateSettings.validateOnFocus){var value=selectedElement.val();if(scope.defaultDateSettings.defaultValidationEnabled){$(selectedElement).removeClass("imp-has-error");if(button){$(button).removeClass("imp-has-error");}$(errorLabel).html("");if((new Date(selectedElement.val())<new Date(scope.defaultDateSettings.minDate))||(new Date(selectedElement.val())>new Date(scope.defaultDateSettings.maxDate))){scope.colorErrors(selectedElement,button);if(scope.defaultDateSettings.customErrorMessage){$(errorLabel).html(scope.defaultDateSettings.customErrorMessage);}}}if(scope.dateSettings.closingDateValidationEnabled){if(new Date(scope.model)<new Date(scope.defaultDateSettings.minDate)){scope.model=scope.defaultDateSettings.closingDate;}}}};var onKeyUp=function(e){if(scope.innerCustomFilters){for(i=0;i<scope.innerCustomFilters.length;i++){if(scope.innerCustomFilters[i].executeOn=="onkeyup"&&!scope.innerCustomFilters[i].ruleFunction(selectedElement.val())){scope.innerCustomFilters[i].callBackFunction();return;}}}if(scope.defaultDateSettings.validateIsDate){if(new Date(scope.expandTheDate($(selectedElement).val()))=="Invalid Date"){$(selectedElement).addClass("imp-has-error");}else{if(!scope.hasError){$(selectedElement).removeClass("imp-has-error");}}}};scope.maskDate=function(event){if(event.keyCode!==8){if(scope.defaultDateSettings.dateFormat=="MM/dd/yyyy"||scope.defaultDateSettings.dateFormat=="MM/dd/yy"){if(event.target.value.length<=10){if(event.target.value.length==2){scope.model=event.target.value+"/";}else{if(event.target.value.length==5){scope.model=event.target.value+"/";}else{if(event.target.value.indexOf("/")===-1&&event.target.value.length==8){scope.model=event.target.value.substring(0,2)+"/"+event.target.value.substring(3,5)+"/"+scope.defaultDateSettings.dateFormat=="MM/dd/yy"?event.target.value.substring(8,10):event.target.value.substring(6,10);}}}}else{scope.model=event.target.value.substring(0,10);}}else{if(scope.defaultDateSettings.dateFormat=="MM/yyyy"){if(event.target.value.length<=7){if(event.target.value.length==2){scope.model=event.target.value+"/";}}else{scope.model=event.target.value.substring(0,7);}}}}};selectedElement.bind("blur",onBlur);selectedElement.bind("focus",onFocus);selectedElement.bind("keyup",onKeyUp);},controller:function($scope){$scope.isToBody=function(){if($scope.dateSettings){return $scope.dateSettings.appendToBody;}return false;};}};});impDirectives.directive("housingExpensesBarGraph",function(){return{restrict:"A",scope:{primaryValue:"@",referenceValue:"@",monthlyPaymentBarWidth:"@"},link:function(scope,element){scope.$watch(function(scope){return scope.primaryValue;},function(newValue){var barWidth=0;var refValue=parseFloat(scope.referenceValue);var primaryValue=parseFloat(newValue);var maxBarWidth=parseFloat(scope.monthlyPaymentBarWidth);if(primaryValue<refValue){barWidth=(primaryValue/refValue)*maxBarWidth;}else{barWidth=scope.monthlyPaymentBarWidth;}var changes={width:barWidth+"px"};element.css(changes);});scope.$watch(function(scope){return scope.referenceValue;},function(newValue){var barWidth=0;var refValue=parseFloat(newValue);var primaryValue=parseFloat(scope.primaryValue);var maxBarWidth=parseFloat(scope.monthlyPaymentBarWidth);if(primaryValue<refValue){barWidth=(primaryValue/refValue)*maxBarWidth;}else{barWidth=scope.monthlyPaymentBarWidth;}var changes={width:barWidth+"px"};element.css(changes);});}};});impDirectives.directive("ltvBarGraph",function(){return{restrict:"A",scope:{ltvValue:"@",firstReference:"@",secondReference:"@",ltvBarHeight:"@"},link:function(scope,element){scope.$watch(function(scope){return scope.ltvValue;},function(newValue){var ltvBarHeight=0;var refLtvVal1=parseFloat(scope.firstReference);var refLtvVal2=parseFloat(scope.secondReference);var ltvVal=parseFloat(newValue);var maxValue=100;var opacityValue=0;var barHeight=parseFloat(scope.ltvBarHeight);if(refLtvVal1>maxValue){maxValue=refLtvVal1;}else{if(refLtvVal2>maxValue){maxValue=refLtvVal2;}}if(maxValue>ltvVal){ltvBarHeight=(ltvVal/maxValue)*barHeight;}else{ltvBarHeight=barHeight;}var opacityValue=ltvVal/maxValue;var changes={height:ltvBarHeight+"px",opacity:opacityValue};element.css(changes);});scope.$watch(function(scope){return scope.firstReference;},function(newValue){var newltvBarHeight=0;var refLtvVal1=parseFloat(newValue);var refLtvVal2=parseFloat(scope.secondReference);var ltvVal=parseFloat(scope.ltvValue);var maxValue=100;var opacityValue=0;var barHeight=parseFloat(scope.ltvBarHeight);if(refLtvVal1>maxValue){maxValue=refLtvVal1;}else{if(refLtvVal2>maxValue){maxValue=refLtvVal2;}}if(maxValue>ltvVal){newltvBarHeight=(ltvVal/maxValue)*barHeight;}else{newltvBarHeight=barHeight;}var opacityValue=ltvVal/maxValue;var changes={height:newltvBarHeight+"px",opacity:opacityValue};element.css(changes);});scope.$watch(function(scope){return scope.secondReference;},function(newValue){var ltvBarHeight=0;var refLtvVal1=parseFloat(scope.firstReference);var refLtvVal2=parseFloat(newValue);var ltvVal=parseFloat(scope.ltvValue);var maxValue=100;var opacityValue=0;var barHeight=parseFloat(scope.ltvBarHeight);if(refLtvVal1>maxValue){maxValue=refLtvVal1;}else{if(refLtvVal2>maxValue){maxValue=refLtvVal2;}}if(maxValue>ltvVal){ltvBarHeight=(ltvVal/maxValue)*barHeight;}else{ltvBarHeight=barHeight;}var opacityValue=ltvVal/maxValue;var changes={height:ltvBarHeight+"px",opacity:opacityValue};element.css(changes);});}};});impDirectives.directive("borrowerCashBarGraph",function(){return{restrict:"A",scope:{totalAmount:"@",cashFromToBorrower:"@",totalAmountBarWidth:"@"},link:function(scope,element){scope.$watch(function(scope){return scope.totalAmount;},function(newValue){var barWidth=(scope.cashFromToBorrower/newValue)*scope.totalAmountBarWidth;var changes={width:barWidth+"px"};element.css(changes);});scope.$watch(function(scope){return scope.cashFromToBorrower;},function(newValue){var barWidth=(newValue/scope.totalAmount)*scope.totalAmountBarWidth;var changes={width:barWidth+"px"};element.css(changes);});}};});impDirectives.directive("backButton",function(){return{restrict:"A",link:function(scope,element,attrs){element.bind("click",goBack);function goBack(){history.back();scope.$apply();}}};});impDirectives.directive("loanDetailsTitle",function(){return{restrict:"A",scope:{productCode:"@"},link:function(scope,element,attrs){scope.$watch(function(scope){if(element[0]&&element[0].children[0]&&element[0].children[0].children[0]){return element[0].children[0].children[0].offsetWidth;}},function(newValue){if(element[0].offsetWidth<=newValue){element[0].children[1].style.display="block";}else{element[0].children[1].style.display="none";}});scope.$watch(function(scope){if(element[0]&&element[0].children[0]&&element[0].children[0].children[0]&&element[0].children[0].children[0].children[0]){return element[0].children[0].children[0].children[0].offsetWidth;}},function(newValue){var firstPartDivElement=element[0].children[0].children[0].children[0];var containerPartDivElementWidth=element[0].children[0].children[0].offsetWidth;if((element[0].offsetWidth<=newValue)){firstPartDivElement.style.fontSize="15px";}});}};});impDirectives.directive("selectItem",function(){return{restrict:"A",link:function(scope,element,attrs){element.bind("click",selectItem);function selectItem(){if(element.parent().hasClass("row")){element.parent().find("*").removeClass("selected");}else{element.parent().parent().find("*").removeClass("selected");}element.addClass("selected");}}};});impDirectives.directive("contextualTabs",function(){return{restrict:"E",controller:function($scope,$element){},link:function(scope,element,attrs,ctrls){},templateUrl:"angular/contextualbar/contextualtabs/contextualtabs.html"};});impDirectives.directive("gridHeight",function(){return{restrict:"A",link:function(scope,element,attrs){var changes={height:$(window).height()-230+"px"};element.css(changes);scope.$watch(function(scope){return $(window).height();},function(newValue){var changes={height:newValue-230+"px"};element.css(changes);});}};});impDirectives.directive("impSelectOnClick",function(){return{restrict:"A",link:function(scope,element){var focusedElement;element.on("click",function(){if(focusedElement!=this){this.select();focusedElement=this;}});element.on("blur",function(){focusedElement=null;});}};});impDirectives.directive("scrollOnClick",function(){return{restrict:"A",link:function(scope,$elm){$elm.on("click",function(){$(window).scrollTo(0,0);});}};});impDirectives.directive("impDocVault",function(){return{restrict:"E",templateUrl:"angular/documents/docvault/docvault.html",scope:{isFlyout:"=",showErrorContainer:"=",showLoader:"=",buttonSelected:"=?",buttonOptions:"=?",callButtonOption:"&?",changeButtonOption:"&?",groupedDocuments:"=",formatCategoryName:"&",toggleGrid:"&",encompassExportStatus:"=?",selectDisabled:"&?",documentSelectedChanged:"&",downloadDocument:"&",openMenu:"&",documentStatusData:"=?",documentStatusChanged:"&?",exportToEncompass:"&?",loanNumber:"=?",showDocumentHistory:"&",deleteDocument:"&?",selectAll:"&",unselectAll:"&",classifyDocuments:"&?",save:"&?",cancel:"&?",savingInProgres:"=?"},link:function(scope,elements,attrs){}};});(function(){angular.module("loanCenter.core",["ngResource","iMP.Filters","iMP.Directives","common","inputDirectives","impButtonDirectives","app.services","ui.bootstrap","ui.utils","ui.router","CalculatorModule"]);})();(function(){var enums={AddressTypes:{Default:0,Present:1,Former:2,Mailing:3,Billing:4,GovernmentMonitoring:5,RealEstate:6},DebtsAccountOwnershipType:{Borrower:0,CoBorrower:1,Joint:2,BorrowerWithOther:3,CoBorrowerWithOther:4},employmentStatus:{none:0,current:1,previous:2},employmentType:{activeMilitaryDuty:0,salariedEmployee:1,selfEmployed:2,retired:3,otherUnemployed:4,},IncomeTotals:{CurrentBorrower:0,AdditionalBorrower:1,CurrentCoBorrower:2,AdditionalCoBorrower:3,Other:4,},incomeTypeEnum:{baseEmploymentIncome:0,militaryBasePay:11,partTime:13,selfEmployedIncome:16},LoanApplicationTabs:{Personal:"Personal",Property:"Property",Assets:"Assets",Credit:"Credit",Declarations:"Declarations",Income:"Income"},DocumentsTabs:{NeedsList:"NeedsList",DocVault:"DocVault"},LoanTransactionTypes:{None:0,Purchase:1,Refinance:2},MiscellaneousDebtTypes:{ChildCareExpensesForVALoansOnly:1,Expenses2106FromTaxReturns:2},OccupancyTypes:{PrimaryResidence:"1",InvestmentProperty:"2",SecondVacationHome:"3"},PledgedAssetComment:{DoNotPayoff:0,PaidOffFreeAndClear:1,PayoffAtClose:2,PayoffAtClosingAndDontCloseAccount:3,PayoffAtClosingAndCloseAccount:4,Sold:5,NotMyLoan:6,PendingSale:7,NotAMortgage:8},PledgedAssetLoanType:{None:0,Fixed:1,Heloc:2},preferredPaymentPeriods:{none:0,monthly:1,annual:2},pricingAdjustmentSectionType:{enterprise:1,lOPrice:2,finalPrice:3,},ContextualTypes:{None:0,LoanApplication:1,LoanDetails:2,CostDetails:3,LoanScenario:4,DocVault:5,Aus:6,PricingResults:7,ComplianceEase:8,Conditions:9,LockingPricing:10,MessageCenter:11,Queue:12,ComplianceCenter:13,PreApprovalLetters:14,Appraisal:15,Documents:16,ShopForRates:17,MailRoomWorkbench:18,FhaCenter:19,VaCenter:20,NetTangibleBenefit:21,Integrations:22,USDACenter:23},iconColors:{active:"#1fb25a",expired:"#E73302",add:"#208DDC",del:"#DD3131",disabled:"#797979"},LiabilitiesDebtComment:{Agree:0,Disagree:1,PaidOff:3,PayoffAtClose:4,AcctNotMine:5,Duplicate:6,NotMyLoan:7,SomeoneElsePays:8},DebtComment:{Agree:0,Disagree:1,PaidOff:3,PayoffAtClose:4,Duplicate:5},PaidBy:{LenderRebate:5},CostContainer:{LoanCosts:1,OtherCosts:2,LenderCredits:3},BankStatementsIncomeType:{NA:0,Months6:1,Months12:2,Months24:3},AusType:{DU:1,LP:2,InvestorAUS:3,ManualTraditional:4,GUS:5},AmortizationType:{None:0,Fixed:1,ARM:2,GPM:3,Other:4},MortageType:{Conventional:0,FHA:1,ConventionalJumbo:2,ConventionalSuperJumbo:3,VA:4,USDA:5},uploadedFileStatus:{none:0,uploaded:1,inReview:2,received:3,faxed:4,removed:5,rejected:6,needed:7,exported:8,exportFailed:9,delivered:10,signed:11,sent:12,pending:13,submitted:14},DocumentContentType:{Unknown:"",pdf:"pdf",doc:"doc",docx:"docx",xls:"xls",xlsx:"xlsx",jpg:"jpg",xml:"xml",zip:"zip",txt:"txt",png:"png",gif:"gif",html:"html",tif:"tif",rtf:"rtf",rar:"rar"},creditReportStatus:{undefined:0,retrieving:1,retrieved:2,error:3},myListQueue:{openLoans:1,closedLoans:2,cancelledLoans:3,prospects:4,unsubmitted:5,registered:6,submitted:7,opening:8,preApproval:9,approved:10,docsOut:11,funding:12,mailRoom:13,pendingEConsent:14,orderRequested:15,orderProcessed:16,delivered:17,exceptions:18,incomplete:19,adverse:20,processing:21,pendingDisclosures:22},userRoles:{loanOfficer:"Loan Officer",secondary:"Secondary",lockDesk:"Lock Desk",administrator:"Administrator"},accountOptions:{jointWithBorrower:1,separateFromBorrower:2},lookupAccountOptions:{jointWithBorrower:"Joint with Borrower",separateFromBorrower:"Separate from Borrower"},timeInterval:{years:"years",months:"months",weeks:"weeks",days:"days",hours:"hours",minutes:"minutes",seconds:"seconds",},CostTypeEnum:{EstimatedLenderCosts:0,EstimatedThirdPartyCosts:1,Prepaids:2,EstimatedReservesDepositedwithLender:3,},costPaymentTypes:{borrowerPaid:"borrowerPaid",sellerPaid:"sellerPaid",otherPaid:"otherPaid"},costPaidWhenTypes:{atClosing:"atClosing",beforeClosing:"beforeClosing"},disclosureStatus:{NotNeeded:1,InitialDisclosureRequired:2,ReDisclosureRequired:3,RequestInProgress:4,DisclosuresCreated:5},contextualBarDropDownTypes:{milestoneStatus:0,leadStatus:1},requestDisclosureAction:{SaveLoanAplication:1,ComplianceCheck:2,CreateGFE:3,CreateTRID:4,CreateGFELock:5,CreateTRIDLock:6},requestExportToEncompassAction:{ExportToEncompass:1,UpdateEncompass:2,UpdateiMP:3},milestoneStatus:{prospect:1,incomplete:2,processing:3,preApproved:4,approved:5,docsOut:6,funded:8,cancelled:9,unsubmitted:10,registered:11,submitted:12,rejected:13,adverse:14,appCompleted:15},privileges:{AUSEditCaseKeyID:"AUS - Edit Case/Key ID",AUSInitiateintegration:"AUS - Initiate integration",AUSViewtab:"AUS - View tab",AccesstoActivities:"Access to Activities",AddNewBorrowerPair:"Add New Borrower Pair",AppraisedValue:"Appraised Value",BranchManagerTaskFilter:"Branch Manager Task Filter",CanEditEscrowsPeriodPayments:"Can Edit Escrows Period Payments",ChangeClosingDate:"Change Closing Date",ChangeLoanNumber:"Change Loan Number",ClosingCostsR:"Closing Costs - Read Only",ClosingCostsRW:"Closing Costs - Read Write",ConcessionLOPrice:"Concession LO Price",ConditionsChangeItemStatus:"Conditions - Change Item Status",ConditionsDelete:"Conditions - Delete",ConditionsViewTab:"Conditions - View Tab",CorporateMarginEnterprise:"Corporate Margin Enterprise",CreateTask:"Create Task",DisplayAppraisalQueues:"Display Appraisal Queues",DivisionMarginEnterprise:"Division Margin Enterprise",DocVaultViewTab:"DocVault - View Tab",EditEventTrigger:"Edit Event Trigger",EditLoanApplicationDate:"Edit Loan Application Date",EnableManageAppraisal:"Enable Manage Appraisal",EnableSubmitAppraisalOrder:"Enable Submit Appraisal Order",EnableSubmittoLenderX:"Enable Submit to LenderX",ExcessPricingEnterprise:"Excess Pricing Enterprise",ExcessPricingFinalPrice:"Excess Pricing Final Price",ExcessPricingLOPrice:"Excess Pricing LO Price",ExportCreditReport:"Export Credit Report",ExtensionEnterprise:"Extension Enterprise",ExtensionFinalPrice:"Extension Final Price",ExtensionLOPrice:"Extension LO Price",ImportLoan:"Import Loan",IntegrationServices:"Integration Services",IssuePreApprovalLetter:"Issue PreApproval Letter",LLPALOPrice:"LLPA LO Price",LoanApplicationChanges:"Loan Application Changes",LoanCenter:"Loan Center",LoanOfficerCompensationEnterprise:"Loan Officer Compensation Enterprise",LoanRequestTestingTool:"Loan Request Testing Tool",LoanServicesTabRetryAction:"Loan Services Tab Retry Action",LoanServicesTabView:"Loan Services Tab View",LockFee:"Lock Fee",MailRoomQueue:"Mail Room Queue",MailroomWorkbench:"Mailroom Workbench",ManagingQueues:"Managing Queues",ModifyIntentToProceed:"Modify Intent To Proceed",ModifyMilestone:"Modify Milestone",Modifyandchange:"Modify and change",ObtainingLoanApplicationinformation:"Obtaining Loan Application information",PermissionToChangeRates:"Permission To Change Rates",Permissionforpricingloan:"Permission for pricing loan",PricingAdjustmentsAllowed:"Pricing Adjustments Allowed",RemovingActivity:"Removing Activity",RenegotiationFinalPrice:"Renegotiation Final Price",RenegotiationLOPrice:"Renegotiation LO Price",ReviewPendingDisclosures:"Review Pending Disclosures",ReviewPreApprovalQueue:"Review PreApproval Queue",ShoppingCartTestingTools:"Shopping Cart Testing Tools",ShoppingCartTooltip:"Shopping Cart Tooltip",ShowAffinityConfiguration:"Show Affinity Configuration",StartanewProspect:"Start a new Prospect",SystemAdminALL:"SystemAdmin.ALL",SystemAdminBusinessAffiliatesALL:"SystemAdmin.BusinessAffiliates.ALL",SystemAdminBusinessAffiliatesParentProfiles:"SystemAdmin.BusinessAffiliates.ParentProfiles",SystemAdminBusinessAffiliatesProfiles:"SystemAdmin.BusinessAffiliates.Profiles",SystemAdminCompanyProfileALL:"SystemAdmin.CompanyProfile.ALL",SystemAdminConfigurationALL:"SystemAdmin.Configuration.ALL",SystemAdminContacts:"SystemAdmin.Contacts",SystemAdminDBLoggingALL:"SystemAdmin.DBLogging.ALL",SystemAdminDBLoggingLogData:"SystemAdmin.DBLogging.LogData",SystemAdminGeneralSettingALL:"SystemAdmin.GeneralSetting.ALL",SystemAdminIntegrationsAndVendorsALL:"SystemAdmin.IntegrationsAndVendors.ALL",SystemAdminIntegrationsAndVendorsAppraisalFee:"SystemAdmin.IntegrationsAndVendors.AppraisalFee",SystemAdminIntegrationsAndVendorsAppraisalProduct:"SystemAdmin.IntegrationsAndVendors.AppraisalProduct",SystemAdminUserAccountsALL:"SystemAdmin.UserAccounts.ALL",ViewAllLoans:"View All Loans",ViewAppraisalFormData:"ViewAppraisalFormData",ViewAppraisalLists:"View Appraisal Lists",ViewConciergeHome:"ViewConciergeHome",ViewEventTriggers:"View Event Triggers",ViewInitiateTestEventCommand:"View Initiate Test Event Command",ViewStandardList:"View Standard Lists",ViewDisclosuresList:"View Disclosures List",ViewLoanCenter30:"View Loan Center 3.0",ViewPipeline:"View Pipeline",ViewQueuesFilter:"View Queues Filter",ViewSystemAdmin:"ViewSystemAdmin",ViewTaskDetails:"View Task Details",ViewUnmaskedCreditCard:"View Unmasked Credit Card",WorstCasePricingFinalPrice:"Worst-Case Pricing Final Price",WorstCasePricingLOPrice:"Worst-Case Pricing LO Price",ViewOptimalBlueXML:"View Optimal Blue XML",SubmitLock:"Submit Lock",AcceptLock:"Accept Lock",EditLoanAssignments:"Edit Loan Assignments",ConcessionLevel1:"Concession Level 1",ConcessionLevel2:"Concession Level 2",ConcessionLevel3:"Concession Level 3",ConcessionLevel4:"Concession Level 4",ConcessionLevel5:"Concession Level 5"},housingExpenses:{homeOwnerExpense:1,floodInsuranceExpense:2,mortgageInsuranceExpense:3,propertyTaxExpense:4,HOAExpense:5},certificationId:{selectOne:0,validStateDriverLicense:1,validStateIdentificationCard:2,militaryIdentificationCard:3,militaryDependentsPhotoID:4,uSPassport:5,nonUSPassport:6,residentAlienCard:7,departmentOfPublicWelfarePhotoID:8,studentPhotoID:9,workIDWithPhoto:10,medicareCard:11,customerIDValidationCheck:12,closingCertification:13,other:14},loanOriginatorSource:{faceToFaceInterview:0}};var modalWindowType={loader:0,error:1,success:2,unsuccess:3,confirmation:4};var discloseActions=[{name:"Save Loan Application",value:1},{name:"Run Compliance Check",value:2},{name:"Create Initial Disclosures",value:4},{name:"Create Initial Lock Disclosures",value:6}];var exportToEncompassActions=[{name:"Export to Encompass",value:1,disabled:false},{name:"Update Encompass",value:2,disabled:false},{name:"Update iMP",value:3,disabled:false}];var lockingActions=[{name:"Save Only",saveAction:true,value:1},{name:"Submit Lock Request",userPrivilege:enums.privileges.SubmitLock,value:3},{name:"Accept Lock Request",userPrivilege:enums.privileges.AcceptLock,value:8},{name:"Deny Lock",userPrivilege:enums.privileges.AcceptLock,value:9}];angular.module("util").constant("enums",enums).constant("modalWindowType",modalWindowType).constant("guidEmpty","00000000-0000-0000-0000-000000000000").constant("discloseActions",discloseActions).constant("exportToEncompassActions",exportToEncompassActions).constant("lockingActions",lockingActions);})();(function(){angular.module("app.services",[]).config(["$provide",function($provide){var elem=angular.element(document.querySelector("#restApiRoot"));$provide.value("apiRoot",elem.attr("href"));}]);})();(function(){angular.module("loanCenter",["blockUI","loan.calculator","loan.events","http.ui.status","loanCenter.core","loanDetails","loanApplication","contextualBar","docVault","costDetails","queue","loanScenario","aus","uploadFiles","PricingResults","encompassModule","complianceEase","lockingandpricingadj","stipsandconditionsOld","impoundCalculator","assignments","digitaldocModule","compliancecenter","preapprovalletters","integrations.common","documents","mailroom","fhaCenter","signalrModule","vaCenter","copyLoan","util","copyLoan","ntbCenter","integrations","ui.tinymce","secureLinkEmail","modal-directive","usdaCenter"]);})();(function(){angular.module("loanCenter").config(function($logProvider,$stateProvider,$urlRouterProvider,$httpProvider){$logProvider.debugEnabled(true);$httpProvider.defaults.transformRequest=function(payload){var result=JSON.stringify(payload,replacer);function replacer(key,value){if(key=="$promise"){return undefined;}if(key=="_active"){return undefined;}if(key=="_primary"){return undefined;}if(key=="lookup"){return undefined;}if(value&&typeof value==="object"){var replacement={};if(Object.prototype.toString.call(value)=="[object Array]"){replacement=new Array();for(var k in value){if(Object.hasOwnProperty.call(value,k)){replacement.push(replacer(k,value[k]));}}return replacement;}else{for(var k in value){if(Object.hasOwnProperty.call(value,k)){replacement[k.replace(/^_/,"")]=value[k];}}return replacement;}}return value;}return result;};$urlRouterProvider.otherwise("/queue");$stateProvider.state("loanCenter",{"abstract":true,url:"/",views:{"contextualBars":{templateUrl:"/angular/contextualbar/contextualbars.html",},"contextualTitle":{templateUrl:"/angular/contextualbar/contextualtitle/contextualtitle.html",controller:"contextualTitleController as contextualTitleCtrl"},"mainView":{templateUrl:"/angular/loancenter/_blank.html"},"navigation":{templateUrl:"/angular/navigation/navigation.html",controller:"NavCtrl as navCtrl"}},resolve:{userAccountId:function(userAccountIdResolver,applicationDataService){return userAccountIdResolver(applicationDataService);},userAccount:function(userAccountId,applicationDataService,$log){return applicationDataService.getUserAccount(userAccountId).then(function(response){return new cls.UserAccountViewModel(response.data);},function(error){$log.error("userAccount::getUserAccount:: Error occurred while retrieving data!");});},applicationData:function(applicationDataResolver,applicationDataService,$stateParams,$rootScope,enums,userAccountId){return applicationDataResolver(applicationDataService,$stateParams,$rootScope,enums,userAccountId);},hasGuids:function(applicationDataService){return applicationDataService.getGuids(5000).then(function(response){util.IdentityGenerator.setGuids(response.data.Response);return true;});}}}).state("loanCenter.queue",{url:"queue",views:{"queueContextual":{templateUrl:"/angular/contextualbar/queue/contextualbarqueue.html",controller:"ContextualBarQueueCtrl as queueBarCtrl"},"queue":{templateUrl:"/angular/queue/queue.html",controller:"queueController as queue"},"contextualBar":{templateUrl:"/angular/contextualbar/contextualtitle/contextualtitle.html",controller:"contextualTitleController as contextualTitleCtrl"}},params:{queue:null,queueTitle:null},resolve:{controllerData:function(queueResolver,queueSvc,$stateParams,blockUI,userAccount,enums){return queueResolver(queueSvc,$stateParams,blockUI,userAccount,enums);},columnDefinition:function(queueColumnDefs,enums,$stateParams,applicationData,NavigationSvc,$state){return queueColumnDefs(enums,$stateParams,applicationData,NavigationSvc,$state);}}}).state("loanCenter.loan",{"abstract":true,url:"loan?loanId",views:{"loanMenu":{templateUrl:"/angular/navigation/loanMenu.html",controller:"loanMenuController as loanMenu"},"loanView":{templateUrl:"/angular/loancenter/_blankLoan.html"},"contextualBar":{templateUrl:"/angular/contextualbar/contextualbar.html",controller:"ContextualBarCtrl as contextualBarCtrl"},"contextualBarsAdditionalDetails":{templateUrl:"/angular/contextualbar/contextualbarsadditionaldetails.html",},},params:{loanId:null,loanPurposeType:null,differentiateId:1},resolve:{wrappedLoan:function(loanResolver,loanService,$filter,$stateParams,HttpUIStatusService,BroadcastSvc,LoanCalculator,applicationData,commonModalWindowFactory,modalWindowType,$modalStack,$modal,digitaldocSvc,encompassSvc,NavigationSvc,costDetailsHelpers){return loanResolver(loanService,$filter,$stateParams,HttpUIStatusService,BroadcastSvc,LoanCalculator,applicationData,commonModalWindowFactory,modalWindowType,$modalStack,$modal,digitaldocSvc,encompassSvc,NavigationSvc,costDetailsHelpers);},loanService:function(loanService){return loanService;},applicationData:function(applicationData){return applicationData;},modalWindowType:function(modalWindowType){return modalWindowType;},commonModalWindowFactory:function(commonModalWindowFactory){return commonModalWindowFactory;},},onEnter:function(wrappedLoan,digitaldocSvc,encompassSvc,NavigationSvc){if(wrappedLoan.ref.active.disclosureStatusDetails.disclosureStatus==srv.DisclosureStatusEnum.RequestInProgress){NavigationSvc.exportToDigitalInProgress=true;digitaldocSvc.checkLoanDisclosureStatus(wrappedLoan,wrappedLoan.ref.loanId);}if(wrappedLoan.ref.isImportToFNMInProgress){NavigationSvc.exportToEncompassInProgress=true;encompassSvc.checkExportToEncompassProgress(wrappedLoan);}else{NavigationSvc.exportToEncompassInProgress=false;}},onExit:function(wrappedLoan,loanService,applicationData){if(wrappedLoan&&wrappedLoan.ref&&wrappedLoan.ref.controlStatus.isAcquired&&wrappedLoan.ref.loanId&&applicationData&&applicationData.currentUserId){loanService.releaseControl(applicationData.currentUserId,wrappedLoan.ref.loanId);}},}).state("loanCenter.loan.loanScenario",{url:"/loanScenario",views:{"loanScenario":{templateUrl:"/angular/loanscenario/loanscenario.html",controller:"loanScenarioController as loanScenario"}},params:{repricing:false,contextualBarTitle:false},resolve:{controllerData:function(loanScenarioResolver,loanService,wrappedLoan,applicationData,$stateParams){return loanScenarioResolver(loanService,wrappedLoan,applicationData,$stateParams);}}}).state("loanCenter.loan.loanScenario.sections",{url:"/sections",views:{"personal":{templateUrl:"/angular/loanapplication/personal/personal.html",controller:"personalController as personal"},"contextualBar@":{templateUrl:"/angular/contextualbar/contextualbar.html",controller:"ContextualBarCtrl as contextualBarCtrl"}},resolve:{isVisible:function(){return{value:false};},controllerData:function(personalResolver,wrappedLoan){return personalResolver(wrappedLoan);}}}).state("loanCenter.loan.loanApplication",{url:"/loanApplication",views:{"contextualDetailsBar":{templateUrl:"/angular/contextualbar/details/contextualbardetails.html",controller:"ContextualBarDetailsCtrl as conBarCtrl"},"contextualBarTabs":{templateUrl:"/angular/contextualbar/contextualtabs/contextualbartabs.html",controller:"ContextualBarTabsCtrl as conBarTabsCtrl"},"main":{templateUrl:"/angular/loanapplication/loanapplication.html",controller:"LoanApplicationTabCtrl as tabCtrl"}}}).state("loanCenter.loan.loanApplication.personal",{url:"/personal",views:{"loanApplication":{templateUrl:"/angular/loanapplication/personal/personal.html",controller:"personalController as personal"}},resolve:{isVisible:function(){return{value:true};},controllerData:function(personalResolver,wrappedLoan){return personalResolver(wrappedLoan);}}}).state("loanCenter.loan.loanApplication.property",{url:"/property",views:{"loanApplication":{templateUrl:"/angular/loanapplication/property/property.html",controller:"propertyController as property"}}}).state("loanCenter.loan.loanApplication.assets",{url:"/assets",views:{"loanApplication":{templateUrl:"/angular/loanapplication/assets/assets.html",controller:"assetsController as assets"}}}).state("loanCenter.loan.loanApplication.credit",{url:"/credit",views:{"loanApplication":{templateUrl:"/angular/loanapplication/credit/credit.html",controller:"creditController as creditCtrl"}},resolve:{controllerData:function(creditResolver,CreditSvc,wrappedLoan){return creditResolver(CreditSvc);}},onEnter:function(wrappedLoan,CreditSvc){}}).state("loanCenter.loan.loanApplication.credit.details",{url:"/details",views:{"publicRecords":{templateUrl:"/angular/loanapplication/credit/publicrecords/publicrecords.html",controller:"publicRecordsController as publicRecords"},"liabilities":{templateUrl:"/angular/loanapplication/credit/liabilities/liabilities.html",controller:"liabilitiesController as liabilities"},"miscExpenses":{templateUrl:"/angular/loanapplication/credit/miscellaneousexpenses/miscexpenses.html",controller:"miscellaneousExpensesController as miscExpenses"},"realEstate":{templateUrl:"/angular/loanapplication/credit/realestate/realestate.html",controller:"realEstateController as realEstate"},"collections":{templateUrl:"/angular/loanapplication/credit/collections/collections.html",controller:"collectionsController as collections"},"runCredit":{templateUrl:"/angular/loanapplication/credit/creditrunbutton/creditrunbutton.html",controller:"runCreditController as runCredit"}},onExit:function($modalStack){$modalStack.dismissAll("cancel");}}).state("loanCenter.loan.loanApplication.declarations",{url:"/declarations",views:{"loanApplication":{templateUrl:"/angular/loanapplication/declarations/declarations.html",controller:"declarationsController as declarationsCtrl"}}}).state("loanCenter.loan.loanApplication.income",{url:"/income",views:{"loanApplication":{templateUrl:"/angular/loanapplication/income/income.html",controller:"incomeController as income"}},resolve:{controllerData:function(incomeResolver){return incomeResolver();}},onEnter:function(wrappedLoan,incomeService){incomeService.sortAdditionalEmploymentInfos(wrappedLoan.ref.active);}}).state("loanCenter.loan.loanDetails",{url:"/loanDetails",views:{"loanDetailsContainer":{templateUrl:"/angular/loandetails/maincontainer.html",controller:"loanDetailsController as loanDetails"}},params:{repricing:false},resolve:{controllerData:function(loanDetailsResolver,enums,$stateParams){return loanDetailsResolver(enums,$stateParams);}}}).state("loanCenter.loan.loanDetails.sections",{url:"/sections",views:{"housingExpensesChart":{templateUrl:"/angular/loandetails/sections/housingexpenses/housingexpensesbreakdownchart.html",controller:"housingExpensesController as housingExpenses"},"housingExpenses":{templateUrl:"/angular/loandetails/sections/housingexpenses/housingexpensesbreakdown.html",controller:"housingExpensesController as housingExpenses"},"sectionSeven":{templateUrl:"/angular/loandetails/sections/sectionseven/sectionseven.html",controller:"sectionSevenController as sectionSeven"},"sectionSevenBarChart":{templateUrl:"/angular/loandetails/sections/sectionseven/sectionsevenbarchart.html",controller:"sectionSevenController as sectionSeven"},"propertyInfo":{templateUrl:"/angular/loandetails/sections/propertyinfo/propertyinfo.html",controller:"propertyInfoController as propertyInfo"},"propertyDetails":{templateUrl:"/angular/loandetails/sections/propertyinfo/propertydetails.html",controller:"propertyInfoController as propertyInfo"},"propertyDetailGraph":{templateUrl:"/angular/loandetails/sections/propertyinfo/propertydetailgraph.html",controller:"propertyInfoController as propertyInfo"}}}).state("loanCenter.loan.pricing",{url:"/pricing",views:{"pricingContextual":{templateUrl:"/angular/contextualbar/productandpricing/contextualbarproductandpricing.html",controller:"ContextualBarProductAndPricingCtrl as pricingBarCtrl"},"pricing":{templateUrl:"/angular/pricingresults/pricingresults.html",controller:"pricingResultsController as pricingResults"},"contextualBar@":{templateUrl:"/angular/contextualbar/contextualbar.html",controller:"ContextualBarCtrl as contextualBarCtrl"}},params:{repricing:false},resolve:{controllerData:function(pricingResultsResolver,wrappedLoan,pricingResultsSvc,$stateParams){return pricingResultsResolver(wrappedLoan,pricingResultsSvc,$stateParams);}}}).state("loanCenter.loan.cost",{url:"/cost",views:{"contextualCostDetails":{templateUrl:"/angular/contextualbar/costdetails/contextualbarcostdetails.html",controller:"ContextualBarCostDetailsCtrl as conBarCtrl"},"costDetails":{templateUrl:"/angular/costdetails/_blank.html"},}}).state("loanCenter.loan.cost.details",{url:"/details",views:{"costDetails":{templateUrl:"/angular/costdetails/costdetails.html",controller:"CostDetailsCtrl as costDetailsCtrl"},},params:{redirectedFromLoanDetailsVaAlertModal:false},onEnter:function(){console.log("state = loanCenter.cost.details");}}).state("loanCenter.loan.cost.details.redirection",{views:{"redirection":{templateUrl:"/angular/integrations/closingcorp/redirection.html"}},params:{smartGFEId:null,apiKey:null,token:null,postUrl:null,customData:null},}).state("loanCenter.loan.cost.transactional",{url:"/transactionalDetails",views:{"costDetails":{templateUrl:"/angular/costdetails/transactionalsummary/transactionalsummary.html",controller:"CostDetailsCtrl as costDetailsCtrl"}}}).state("loanCenter.loan.messagecenter",{url:"/messagecenter",views:{"messagecenter":{templateUrl:"/angular/messagecenter/messagecenter.html",controller:"messagecenterController as messagecenterCtrl"}}}).state("loanCenter.loan.aus",{url:"/aus",views:{"aus":{templateUrl:"/angular/aus/aus.html",controller:"ausController as ausCtrl"}},params:{tab:null},resolve:{ausResolve:function(ausResolver,$stateParams,$state,ausSvc,wrappedLoan,enums){return ausResolver($stateParams,$state,ausSvc,wrappedLoan,enums);}}}).state("loanCenter.loan.aus.du",{url:"/du",views:{"ausDetails":{templateUrl:"/angular/aus/du/du.html",controller:"duController as duCtrl"}},resolve:{du:function(duResolver,ausResolve){return duResolver(ausResolve);}}}).state("loanCenter.loan.aus.lp",{url:"/lp",views:{"ausDetails":{templateUrl:"/angular/aus/lp/lp.html",controller:"lpController as lpCtrl"}},resolve:{lp:function(lpResolver,ausResolve){return lpResolver(ausResolve);}}}).state("loanCenter.loan.loanDelivery",{url:"/loanDelivery",views:{"loanDelivery":{templateUrl:"/angular/loanDelivery/loanDelivery.html",},"contextualBar@":{templateUrl:"/angular/loanDelivery/contextualbar.html",}},}).state("loanCenter.loan.appraisal",{url:"/appraisal",views:{"appraisal":{controller:"AppraisalController as appraisal"},"contextualBar@":{templateUrl:"/angular/contextualbar/contextualbar.html",controller:"ContextualBarCtrl as contextualBarCtrl"}},onEnter:["$rootScope",function($rootScope){Appraisal.OpenAppraisalFormAsMainCommand($rootScope.SelectedLoan.LoanId);}],onExit:function($rootScope){$rootScope.navigation="";}}).state("loanCenter.loan.refresh",{url:"/refresh",views:{"refresh":{template:'<div class="imp-loader-container">'+'<img src="../../../Content/ajax-loader.gif" alt="loader" class="imp-loader" />'+"</div>",controller:function($state,$stateParams){$state.go($stateParams.page,{"tab":$stateParams.tab});}}},params:{page:null,tab:null},});}).run(function($rootScope,$state){$rootScope.$on("$stateChangeError",function(event,toState,toParams,fromState,fromParams,error){console.log(error);});$rootScope.$on("$viewContentLoading",function(event,viewConfig){console.log("Contents loading.");});$rootScope.$on("$viewContentLoaded",function(event,viewConfig){console.log("Contents did load.");});});})();(function(){angular.module("loanCenter").provider("loanResolver",loanResolver);function loanResolver(){this.$get=function(){return resolver;};function resolver(loanService,$filter,$stateParams,HttpUIStatusService,BroadcastSvc,LoanCalculator,applicationData,commonModalWindowFactory,modalWindowType,$modalStack,$modal,digitaldocSvc,encompassSvc,NavigationSvc,costDetailsHelpers){console.log("loading loan: "+$stateParams.loanId?$stateParams.loanId:"(new)");return HttpUIStatusService.load("Loading Loan...",function(happyPath,unhappyPath){return loanService.loan().get({loanId:$stateParams.loanId,userAccountId:applicationData.currentUserId}).$promise.then(happyPath,unhappyPath);},function(loan){if(loan&&$stateParams.loanPurposeType){loan.loanPurposeType=$stateParams.loanPurposeType;}var wrappedLoan=new lib.referenceWrapper(new cls.LoanViewModel(loan,$filter,applicationData.currentUser.isWholesale));console.log("loan successfully created = "+($stateParams.loanId?$stateParams.loanId:"(new)"));if(!$stateParams.loanId||!loan.loanPurposeType){wrappedLoan.ref.isNewProspectSaved=false;populateDefaultValues($stateParams,wrappedLoan,applicationData);}$stateParams.loanId=wrappedLoan.ref.loanId;NavigationSvc.lastRepricing.timestamp=0;loanService.wrappedLoan=wrappedLoan;costDetailsHelpers.initializeCostService(wrappedLoan,applicationData);costDetailsHelpers.getCostDetailsData();BroadcastSvc.broadcastLoanChanged(wrappedLoan,applicationData);LoanCalculator.bindToCalculator(wrappedLoan,applicationData);if(!wrappedLoan.ref.controlStatus){wrappedLoan.ref.controlStatus={isAcquired:true,};}wrappedLoan.canSave=function(){return wrappedLoan.ref.controlStatus.isAcquired;};if(!wrappedLoan.ref.controlStatus.isAcquired){wrappedLoan.ref.controlStatus.lockAcquiredAtStr=new Date(wrappedLoan.ref.controlStatus.lockAcquiredAt).toLocaleTimeString("en-us");}return wrappedLoan;},function(error){console.log("loan load failure: "+$stateParams.loanId+" "+error);},$stateParams.loanId!=null);}function populateDefaultValues($stateParams,wrappedLoan,applicationData){wrappedLoan.ref.loanNumber="Pending";if($stateParams.loanPurposeType){wrappedLoan.ref.loanPurposeType=$stateParams.loanPurposeType;}else{if(!wrappedLoan.ref.loanPurposeType){wrappedLoan.ref.loanPurposeType=2;}}wrappedLoan.ref.status=2;wrappedLoan.ref.companyId=applicationData.companyProfile.companyProfileId;wrappedLoan.ref.channelId=applicationData.currentUser.channelId&&applicationData.currentUser.channelId!=-1?applicationData.currentUser.channelId:null;wrappedLoan.ref.isWholeSale=applicationData.currentUser.isWholesale;wrappedLoan.ref.divisionId=applicationData.currentUser.divisionId&&applicationData.currentUser.divisionId!=-1?applicationData.currentUser.divisionId:null;wrappedLoan.ref.branchId=applicationData.currentUser.branchId;if(!wrappedLoan.ref.currentMilestone){if(wrappedLoan.ref.isWholeSale){wrappedLoan.ref.currentMilestone=srv.milestoneStatus.unsubmitted;}else{wrappedLoan.ref.currentMilestone=srv.milestoneStatus.prospect;}}if(wrappedLoan.ref.loanPurposeType==srv.LoanPurposeTypeEnum.Purchase){wrappedLoan.ref.homeBuyingType=srv.HomeBuyingType.GetPreApproved;wrappedLoan.ref.getSubjectProperty().streetName="TBD";}if(applicationData.currentUser.isInRole("Concierge")||applicationData.currentUser.isInRole("Loan Officer")){wrappedLoan.ref.conciergeId=applicationData.currentUser.userAccountId;wrappedLoan.ref.conciergeFullName=applicationData.currentUser.fullName;wrappedLoan.ref.loaId=applicationData.currentUser.loaId;wrappedLoan.ref.callCenterId=applicationData.currentUser.loanProcessorId;wrappedLoan.ref.salesManagerId=applicationData.currentUser.salesManagerId;wrappedLoan.ref.teamLeaderId=applicationData.currentUser.teamLeaderId;}if(!wrappedLoan.ref.closingDate){wrappedLoan.ref.closingDate=new srv.cls.LoanDateViewModel();}wrappedLoan.ref.closingDate.dateValue=moment().add(30,"days").format("YYYY-MM-DDTHH:mm:ss");}}})();(function(){angular.module("loanCenter").service("loanService",["$resource","apiRoot","$filter","$http","$log",loanService]);function loanService($resource,apiRoot,$filter,$http,$log){var loanApiPath=apiRoot+"loan/";var loanExApiPath=apiRoot+"LoanEx/";var liablityServices=$resource(apiRoot+"LiabilityService/",{applyCommentLiability:{method:"POST",params:{debtViewModel:"debtViewModel",accountId:"accountId"}},applyCommentCollection:{method:"POST",params:{debtViewModel:"debtViewModel",userAccountId:"userAccountId"}},applyCommentPublicRecord:{method:"POST",params:{publicRecordViewModel:"publicRecordViewModel",userAccountId:"userAccountId"}},createLiabilityRecords:{method:"POST",params:{debtAccountOwnershipType:"debtAccountOwnershipType",borrowerId:"borrowerId",secondaryBorrowerId:"secondaryBorrowerId"}},convertLiabilityOwnership:{method:"POST",params:{debtVm:"debtVm"}},applyCommentReo:{method:"POST",params:{pledgedAssetVm:"pledgedAssetVm"}}});var newCreditServices=$resource(apiRoot+"MegaLoanService/",{reRunCreditReport:{method:"GET",params:{loanId:"loanId",userAccountId:"accountId",reRunCredit:"reRunCredit",borrowerId:"borrowerId"}}});var releasingServices=$resource(loanExApiPath,{},{releaseControlAndAcquireLock:{method:"GET",params:{loanId:"loanId",userAccountId:"userAccountId",lockOwnerId:"lockOwnerId"}}});var wrappedLoan={};var service={loan:loan,loanEx:loanEx,releaseControl:releaseControl,getActiveLoanApplication:getActiveLoanApplication,getPrimaryLoan:getPrimaryLoan,liablityServices:liablityServices,newCreditServices:newCreditServices,wrappedLoan:wrappedLoan,lazyLoad:lazyLoad,releasingServices:releasingServices};return service;function loan(){return $resource(loanApiPath);}function loanEx(){return $resource(loanExApiPath);}function releaseControl(userAccountId,loanId){loanEx().get({loanId:loanId,userAccountId:userAccountId}).$promise.then(function(o){console.log("releaseControl("+userAccountId+", "+loanId+") SUCCESS:"+o.lockOwnerUserName);},function(o){console.log("releaseControl("+userAccountId+", "+loanId+") FAIL:"+o.lockOwnerUserName);});}function lazyLoad(controller,loanId,userAccountId){var url=apiRoot+controller+"/";var httpGet=$http({url:url,method:"GET",params:{loanId:loanId,userAccountId:userAccountId}});return httpGet;}function getActiveLoanApplication(loan){return $filter("filter")(loan.getLoanApplications(),{loanApplicationId:loan.loanId},true)[0];}function getPrimaryLoan(loan){return $filter("filter")(loan.getLoanApplications(),{isPrimary:true},true)[0];}}})();(function(){angular.module("loanCenter").factory("BroadcastSvc",BroadcastSvc);BroadcastSvc.$inject=["$rootScope"];function BroadcastSvc($rootScope){var sharedService={};sharedService.message="";sharedService.prepForBroadcast=function(msg){this.message=msg;this.broadcastItem();};sharedService.broadcastItem=function(){$rootScope.$broadcast("REFRESH");};sharedService.broadcastCotextualBar=function(){$rootScope.$broadcast("REFRESHCotextualBar");};sharedService.broadcastCostDetailsLoaded=function(){$rootScope.$broadcast("CostDetailsLoaded");};sharedService.broadcastCostDetailsTotals=function(){$rootScope.$broadcast("CostDetailsTotalsUpdated");};sharedService.broadcastSelectedProduct=function(product){$rootScope.$broadcast("ProductSelected",product);};sharedService.broadcastChangedImpounds=function(data){$rootScope.$broadcast("ImpoundsChanged",data);};sharedService.broadcastQueueLoadRequest=function(data){$rootScope.$broadcast("QueueLoadRequest",data);};sharedService.broadcastQueueSizeChanged=function(data){$rootScope.$broadcast("QueueSizeChanged",data);};sharedService.broadcastLoanChanged=function(wrappedLoan,applicationData){$rootScope.$broadcast("LoanChanged",{wrappedLoan:wrappedLoan,applicationData:applicationData});};sharedService.broadcastRefreshGridColumns=function(){$rootScope.$broadcast("BroadcastRefreshGridColumns");};sharedService.broadcastRepopulatePricingResults=function(){$rootScope.$broadcast("BroadcastRepopulatePricingResults");};sharedService.broadcastUpdateSectionSeven=function(){$rootScope.$broadcast("UpdateSectionSeven");};sharedService.broadcastClearAllFilter=function(){$rootScope.$broadcast("BroadcastClearAllFilter");};sharedService.broadcastRefreshQueue=function(){$rootScope.$broadcast("BroadcastRefreshQueue");};sharedService.broadcastCostsRecalculated=function(){$rootScope.$broadcast("CostsRecalculated");};return sharedService;}})();(function(){angular.module("util").provider("applicationDataResolver",applicationDataResolver);function applicationDataResolver(){var applicationDataObject;var applicationDataSvc;var Enums;this.$get=function(){return resolver;};function resolver(applicationDataService,$stateParams,$rootScope,enums,userAccountId){applicationDataSvc=applicationDataService;if(applicationDataObject&&applicationDataObject.currentUserId){return applicationDataObject;}Enums=enums;applicationDataObject=applicationDataService.applicationData().get({userAccountId:userAccountId}).$promise.then(function(result){applicationDataObject=result;addMissingLookups(applicationDataObject);applicationDataObject.currentUserId=userAccountId;applicationDataObject.currentUser=new cls.UserAccountViewModel(applicationDataObject.currentUser);applicationDataObject.currentUser.isWholesale=isWholesaleUser(applicationDataObject);applicationDataService.applicationDataObject=applicationDataObject;applicationDataObject.lookup=new cls.LookupViewModel(applicationDataObject.lookup);return applicationDataObject;});return applicationDataObject;}function addMissingLookups(applicationData){applicationData.lookup.lienPosition=[new cls.LookupItem("First",1),new cls.LookupItem("Second",2),new cls.LookupItem("Third",3),new cls.LookupItem("Fourth",4),new cls.LookupItem("Fifth",5)];applicationData.lookup.propertyTaxPayPeriods=[new cls.LookupItem("Monthly",1),new cls.LookupItem("Annual",2)];applicationData.lookup.accountOptions=[new cls.LookupItem(Enums.lookupAccountOptions.jointWithBorrower,1),new cls.LookupItem(Enums.lookupAccountOptions.separateFromBorrower,2)];applicationData.lookup.additionalEmploymentTypes=getAdditionalEmploymentTypes(applicationData.lookup.employmentTypes);if(!applicationData.lookup.employmentStatuses||applicationData.lookup.employmentStatuses.length<=0){applicationData.lookup.employmentStatuses=[new cls.LookupItem("Current",1),new cls.LookupItem("Previous",2)];}return applicationData;}function getAdditionalEmploymentTypes(employmentTypes){if(!employmentTypes||employmentTypes.length<=0){return;}var list=angular.copy(employmentTypes);list.filter(function(e){return e.value==0||e.value==3||e.value==4;}).map(function(e){e.disabled=true;});return list;}function isWholesaleUser(applicationData){var channel=_.findWhere(applicationData.companyProfile.channels,{channelId:applicationData.currentUser.channelId});return channel?channel.isWholesale:false;}}})();angular.module("util",[]);(function(){angular.module("util").service("applicationDataService",["$resource","apiRoot","$filter","$http",applicationDataService]);function applicationDataService($resource,apiRoot,$filter,$http){var appDataApiPath=apiRoot+"applicationdata/";var guidPath=apiRoot+"IdentityGeneratorService/GetGuids?count=";var applicationDataObject={};var service={applicationData:applicationData,getUserAccountId:getUserAccountId,applicationDataObject:applicationDataObject,getGuids:getGuids,getUserAccount:getUserAccount};return service;function applicationData(){return $resource(appDataApiPath);}function getGuids(count){return $http.get(guidPath+count);}function getUserAccountId(){return $http.get("/UserAccount/GetUserAccountId");}function getUserAccount(userAccountId){return $http.get(apiRoot+"user/GetUserAccountById",{params:{userAccountId:userAccountId}});}}})();var appData;(function(appData){var ApplicationDataService2=(function(){function ApplicationDataService2($q,applicationDataResolver,applicationDataService,enums,$log){var _this=this;this.$q=$q;this.applicationDataResolver=applicationDataResolver;this.applicationDataService=applicationDataService;this.enums=enums;this.$log=$log;this.getApplicationData=function(){var deferred=_this.$q.defer();var self=_this;_this.applicationDataService.getUserAccountId().then(function(result){var userAccountId=parseInt(result.data);deferred.resolve(self.applicationDataResolver(self.applicationDataService,null,null,self.enums,userAccountId));},function(error){this.$log.error("Failure loading UserAccountId",error);return deferred.reject;});return deferred.promise;};}ApplicationDataService2.$inject=["$q","applicationDataResolver","applicationDataService","enums","$log"];return ApplicationDataService2;})();angular.module("util").service("applicationDataService2",ApplicationDataService2);})(appData||(appData={}));(function(){angular.module("util").provider("userAccountIdResolver",userAccountIdResolver);function userAccountIdResolver(){var userAccountId;this.$get=function(){return resolver;};function resolver(applicationDataService){if(userAccountId){return userAccountId;}userAccountId=applicationDataService.getUserAccountId().then(function(result){var id=parseInt(result.data);return id;},function(error){$log.error("Failure loading UserAccountId",error);});return userAccountId;}}})();(function(){angular.module("loanApplication",["generated.services"]);})();(function(){angular.module("loanApplication").provider("incomeResolver",incomeResolver);function incomeResolver(){this.$get=function(){return resolver;};function resolver(){var service={isExpanded:{borrower:true,coBorrower:true},showErrorContainer:false,showLoader:false,disableFields:false};return service;}}})();(function(){angular.module("loanApplication").provider("personalResolver",personalResolver);function personalResolver(){this.$get=function(){return resolver;};function resolver(wrappedLoan){var service={isEmailFieldDisabled:{borrower:wrappedLoan.ref.active&&wrappedLoan.ref.active.getBorrower().userAccount.username&&wrappedLoan.ref.active.getBorrower().userAccount.isOnlineUser&&wrappedLoan.ref.active.getBorrower().userAccount.username.trim()!=="",coBorrower:wrappedLoan.ref.active&&wrappedLoan.ref.active.isSpouseOnTheLoan&&wrappedLoan.ref.active&&wrappedLoan.ref.active.getCoBorrower().userAccount.username&&wrappedLoan.ref.active.getCoBorrower().userAccount.isOnlineUser&&wrappedLoan.ref.active.getCoBorrower().userAccount.username.trim()!==""},flags:{showEmailDisclaimerSameAsBorrower:function(){return wrappedLoan.ref.active&&wrappedLoan.ref.active.getBorrower().userAccount.username&&wrappedLoan.ref.active.getCoBorrower().userAccount.username&&wrappedLoan.ref.active.getBorrower().username!=""&&wrappedLoan.ref.active.getCoBorrower().userAccount.username!=""&&wrappedLoan.ref.active.getCoBorrower().userAccount.username==wrappedLoan.ref.active.getBorrower().userAccount.username;},showEmailDisclaimerDifferentThanBorrower:function(){return wrappedLoan.ref.active&&wrappedLoan.ref.active.getBorrower().userAccount.username&&wrappedLoan.ref.active.getCoBorrower().userAccount.username&&wrappedLoan.ref.active.getCoBorrower().username!=""&&wrappedLoan.ref.active.getCoBorrower().userAccount.username!=wrappedLoan.ref.active.getBorrower().userAccount.username;}}};return service;}}})();(function(){angular.module("loanApplication").provider("creditResolver",creditResolver);function creditResolver(){this.$get=function(){return resolver;};function resolver(creditService){var creditService=creditService;var services={common:{disableFields:false},liabilities:{flags:{isDisableFields:false,isCollapsed:false}},isCollapsed:{liabilities:false,realEstate:false,collections:false,miscExpenses:false,publicRecords:false}};return services;}}})();(function(){angular.module("stipsandconditionsOld",[]);angular.module("stipsandconditionsOld").controller("LoanCenterConditionsController",function($scope,$compile,$http,$modal,$filter){$scope.ConditionsMainViewModel=[];$scope.refresh=function(loanId,refreshNeeded){if(conditionsLoaded&&refreshNeeded!=true){$("#loanDetailsSubTabProgressBar").hide();$("#conditionsSubSection").show();}else{$.getJSON("Conditions/GetConditionsData?loanid="+loanId,function(data){if(data.success!=false){$scope.getData(data,true);}else{$scope.openErrorPopup(data.message);}if(refreshNeeded===true){setTimeout(function(){HideProcessingInfo();},300);return;}$("#conditionsSubSection").html($compile($("#conditionsSubSection").html())($scope));conditionsLoaded=true;if($("#ConditionsMenuLi").hasClass("ui-tabs-selected")){setTimeout(function(){$("#loanDetailsSubTabProgressBar").hide();$("#conditionsSubSection").show();},300);}});}};$scope.SetConditionSorting=function(categoryName,borrower){var index="";if(categoryName=="Assets"){index="3";}if(categoryName=="Collateral"){index=borrower?"5":"4";}if(categoryName=="Credit"){index=borrower?"1":"5";}if(categoryName=="Identity"){index=borrower?"4":"6";}if(categoryName=="Income"){index=borrower?"2":"7";}if(categoryName=="Escrow"){index=borrower?"6":"2";}if(categoryName=="Property"){index=borrower?"7":"1";}return index+categoryName;};$scope.getData=function(data,checkIsOpen){$scope.ConditionsMainViewModel=data;$scope.groupedConditions=_.groupByMulti($scope.ConditionsMainViewModel.ConditionsSub.Conditions,["OwnerNames","CategoryDescription"]);$scope.groupedDocuments=_.groupBy($scope.ConditionsMainViewModel.ConditionsDocuments,"CategorySortName");$scope.lockHistoryPopup='<div><table> <thead><th><tr><td class="condition-lock-history-td boldText">Locked On</td><td class="condition-lock-history-td boldText">Period</td><td class="condition-lock-history-td boldText">Expires On</td><td class="condition-lock-history-td boldText">Locked By</td></tr></th><thead><tbody>';angular.forEach(data.LoanSummary.LoanLockHistoryData,function(history){$scope.lockHistoryPopup+='<tr><td class="condition-lock-history-td">'+history.LockedOn+'</td><td class="condition-lock-history-td">'+history.Period+' Days</td><td class="condition-lock-history-td">'+history.ExpiresOn+'</td><td class="condition-lock-history-td">'+history.ModifyBy+"</td></tr>";});$scope.lockHistoryPopup+="</tbody></table></div>";if(checkIsOpen==true){$scope.expandCategoriesAndItems($scope.groupedConditions);$scope.ConditionsDueFilterId="";}$scope.InitializeDeliveryVault();$scope.$apply();};$scope.previous={};$scope.previous.item={};$scope.getNotesIcon=function(notes){if(notes==null||notes.length==0){return"blank";}var readCount=0;var addNoteToFileCount=0;angular.forEach(notes,function(note){if(!note.MarkAsUnread){readCount++;}if(note.AddNoteToFile){addNoteToFileCount++;}});if(addNoteToFileCount>0&&readCount==notes.length){return"attached";}if(readCount==notes.length){return"read";}return"unread";};$scope.deleteConditionDisabled=function(condition){var ausSource=["DU","LP","GUS"];var conditionSourceCode=condition!=null&&condition.ConditionSource!=null&&condition.ConditionSource.Code!=null?condition.ConditionSource.Code:"";var decisionStatusApproved=($scope.ConditionsMainViewModel!=null&&$scope.ConditionsMainViewModel.LoanSummary!=null&&$scope.ConditionsMainViewModel.LoanSummary.DecisionStatus!=null&&$scope.ConditionsMainViewModel.LoanSummary.DecisionStatus=="48");return _.contains(ausSource,conditionSourceCode)||decisionStatusApproved;};$scope.docVaultCategoryVisible=function(categoryName){categoryName=categoryName.replace("01","").replace("02","").replace("03","");return categoryName==null?false:categoryName.toLowerCase()=="unclassified"||categoryName.toLowerCase()=="unassigned";};$scope.docVaultIsUnclassifiedCategory=function(categoryName){categoryName=categoryName.replace("01","").replace("02","").replace("03","");return categoryName==null?false:categoryName.toLowerCase()=="unclassified";};$scope.iconColors={active:"#1fb25a",expired:"#E73302",add:"#208DDC",del:"#DD3131",disabled:"#797979"};$scope.getIconColor=function(number){if(number>=0){return $scope.iconColors.active;}else{return $scope.iconColors.expired;}};$scope.conditionDueFilters=[{code:"",selectedcode:""},{code:"PriorToApproval",selectedcode:"PriorToApproval"},{code:"PriorToApproval",selectedcode:"PriorToDocuments"},{code:"PriorToDocuments",selectedcode:"PriorToDocuments"},{code:"PriorToApproval",selectedcode:"PriorToFunding"},{code:"PriorToDocuments",selectedcode:"PriorToFunding"},{code:"PriorToFunding",selectedcode:"PriorToFunding"},{code:"AfterFunding",selectedcode:"AfterFunding"}];$scope.conditionsDueFilter=function(condition,filterId){if(filterId==null||filterId==""){return true;}var visible=false;angular.forEach($scope.conditionDueFilters,function(itemValue,itemKey){if(itemValue.selectedcode==filterId&&(condition.Due==null||itemValue.code==condition.Due.Code)){visible=true;return false;}});return visible;};$scope.isDescriptionTextExpired=function(number){if(number>0){return false;}else{return true;}};$scope.isDateTextExpired=function(number){if(number>=0){return false;}else{return true;}};$scope.isOwnerOccupied=function(isOwnerOccupied){return isOwnerOccupied?"- Owner Occupied":"- Non-Owner Occupied";};$scope.showCount=function(categoryGroups){var show=false;angular.forEach(categoryGroups,function(condition){if(!condition.IsRemoved){show=true;}});return show;};$scope.getCategoryOpenItemsCount=function(categoryGroups){var count=0;angular.forEach(categoryGroups,function(condition){count+=$scope.getConditionOpenItemsCount(condition);});return count;};$scope.getCategoryReadyForReviewItemsCount=function(categoryGroups){var count=0;angular.forEach(categoryGroups,function(condition){count+=$scope.getConditionReadyForReviewItemsCount(condition);});return count;};$scope.getConditionOpenItemsCount=function(condition){var count=0;angular.forEach(condition.CurativeItems,function(item){if(item.Status.Code!="Waived"&&item.Status.Code!="Cleared"&&item.IsRemoved!=true){count+=1;}});condition.OpenitemsCount=count;return count;};$scope.getConditionReadyForReviewItemsCount=function(condition){var count=0;angular.forEach(condition.CurativeItems,function(item){if(item.Status.Code=="ReadyToReview"&&item.IsRemoved!=true){count+=1;}});condition.ReadyForReviewItemsCount=count;return count;};$scope.addNewCondition=function(){var newCondition=$modal.open({templateUrl:"angular/stipsandconditions2.0/addnewcondition.html",controller:NewConditionCtrl,backdrop:"static",resolve:{ConditionsSub:function(){return $scope.ConditionsMainViewModel.ConditionsSub;},NewCondition:function(){return $scope.ConditionsMainViewModel.ConditionsSub.NewCondition;}}});newCondition.result.then(function(NewConditionViewModel){var newConditionItem=$modal.open({templateUrl:"angular/stipsandconditions2.0/addnewconditionitem.html",controller:NewConditionItemCtrl,backdrop:"static",resolve:{NewConditionViewModel:function(){return NewConditionViewModel;},ConditionsSub:function(){return $scope.ConditionsMainViewModel.ConditionsSub;},DocumentsList:function(){return $scope.ConditionsMainViewModel.ConditionsDocuments;}}});newConditionItem.result.then(function(NewConditionViewModel){$scope.AddNewConditionToList(NewConditionViewModel);});});};$scope.addNewCurativeItem=function(condition){condition.CurativeItems.push({Description:null,Document:null,For:null,Item:null,Status:$scope.ConditionsMainViewModel.ConditionsSub.NewCondition.CurativeItems[0].Status,UpdatedBy:$scope.ConditionsMainViewModel.ConditionsSub.NewCondition.CurativeItems[0].UpdatedBy,UpdatedDate:new Date()});var newConditionItem=$modal.open({templateUrl:"angular/stipsandconditions2.0/addnewconditionitem.html",controller:NewConditionItemCtrl,backdrop:"static",resolve:{NewConditionViewModel:function(){return condition;},ConditionsSub:function(){return $scope.ConditionsMainViewModel.ConditionsSub;},DocumentsList:function(){return $scope.ConditionsMainViewModel.ConditionsDocuments;}}});newConditionItem.result.then(function(NewConditionViewModel){var items=angular.copy(NewConditionViewModel.CurativeItems);var newCondition=angular.copy(NewConditionViewModel);newCondition.CurativeItems=[];newCondition.NewCondition=true;var i=NewConditionViewModel.CurativeItems.length;while(i--){if(!NewConditionViewModel.CurativeItems[i].PreviouslyAdded){NewConditionViewModel.CurativeItems.splice(i,1);}}angular.forEach($scope.ConditionsMainViewModel.ConditionsSub.ForList,function(assigned){angular.forEach(items,function(item){if(item.PreviouslyAdded){return true;}if(item.For.Value==assigned.Value){item.PreviouslyAdded=true;if(assigned.SectionName!=NewConditionViewModel.OwnerNames){var alreadyExists=false;angular.forEach($scope.ConditionsMainViewModel.ConditionsSub.Conditions,function(existingCondition){if(!existingCondition.IsRemoved&&existingCondition.OwnerNames==assigned.SectionName&&existingCondition.ConfigurationCode.Code==NewConditionViewModel.ConfigurationCode.Code&&existingCondition.AssignedTo.RoleId==NewConditionViewModel.AssignedTo.RoleId&&existingCondition.Due.Code==NewConditionViewModel.Due.Code&&existingCondition.SignOff.RoleId==NewConditionViewModel.SignOff.RoleId){alreadyExists=true;existingCondition.CurativeItems.push(item);}});if(alreadyExists==false){newCondition.OwnerNames=assigned.SectionName;newCondition.CurativeItems.push(item);}}else{NewConditionViewModel.CurativeItems.push(item);}}});if(newCondition.CurativeItems.length>0){newCondition.CategoryDescription=$scope.SetConditionSorting(newCondition.CategoryDescription.substr(1,newCondition.CategoryDescription.length),newCondition.OwnerNames!="");$scope.ConditionsMainViewModel.ConditionsSub.Conditions.push(angular.copy(newCondition));newCondition.CurativeItems=[];}});$scope.groupedConditions=_.groupByMulti($scope.ConditionsMainViewModel.ConditionsSub.Conditions,["OwnerNames","CategoryDescription"]);$scope.UpdateUnassignedDocList();});};$scope.AddNewConditionToList=function(NewConditionViewModel){angular.forEach($scope.ConditionsMainViewModel.ConditionsSub.CategoryList,function(category){if(category.EnumerationValueId==NewConditionViewModel.ConfigurationCode.CategoryCdId){NewConditionViewModel.CategoryDescription=category.Description;NewConditionViewModel.CategorId=category.EnumerationValueId;}});var childConditions=[];angular.forEach($scope.ConditionsMainViewModel.ConditionsSub.ForList,function(assigned){var newCondition=angular.copy(NewConditionViewModel);newCondition.CurativeItems=[];newCondition.OwnerNames=assigned.SectionName;angular.forEach(NewConditionViewModel.CurativeItems,function(item){if(item.For.Value==assigned.Value){item.PreviouslyAdded=true;newCondition.CurativeItems.push(item);}});if(newCondition.CurativeItems.length>0){var conditionAlreadyExists=false;angular.forEach(childConditions,function(condition){if(condition.OwnerNames==newCondition.OwnerNames){angular.forEach(newCondition.CurativeItems,function(item){condition.CurativeItems.push(item);});conditionAlreadyExists=true;return false;}});if(conditionAlreadyExists==false){newCondition.CategoryDescription=$scope.SetConditionSorting(newCondition.CategoryDescription,newCondition.OwnerNames!="");childConditions.push(newCondition);}}});angular.forEach(childConditions,function(condition){$scope.ConditionsMainViewModel.ConditionsSub.Conditions.push(condition);});$scope.groupedConditions=_.groupByMulti($scope.ConditionsMainViewModel.ConditionsSub.Conditions,["OwnerNames","CategoryDescription"]);$scope.UpdateUnassignedDocList();};$scope.UpdateUnassignedDocList=function(){var listOfAssignedDocuments=[];angular.forEach($scope.ConditionsMainViewModel.ConditionsSub.Conditions,function(condition){if(condition.IsRemoved){return;}angular.forEach(condition.CurativeItems,function(curativeItem){if(!curativeItem.IsRemoved&&curativeItem.Document!=null&&curativeItem.Document.RepositoryId!=null&&curativeItem.Document.RepositoryId!=""){listOfAssignedDocuments.push(curativeItem.Document.RepositoryId);}});});angular.forEach($scope.ConditionsMainViewModel.ConditionsDocuments,function(document){if(document.Category.toLowerCase()=="unclassified"||document.Category.toLowerCase()=="rejected"){return;}if(listOfAssignedDocuments.indexOf(document.RepositoryId)>=0){document.Category=document.OriginalCategory;document.CategorySortName=document.OriginalCategory;}else{document.Category="UNASSIGNED";document.CategorySortName="02UNASSIGNED";}});$scope.groupedDocuments=_.groupBy($scope.ConditionsMainViewModel.ConditionsDocuments,"CategorySortName");$scope.InitializeDeliveryVault();};$scope.conditionRemoved=function(condition){condition.IsRemoved=true;$scope.UpdateUnassignedDocList();};$scope.curativeItemRemoved=function(item,condition){item.IsRemoved=true;var removeCondition=true;angular.forEach(condition.CurativeItems,function(item){if(!item.IsRemoved){removeCondition=false;}});if(removeCondition){condition.IsRemoved=true;}$scope.UpdateUnassignedDocList();};$scope.openCommentHistoryPopUp=function(condition){$.getJSON("Conditions/GetConditionHistoryItems?conditionId="+condition.ConditionId,function(data){$modal.open({templateUrl:"angular/stipsandconditions2.0/conditioncommenthistory.html",controller:ConditionCommentHistoryCtrl,backdrop:"static",resolve:{Code:function(){return condition.ConfigurationCode.Code;},ConditionCommentHistoryViewModel:function(){return data;},Description:function(){return condition.ConfigurationCode.Title;}}});});};$scope.openItemHistoryPopUp=function(item){$.getJSON("Conditions/GetItemHistory?itemId="+item.CurativeItemId,function(data){$modal.open({templateUrl:"angular/stipsandconditions2.0/itemhistory.html",controller:ItemHistoryCtrl,backdrop:"static",resolve:{ItemHistoryViewModel:function(){return data;},Description:function(){return item.Item.Code+" "+(item.Description==null?"":item.Description);}}});});};$scope.openDecisionHistoryPopup=function(loanId){$.getJSON("Conditions/GetDecisionStatusHistory?loanid="+loanId,function(data){$modal.open({templateUrl:"angular/stipsandconditions2.0/decisionhistory.html",controller:DecisionHistoryCtrl,backdrop:"static",resolve:{DecisionHistoryViewModel:function(){return data;}}});});};$scope.openAddItemNotePopUp=function(notes,description,currentUser,isConditionSignedOff){var itemNotes=$modal.open({templateUrl:"angular/stipsandconditions2.0/additemnote.html",controller:ConditionItemNotesCtrl,backdrop:"static",resolve:{CurativeItemNotesViewModel:function(){return{Notes:[],CurrentNotes:notes,Description:description,CurrentUser:currentUser,SignedOff:isConditionSignedOff};}}});itemNotes.result.then(function(CurativeItemNotesViewModel){angular.copy(CurativeItemNotesViewModel.Notes,notes);});};$scope.openErrorPopup=function(message){var modalInstance=$modal.open({templateUrl:"angular/stipsandconditions2.0/errorpopup.html",controller:ErrorPopupCtrl,backdrop:"static",size:"sm",resolve:{message:function(){return message;}}});};$scope.openDocumentClassificationPopup=function(document){var modalInstance=$modal.open({templateUrl:"angular/stipsandconditions2.0/documentClassificationPopup.html",controller:DocumentClassificationCtrl,size:"sm",backdrop:"static",resolve:{Document:function(){return document;},DocumentTypes:function(){return $scope.ConditionsMainViewModel.ConditionsSub.ItemsList;},BorrowerNames:function(){var result=[];$scope.ConditionsMainViewModel.ConditionsSub.ForList.forEach(function(item){if(item.Section=="Borrowers"){result.push(item.Value);}});return result;}}});};$scope.InitializeDeliveryVault=function(){var deliveryVaultExcludedCategories=["UNCLASSIFIED","UNASSIGNED","REJECTED"];var groupedByCategory=_.groupBy($scope.ConditionsMainViewModel.ConditionsDocuments,"Category");$scope.deliveryVaultDocuments=_.omit(groupedByCategory,deliveryVaultExcludedCategories);$scope.documentDownloadLink=function(repositoryId){if(repositoryId==null||repositoryId==""){return"";}var encodedRepositoryId=encodeURIComponent(repositoryId);var url="/Downloader.axd?documentType=repositoryItem&repositoryItemId="+encodedRepositoryId;return url;};var sortingOrder=$scope.ConditionsMainViewModel.DeliveryVault.DeliveryVaultStackingOrder.StackingOrder;var allDocCategories=Object.keys($scope.deliveryVaultDocuments);allDocCategories=_.sortBy(allDocCategories,function(item){return item;});allDocCategories.forEach(function(key){if(sortingOrder.indexOf(key)==-1){sortingOrder.push(key);$scope.ConditionsMainViewModel.DeliveryVault.StackingOrderChanged=true;}});var newlist=new Object();var i=0;if(sortingOrder){sortingOrder.forEach(function(key){if($scope.deliveryVaultDocuments[key]==null||$scope.deliveryVaultDocuments[key]==undefined){return;}var prefix="";if(i<10){prefix="0"+i;}else{prefix=i.toString();}var newKey=prefix+"-"+key;newlist[newKey]=$scope.deliveryVaultDocuments[key];newlist[newKey]=_.sortBy(newlist[newKey],"SortOrder");newlist[newKey].SortOrder=i;newlist[newKey].CategoryName=key;i++;});}$scope.deliveryVaultDocuments=newlist;};$scope.syncOrder=function(elemPositions){$scope.ConditionsMainViewModel.DeliveryVault.StackingOrderChanged=true;elemPositions.forEach(function(elemId,index){if(elemId.indexOf("divDeliveryVaultCategorySortable")!=-1){var id=elemId.replace(/divDeliveryVaultCategorySortable/,"");var obj=$scope.deliveryVaultDocuments[id];if(obj!=undefined){obj.SortOrder=index;}}else{var id=elemId.replace(/divDeliveryVaultDocumentsSortable/,"");$scope.ConditionsMainViewModel.ConditionsDocuments.forEach(function(obj){if(id===obj.DocumentId){obj.SortOrder=index;}});}});};$scope.conditions_save=function(){ShowProcessingInfo();$.ajax({url:"Conditions/Save",data:JSON.stringify($scope.ConditionsMainViewModel),type:"POST",contentType:"application/json; charset=utf-8",success:function(result){if(result.success==false){HideProcessingInfo();$scope.openErrorPopup("An error occurred while saving data. Please try again.");return;}$scope.getData(result,false);HideProcessingInfo();if(result.Error==true){$scope.openErrorPopup("An error occurred while saving data. Please try again.");}},error:function(e){HideProcessingInfo();$scope.openErrorPopup("An error occurred while saving data. Please try again.");}});};$scope.conditions_cancel=function(){ShowProcessingInfo();$scope.refresh($scope.ConditionsMainViewModel.LoanId,true);};$scope.deliveryVault_SaveStackingOrder=function(){ShowProcessingInfo();var keys=Object.keys($scope.deliveryVaultDocuments);var sortingOrder=[];var sortingOrderDocument=[];keys.forEach(function(key){var currentCategory=$scope.deliveryVaultDocuments[key];sortingOrder[currentCategory.SortOrder]=currentCategory.CategoryName;var categoryKey=currentCategory.CategoryName;currentCategory=_.sortBy(currentCategory,"SortOrder");var docStackOrder={CategoryName:categoryKey,StackingOrder:[]};currentCategory.forEach(function(doc){docStackOrder.StackingOrder.push(doc.DocumentId.toString());});sortingOrderDocument.push(docStackOrder);});$scope.ConditionsMainViewModel.DeliveryVault.DeliveryVaultStackingOrder.StackingOrder=sortingOrder;$scope.ConditionsMainViewModel.DeliveryVault.DeliveryVaultStackingOrder.DeliveryVaultDocumentsStackingOrder=sortingOrderDocument;$http({method:"post",url:"Conditions/DeliveryVault_SaveStackingOrder",data:$scope.ConditionsMainViewModel.DeliveryVault.DeliveryVaultStackingOrder}).success(function(data){if(data.success==false){HideProcessingInfo();$scope.openErrorPopup("An error occurred while saving stacking order. Please try again.");return;}$scope.ConditionsMainViewModel.DeliveryVault.StackingOrderChanged=false;HideProcessingInfo();}).error(function(){HideProcessingInfo();$scope.openErrorPopup("An error occurred while saving stacking order. Please try again.");});};$scope.showSignOffPopUp=function(condition,conditionItem,previousItem){var signOffPopUp=$modal.open({templateUrl:"angular/stipsandconditions2.0/signOffConditionPopUp.html",controller:SignOffPopUpCtrl,backdrop:"static",resolve:{Code:function(){return condition!=null&&condition.ConfigurationCode!=null&&condition.ConfigurationCode.Code!=null?condition.ConfigurationCode.Code:null;},Condition:function(){return condition;},ConditionItem:function(){return conditionItem;},PreviousItem:function(){return previousItem;},ConditionsMainViewModelParam:function(){return $scope.ConditionsMainViewModel;}}});signOffPopUp.result.then(function(signedOffcondition){condition=signedOffcondition;});};$scope.disableStatusesForRoles=function(condition,item){var shouldBreak=false;if(item.Status.Code=="Cleared"||item.Status.Code=="Waived"){angular.forEach($scope.ConditionsMainViewModel.CurrentUserRoles,function(role){if(!shouldBreak){if(role.RoleId==condition.AssignedTo.RoleId){var resolve={curativeItem:function(){return item;},previousItem:function(){return $scope.previous.item;},condition:function(){return condition;},};var popup=$scope.showPopup(disableStatusController,"angular/stipsandconditions2.0/errorpopup.html",resolve);popup.result.then(function(revertedCondition){condition=revertedCondition;});shouldBreak=true;return;}}});}return shouldBreak;};$scope.showPopup=function(controller,templateUrl,resolve){var popup=$modal.open({templateUrl:templateUrl,controller:controller,backdrop:"static",resolve:resolve});return popup;};$scope.conditionItemStatusChanged=function(condition,conditionItem){if(conditionItem==null){return;}if($scope.disableStatusesForRoles(condition,conditionItem)){return;}if($scope.ConditionsMainViewModel!=null&&$scope.ConditionsMainViewModel.CurrentUser!=null&&$scope.ConditionsMainViewModel.CurrentUser.UserName!=null){conditionItem.UpdatedBy=$scope.ConditionsMainViewModel.CurrentUser;}else{}conditionItem.UpdatedDate=new Date();if($scope.ConditionsMainViewModel==null||$scope.ConditionsMainViewModel.Privileges==null||$scope.ConditionsMainViewModel.Privileges.Delete==null||$scope.ConditionsMainViewModel.Privileges.Delete==false){return;}var curativeItems=condition!=null&&condition.CurativeItems!=null?condition.CurativeItems:null;if(curativeItems==null||curativeItems.length==0){return;}for(var i=0;i<curativeItems.length;i++){if(curativeItems[i]==null||curativeItems[i].Status==null||curativeItems[i].Status.Code==null||(curativeItems[i].Status.Code!="Waived"&&curativeItems[i].Status.Code!="Cleared")){return;}}$scope.showSignOffPopUp(condition,conditionItem,$scope.previous.item);};$scope.expandCategoriesAndItems=function(groupedConditions){if(groupedConditions!=null){angular.forEach(groupedConditions,function(categoryGroups,key){angular.forEach(categoryGroups,function(category){var isVisible=$filter("getByProperty")("CurativeItemsVisible",true,category)!=null;if(isVisible&&category!=null){category.DetailsVisible=true;angular.forEach(category,function(value,key){if(category[key].Status.Code=="PastDue"){category[key].CurativeItemsVisible=true;}});}});});}},$scope.CategoryGroupsExpand=function(categoryGroups){var isVisible=false;if(categoryGroups!=null){angular.forEach(categoryGroups,function(value,key){if(categoryGroups[key].CurativeItems!=null&&categoryGroups[key].CurativeItems[0].Status!=null&&categoryGroups[key].CurativeItems[0].Status.Code=="PastDue"){isVisible=true;categoryGroups[key].CurativeItemsVisible=true;}else{categoryGroups[key].CurativeItemsVisible=false;}});if(!isVisible){categoryGroups.DetailsVisible=!categoryGroups.DetailsVisible;}else{categoryGroups.DetailsVisible=true;}}},$scope.ConditionExpand=function(condition){var isVisible=condition.CurativeItems!=null&&condition.CurativeItems[0].Status!=null&&condition.CurativeItems[0].Status.Code==="PastDue";if(isVisible===true){condition.CurativeItemsVisible=true;}else{condition.CurativeItemsVisible=!condition.CurativeItemsVisible;}};});var NewConditionCtrl=function($scope,$modalInstance,ConditionsSub,NewCondition){$scope.NewConditionViewModel=angular.copy(NewCondition);$scope.AssignedToList=ConditionsSub.AssignedToList;$scope.SignedOffList=ConditionsSub.SignedOffList;$scope.CodesList=ConditionsSub.CodesList;$scope.DueList=ConditionsSub.DueList;$scope.CategoryList=ConditionsSub.CategoryList;$scope.conditions_addnewcondition_addItem=function(){$modalInstance.close($scope.NewConditionViewModel);};$scope.conditions_addnewcondition_cancel=function(){$modalInstance.dismiss("cancel");};$scope.configurationcodechanged=function(code){$scope.NewConditionViewModel.ConfigurationCode=code;angular.forEach($scope.AssignedToList,function(assignedTo){if(assignedTo.RoleId==code.CurativeRoleCdId){$scope.NewConditionViewModel.AssignedTo=assignedTo;return false;}});angular.forEach($scope.DueList,function(due){if(due.EnumerationValueId==code.GateCdId){$scope.NewConditionViewModel.Due=due;return false;}});$scope.NewConditionViewModel.InternalOnly=code.ExternallyVisible;};};var NewConditionItemCtrl=function($scope,$modalInstance,NewConditionViewModel,ConditionsSub,DocumentsList){$scope.NewConditionViewModel=NewConditionViewModel;$scope.ItemsList=ConditionsSub.ItemsList;$scope.ForList=ConditionsSub.ForList;$scope.DocumentList=DocumentsList;$scope.Status=ConditionsSub.NewCondition.CurativeItems[0].Status;$scope.UpdatedBy=ConditionsSub.NewCondition.CurativeItems[0].UpdatedBy;$scope.UpdatedDate=new Date();$scope.search=[];$scope.docTypeFilter=function(item){var show=false;angular.forEach($scope.NewConditionViewModel.ConfigurationCode.ItemConfigurations,function(itemConfiguration){if(itemConfiguration.DocTypeId==item.EnumerationValueId){show=true;}});return show;};var selectedCategory=$scope.NewConditionViewModel.ConfigurationCode.CategoryCdId;$scope.IsPropertyCondition=false;angular.forEach(ConditionsSub.PropertyConditionList,function(propertyItem){if(propertyItem==selectedCategory){$scope.IsPropertyCondition=true;}});$scope.filterForMenu=function(item){if(($scope.IsPropertyCondition&&item.Section=="Property")||(!$scope.IsPropertyCondition&&item.Section!="Property")){return true;}else{return false;}};$scope.conditions_addnewconditionitem_save=function(){$modalInstance.close($scope.NewConditionViewModel);};$scope.conditions_addnewconditionitem_cancel=function(){angular.forEach(NewConditionViewModel.CurativeItems,function(item){if(item.PreviouslyAdded){return true;}else{item.IsRemoved=true;}});$modalInstance.dismiss("cancel");};$scope.conditions_addnewconditionitem_addNewItem=function(){$scope.NewConditionViewModel.CurativeItems.push({Description:null,Document:null,For:null,Item:null,Status:$scope.Status,UpdatedBy:$scope.UpdatedBy,UpdatedDate:new Date()});};};var ConditionCommentHistoryCtrl=function($scope,$modalInstance,ConditionCommentHistoryViewModel,Description,Code){$scope.ConditionCommentHistoryViewModel=ConditionCommentHistoryViewModel;$scope.Code=Code;$scope.Description=Description;$scope.ok=function(){$modalInstance.dismiss("cancel");};};var ErrorPopupCtrl=function($scope,$modalInstance,message){$scope.message=message;$scope.header="Error";$scope.ok=function(){$modalInstance.dismiss("cancel");};};var ItemHistoryCtrl=function($scope,$modalInstance,ItemHistoryViewModel,Description){$scope.ItemHistoryViewModel=ItemHistoryViewModel;$scope.Description=Description;$scope.ok=function(){$modalInstance.dismiss("cancel");};};var SignOffPopUpCtrl=function($scope,$modal,$modalInstance,Code,Condition,ConditionItem,PreviousItem,ConditionsMainViewModelParam){$scope.Code=Code;$scope.conditions_signoffpopup_cancel=function(){ConditionItem.Status=PreviousItem.Status;ConditionItem.UpdatedDate=PreviousItem.UpdatedDate;ConditionItem.UpdatedBy=PreviousItem.UpdatedBy;$modalInstance.close(Condition);};$scope.conditions_signoffpopup_addNewItem=function(){var newConditionViewModel=angular.copy(ConditionsMainViewModelParam.ConditionsSub.NewCondition);var newConditionItem=$modal.open({templateUrl:"angular/stipsandconditions2.0/addnewconditionitem.html",controller:NewConditionItemCtrl,backdrop:"static",resolve:{NewConditionViewModel:function(){newConditionViewModel.ConfigurationCode.Code=Condition.ConfigurationCode.Code;newConditionViewModel.ConfigurationCode.Title=Condition.ConfigurationCode.Title;return newConditionViewModel;},ConditionsSub:function(){return ConditionsMainViewModelParam.ConditionsSub;},DocumentsList:function(){return ConditionsMainViewModelParam.ConditionsDocuments;}}});};$scope.conditions_signoffpopup_signOff=function(){Condition.IsSignedOff=true;Condition.SignOffDate=new Date();Condition.UserSignedOff=ConditionItem.UpdatedBy;$modalInstance.close(Condition);};};var disableStatusController=function($scope,$modalInstance,condition,curativeItem,previousItem){$scope.message="You do not have the permission to set this status.";$scope.header="Permission";$scope.ok=function(){curativeItem.Status=previousItem.Status;curativeItem.UpdatedDate=previousItem.UpdatedDate;curativeItem.UpdatedBy=previousItem.UpdatedBy;$modalInstance.close(condition);};};var ConditionItemNotesCtrl=function($scope,$modalInstance,CurativeItemNotesViewModel){$scope.CurativeItemNotesViewModel=CurativeItemNotesViewModel;angular.copy($scope.CurativeItemNotesViewModel.CurrentNotes,$scope.CurativeItemNotesViewModel.Notes);$scope.cancel=function(){$modalInstance.dismiss("cancel");};$scope.save=function(){$modalInstance.close($scope.CurativeItemNotesViewModel);};$scope.addNote=function(){$scope.CurativeItemNotesViewModel.Notes.push({Content:$scope.CurativeItemNotesViewModel.Content,UserAccountCreatedId:$scope.CurativeItemNotesViewModel.CurrentUser.UserAccountId,UserAccountCreatedUserName:$scope.CurativeItemNotesViewModel.CurrentUser.UserName,DateCreated:new Date(),AddNoteToFile:false,MarkAsUnread:true});$scope.CurativeItemNotesViewModel.Content="";};};var DecisionHistoryCtrl=function($scope,$modalInstance,DecisionHistoryViewModel){$scope.model=DecisionHistoryViewModel;$scope.ok=function(){$modalInstance.dismiss("cancel");};};var BrowseDocVaultCtrl=function($scope,$modalInstance,Item,Documents){$scope.documents=Documents;$scope.model={selectedDocument:$scope.documents[0]};$scope.save=function(){Item.Document=$scope.model.selectedDocument;Item.RepositoryId=$scope.model.selectedDocument.RepositoryId;$modalInstance.dismiss("save");};$scope.cancel=function(){$modalInstance.dismiss("cancel");};};angular.module("stipsandconditionsOld").controller("ItemController",function($scope,$modal){$scope.pdfMenu="pdfMenu";$scope.docVaultMenu="docVaultMenu";$scope.filteredDocuments=$scope.ConditionsMainViewModel.ConditionsDocuments.filter(function(doc){return doc.DocumentTypeId===$scope.$parent.$parent.condition.ConfigurationCode.ItemConfigurations[0].DocTypeId;});$scope.assignDocument=function(doc){console.log(doc.Name);};$scope.downloadDocument=function(event){var downloadLink;if($scope.$parent.item.Document.RepositoryId){downloadLink=(function(repositoryId){if(repositoryId==null||repositoryId==""){return"";}var encodedRepositoryId=encodeURIComponent(repositoryId);var url="/Downloader.axd?documentType=repositoryItem&repositoryItemId="+encodedRepositoryId;return url;})($scope.$parent.item.Document.RepositoryId);}console.log("Download a copy on this link: "+downloadLink);window.open(downloadLink,"_blank","");};$scope.unassignFromItem=function(){$scope.$parent.item.Document=null;$scope.$parent.item.RepositoryId=null;};$scope.rejectDocument=function(event){};$scope.deleteFromDocVault=function(){};$scope.browseDocVault=function(){$modal.open({templateUrl:"angular/stipsandconditions2.0/browseDocVault.html",controller:BrowseDocVaultCtrl,resolve:{Item:function(){return $scope.$parent.item;},Documents:function(){return $scope.filteredDocuments;}}});};$scope.preserveCurrentState=function(){angular.copy($scope.item,$scope.previous.item);};});angular.module("stipsandconditionsOld").controller("DocVaultController",function($scope){$scope.documentclassificationMenu="documentclassificationMenu";$scope.classifyDocument=function(document){$scope.openDocumentClassificationPopup(document);};$scope.rejectDocument=function(document){document.Rejected=true;};$scope.deleteFromDocVault=function(){console.log("Delete from DocVault");};$scope.downloadDocument=function(fileDownloadUrl){window.open(fileDownloadUrl,"_blank");};});var DocumentClassificationCtrl=function($scope,$http,$modal,$modalInstance,Document,DocumentTypes,BorrowerNames){$scope.Document=Document;$scope.DocumentTypes=DocumentTypes;$scope.BorrowerNames=BorrowerNames;$scope.PreviousDocumentState={};angular.copy($scope.Document,$scope.PreviousDocumentState);$scope.documentClassificationPopup_cancel=function(){angular.copy($scope.PreviousDocumentState,$scope.Document);$modalInstance.dismiss("cancel");};$scope.documentClassificationPopup_save=function(){$scope.Document.Processing=true;$http({method:"post",url:"Conditions/BuildVaultDocumentName",data:$scope.Document}).success(function(data){if(data.success==false){$scope.openErrorPopup(data.message);return;}$scope.Document.Name=data.documentName;$scope.Document.Processing=false;HideProcessingInfo();}).error(function(){$scope.openErrorPopup(data.message);$scope.Document.Processing=false;});$modalInstance.dismiss("cancel");};};})();(function(){angular.module("loanCenter").controller("NavCtrl",NavigationController);NavigationController.$inject=["$scope","$state","$stateParams","$rootScope","$modal","$modalStack","NavigationSvc","BroadcastSvc","enums","applicationData","importFnmSvc","commonModalWindowFactory","modalWindowType","loanService","ContextualBarSvc","$timeout","queueSvc","modalPopoverFactory"];function NavigationController($scope,$state,$stateParams,$rootScope,$modal,$modalStack,NavigationSvc,BroadcastSvc,enums,applicationData,importFnmSvc,commonModalWindowFactory,modalWindowType,loanService,ContextualBarSvc,$timeout,queueSvc,modalPopoverFactory){var vm=this;vm.applicationData=applicationData;vm.modalPopoverFactory=modalPopoverFactory;vm.tabNames=enums.LoanApplicationTabs;vm.areSixPiecesAcquiredForAllLoanApplications=NavigationSvc.areSixPiecesAcquiredForAllLoanApplications;vm.affordabilityUrl=affordabilityUrl;vm.getMenuLabelText=getMenuLabelText;vm.mortgageType=null;vm.selectedLoanId=null;vm.enums=enums;vm.assignmentsEnabled=null;vm.isWholesaleUser=applicationData.currentUser.isWholesale;vm.conciergeUrl=vm.applicationData.configuration.conciergeHome+"?LOFirstVisit=False&isEmbeddedInLoanCenter=0";vm.loanCenter3Url=vm.applicationData.configuration.loanCenterHome+"?v=3";vm.loanCenter2Url=vm.applicationData.configuration.loanCenterHome;vm.sysAdminUrl=vm.applicationData.configuration.systemAdmin+"?LOFirstVisit=False&isEmbeddedInLoanCenter=0";vm.createNewLoanApplication=createNewLoanApplication;vm.importFnmFile=importFnmFile;vm.openLink=openLink;vm.redirect=redirect;vm.openProspect=openProspect;vm.showReadOnlyMode=showReadOnlyMode;vm.showCheckOutPopup=showCheckOutPopup;vm.getCheckOutMessage=getCheckOutMessage;vm.checkoutPopupContent=checkoutPopupContent;vm.openFirstLoanFromMailList=openFirstLoanFromMailList;vm.NavigationSvc=NavigationSvc;vm.releaseLockedLoan=releaseLockedLoan;vm.numberOfListUserSees=numberOfListsUserSees();$scope.startItemOpen=false;$scope.startItemHover=false;vm.workbenchItemOpen=false;$scope.contactsItemOpen=false;$scope.toolsItemOpen=false;$scope.reportsItemOpen=false;$scope.favoritesItemOpen=false;$scope.settingsItemOpen=false;$rootScope.userAccountId=vm.applicationData.currentUser.userAccountId;angular.element(document).ready(function(){vm.showCheckOutPopup();});function numberOfListsUserSees(){var number=0;if(applicationData.currentUser.hasPrivilege(enums.privileges.ViewStandardList)){number++;}if(applicationData.currentUser.hasPrivilege(enums.privileges.ViewAppraisalLists)){number++;}if(applicationData.currentUser.hasPrivilege(enums.privileges.ViewDisclosuresList)){number++;}if(number<=0){number=1;}switch(number){case 1:number="small";break;case 2:number="medium";break;case 3:number="wide";break;}return number;}function openFirstLoanFromMailList(){NavigationSvc.openFirstLoanInMailRoomQueue(vm.applicationData.currentUser.userAccountId);}function getMenuLabelText(key){return NavigationSvc.getMenuLabelText(key,vm.isWholesaleUser);}function openLoanApplication(stateName,newApplication,loanPurposeType){$scope.startItemOpen=false;$scope.startItemHover=false;$modalStack.dismissAll("cancel");NavigationSvc.openLoanApplication(stateName,newApplication,loanPurposeType);}$scope.updateValuesOnRowChange=function(){SetValueForLoan();};$scope.updateValuesOnRowChangeNEW=function(loanId){SetValueForLoanNEW(loanId);};$scope.prepareLoanOnRowSelect=function(loanId){var SelectedLoan=NavigationSvc.PrepareLoanFromQueueNEW(loanId,vm.applicationData.currentUser.userAccountId);$rootScope.selectedLoanId=SelectedLoan.LoanId;$scope.queueName=SelectedLoan.QueueName;$scope.prospectId="";NavigationSvc.SetNavigationLinks(SelectedLoan.LoanId);vm.selectedLoanId=SelectedLoan.LoanId;};$scope.logout=function(url,borrowerUrl){window.open(borrowerUrl,"_blank","width=200,height=110,menubar=no,resizable=no,scrollbars=no,status=no,titlebar=no,toolbar=no");$.ajax({type:"POST",url:url,success:function(data){window.location=data;}});};$scope.mainSearch=function(value){if(value){Search.SearchDataHelper(false,value);}$rootScope.navigation="";$rootScope.ContextualType="";};$scope.sysAdminSearch=function(value){if(value){SystemAdmin.Search(undefined,value);}};$scope.mainClear=function(){Search.SearchDataHelper(true,"");};$scope.sysAdminClear=function(){SystemAdmin.Search(undefined,"");};function SetValueForLoan(){var SelectedLoan=NavigationSvc.SelectLoanFromQueue();$rootScope.selectedLoanId=SelectedLoan.LoanId;$scope.queueName=SelectedLoan.QueueName;$scope.prospectId=$(".tablelistselected").find(".prospectid").text().trim();NavigationSvc.SetNavigationLinks(SelectedLoan.LoanId);vm.selectedLoanId=SelectedLoan.LoanId;}function SetValueForLoanNEW(loanId){var SelectedLoan=NavigationSvc.SelectLoanFromQueueNEW(loanId,vm.applicationData.currentUser.userAccountId);$rootScope.selectedLoanId=SelectedLoan.LoanId;$scope.queueName=SelectedLoan.QueueName;$scope.prospectId="";NavigationSvc.SetNavigationLinks(SelectedLoan.LoanId);vm.selectedLoanId=SelectedLoan.LoanId;}function affordabilityUrl(){var url=applicationData.configuration.borrowerSiteUrl.concat("/Affordability/");window.open(url,"_blank");}function importFnmFile(loanExists,emptyLoanOnCancel,loanPurposeType){importFnmSvc.openImportLoanModal(applicationData,loanExists,emptyLoanOnCancel,loanPurposeType);}function createNewLoanApplication(loanExists,emptyLoanOnCancel,loanPurposeType){if(applicationData.currentUser.isWholesale){importFnmFile(loanExists,emptyLoanOnCancel,loanPurposeType);}else{openLoanApplication("loanCenter.loan.loanApplication.personal",true,loanPurposeType);}}function openProspect(){openLink("LoanScenario");NavigationSvc.openProspect();}function openLink(linkName,state){$scope.startItemOpen=false;$scope.startItemHover=false;$modalStack.dismissAll("cancel");NavigationSvc.openLink(linkName,state);}function signOut(url,signoutUrl){window.open(url,"_blank","width=200,height=110,menubar=no,resizable=no,scrollbars=no,status=no,titlebar=no,toolbar=no");$.ajax({type:"POST",url:signoutUrl,success:function(data){window.location=data;}});}function handleRedirection(url,signoutUrl){$modalStack.dismissAll("close");if(signoutUrl){signOut(url,signoutUrl);}else{window.open(url,"_self");}}function redirect(url,signoutUrl){if($rootScope.selectedLoanId&&window.location.hash.indexOf("loan")>-1){var message="";if(loanService.wrappedLoan.ref.primary.getBorrower().firstName.trim()&&!!loanService.wrappedLoan.ref.primary.getBorrower().lastName.trim()){message=loanService.wrappedLoan.ref.primary.getBorrower().lastName+", "+loanService.wrappedLoan.ref.primary.getBorrower().firstName;}commonModalWindowFactory.open({type:modalWindowType.unload,message:message,ctrl:{doNotSaveTheLoan:doNotSaveTheLoan,saveTheLoan:saveTheLoan,closeTheModal:closeTheModal}});}else{handleRedirection(url,signoutUrl);}function closeTheModal(){$modalStack.dismissAll("close");}function saveTheLoan(){commonModalWindowFactory.close("close");if(loanService.wrappedLoan.ref.isValidForSave()){NavigationSvc.SaveAndUpdateWrappedLoan(applicationData.currentUserId,loanService.wrappedLoan,function(wrappedLoan){handleRedirection(url,signoutUrl);},function(error){commonModalWindowFactory.open({type:modalWindowType.error,message:"Error while saving loan"});$log.error(error);});}else{NavigationSvc.openLoanApplication("loanCenter.loan.loanApplication.personal");}}function doNotSaveTheLoan(){handleRedirection(url,signoutUrl);}}function showReadOnlyMode(){return loanService.wrappedLoan&&loanService.wrappedLoan.ref&&loanService.wrappedLoan.ref.controlStatus&&!loanService.wrappedLoan.ref.controlStatus.isAcquired&&ContextualBarSvc.getContextualType()!=enums.ContextualTypes.Queue;}function getCheckOutMessage(){if(loanService.wrappedLoan&&loanService.wrappedLoan.ref&&loanService.wrappedLoan.ref.controlStatus){return" - Checked out to "+loanService.wrappedLoan.ref.controlStatus.lockOwnerUserName;}return"";}function showCheckOutPopup(){if(vm.showReadOnlyMode()){$timeout(function(){var element=document.getElementById("divLoanCheckOutTooltip");element.click();},100);}}function checkoutPopupContent(event){if(vm.showReadOnlyMode()){var checkoutPopup=this.modalPopoverFactory.openModalPopover("angular/navigation/checkoutpopup.html",{},{message:this.getCheckOutMessage(),hasPrivilege:vm.applicationData.currentUser.hasPrivilege("Release a Loan in Read Only Mode")},event,{zindex:10800,position:"fixed"});checkoutPopup.result.then(function(){vm.releaseLockedLoan();});}}function releaseLockedLoan(){loanService.releasingServices.releaseControlAndAcquireLock({loanId:loanService.wrappedLoan.ref.loanId,userAccountId:vm.applicationData.currentUser.userAccountId,lockOwnerId:loanService.wrappedLoan.ref.controlStatus.lockOwnerId}).$promise.then(function(data){loanService.wrappedLoan.ref.controlStatus=data;},function(error){console.log("releaseControl("+vm.applicationData.currentUser.userAccountId+", "+loanService.wrappedLoan.ref.loanId+") FAIL:"+error.lockOwnerUserName);});}}})();(function(){angular.module("loanCenter").factory("NavigationSvc",NavigationSvc);NavigationSvc.$inject=["$http","$q","$resource","$rootScope","apiRoot","BroadcastSvc","enums","$state","$stateParams","$filter","simpleModalWindowFactory","HttpUIStatusService","costDetailsHelpers","loanEvent","navigationConstant","$modal","queueSvc","$timeout"];function NavigationSvc($http,$q,$resource,$rootScope,ApiRoot,BroadcastSvc,enums,$state,$stateParams,$filter,simpleModalWindowFactory,HttpUIStatusService,costDetailsHelpers,loanEvent,navigationConstant,$modal,queueSvc,$timeout){var LoanAppTabs={Personal:{isSelected:false,isDisabled:false},Property:{isSelected:false,isDisabled:false},Assets:{isSelected:false,isDisabled:false},Credit:{isSelected:false,isDisabled:false},Declarations:{isSelected:false,isDisabled:false},Income:{isSelected:false,isDisabled:false},all:{isDisabled:false}};var DocumentsTabs={NeedsList:{isSelected:false},DocVault:{isSelected:false}};var IsBorrowerCreated=false;var contextualType;var navigation;var areSixPiecesAcquiredForAllLoanApplications={value:false};var stateChangeStarted={value:false};var lastRepricing={timestamp:0};var checkLoanDisclosureStatusTimer={};var checkLoanDisclosureStatusTimeoutTimer={};var exportToDigitalInProgress=false;var exportToEncompassInProgress=false;var checkExportToEncompassProgressTimer={};var checkExportToEncompassProgressTimeoutTimer={};var checkComplianceCheckStatusTimer={};var service={IsBorrowerCreated:IsBorrowerCreated,LoanAppTabs:LoanAppTabs,DocumentsTabs:DocumentsTabs,SelectLoanFromQueue:SelectLoanFromQueue,SelectLoanFromQueueNEW:SelectLoanFromQueueNEW,PrepareLoanFromQueueNEW:PrepareLoanFromQueueNEW,SetNavigationLinks:SetNavigationLinks,contextualType:contextualType,SaveAndUpdateWrappedLoan:SaveAndUpdateWrappedLoan,areSixPiecesAcquiredForAllLoanApplications:areSixPiecesAcquiredForAllLoanApplications,setPersonalAsActiveAndRedirect:setPersonalAsActiveAndRedirect,getMenuLabelText:getMenuLabelText,ClearCreditData:ClearCreditData,openLoanApplication:openLoanApplication,openDocuments:openDocuments,openLink:openLink,navigation:navigation,openProspect:openProspect,openAntiSteeringModal:openAntiSteeringModal,stateChangeStarted:stateChangeStarted,openFirstLoanInMailRoomQueue:openFirstLoanInMailRoomQueue,navigateToFHACalculator:navigateToFHACalculator,cancelChanges:cancelChanges,setBodyPosition:setBodyPosition,navigateToVACalculator:navigateToVACalculator,checkLoanDisclosureStatusTimer:checkLoanDisclosureStatusTimer,checkLoanDisclosureStatusTimeoutTimer:checkLoanDisclosureStatusTimeoutTimer,exportToDigitalInProgress:exportToDigitalInProgress,exportToEncompassInProgress:exportToEncompassInProgress,checkExportToEncompassProgressTimer:checkExportToEncompassProgressTimer,checkExportToEncompassProgressTimeoutTimer:checkExportToEncompassProgressTimeoutTimer,navigateToNetTangibleBenefit:navigateToNetTangibleBenefit,lastRepricing:lastRepricing,checkComplianceCheckStatusTimer:checkComplianceCheckStatusTimer};return service;var LoanApiPath=ApiRoot+"LoanEx/";var SaveLoanData=$resource(LoanApiPath+"MegaSave",{viewModel:"@viewModel"});function SaveAndUpdateWrappedLoan(userAccountId,wrappedLoan,happyPath,errorPath,message,displayStatus){wrappedLoan.ref.prepareSave();var megaLoanSave=$resource(ApiRoot+"LoanEx/"+"MegaSave",{viewModel:"@viewModel",userAccountId:"@userAccountId"});var displayMessage=message?message:"Saving Loan...";HttpUIStatusService.save(displayMessage,function(happyPath,unhappyPath){return megaLoanSave.save({userAccountId:userAccountId},wrappedLoan.ref).$promise.then(happyPath,unhappyPath);},function(savedLoan){savedLoan.selectedAppIndex=wrappedLoan.ref.selectedAppIndex;wrappedLoan.ref=new cls.LoanViewModel(savedLoan,$filter,savedLoan.isWholesaleUser);costDetailsHelpers.initializeCostService(wrappedLoan);costDetailsHelpers.getCostDetailsData();if(angular.element(document.getElementById("divMainNavBar")).scope()!=undefined){angular.element(document.getElementById("divMainNavBar")).scope().updateValuesOnRowChangeNEW(wrappedLoan.ref.loanId);}$rootScope.SelectedLoan.LoanId=wrappedLoan.ref.loanId;loanEvent.broadcastPropertyChangedEvent(events.LoanFieldIdentifier.todo,{});if(happyPath){happyPath(wrappedLoan);}return wrappedLoan;},errorPath,displayStatus);}function setBodyPosition(){$timeout(function(){var bodyContainer=document.getElementById("impBodyContainer");if(bodyContainer){bodyContainer.style.top=$("#contextualBody").outerHeight(true)+40+"px";}var productsHeader=document.getElementById("productsHeader");if(productsHeader){productsHeader.style.top=$("#contextualBody").outerHeight(true)+40+"px";}});}function cancelChanges(loanId){$state.go($state.current,{"loanId":loanId},{reload:true});}function ClearCreditData(wrappedLoan){wrappedLoan.ref.active.getBorrower().Liabilities=_.filter(wrappedLoan.ref.active.getBorrower().Liabilities,function(liability){return liability.isNewRow||liability.isUserEntry;});wrappedLoan.ref.active.getBorrower().publicRecords=[];if(wrappedLoan.ref.active.isSpouseOnTheLoan){wrappedLoan.ref.active.getCoBorrower().Liabilities=_.filter(wrappedLoan.ref.active.getCoBorrower().Liabilities,function(liability){return liability.isNewRow||liability.isUserEntry;});wrappedLoan.ref.active.getCoBorrower().publicRecords=[];}}function SelectLoanFromQueue(userAccountId){var oldGridPlaceholderDiv=document.getElementById("oldGridPlaceholder");oldGridPlaceholderDiv.removeAttribute("style");var selectedRow=document.getElementsByClassName("tablelistselected")[0];var selectedLoan={LoanId:selectedRow==undefined?"":angular.element(selectedRow.getElementsByClassName("loanid")[0]).text().trim(),UserAccountId:userAccountId,QueueName:RetrieveSelectedQueueName(),ApplicationStep:selectedRow==undefined?"":angular.element(selectedRow.getElementsByClassName("applicationStep")[0]).text().trim()};$rootScope.SelectedLoan=selectedLoan;contextualType=enums.ContextualTypes.None;return selectedLoan;}function SelectLoanFromQueueNEW(loanId,userAccountId){var selectedLoan={LoanId:(loanId==undefined||loanId==null)?"":loanId.trim(),UserAccountId:userAccountId,QueueName:"",ApplicationStep:""};$rootScope.SelectedLoan=selectedLoan;contextualType=enums.ContextualTypes.None;return selectedLoan;}function PrepareLoanFromQueueNEW(loanId,userAccountId){var selectedLoan={LoanId:(loanId==undefined||loanId==null)?"":loanId.trim(),UserAccountId:userAccountId,QueueName:"",ApplicationStep:""};$rootScope.SelectedLoan=selectedLoan;return selectedLoan;}function SetNavigationLinks(loanId){if($rootScope.SelectedLoan.QueueName==="Prospects"){if(loanId==null||loanId.trim()===""){return;}var isBorrowerCreatedPath=ApiRoot+"personal/IsBorrowerCreated/";$http.get(isBorrowerCreatedPath,{params:{loanId:loanId}}).success(function(data,status,headers,config){IsBorrowerCreated=data;SetValuesForTabs(!IsBorrowerCreated);}).error(function(data,status,headers,config){console.log(data);});}else{SetValuesForTabs(false);}}function SetValuesForTabs(isDisabled){angular.forEach(LoanAppTabs,function(tab,tabName){if(enums.LoanApplicationTabs.Personal.toLowerCase()!==tabName.toLowerCase()){tab.isDisabled=isDisabled;}});}function setPersonalAsActiveAndRedirect(callReload,loanId){angular.forEach(LoanAppTabs,function(tab,tabName){if(tabName.toLowerCase()==="personal"){tab.isSelected=true;}else{tab.isSelected=false;}});if(callReload){$state.go("loanCenter.loan.loanApplication.personal",{"loanId":loanId},{reload:callReload});}else{$state.go("loanCenter.loan.loanApplication.personal");}}function getMenuLabelText(key,isWholesaleUser){if(isWholesaleUser){return getTextByKey(key,navigationConstant.WHOLESALE.LABELS);}else{return getTextByKey(key,navigationConstant.ORDINARY.LABELS);}}function getTextByKey(key,labels){for(var b in labels){if(b.toString()==key.toString()){return labels[b];}}}function openDocuments(selectedTab,stateName){$rootScope.navigation="Documents";angular.forEach(DocumentsTabs,function(tab,tabName){if(selectedTab.toLowerCase()===tabName.toLowerCase()){tab.isSelected=true;}else{tab.isSelected=false;}});$state.go(stateName);}function openLoanApplication(stateName,newApplication,loanPurposeType){if(!common.string.isNullOrWhiteSpace(stateName)){if(newApplication){$state.go(stateName,{loanId:null,loanPurposeType:loanPurposeType,differentiateId:$stateParams.differentiateId?$stateParams.differentiateId+1:1},{reload:true});}else{$state.go(stateName,{loanId:$stateParams.loanId});}}}function openProspect(){$state.go("loanCenter.loan.loanScenario.sections",{loanId:null,loanPurposeType:null,differentiateId:$stateParams.differentiateId?$stateParams.differentiateId+1:1,repricing:false},{reload:true});}function openLink(linkName,state,wrappedLoan,applicationData){switch(linkName){case"CostDetails":navigation="CostDetails";break;case"Conditions":navigation="StipsAndConditions";break;case"lockingandpricingadj":navigation="lockingandpricingadj";break;case"PreApprovalLetters":navigation="PreApprovalLetters";break;case"Queue":navigation="Queue";break;case"Aus":navigation="AUS";break;case"LoanScenario":if($stateParams){$stateParams.loanId=null;}navigation="LoanScenario";break;case"LoanDetails":navigation="LoanDetails";break;case"ComplianceEase":navigation="ComplianceEase";break;case"MessageCenter":navigation="MessageCenter";break;case"Mailroom":navigation="Mailroom";break;case"NetTangibleBenefit":navigation="NetTangibleBenefit";break;case"Integrations":navigation="Integrations";break;case"LoanParticipants":var modalInstance=$modal.open({templateUrl:"angular/loanparticipants/loanparticipants.html",backdrop:"static",windowClass:"imp-modal flyout imp-modal-agents-parties",controller:"LoanParticipantsModal",controllerAs:"modalCtrl",resolve:{wrappedLoan:function(){return wrappedLoan;},applicationData:function(){return applicationData;}}});break;case"DocumentLibrary":var modalInstance=$modal.open({templateUrl:"angular/documentlibrary/documentlibrary.html",backdrop:"static",windowClass:"imp-reference-modal documentlibrary-modal",});break;case"Assignments":var modalInstance=$modal.open({templateUrl:"angular/assignments/assignments.html",backdrop:"static",windowClass:"imp-reference-modal assignments-modal",controller:"AssignmentsController",controllerAs:"assignmentsCtrl",resolve:{wrappedLoan:function(){return wrappedLoan;},applicationData:function(){return applicationData;}}});break;case"ComplianceCenter":navigation="ComplianceCenter";break;case"Appraisal":navigation="Appraisal";break;case"CopyLoan":var modalInstance=$modal.open({templateUrl:"angular/copyloan/copyloan.html",backdrop:"static",windowClass:"imp-reference-modal copyloan-modal",controller:"copyLoanController",controllerAs:"copyLoan",resolve:{wrappedLoan:function(){return wrappedLoan;},applicationData:function(){return applicationData;}}});break;case"SecureLinkEmail":var modalInstance=$modal.open({templateUrl:"angular/securelinkemail/securelinkemail.html",backdrop:"static",windowClass:"imp-reference-modal copyloan-modal",controller:"secureLinkEmailController",controllerAs:"secureLinkEmailCtrl",resolve:{wrappedLoan:function(){return wrappedLoan;},applicationData:function(){return applicationData;}}});break;}if(state){$state.go(state);}}function openAntiSteeringModal(amortizationType,antiSteeringOptions,areLoanAntiSteeringOptionsCompleted,submitForApprovalAction){var modalInstance=$modal.open({templateUrl:"angular/navigation/antisteering/antisteeringmodawindow.html",backdrop:"static",windowClass:"imp-center-modal confirmation-modal steering-modal-widowclass",controller:"antiSteeringController",controllerAs:"antiSteeringCtrl",resolve:{amortizationType:function(){return amortizationType;},antiSteeringOptions:function(){return antiSteeringOptions;},optionsCompletedCallBack:function(){return areLoanAntiSteeringOptionsCompleted;},submitForApprovalCallBack:function(){return submitForApprovalAction;},}});}function openFirstLoanInMailRoomQueue(userAccountId){queueSvc.queue().get({currentUserId:userAccountId,queue:enums.myListQueue.mailRoom}).$promise.then(function(data){var firstLoan=data.list[0];var loanId=firstLoan.loanId;var parentLoanId=firstLoan.parentLoanId;var disclosureDueDate=firstLoan.disclosureDueDate._i;$state.go("loanCenter.workbench.mailroom",{"loanId":loanId,"parentLoanId":parentLoanId,"disclosureDueDate":disclosureDueDate},{reload:true});},function(error){console.log(error);});}function navigateToFHACalculator(value){switch(Number(value)){case srv.FHAProductsEnum.StreamlineRefinance:$state.go("loanCenter.loan.fhacenter.streamlinerefinance");break;case srv.FHAProductsEnum.SimpleRefinance:$state.go("loanCenter.loan.fhacenter.simplerefinance");break;case srv.FHAProductsEnum.RateAndTermRefinance:$state.go("loanCenter.loan.fhacenter.rateandtermrefinance");break;case srv.FHAProductsEnum.CashOutRefinance:$state.go("loanCenter.loan.fhacenter.cashoutrefinance");break;case srv.FHAProductsEnum.Purchase:$state.go("loanCenter.loan.fhacenter.purchase");break;case srv.FHAProductsEnum.PurchaseDown:$state.go("loanCenter.loan.fhacenter.purchasedown");break;default:$state.go("loanCenter.loan.fhacenter");break;}}function navigateToNetTangibleBenefit(){$state.go("loanCenter.loan.nettangible.details");}function navigateToVACalculator(value){switch(Number(value)){case srv.VACalculatorsEnum.VAGeneralInformation:$state.go("loanCenter.loan.vacenter.generalinformation");break;case srv.VACalculatorsEnum.IRRLMax:$state.go("loanCenter.loan.vacenter.irrlmax");break;case srv.VACalculatorsEnum.IRRLQMCertification:$state.go("loanCenter.loan.vacenter.irrlqmcertification");break;default:$state.go("loanCenter.loan.vacenter.generalinformation");break;}}}})();(function(){angular.module("loanCenter").constant("navigationConstant",{WHOLESALE:{LABELS:{CLOSED_LOANS:"Closed",CANCELLED_LOANS:"Cancelled",INCOMPLETE:"Incomplete",PREAPPROVAL:"PreApproved",QUEUE:"My Pipeline"}},ORDINARY:{LABELS:{CLOSED_LOANS:"Closed Loans",CANCELLED_LOANS:"Cancelled Loans",INCOMPLETE:"Incomplete",PREAPPROVAL:"PreApproval",QUEUE:"My Pipeline"}}});})();(function(){angular.module("loanCenter").controller("loanMenuController",loanMenuController);loanMenuController.$inject=["$scope","$state","$rootScope","$modal","$modalStack","NavigationSvc","BroadcastSvc","enums","applicationData","wrappedLoan","importFnmSvc","modalWindowType","commonModalWindowFactory","digitaldocSvc","encompassSvc"];function loanMenuController($scope,$state,$rootScope,$modal,$modalStack,NavigationSvc,BroadcastSvc,enums,applicationData,wrappedLoan,importFnmSvc,modalWindowType,commonModalWindowFactory,digitaldocSvc,encompassSvc){var vm=this;var loanLoaded=isLoanLoaded();var loanApplicationDateSet=isLoanApplicationDateSet();var loanClosed=isLoanClosed();var intentToProceedDateSet=isIntentToProceedDateSet();var bypass=false;var onChangeEntered=false;vm.loanMenuItems={prospect:{isEnabled:loanLoaded},personalTab:{isEnabled:loanLoaded},propertyTab:{isEnabled:loanLoaded},assetsTab:{isEnabled:loanLoaded},creditTab:{isEnabled:loanLoaded},declarationsTab:{isEnabled:loanLoaded},incomeTab:{isEnabled:loanLoaded},loanDetails:{isEnabled:loanLoaded},loanAssignments:{isEnabled:loanLoaded},preApproval:{isEnabled:hasPrivilege("Issue PreApproval Letter"),isVisible:isLoanPurposeType(srv.LoanType.Purchase)},documents:{isEnabled:loanLoaded},borrowerNeedsList:{isEnabled:loanLoaded},loanParticipants:{isEnabled:loanLoaded},viewInBorrowerSite:{isEnabled:loanLoaded},copyLoan:{isEnabled:loanLoaded},borrowerActivities:{isEnabled:false&&hasPrivilege("Access to Activities")},aus:{isEnabled:isAusEnabled},stipsConditions:{isEnabled:hasPrivilege("Conditions - View Tab")},complianceCenter:{isEnabled:loanLoaded},documentLibrary:{isEnabled:false&&loanLoaded},disclosures:{isEnabled:false&&loanLoaded},closingCosts:{isEnabled:loanLoaded&&(hasPrivilege(enums.privileges.ClosingCostsR)||hasPrivilege(enums.privileges.ClosingCostsRW))},loanDelivery:{isEnabled:false&&loanApplicationDateSet},titleAndEscrow:{isEnabled:false&&intentToProceedDateSet},veritax:{isEnabled:false&&intentToProceedDateSet},appraisal:{isEnabled:true},credit:{isEnabled:false},complianceEase:{isEnabled:true},dataVerify:{isEnabled:false},uldd:{isEnabled:false},lqa:{isEnabled:false},earlyCheck:{isEnabled:false},lockingAndAdjustments:{isEnabled:loanLoaded},pooling:{isEnabled:false&&loanClosed},antiSteeringOptions:{isEnabled:isProspectSaved},adverseLoan:{isEnabled:isProspectSaved}};function isAusEnabled(){return !!wrappedLoan&&!!wrappedLoan.ref&&hasPrivilege("AUS - View tab")&&wrappedLoan.ref.allLoanAppsCompleted();}function isProspectSaved(){return wrappedLoan.ref.isNewProspectSaved;}vm.applicationData=applicationData;vm.wrappedLoan=wrappedLoan;vm.tabNames=enums.LoanApplicationTabs;vm.documentTabNames=enums.DocumentsTabs;vm.loanAppTabs=NavigationSvc.LoanAppTabs;vm.areSixPiecesAcquiredForAllLoanApplications=NavigationSvc.areSixPiecesAcquiredForAllLoanApplications;vm.toggleFhaCenterSection=toggleFhaCenterSection;vm.loanMenuOnMouseOver=loanMenuOnMouseOver;vm.getMenuLabelText=getMenuLabelText;vm.mortgageType=null;vm.openLink=openLink;vm.selectedLoanId=null;vm.enums=enums;vm.isWholesaleUser=applicationData.currentUser.isWholesale;vm.conciergeUrl=vm.applicationData.configuration.conciergeHome+"?LOFirstVisit=False&isEmbeddedInLoanCenter=0";vm.loanCenter3Url=vm.applicationData.configuration.loanCenterHome+"?v=3";vm.loanCenter2Url=vm.applicationData.configuration.loanCenterHome;vm.sysAdminUrl=vm.applicationData.configuration.systemAdmin+"?LOFirstVisit=False&isEmbeddedInLoanCenter=0";vm.createNewLoanApplication=createNewLoanApplication;vm.openLoanApplication=openLoanApplication;vm.openDocuments=openDocuments;vm.importFnmFile=importFnmFile;vm.openAntiSteeringModal=openAntiSteeringModal;vm.openAdverseModal=openAdverseModal;vm.navigateToFHACalculator=navigateToFHACalculator;vm.navigateToVACalculator=navigateToVACalculator;vm.navigateToNetTangibleBenefit=navigateToNetTangibleBenefit;vm.navigateToVACalculator=navigateToVACalculator;$scope.startItemOpen=false;$scope.startItemHover=false;$scope.loanItemOpen=false;$scope.loanItemHover=false;vm.workbenchItemOpen=false;$scope.contactsItemOpen=false;$scope.toolsItemOpen=false;$scope.reportsItemOpen=false;$scope.favoritesItemOpen=false;$scope.settingsItemOpen=false;$rootScope.userAccountId=vm.applicationData.currentUser.userAccountId;RealodPage();function getMenuLabelText(key){return NavigationSvc.getMenuLabelText(key,vm.isWholesaleUser);}function openLink(linkName,state){$scope.loanItemOpen=false;$scope.loanItemHover=false;$modalStack.dismissAll("cancel");NavigationSvc.openLink(linkName,state,vm.wrappedLoan,vm.applicationData);}function navigateToFHACalculator(){NavigationSvc.navigateToFHACalculator(vm.wrappedLoan.ref.fhaScenarioViewModel.fhaProductId);}function navigateToVACalculator(){NavigationSvc.navigateToVACalculator();}function navigateToNetTangibleBenefit(){if(wrappedLoan.ref.loanPurposeType==srv.LoanPurposeTypeEnum.Refinance){NavigationSvc.navigateToNetTangibleBenefit();}}function navigateToVACalculator(){NavigationSvc.navigateToVACalculator();}function loanMenuOnMouseOver(){toggleFhaCenterSection();}function toggleFhaCenterSection(){vm.mortgageType=(wrappedLoan&&wrappedLoan.ref&&wrappedLoan.ref.financialInfo&&window.location.hash!="#/"&&window.location.hash!="#/queue")?wrappedLoan.ref.financialInfo.mortgageType:null;}$rootScope.$on("$stateChangeStart",function(event,toState,toParams,fromState,fromParams){if(bypass){NavigationSvc.stateChangeStarted.value=true;return;}if(((fromParams.loanId!=toParams.loanId&&!toParams.loanId)||fromParams.loanPurposeType!=toParams.loanPurposeType||fromParams.differentiateId!=toParams.differentiateId)&&!onChangeEntered){onChangeEntered=true;event.preventDefault();var message="";if(wrappedLoan.ref.primary.getBorrower().firstName.trim()&&!!wrappedLoan.ref.primary.getBorrower().lastName.trim()){message=wrappedLoan.ref.primary.getBorrower().lastName+", "+wrappedLoan.ref.primary.getBorrower().firstName;}commonModalWindowFactory.open({type:modalWindowType.unload,message:message,ctrl:{doNotSaveTheLoan:doNotSaveTheLoan,saveTheLoan:saveTheLoan,closeTheModal:closeTheModal}});}else{NavigationSvc.stateChangeStarted.value=true;}function closeTheModal(){bypass=false;onChangeEntered=false;commonModalWindowFactory.close("close");}function saveTheLoan(){bypass=true;commonModalWindowFactory.close("close");if(wrappedLoan.ref.isValidForSave()){NavigationSvc.SaveAndUpdateWrappedLoan(applicationData.currentUserId,wrappedLoan,function(wrappedLoan){encompassSvc.cancelTimer();digitaldocSvc.cancelTimer();$state.go(toState,toParams);},function(error){bypass=false;onChangeEntered=false;commonModalWindowFactory.open({type:modalWindowType.error,message:"Error while saving loan"});$log.error(error);});}else{bypass=false;onChangeEntered=false;}}function doNotSaveTheLoan(){bypass=true;commonModalWindowFactory.close("close");encompassSvc.cancelTimer();digitaldocSvc.cancelTimer();$state.go(toState,toParams);}});$rootScope.$on("$stateChangeSuccess",function(event,toState,toParams,fromState,fromParams){NavigationSvc.stateChangeStarted.value=false;});$rootScope.$on("$stateNotFound",function(event,unfoundState,fromState,fromParams){NavigationSvc.stateChangeStarted.value=false;});$rootScope.$on("$stateChangeError",function(event,toState,toParams,fromState,fromParams,error){NavigationSvc.stateChangeStarted.value=false;});$scope.openProspect=function(stateName){$rootScope.startItemOpen=false;$rootScope.startItemHover=false;$rootScope.navigation="LoanScenario";$state.go(stateName,{loanId:$rootScope.SelectedLoan.LoanId,loanPurposeType:null,repricing:true});};function openLoanApplication(stateName,newLoanApplication,loanPurposeType){$scope.loanItemOpen=false;$scope.loanItemHover=false;$modalStack.dismissAll("cancel");NavigationSvc.openLoanApplication(stateName,newLoanApplication,loanPurposeType);}function openDocuments(selectedTab,stateName){$modalStack.dismissAll("cancel");NavigationSvc.openDocuments(selectedTab,stateName);}$scope.openConciergeEmbeddedCommand=function(action){$scope.loanItemOpen=false;$scope.loanItemHover=false;$modalStack.dismissAll("cancel");var loanId=$scope.selectedLoanId;var queueName=$scope.queueName;var prospectId=$scope.prospectId;var userAccountId=vm.wrappedLoan.ref.primary.getBorrower().userAccount.userAccountId;switch(action){case"AssignLoanInfo":AssignLoanInfo.AssignLoanInfoLoad(loanId);break;case"Activities":ConciergeCommandEmbedded.OpenConciergeEmbeddedCommand(WorkQueueCommands.ManageActivities,currentQueue,loanId,prospectId);break;case"Alerts":ConciergeCommandEmbedded.OpenConciergeEmbeddedCommand(WorkQueueCommands.ManageAlerts,currentQueue,loanId,prospectId);break;case"Appraisal":Appraisal.OpenAppraisalFormCommand(loanId,prospectId);break;case"Credit":ConciergeCommandEmbedded.OpenConciergeEmbeddedCommand(WorkQueueCommands.ManageCredit,currentQueue,loanId,prospectId);break;case"Disclosures":if(currentQueue==WorkQueueTypes.MailRoom){MailRoomGrid.MailRoomOpenDisclosures(loanId,documentId,userAccountId);}else{ConciergeCommandEmbedded.OpenConciergeEmbeddedCommand(WorkQueueCommands.ManageDisclosures,currentQueue,loanId,prospectId);}break;case"Documents":ConciergeCommandEmbedded.OpenConciergeEmbeddedCommand(WorkQueueCommands.ManageDocuments,currentQueue,loanId,"");break;case"ManageLoan":ConciergeCommandEmbedded.OpenConciergeEmbeddedSubCommand(WorkQueueCommands.ManageLoan,currentQueue,loanId,prospectId,1);break;case"Escrow":ManageFees.ManageFeesLoad(loanId,prospectId);break;case"ManageProspects":ManageProspects.ManageProspectsLoad(loanId,prospectId,true);break;case"LoanDetails":$("#detailsSection").hide();$("#detailsSection").html("");LoanDetails.LoanDetailsCommand(currentQueue,loanId,prospectId);break;case"LoanServices":LoanServices.LoanServicesLoad(loanId,true);break;case"ViewInBorrower":ViewInBorrower(loanId,userAccountId);break;case"FileManagement":ConciergeCommandEmbedded.OpenConciergeEmbeddedCommand(WorkQueueCommands.FileManagement,currentQueue,loanId,prospectId);break;case"disabled":return false;break;default:break;}};$scope.$on("LoanChanged",function(event,args){var loanId=args.wrappedLoan.ref.loanId;var selectedLoan={LoanId:(loanId==undefined||loanId==null)?null:loanId.trim(),UserAccountId:args.applicationData.currentUser.userAccountId,QueueName:"",ApplicationStep:""};$rootScope.SelectedLoan=selectedLoan;$rootScope.selectedLoanId=loanId;$scope.queueName=selectedLoan.QueueName;$scope.prospectId="";NavigationSvc.SetNavigationLinks(selectedLoan.LoanId);vm.selectedLoanId=loanId;BroadcastSvc.broadcastCotextualBar();return selectedLoan;});function RealodPage(){switch(window.location.hash){case"#/":$rootScope.navigation="";break;case"#/cost/details":$rootScope.navigation="CostDetails";break;case"#/loanApplication/personal":$rootScope.navigation="personal";break;case"#/lockingandpricingadj":$rootScope.navigation="lockingandpricingadj";break;case"#/compliancecenter":$rootScope.navigation="ComplianceCenter";break;case"#/cost/pricing":$rootScope.navigation="ProductAndPricing";break;case"#/queue":$rootScope.navigation="Queue";break;default:$rootScope.navigation="";break;}}function importFnmFile(loanExists,emptyLoanOnCancel,loanPurposeType){importFnmSvc.openImportLoanModal(applicationData,loanExists,emptyLoanOnCancel,loanPurposeType);}function createNewLoanApplication(loanExists,emptyLoanOnCancel,loanPurposeType){if(applicationData.currentUser.isWholesale){importFnmFile(loanExists,emptyLoanOnCancel,loanPurposeType);}else{openLoanApplication("loanCenter.loan.loanApplication.personal",true,loanPurposeType);}}function isLoanLoaded(){if(wrappedLoan&&wrappedLoan.ref){return true;}return false;}function isLoanNumber(){return loanLoaded&&wrappedLoan.ref.loanNumber&&wrappedLoan.ref.loanNumber.trim()!=""&&wrappedLoan.ref.loanNumber.trim().toLower()!="pending";}function isLoanPurposeType(loanPurposeType){return loanLoaded&&wrappedLoan.ref.loanPurposeType==loanPurposeType;}function isLoanApplicationDateSet(){return loanLoaded&&wrappedLoan.ref.sixPiecesAcquiredForAllLoanApplications;}function isIntentToProceedDateSet(){return loanLoaded&&wrappedLoan.ref.isIntentToProceedDateSet();}function isLoanClosed(){return loanLoaded&&wrappedLoan.ref.currentMilestone==srv.milestoneStatus.funded;}function hasPrivilege(priviledge){return applicationData.currentUser.hasPrivilege(priviledge);}function openAntiSteeringModal(){NavigationSvc.openAntiSteeringModal(vm.wrappedLoan.ref.financialInfo.amortizationType,vm.wrappedLoan.ref.antiSteeringOptions,vm.wrappedLoan.ref.areLoanAntiSteeringOptionsCompleted,null);}function updateDisclosureStatusToNotNeeded(loanApplication){if(!loanApplication.disclosureStatusDetails){loanApplication.disclosureStatusDetails=new srv.cls.DisclosureStatusDetailsViewModel();}loanApplication.disclosureStatusDetails.disclosureStatus=srv.DisclosureStatusEnum.NotNeeded;loanApplication.disclosureStatusDetails.disclosureStatusText="Not Needed";loanApplication.disclosureStatusDetails.disclosureStatusReasons=[];loanApplication.alertPanelVisible=false;}function adverseDone(adverseReason){wrappedLoan.ref.adverseReason.reason=adverseReason.reason;wrappedLoan.ref.adverseReason.reasonType=adverseReason.reasonType;wrappedLoan.ref.currentMilestone=enums.milestoneStatus.adverse;lib.forEach(vm.wrappedLoan.ref.getLoanApplications(),function(la){updateDisclosureStatusToNotNeeded(la);});$modalStack.dismissAll("close");NavigationSvc.SaveAndUpdateWrappedLoan(applicationData.currentUserId,wrappedLoan);}function openAdverseModal(){var modalInstance=$modal.open({templateUrl:"angular/navigation/adverse/adversemodalwindow.html",backdrop:"static",windowClass:"imp-center-modal imp-adverse-modal",controller:"adverseController",controllerAs:"adverseCtrl",resolve:{model:function(){return{adverseReason:wrappedLoan.ref.adverseReason};},callBackDone:function(){return adverseDone;},wrappedLoan:function(){return wrappedLoan;},applicationData:function(){return applicationData;}}});}}})();(function(){angular.module("loanCenter").controller("antiSteeringController",antiSteeringController);antiSteeringController.$inject=["$modalStack","amortizationType","antiSteeringOptions","optionsCompletedCallBack","submitForApprovalCallBack"];function antiSteeringController($modalStack,amortizationType,antiSteeringOptions,optionsCompletedCallBack,submitForApprovalCallBack){var vm=this;vm.amortizationType=amortizationType;vm.antiSteeringOptions=antiSteeringOptions;vm.optionsCompletedCallBack=optionsCompletedCallBack;vm.submitForApprovalCallBack=submitForApprovalCallBack;vm.cancel=cancel;vm.done=done;vm.isDoneDisabled=isDoneDisabled;vm.initialize=initialize();function cancel(){$modalStack.dismissAll("cancel");}function initialize(){vm.amortizationTypeText=vm.amortizationType==1?"Fixed Rate Loan Options":"Adjustable Rate Loan Options";vm.model=angular.copy(vm.antiSteeringOptions);}function done(){angular.extend(vm.antiSteeringOptions,vm.model);$modalStack.dismissAll("cancel");if(vm.submitForApprovalCallBack){vm.submitForApprovalCallBack();}}function isDoneDisabled(){return !vm.optionsCompletedCallBack(vm.model);}}})();var loanCenter;(function(loanCenter){var adverseController=(function(){function adverseController(model,$modalStack,callBackDone,wrappedLoan,applicationData){var _this=this;this.model=model;this.$modalStack=$modalStack;this.callBackDone=callBackDone;this.wrappedLoan=wrappedLoan;this.applicationData=applicationData;this.done=function(){_this.callBackDone(_this.adverseReason);};this.cancel=function(){_this.$modalStack.dismissAll("close");};this.adverseDisabled=function(){return(!_this.showComment()||common.string.isNullOrWhiteSpace(_this.adverseReason.reason));};this.getAdverseReasons=function(){var flag_refinance=1;var flag_common=2;var flag_purchase=3;var currentContext=flag_refinance;var reasons=lib.filter(_this.applicationData.lookup.adverseReasons,function(reason){return reason.value==0;});if(_this.wrappedLoan.ref.loanPurposeType==1&&_this.wrappedLoan.ref.homeBuyingType==3){currentContext=flag_purchase;}lib.forEach(_this.applicationData.lookup.adverseReasons,function(reason){if(reason.contextFlags==flag_common||reason.contextFlags==currentContext){reasons.push(reason);}});return reasons;};this.showComment=function(){return(_this.adverseReason.reasonType!=null&&_this.adverseReason.reasonType!=0);};this.adverseReason=new srv.cls.AdverseReasonViewModel();if(this.model.adverseReason){angular.extend(this.adverseReason,this.model.adverseReason);}}adverseController.className="adverseController";adverseController.$inject=["model","$modalStack","callBackDone","wrappedLoan","applicationData"];return adverseController;})();loanCenter.adverseController=adverseController;angular.module("loanCenter").controller("adverseController",adverseController);})(loanCenter||(loanCenter={}));(function(){angular.module("loanCenter").controller("LoanApplicationTabCtrl",LoanApplicationTabController);LoanApplicationTabController.$inject=["NavigationSvc","wrappedLoan","$state","applicationData","$location","$anchorScroll","enums","$timeout"];function LoanApplicationTabController(NavigationSvc,wrappedLoan,$state,applicationData,$location,$anchorScroll,enums,$timeout){var vm=this;vm.wrappedLoan=wrappedLoan;vm.loanAppTabs=NavigationSvc.LoanAppTabs;vm.navigateTabs=navigateTabs;vm.cancelChanges=cancelChanges;vm.saveAll=saveAll;vm.NavigationSvc=NavigationSvc;vm.nextPreviousNavigation=nextPreviousNavigation;vm.isPreviousDisabled=isPreviousDisabled;vm.isTabSelected=isTabSelected;NavigationSvc.contextualType=enums.ContextualTypes.LoanApplication;vm.flipPurpose=flipPurpose;vm.canFlip=vm.wrappedLoan.ref.leadManagerId!==undefined&&vm.wrappedLoan.ref.leadManagerId.length>0&&(vm.wrappedLoan.ref.product.programName==""||vm.wrappedLoan.ref.product.programName==undefined||vm.wrappedLoan.ref.product.programName==null);function flipPurpose(){wrappedLoan.ref.loanPurposeType=wrappedLoan.ref.loanPurposeType==2?1:2;saveAll();}function navigateTabs(state){if(!wrappedLoan.ref.active.areTabsDisabled()){$state.go(state);}}function cancelChanges(){NavigationSvc.cancelChanges(wrappedLoan.ref.loanId);}function saveAll(){if(!wrappedLoan.ref.isValidForSave()){$location.hash("borrowerSection");$anchorScroll.yOffset=280;$anchorScroll();return;}wrappedLoan.ref.selectedAppIndex=wrappedLoan.ref.getLoanApplications().indexOf(wrappedLoan.ref.active);$timeout(function(){NavigationSvc.SaveAndUpdateWrappedLoan(applicationData.currentUserId,wrappedLoan);});}function nextPreviousNavigation(direction){var command;switch($state.current.name){case"loanCenter.loan.loanApplication.personal":command=direction==1?getStateAndActiveTab("loanCenter.loan.loanApplication.property","Property"):getStateAndActiveTab("loanCenter.loan.loanApplication.personal","Personal");break;case"loanCenter.loan.loanApplication.property":command=direction==1?getStateAndActiveTab("loanCenter.loan.loanApplication.assets","Assets"):getStateAndActiveTab("loanCenter.loan.loanApplication.personal","Personal");break;case"loanCenter.loan.loanApplication.assets":command=direction==1?getStateAndActiveTab("loanCenter.loan.loanApplication.credit.details","Credit"):getStateAndActiveTab("loanCenter.loan.loanApplication.property","Property");break;case"loanCenter.loan.loanApplication.credit.details":command=direction==1?getStateAndActiveTab("loanCenter.loan.loanApplication.declarations","Declarations"):getStateAndActiveTab("loanCenter.loan.loanApplication.assets","Assets");break;case"loanCenter.loan.loanApplication.declarations":command=direction==1?getStateAndActiveTab("loanCenter.loan.loanApplication.income","Income"):getStateAndActiveTab("loanCenter.loan.loanApplication.credit.details","Credit");break;case"loanCenter.loan.loanApplication.income":if(direction==1){if(this.wrappedLoan.ref.vaInformation.isvaLoan){command=getStateAndActiveTab("loanCenter.loan.vacenter.generalinformation","Income");}else{command=getStateAndActiveTab("loanCenter.loan.loanDetails.sections","Income");}}else{command=getStateAndActiveTab("loanCenter.loan.loanApplication.declarations","Declarations");}break;}angular.forEach(NavigationSvc.LoanAppTabs,function(tab,tabName){if(command.selectedTab.toLowerCase()===tabName.toLowerCase()){tab.isSelected=true;}else{tab.isSelected=false;}});$state.go(command.navigateToState);}function getStateAndActiveTab(state,tab){return{navigateToState:state,selectedTab:tab};}function isPreviousDisabled(){return $state.current.name=="loanCenter.loan.loanApplication.personal";}function isTabSelected(stateName){return $state.current.name==stateName;}}})();(function(){angular.module("contextualBar",["loan.calculator"]);})();(function(){angular.module("contextualBar").factory("comparisonSvc",comparisonSvc);comparisonSvc.$inject=["$resource","apiRoot"];function comparisonSvc($resource,apiRoot){var comparisonApiPath=apiRoot+"Comparison/";var comparisonServices=$resource(comparisonApiPath+":action",{path:"@action"},{getComparisonHistory:{method:"GET",params:{loanId:"loanId",userAccountId:"userAccountId"}}});var service={comparisonServices:comparisonServices};return service;}})();var contextualBar;(function(contextualBar){var ContextualBarSvc=(function(){function ContextualBarSvc(NavigationSvc){var _this=this;this.NavigationSvc=NavigationSvc;this.getAusType=function(loan,ausTypesLookup){lib.assert(loan,"Invalid argument: Loan");lib.assert(loan.product,"Invalid argument: Loan.Product");var ausTypes=loan.product.loanAusTypes;if(!ausTypes){return;}var ausTypesStringCollection=[];for(var i=0;i<ausTypes.length;i++){ausTypesLookup.filter(function(a){return a.value==ausTypes[i];}).forEach(function(ausType){return ausTypesStringCollection.push(ausType.text);});}return common.string.buildCommaSeparatedString(ausTypesStringCollection);};this.getContextualName=function(applicationData,selectedContextualType){if(selectedContextualType){return applicationData.lookup.contextualTypes.filter(function(c){return c.value==selectedContextualType;})[0].text;}};this.getContextualType=function(){return _this.NavigationSvc.contextualType;};}ContextualBarSvc.$inject=["NavigationSvc"];ContextualBarSvc.className="ContextualBarSvc";return ContextualBarSvc;})();contextualBar.ContextualBarSvc=ContextualBarSvc;moduleRegistration.registerService("contextualBar",ContextualBarSvc);})(contextualBar||(contextualBar={}));(function(){angular.module("contextualBar").controller("comparisonPDFController",comparisonPDFController);comparisonPDFController.$inject=["loan","applicationData","comparison","enums","$modal","$controller","modalPopoverFactory"];function comparisonPDFController(loan,applicationData,comparison,enums,$modal,$controller,modalPopoverFactory){var vm=this;angular.extend(this,$controller("DocumentCtrl",{$scope:vm}));vm.rowData=comparison.sentEmailItems;vm.openModal=openModal;vm.openTooltip=openTooltip;vm.multipleRecipients=[];function getLookupDescriptionForValue(value,lookupName){if(applicationData.lookup[lookupName]){for(var i=0;i<applicationData.lookup[lookupName].length-1;i++){if(applicationData.lookup[lookupName][i].value==value){return applicationData.lookup[lookupName][i].text;}}}return"";}function percentageRenderer(params){return'<div style="padding-left:10px;">'+params.value+"%</div>";}function openModal(params){var instance=$modal.open({templateUrl:"angular/contextualbar/comparisonpdf/simplecontentmodal.html",windowClass:"simple-content-modal",controller:"simpleContentModalController",controllerAs:"simpleContent",resolve:{comparisonParams:function(){return params;}}});}function openTooltip(params){var emails=params.split(",");var otherEmails=emails[1].split(";");vm.multipleRecipients=[];vm.multipleRecipients.push(emails[0]);vm.multipleRecipients=vm.multipleRecipients.concat(otherEmails);var sectionSevenPopup=modalPopoverFactory.openModalPopover("angular/contextualbar/comparisonpdf/multiplerecipients.html",vm,{},event,{arrowRight:false,className:"tooltip-arrow-left",verticalPopupPositionPerHeight:0,horisontalPopupPositionPerWidth:0.33});}function renderHeadersToTheRight(params){var header=renderHeader(params.colDef.headerName);header.style.textAlign="right";return header;}function renderPercentageHeaders(params){var header=renderHeader(params.colDef.headerName);header.style.paddingLeft="8px";return header;}function renderHeader(headerName){var eHeader=document.createElement("div");var eTitle=document.createTextNode(headerName);eHeader.appendChild(eTitle);return eHeader;}var purchaseColumns=[{headerName:"",width:30,field:"number",icons:{menu:"<i/>"},headerClass:"ag-header-cell-without-style",suppressSorting:true,cellRenderer:function(params){params.$scope.downloadDocument=vm.DownloadDocument;return'<div style="background: url(../../Content/LoanCenterSprite.png);background-position: -148px -245px; width: 18px; height: 30px; position: absolute; top:4px;" ng-click=downloadDocument('+"'"+params.data.reportRepositoryItemId+"'"+")></div>";},cellClass:"columnDefault"},{headerName:"",field:"htmlContent",width:40,icons:{menu:"<i/>"},headerClass:"ag-header-cell-without-style",suppressSorting:true,cellRenderer:function(params){if(!params.data.isWhatIfRateOption){params.$scope.openModal=vm.openModal;return'<div style="background: url(../../Content/LoanCenterSprite.png);background-position: -123px -242px; width: 26px; height: 30px; position: absolute; top:2px;" ng-click="openModal(data)"></div>';}return"";}},{headerName:"Recipients",width:170,filter:"set",field:"emailAddress",cellRenderer:function(params){if(!params.data.isWhatIfRateOption){var email=params.value.split(",");if(email.length>1){params.$scope.openTooltip=vm.openTooltip;var a=email[0].length>26?email[0].substring(0,25):email[0];return'<div style="color:#208ddc;" ng-click="openTooltip(data.emailAddress)">'+a+"...</div>";}return"<span>"+params.value+"</span>";}else{return'<span style="color: #9d9d9d">none - save only</span>';}}},{headerName:"Property",field:"propertyType",cellRenderer:function(params){return getLookupDescriptionForValue(params.value,"subjectPropertyTypes");},width:100,},{headerName:"Occupancy",field:"occupancyType",cellRenderer:function(params){return getLookupDescriptionForValue(params.value,"occupancyTypeListGrid");},width:90},{headerName:"Purch Pr.",field:"purchasePrice",width:80,cellStyle:{"text-align":"right"},cellRenderer:function(params){return'<span>{{data.purchasePrice | impCurrency:"$":0}}</span>';},headerCellRenderer:renderHeadersToTheRight},{headerName:"Loan Amt",field:"loanAmount",width:90,cellStyle:{"text-align":"right"},cellRenderer:function(params){return'<span>{{data.loanAmount | impCurrency:"$":0}}</span>';},headerCellRenderer:renderHeadersToTheRight},{headerName:"Down Pmt",field:"downPayment",width:90,cellStyle:{"text-align":"right"},cellRenderer:function(params){return'<span>{{data.downPayment | impCurrency:"$":0}}</span>';},headerCellRenderer:renderHeadersToTheRight},{headerName:"DTI",field:"dti",cellRenderer:percentageRenderer,width:60,headerCellRenderer:renderPercentageHeaders},{headerName:"LTV",field:"ltv",cellRenderer:percentageRenderer,width:70,headerCellRenderer:renderPercentageHeaders},{headerName:"FICO",field:"fico",width:70,},{headerName:"Impounds",field:"impounds",cellRenderer:function(params){return getLookupDescriptionForValue(params.value,"impoundListGrid");},width:80},{headerName:"Created",cellRenderer:function(params){return new Date(params.data.dateCreated.replace("T"," ")).format("MM/dd/yy h:mmtt");},width:110}];var refiColumns=[{headerName:"",width:30,field:"number",icons:{menu:"<i/>"},headerClass:"ag-header-cell-without-style",suppressSorting:true,cellRenderer:function(params){params.$scope.downloadDocument=vm.DownloadDocument;return'<div style="background: url(../../Content/LoanCenterSprite.png);background-position: -148px -245px; width: 18px; height: 30px; position: absolute; top:4px;" ng-click=downloadDocument('+"'"+params.data.reportRepositoryItemId+"'"+")></div>";},cellClass:"columnDefault"},{headerName:"",field:"htmlContent",width:40,icons:{menu:"<i/>"},headerClass:"ag-header-cell-without-style",suppressSorting:true,cellRenderer:function(params){if(!params.data.isWhatIfRateOption){params.$scope.openModal=vm.openModal;return'<div style="background: url(../../Content/LoanCenterSprite.png);background-position: -123px -242px; width: 26px; height: 30px; position: absolute; top:2px;" ng-click="openModal(data)"></div>';}return"";}},{headerName:"Recipients",width:170,filter:"set",field:"emailAddress",cellRenderer:function(params){if(!params.data.isWhatIfRateOption){var email=params.value.split(",");if(email.length>1){params.$scope.openTooltip=vm.openTooltip;var a=email[0].length>26?email[0].substring(0,25):email[0];return'<div style="color:#208ddc;" ng-click="openTooltip(data.emailAddress)">'+a+"...</div>";}return"<span>"+params.value+"</span>";}else{return'<span style="color: #9d9d9d">none - save only</span>';}}},{headerName:"Property",field:"propertyType",cellRenderer:function(params){return getLookupDescriptionForValue(params.value,"subjectPropertyTypes");},width:100,},{headerName:"Occupancy",field:"occupancyType",cellRenderer:function(params){return getLookupDescriptionForValue(params.value,"occupancyTypeListGrid");},width:90},{headerName:"Est. Value",field:"estimatedValue",width:80,cellStyle:{"text-align":"right"},cellRenderer:function(params){return'<span>{{data.estimatedValue | impCurrency:"$":0}}</span>';},headerCellRenderer:renderHeadersToTheRight},{headerName:"Loan Amt",field:"loanAmount",width:90,cellStyle:{"text-align":"right"},cellRenderer:function(params){return'<span>{{data.loanAmount | impCurrency:"$":0}}</span>';},headerCellRenderer:renderHeadersToTheRight},{headerName:"Cash Out",field:"cashout",width:90,cellStyle:{"text-align":"right"},cellRenderer:function(params){return'<span>{{data.cashout | impCurrency:"$":0}}</span>';},headerCellRenderer:renderHeadersToTheRight},{headerName:"DTI",field:"dti",cellRenderer:percentageRenderer,width:60,headerCellRenderer:renderPercentageHeaders},{headerName:"LTV",field:"ltv",cellRenderer:percentageRenderer,width:70,headerCellRenderer:renderPercentageHeaders},{headerName:"FICO",field:"fico",width:70,},{headerName:"Impounds",field:"impounds",cellRenderer:function(params){return getLookupDescriptionForValue(params.value,"impoundListGrid");},width:80},{headerName:"Created",cellRenderer:function(params){return new Date(params.data.dateCreated.replace("T"," ")).format("MM/dd/yy h:mmtt");},width:110}];vm.gridOptions={columnDefs:loan.ref.loanPurposeType==enums.LoanTransactionTypes.Purchase?purchaseColumns:refiColumns,rowSelection:"single",enableSorting:false,rowData:vm.rowData,enableFilter:false,enableColResize:false,enableServerSideSorting:true,dontUseScrolls:false,angularCompileRows:true};}})();(function(){angular.module("contextualBar").controller("simpleContentModalController",simpleContentModalController);simpleContentModalController.$inject=["$modal","comparisonParams","$sce","$modalInstance"];function simpleContentModalController($modal,comparisonParams,$sce,$modalInstance){var vm=this;vm.params=comparisonParams;vm.renderHtml=renderHtml;vm.close=close;function close(){$modalInstance.dismiss("cancel");}function renderHtml(htmlText){var text=$("<html/>").html(htmlText).find("#Table_01 tr:eq(1) td:eq(1)").html();if(!text){text=$("<table/>").html(htmlText).find("tr td:eq(1)").html();}return $sce.trustAsHtml(text.replace(/color: #767676;/g,""));}}})();(function(){angular.module("contextualBar").controller("ContextualBarCtrl",ContextualBarController);ContextualBarController.$inject=["$rootScope","$scope","ContextualBarSvc","NavigationSvc","enums","wrappedLoan","$log","applicationData","$modal","loanDetailsSvc","comparisonSvc","$timeout","$filter","commonCalculatorSvc"];function ContextualBarController($rootScope,$scope,ContextualBarSvc,NavigationSvc,enums,wrappedLoan,$log,applicationData,$modal,loanDetailsSvc,comparisonSvc,$timeout,$filter,commonCalculatorSvc){var vm=this;vm.enums=enums;vm.wrappedLoan=wrappedLoan;vm.applicationData=applicationData;vm.loanDetailsSvc=loanDetailsSvc;vm.milestoneStatuses=getMilestoneStatuses();vm.leadStatuses=applicationData.lookup.leadStatuses;vm.loanStatus=loanStatus;vm.leadStatus="";vm.loanStatusDropdownOpened=false;vm.leadStatusDropdownOpened=false;vm.alertExpanded=false;var modalOpened=false;var modalInstance={};var manualDTI=0;vm.contextualTypes=applicationData.lookup.contextualTypes;vm.hasModifyMilestonePrivilege=hasModifyMilestonePrivilege;vm.changeLoanStatusDropdownOpened=changeLoanStatusDropdownOpened;vm.handleDocumentClick=handleDocumentClick;document.onclick=vm.handleDocumentClick;vm.dropdownStatusChanged=dropdownStatusChanged;vm.toggleComparisonModal=toggleComparisonModal;vm.getContextualName=getContextualName;vm.getContextualType=getContextualType;vm.getDTI=getDTI;vm.isApplicationDateVisible=isApplicationDateVisible;vm.onAppliationDateBlur=onAppliationDateBlur;vm.isLoanNumberVisible=isLoanNumberVisible;vm.loanApplicationsForStatuses;vm.getLowestMiddleFicoScore=getLowestMiddleFicoScore;vm.isManualSelection=isManualSelection;vm.toggleIsAlertExpanded=toggleIsAlertExpanded;$scope.$watch(function(){return wrappedLoan.ref.areSixPiecesAcquiredForAllLoanApplications();});function toggleIsAlertExpanded(){vm.alertExpanded=!vm.alertExpanded;NavigationSvc.setBodyPosition();}function loanStatus(currentMilestoneVal){var currentMilestone=_.find(vm.milestoneStatuses,function(milestoneStatus){return milestoneStatus.value==currentMilestoneVal;});if(currentMilestone){return currentMilestone.text;}}var currentLeadStatus=_.find(vm.leadStatuses,function(leadStatus){return leadStatus.value==wrappedLoan.ref.leadStatus;});if(currentLeadStatus){vm.leadStatus=currentLeadStatus.text;}vm.moreThanFourReasons=moreThanFourReasons;vm.alertPanelVisible=alertPanelVisible;vm.getComplianceDate=getComplianceDate;vm.temporaryComplianceDate="";vm.temporaryAutoDiscloseTime="";vm.currentLoanStateName="";vm.initializeComplianceDate=initializeComplianceDate;vm.getComplianceDateCallInProgress=false;vm.areDisclosuresCreatedForAnyLoanApplication=false;vm.originalApplicationDate=vm.wrappedLoan.ref.applicationDate;vm.initializeComplianceDate();function getContextualName(){return ContextualBarSvc.getContextualName(applicationData,ContextualBarSvc.getContextualType());}function getContextualType(){return ContextualBarSvc.getContextualType();}function getMilestoneStatuses(){var Flag_RetailChannel=1;var Flag_WholesaleChannel=2;var currentContext=Flag_RetailChannel;var userChannel=_.filter(applicationData.companyProfile.channels,function(channel){return channel.channelId==wrappedLoan.ref.channelId;});if(userChannel&&userChannel.length==1&&userChannel[0].isWholesale){currentContext=Flag_WholesaleChannel;}var milestoneStatuses=_.filter(applicationData.lookup.milestonestatuses,function(milestonestatus){return milestonestatus.contextFlags&currentContext;});lib.forEach(milestoneStatuses,function(e){if(vm.wrappedLoan.ref.isMilestoneStatusManual&&e.value==vm.wrappedLoan.ref.currentMilestone){e.selected=true;}else{e.selected=false;}});return milestoneStatuses;}function isManualSelection(milestoneStatus){return vm.wrappedLoan.ref.isMilestoneStatusManual&&vm.wrappedLoan.ref.currentMilestone==milestoneStatus;}function moreThanFourReasons(){return vm.wrappedLoan.ref.active.disclosureStatusDetails&&vm.wrappedLoan.ref.active.disclosureStatusDetails.disclosureStatusReasons&&vm.wrappedLoan.ref.active.disclosureStatusDetails.disclosureStatusReasons.length>4;}function alertPanelVisible(){var allLoanAplications=vm.wrappedLoan.ref.getLoanApplications();vm.areDisclosuresCreatedForAnyLoanApplication=allLoanAplications.filter(function(item){return item.disclosureStatusDetails&&item.disclosureStatusDetails.disclosureStatus==srv.DisclosureStatusEnum.DisclosuresCreated;}).length>0;vm.loanApplicationsForStatuses=allLoanAplications.filter(function(item){return alertPanelVisibleStatuses(item);});updateDisclosureStatusMessages(vm.loanApplicationsForStatuses);vm.wrappedLoan.ref.active.alertPanelVisible=vm.selectedContextualType!=vm.enums.ContextualTypes.Queue&&(alertPanelVisibleStatuses(vm.wrappedLoan.ref.active)||vm.areDisclosuresCreatedForAnyLoanApplication);return vm.wrappedLoan.ref.active.alertPanelVisible;}function alertPanelVisibleStatuses(loanApp){return loanApp.disclosureStatusDetails&&(loanApp.disclosureStatusDetails.disclosureStatus==srv.DisclosureStatusEnum.InitialDisclosureRequired||loanApp.disclosureStatusDetails.disclosureStatus==srv.DisclosureStatusEnum.ReDisclosureRequired||loanApp.disclosureStatusDetails.disclosureStatus==srv.DisclosureStatusEnum.RequestInProgress||loanApp.disclosureStatusDetails.disclosureStatus==srv.DisclosureStatusEnum.DisclosuresCreated);}function initializeComplianceDate(){if(vm.selectedContextualType!=vm.enums.ContextualTypes.Queue){vm.getComplianceDateCallInProgress=true;var appDate=vm.wrappedLoan.ref.applicationDate;if(!vm.wrappedLoan.ref.applicationDate||moment("0001-01-01").diff(moment(vm.wrappedLoan.ref.applicationDate))==0){appDate=new Date();}vm.loanDetailsSvc.getComplianceDate.getComplianceDate({appDate:appDate,stateName:vm.wrappedLoan.ref.getSubjectProperty().stateName}).$promise.then(function(data){vm.currentLoanStateName=vm.wrappedLoan.ref.getSubjectProperty().stateName;if(data&&data.complianceDate){vm.temporaryComplianceDate=(moment(data.complianceDate)).format("MM/DD/YY");vm.temporaryAutoDiscloseTime=(moment(data.autoDiscloseTime)).format("hh:mm A");}vm.getComplianceDateCallInProgress=false;},function(errorMsg){vm.currentLoanStateName="";vm.getComplianceDateCallInProgress=false;$log.error(errorMsg);});}}function getComplianceDate(){if(!vm.getComplianceDateCallInProgress&&vm.wrappedLoan.ref.active&&vm.wrappedLoan.ref.active.alertPanelVisible&&!!vm.wrappedLoan.ref.getSubjectProperty().stateName&&(!vm.temporaryComplianceDate||vm.currentLoanStateName!=vm.wrappedLoan.ref.getSubjectProperty().stateName)){vm.currentLoanStateName=vm.wrappedLoan.ref.getSubjectProperty().stateName;vm.initializeComplianceDate();}return vm.temporaryComplianceDate;}function hasModifyMilestonePrivilege(){return !!_.find(applicationData.currentUser.privileges,function(userPrivilege){return userPrivilege.category&&userPrivilege.category==88;});}function changeLoanStatusDropdownOpened(){if(hasModifyMilestonePrivilege()){vm.loanStatusDropdownOpened=!vm.loanStatusDropdownOpened;}}function handleDocumentClick(){if(vm.loanStatusDropdownOpened&&hasModifyMilestonePrivilege()){vm.loanStatusDropdownOpened=!vm.loanStatusDropdownOpened;}}function dropdownStatusChanged(status,statusType){switch(statusType){case vm.enums.contextualBarDropDownTypes.milestoneStatus:if(wrappedLoan.ref.isMilestoneStatusManual&&wrappedLoan.ref.currentMilestone==status.value){wrappedLoan.ref.isMilestoneStatusManual=false;status.selected=false;wrappedLoan.ref.currentMilestone=wrappedLoan.ref.originalMilestoneStatus;}else{wrappedLoan.ref.isMilestoneStatusManual=true;lib.forEach(vm.milestoneStatuses,function(e){e.selected=false;});status.selected=true;wrappedLoan.ref.currentMilestone=status.value;}loanStatus(wrappedLoan.ref.currentMilestone);break;case vm.enums.contextualBarDropDownTypes.leadStatus:vm.leadStatus=status.text;wrappedLoan.ref.leadStatus=status.value;break;}}function toggleComparisonModal(){if(!modalOpened){modalOpened=true;modalInstance=$modal.open({templateUrl:"angular/contextualbar/comparisonpdf/comparisonreportmodal.html",controller:"comparisonPDFController",controllerAs:"comparisonPDF",windowClass:"comparison-modal-window .modal-dialog",backdropClass:"comparison-modal-backdrop",resolve:{loan:function(){return vm.wrappedLoan;},applicationData:function(){return vm.applicationData;},comparison:function(){return comparisonSvc.comparisonServices.getComparisonHistory({loanId:vm.wrappedLoan.ref.loanId,userAccountId:vm.applicationData.currentUser.userAccountId}).$promise.then(function(data){return data;},function(error){$log.error("Failure loading Comparison history details",error);});}}});}else{modalInstance.dismiss("cancel");}modalInstance.result.then(function(){},function(){modalOpened=false;});}function getDTI(){if(!manualDTI||(manualDTI!=wrappedLoan.ref.financialInfo.dti&&wrappedLoan.ref.financialInfo.dti)){manualDTI=wrappedLoan.ref.financialInfo.dti;}wrappedLoan.ref.financialInfo.dti=wrappedLoan.ref.financialInfo.dti?wrappedLoan.ref.financialInfo.dti:manualDTI;return wrappedLoan.ref.financialInfo.dti;}function onAppliationDateBlur(){if(!vm.wrappedLoan.ref.applicationDate){$timeout(function(){vm.wrappedLoan.ref.applicationDate=vm.originalApplicationDate;},200);}}function isApplicationDateVisible(){var originalApplicationDateEmpty=!vm.originalApplicationDate||vm.originalApplicationDate=="0001-01-01T00:00:00";var applicationDateEmpty=!vm.wrappedLoan.ref.applicationDate||vm.wrappedLoan.ref.applicationDate=="0001-01-01T00:00:00";if(originalApplicationDateEmpty&&!applicationDateEmpty){vm.originalApplicationDate=vm.wrappedLoan.ref.applicationDate;originalApplicationDateEmpty=applicationDateEmpty;}return !originalApplicationDateEmpty;}function isLoanNumberVisible(){return vm.wrappedLoan.ref.shouldLoanNumberBeVisible();}function updateDisclosureStatusMessages(loanApps){for(var i=0;i<loanApps.length;i++){setDisclosureStatusMessage(loanApps[i]);loanApps[i].setDisclosureStatusTitle();}}function setDisclosureStatusMessage(loanApp){var areDisclosuresCreated=loanApp.disclosureStatusDetails.disclosureStatus&&loanApp.disclosureStatusDetails.disclosureStatus==srv.DisclosureStatusEnum.DisclosuresCreated;if(areDisclosuresCreated&&loanApp.docDelivery==srv.docDeliveryTypeEnum.Mail){loanApp.disclosureStatusDetails.disclosureStatusDetailsMessageBody="waiting to be Mailed for "+loanApp.getBorrower().getFullName()+(loanApp.isSpouseOnTheLoan?", "+loanApp.getCoBorrower().getFullName():"")+".";}else{if(areDisclosuresCreated&&loanApp.docDelivery==srv.docDeliveryTypeEnum.Electronic&&loanApp.getBorrower().eConsent.consentStatus==srv.ConsentStatusEnum.None){loanApp.disclosureStatusDetails.disclosureStatusDetailsMessageBody=loanApp.getBorrower().getFullName()+" must eConsent or the Disclosure Package will be mailed on "+$filter("date")(vm.getComplianceDate(),"MM/dd/yyyy")+" at "+vm.temporaryAutoDiscloseTime+" PST";}else{loanApp.disclosureStatusDetails.disclosureStatusDetailsMessageBody="will be created and sent on "+$filter("date")(vm.getComplianceDate(),"MM/dd/yyyy")+" at "+vm.temporaryAutoDiscloseTime+".";}}}function getLowestMiddleFicoScore(){var midFicoScore=commonCalculatorSvc.GetLowestMiddleFicoScore(vm.wrappedLoan,vm.applicationData);return midFicoScore;}}})();var loanCenter;(function(loanCenter){var ContextualBarDetailsController=(function(){function ContextualBarDetailsController($rootScope,$scope,ContextualBarSvc,enums,LoanCalculator,wrappedLoan,applicationData,loanService,userAccountId,modalPopoverFactory,commonCalculatorSvc){var _this=this;this.$rootScope=$rootScope;this.$scope=$scope;this.ContextualBarSvc=ContextualBarSvc;this.enums=enums;this.LoanCalculator=LoanCalculator;this.wrappedLoan=wrappedLoan;this.applicationData=applicationData;this.loanService=loanService;this.userAccountId=userAccountId;this.modalPopoverFactory=modalPopoverFactory;this.commonCalculatorSvc=commonCalculatorSvc;this.getAusType=function(){return _this.ContextualBarSvc.getAusType(_this.wrappedLoan.ref,_this.applicationData.lookup.ausTypes);};this.GetIconColor=function(numberparam){return numberparam>=0?_this.enums.iconColors.active:_this.enums.iconColors.expired;};this.IsDateTextExpired=function(numberparam){return numberparam<0;};this.IsDescriptionTextExpired=function(numberparam){return numberparam<=0;};this.getLowestMiddleFicoScore=function(){var midFicoScore=_this.commonCalculatorSvc.GetLowestMiddleFicoScore(_this.wrappedLoan,_this.applicationData);return midFicoScore;};var self=this;self.IsVisible=false;self.iconColors=self.enums.iconColors;this.loan=this.wrappedLoan.ref;self.lowerDecisionScore=self.getLowestMiddleFicoScore();$scope.$on("REFRESHCotextualBar",function(event){self.lowerDecisionScore=self.getLowestMiddleFicoScore();});}ContextualBarDetailsController.className="ContextualBarDetailsController";ContextualBarDetailsController.$inject=["$rootScope","$scope","ContextualBarSvc","enums","LoanCalculator","wrappedLoan","applicationData","loanService","userAccountId","modalPopoverFactory","commonCalculatorSvc"];return ContextualBarDetailsController;})();loanCenter.ContextualBarDetailsController=ContextualBarDetailsController;angular.module("contextualBar").controller("ContextualBarDetailsCtrl",ContextualBarDetailsController);})(loanCenter||(loanCenter={}));(function(){angular.module("loanCenter").controller("ContextualBarCostDetailsCtrl",contextualBarCostDetailsController);contextualBarCostDetailsController.$inject=["$scope","$location","anchorSmoothScroll","$modal","enums","wrappedLoan","costDetailsSvc","$q","$rootScope","TransactionalSummaryService"];function contextualBarCostDetailsController($scope,$location,anchorSmoothScroll,$modal,enums,wrappedLoan,costDetailsSvc,$q,$rootScope,TransactionalSummaryService){var vm=this;vm.enums=enums;vm.wrappedLoan=wrappedLoan;vm.totals={};vm.zeroPercentTolerance=0;vm.tenPercentTolerance=0;vm.toggleAutomatedFees=function(){vm.wrappedLoan.ref.smartGFEEnabled=!vm.wrappedLoan.ref.smartGFEEnabled;};vm.scrollTo=function(id){var old=$location.hash();$location.hash(id);anchorSmoothScroll(id,169);$location.hash(old);};vm.getColorCode=function(value,threshHold){return(parseFloat(value)>parseFloat(threshHold))?"alert-red":"primary-green";};$scope.$on("CostDetailsLoaded",function(event){vm.totals=costDetailsSvc.wrappedLoan.ref.closingCost.totals;if(costDetailsSvc.activeToleranceData&&costDetailsSvc.activeToleranceData.zeroTolerance){vm.zeroPercentTolerance=costDetailsSvc.activeToleranceData.zeroTolerance.changePercent;}if(costDetailsSvc.activeToleranceData&&costDetailsSvc.activeToleranceData.tenPercentTolerance){vm.tenPercentTolerance=costDetailsSvc.activeToleranceData.tenPercentTolerance.changePercent;}vm.totalFromBorrower=TransactionalSummaryService.calculate(wrappedLoan.ref.transactionSummary,wrappedLoan.ref);});$scope.$on("CostDetailsTotalsUpdated",function(event){vm.totals=costDetailsSvc.wrappedLoan.ref.closingCost.totals;vm.totalFromBorrower=TransactionalSummaryService.calculate(wrappedLoan.ref.transactionSummary,wrappedLoan.ref);costDetailsSvc.updateActiveToleranceTotals().then(function(data){vm.zeroPercentTolerance=data.zeroTolerance==undefined?0:data.zeroTolerance.changePercent;vm.tenPercentTolerance=data.tenPercentTolerance==undefined?0:data.tenPercentTolerance.changePercent;},function(errorMsg){console.log("Error:"+JSON.stringify(errorMsg));});});vm.toleranceModal=function(){var modalInstance=$modal.open({templateUrl:"angular/contextualbar/costdetails/tolerancemodal.html",controller:"toleranceModalController",controllerAs:"toleranceModalCtrl",backdrop:"static",windowClass:"imp-modal flyout imp-model-tolerance-modal",resolve:{costDetailsSvc:function(){return costDetailsSvc;},$q:function(){return $q;},$rootScope:function(){return $rootScope;},$scope:function(){return $scope;}}});};}})();var contextualBar;(function(contextualBar){var contextualTitleController=(function(){function contextualTitleController(ContextualBarSvc,NavigationSvc,applicationData,enums){var _this=this;this.ContextualBarSvc=ContextualBarSvc;this.NavigationSvc=NavigationSvc;this.applicationData=applicationData;this.enums=enums;this.getContextualName=function(){return _this.ContextualBarSvc.getContextualName(_this.applicationData,_this.ContextualBarSvc.getContextualType());};this.getContextualType=function(){return _this.ContextualBarSvc.getContextualType();};var self=this;self.ContextualBarSvc=ContextualBarSvc;self.enums=enums.ContextualTypes.Queue;self.applicationData=applicationData;}contextualTitleController.className="contextualTitleController";contextualTitleController.$inject=["ContextualBarSvc","NavigationSvc","applicationData","enums"];return contextualTitleController;})();contextualBar.contextualTitleController=contextualTitleController;moduleRegistration.registerController("contextualBar",contextualTitleController);})(contextualBar||(contextualBar={}));(function(){angular.module("loanCenter").directive("impTolerance",function(){return{restrict:"E",templateUrl:"angular/contextualbar/costdetails/tolerance.html",scope:{"model":"=","costs":"=","headerTitle":"@","lastSection":"&","threshHold":"@"},controller:function($scope,$element,$attrs){$scope.unlimitedTolerance=($attrs.unlimitedTolerance=="false")?false:true;$scope.lastSection=($attrs.lastSection=="false")?false:true;$scope.getColorCode=function(value){if(parseFloat($scope.threshHold)==100){return(parseFloat(value)>0)?"alert-red":"primary-green";}return(parseFloat(value)>parseFloat($scope.threshHold))?"alert-red":"primary-green";};}};});})();(function(){angular.module("loanCenter").directive("impToleranceSelect",["costDetailsSvc","$rootScope",function(costDetailsSvc,$rootScope){return{restrict:"E",templateUrl:"angular/contextualbar/costdetails/toleranceselect.html",bindToController:true,scope:{"toleranceGroup":"=","selectedToleranceId":"=","activeToleranceId":"=","selectedToleranceItems":"="},controller:function(){var vm=this;vm.setActiveToleranceGroup=function(id){costDetailsSvc.getToleranceLineItems(id).then(function(data){vm.selectedToleranceId=id;vm.selectedToleranceItems=data;},function(errorMsg){console.log("Error:"+JSON.stringify(errorMsg));});};vm.getColorCode=function(status){return(status==0)?"alert-red":"primary-green";};},controllerAs:"toleranceSelect"};}]);})();(function(){angular.module("loanCenter").controller("toleranceModalController",toleranceModalController);toleranceModalController.$inject=["$modalInstance","costDetailsSvc"];function toleranceModalController($modalInstance,costDetailsSvc){var vm=this;vm.selectedToleranceItems={};vm.cancel=cancel;vm.getColorCode=getColorCode;costDetailsSvc.getToleranceGroups().then(function(data){vm.toleranceGroups=data;},function(errorMsg){console.log("Error:"+JSON.stringify(errorMsg));});costDetailsSvc.getActiveToleranceGroup().then(function(data){vm.selectedToleranceId=vm.activeToleranceId=data.disclosureDetailsId;vm.selectedToleranceItems=costDetailsSvc.selectedToleranceItems;},function(errorMsg){console.log("Error:"+JSON.stringify(errorMsg));});function cancel(){$modalInstance.dismiss("cancel");}function getColorCode(value){return(parseFloat(value)>0)?"alert-red":"primary-green";}}})();var contextualBar;(function(contextualBar){var AppraisalContextualBarController=(function(){function AppraisalContextualBarController(wrappedLoan,applicationData){this.wrappedLoan=wrappedLoan;this.applicationData=applicationData;}AppraisalContextualBarController.className="AppraisalContextualBarController";AppraisalContextualBarController.$inject=["wrappedLoan","applicationData"];return AppraisalContextualBarController;})();contextualBar.AppraisalContextualBarController=AppraisalContextualBarController;moduleRegistration.registerController("contextualBar",AppraisalContextualBarController);})(contextualBar||(contextualBar={}));var loancenter;(function(loancenter){function oweDueTextFilter(){return function(inputStr,amount){return(amount>0)?inputStr.replace(/from /gi,"To "):inputStr.replace(/to /gi,"From ");};}loancenter.oweDueTextFilter=oweDueTextFilter;angular.module("loanCenter").filter("oweDueTextFilter",oweDueTextFilter);})(loancenter||(loancenter={}));var loancenter;(function(loancenter){angular.module("loanCenter").directive("impTransactionsSummary",["TransactionalSummaryService","$timeout","BroadcastSvc",function(TransactionalSummaryService,$timeout,BroadcastSvc){return{restrict:"E",templateUrl:"angular/costdetails/transactionalsummary/transactions.html",bindToController:true,scope:{"wrappedLoan":"=","borrowerDataK":"=","borrowerDataL":"=","sellerDataM":"=","sellerDataN":"=","costController":"="},controller:function($scope){console.log($scope.transactionsCtrl.wrappedLoan);function countRows(subSectionList){var sum=0;if(angular.isUndefined(subSectionList)){return sum;}for(var i=0;i<subSectionList.length;i++){if(Array.isArray(subSectionList[i].records)){sum+=subSectionList[i].records.length;}}return sum;}$scope.transactionsCtrl.kCount=countRows($scope.transactionsCtrl.borrowerDataK.subSectionList);$scope.transactionsCtrl.lCount=countRows($scope.transactionsCtrl.borrowerDataL.subSectionList);$scope.transactionsCtrl.mCount=countRows($scope.transactionsCtrl.sellerDataM.subSectionList);$scope.transactionsCtrl.nCount=countRows($scope.transactionsCtrl.sellerDataN.subSectionList);},controllerAs:"transactionsCtrl"};}]);})(loancenter||(loancenter={}));var loancenter;(function(loancenter){var transactionRow=(function(){function transactionRow($http,$templateCache,$compile,$parse,TransactionalSummaryService){var _this=this;this.restrict="E";this.templateUrl="/angular/costdetails/transactionalsummary/transaction.row.html";this.scope={"mode":"@","item":"=","recalulate":"=","viewModel":"=","sectionKey":"=","subSectionKey":"=","dictionary":"=","costController":"="};this.controller=function($scope){var vm=_this;_this.initialize($scope);$scope.setTemplate=function(mode){if(mode=="edit"){_this.config=_this.findEntryDataDictionary($scope.item.costName,$scope.dictionary);_this.setType($scope);_this.editExisting($scope);$scope.mode="view";}else{if(mode=="view"){_this.config=_this.findEntryDataDictionary($scope.item.costName,$scope.dictionary);_this.setType($scope);$scope.mode="edit";}}_this.setTemplate($scope);$scope.recalulate();};$scope.save=function(){if($scope.type=="cost-item"){TransactionalSummaryService.UpdateCreditOrDebit($scope.viewModel,$scope.sectionKey,$scope.subSectionKey,$scope.item.lineNumber,$scope.item.amount,$scope.item.costName,$scope.item.costNameString,$scope.item.isDoubleEntry);$scope.setTemplate($scope.mode);}else{if("date-cost-item"){$scope.item.from=$scope.item.startDate;$scope.item.to=$scope.item.endDate;TransactionalSummaryService.UpdateCreditOrDebit($scope.viewModel,$scope.sectionKey,$scope.subSectionKey,$scope.item.lineNumber,$scope.item.amount,$scope.item.costName,$scope.item.costNameString,$scope.item.isDoubleEntry,true,$scope.item.from,$scope.item.to);$scope.setTemplate($scope.mode);}}};$scope.remove=function(){TransactionalSummaryService.RemoveCreditOrDebit($scope.viewModel,$scope.sectionKey,$scope.subSectionKey,$scope.item.lineNumber,$scope.recalulate);};$scope.change=function(){_this.config=_this.findEntryDataDictionary($scope.item.costName,$scope.dictionary);if($scope.item.costName!=18&&$scope.item.costName!=24){$scope.item.costNameString=_this.config.ledgerEntryNameString;}else{$scope.item.costNameString="";}_this.setType($scope);_this.editExisting($scope);_this.setTemplate($scope);if(!angular.isUndefined(_this.config)&&_this.config.isDoubleEntry!=$scope.item.isDoubleEntry){$scope.item.isDoubleEntry=_this.config.isDoubleEntry;$scope.save();}};};this.setTemplate=function($scope){if($scope.type=="date-cost-item"&&$scope.mode=="edit"){$scope.template="/angular/costdetails/transactionalsummary/row.datecostitem.edit.html";}if($scope.type=="date-cost-item"&&$scope.mode=="view"){$scope.template="/angular/costdetails/transactionalsummary/row.datecostitem.html";if(!$scope.item.startDate&&!$scope.item.endDate){$scope.item.startDate=$scope.item.from;$scope.item.endDate=$scope.item.to;}}if($scope.type=="cost-item"&&$scope.mode=="edit"){$scope.template="/angular/costdetails/transactionalsummary/row.costitem.edit.html";}if($scope.type=="cost-item"&&$scope.mode=="view"){$scope.template="/angular/costdetails/transactionalsummary/row.costitem.html";}};this.editExisting=function($scope){$scope.item.hasValue=true;};this.initialize=function($scope){_this.fillInBlanksForOthers($scope.dictionary);_this.config=_this.findEntryDataDictionary($scope.item.costName,$scope.dictionary);_this.setType($scope);_this.setTemplate($scope);};this.setType=function($scope){if(_this.config){$scope.type=_this.config.acceptsDateRange?"date-cost-item":"cost-item";}else{$scope.type="cost-item";}};this.findEntryDataDictionary=function(id,dicitonary){for(var key in dicitonary){if(dicitonary[key].ledgerEntryName==id){return dicitonary[key];}}return false;};this.fillInBlanksForOthers=function(dicitonary){var strings={18:"Other",24:"Other (Double)"};for(var key in strings){var entry=_this.findEntryDataDictionary(key,dicitonary);if(entry){entry.ledgerEntryNameString=strings[key];}}};this.replace=true;}transactionRow.Factory=function(){var directive=function($http,$templateCache,$compile,$parse,TransactionalSummaryService){return new transactionRow($http,$templateCache,$compile,$parse,TransactionalSummaryService);};directive["$inject"]=["$http","$templateCache","$compile","$parse","TransactionalSummaryService"];return directive;};return transactionRow;})();loancenter.transactionRow=transactionRow;angular.module("loanCenter").directive("transactionRow",transactionRow.Factory());})(loancenter||(loancenter={}));var loancenter;(function(loancenter){var transactionSubSection=(function(){function transactionSubSection(TransactionalSummaryService){var _this=this;this.assignCostGetter=function($scope,TransactionalSummaryService){for(var k=0;k<$scope.subSection.records.length;k++){$scope.subSection.records[k].getAmount=_this.costGetterFunction($scope,TransactionalSummaryService);}};this.costGetterFunction=function($scope,TransactionalSummaryService){return function(){if(this&&this.hasOwnProperty("useLoanInfoRequestKey")&&this.useLoanInfoRequestKey){return TransactionalSummaryService.GetLoanInfoRequestEnumValue(this.loanInfoRequestKey,$scope.wrappedLoan,$scope.costController);}else{if(this){return this.amount;}}};};this.restrict="E";this.templateUrl="/angular/costdetails/transactionalsummary/subsection.html";this.scope={"wrappedLoan":"=","subSection":"=","sectionKey":"=","sectionNameString":"=","calculateSectionTotal":"=","costController":"="};this.controller=function($scope){$scope.hover=false;$scope.initializeEmptyDebtCredit=function(){if($scope.costController.closingCostsRW){TransactionalSummaryService.InitEmptyCreditOrDebit($scope.wrappedLoan,$scope.sectionKey,$scope.subSection.subSectionKey);}};if($scope.subSection.subSectionNameString){$scope.template="/angular/costdetails/transactionalsummary/dynamic.subsection.html";}else{_this.assignCostGetter($scope,TransactionalSummaryService);$scope.template="/angular/costdetails/transactionalsummary/static.subsection.html";}$scope.save=function(item){TransactionalSummaryService.UpdateCreditOrDebit($scope.wrappedLoan,$scope.sectionKey,$scope.subSection.subSectionKey,item.lineNumber,item.amount,item.costName,item.costNameString,item.isDoubleEntry);$scope.calculateSectionTotal();};$scope.log=function(variable){console.log(variable);};$scope.canAdd=function(){var filteredRecords=_.filter($scope.subSection.records,function(record){return record.isRemoved!=true;});return filteredRecords.length<$scope.subSection.limit&&$scope.costController.closingCostsRW;};};}transactionSubSection.Factory=function(){var directive=function(TransactionalSummaryService){return new transactionSubSection(TransactionalSummaryService);};directive["$inject"]=["TransactionalSummaryService"];return directive;};return transactionSubSection;})();loancenter.transactionSubSection=transactionSubSection;angular.module("loanCenter").directive("transactionSubSection",transactionSubSection.Factory());})(loancenter||(loancenter={}));var loancenter;(function(loancenter){var transactionSection=(function(){function transactionSection(TransactionalSummaryService,BroadcastSvc){var _this=this;this.BroadcastSvc=BroadcastSvc;this.restrict="E";this.replace=true;this.templateUrl="angular/costdetails/transactionalsummary/section.html";this.scope={"sectionTitle":"@?","sectionFooter":"@","sectionTotal":"=","wrappedLoan":"=","subSection":"=","sectionLetter":"@","addEmptyRows":"=","costController":"="};this.controller=function($scope){_this.atttachGetterForCost($scope.subSection.subSectionList,$scope);$scope.calculateSectionTotal=function(){$scope.sectionTotal=_this.calculateTotal($scope.subSection.subSectionList);};$scope.calculateSectionTotal();$scope.range=function(n){n=(n>0)?n:0;return new Array(n);};console.log($scope.sectionLetter);if($scope.sectionLetter=="k"||$scope.sectionLetter=="l"){$scope.$watch("sectionTotal",function(){BroadcastSvc.broadcastCostDetailsTotals();});}};this.calculateTotal=function(subSectionList){var sum=0;for(var i=0;i<subSectionList.length;i++){if(Array.isArray(subSectionList[i].records)){for(var k=0;k<subSectionList[i].records.length;k++){if(subSectionList[i].records[k].useLoanInfoRequestKey){var amount=0;if(typeof subSectionList[i].records[k].getAmount=="function"){amount=parseFloat(subSectionList[i].records[k].getAmount());}else{if(subSectionList[i].records[k].amount=="number"){amount=subSectionList[i].records[k].amount;}}if(typeof amount=="number"){sum+=amount;}}else{var amount=parseFloat(subSectionList[i].records[k].amount)||0;if(subSectionList[i].records[k].isRemoved!=true&&typeof amount=="number"){sum+=amount;}}}}}return sum;};this.atttachGetterForCost=function(subSectionList,$scope){var sum=0;for(var i=0;i<subSectionList.length;i++){if(Array.isArray(subSectionList[i].records)){for(var k=0;k<subSectionList[i].records.length;k++){if(subSectionList[i].records[k].useLoanInfoRequestKey){subSectionList[i].records[k].getAmount=this.costGetterFunction($scope,TransactionalSummaryService);}}}}return sum;};this.costGetterFunction=function($scope,TransactionalSummaryService){return function(){var _amount;if(this&&this.hasOwnProperty("useLoanInfoRequestKey")&&this.useLoanInfoRequestKey){this.amount=_amount=TransactionalSummaryService.GetLoanInfoRequestEnumValue(this.loanInfoRequestKey,$scope.wrappedLoan,false);}else{if(this){_amount=this.amount;}}return _amount;};};}transactionSection.Factory=function(){var directive=function(TransactionalSummaryService,BroadcastSvc){return new transactionSection(TransactionalSummaryService,BroadcastSvc);};directive["$inject"]=["TransactionalSummaryService","BroadcastSvc"];return directive;};return transactionSection;})();loancenter.transactionSection=transactionSection;angular.module("loanCenter").directive("transactionSection",transactionSection.Factory());})(loancenter||(loancenter={}));var loancenter;(function(loancenter){var TransactionalSummaryService=(function(){function TransactionalSummaryService($resource,apiRoot){this.$resource=$resource;this.apiRoot=apiRoot;this.$inject=["$resource","api"];}TransactionalSummaryService.prototype.InitEmptyCreditOrDebit=function(viewModel,sectionKey,subSectionKey,isDoubleEntry){if(isDoubleEntry===void 0){isDoubleEntry=false;}this.transSummaryProxy=this.$resource(this.apiRoot+"TransactionSummaryService/InitEmptyCreditOrDebit",{},{InitEmptyCreditOrDebit:{method:"POST"}});this.transSummaryProxy.InitEmptyCreditOrDebit({},{lineNumber:0,sectionKey:sectionKey,subSectionKey:subSectionKey,isDoubleEntry:isDoubleEntry,viewModel:viewModel.transactionSummary}).$promise.then(function(sr){viewModel.transactionSummary=sr.response.viewModel;console.log(sr);},function(error){console.log(error);});};TransactionalSummaryService.prototype.UpdateCreditOrDebit=function(viewModel,sectionKey,subSectionKey,lineNumber,amount,ledgerEntryName,ledgerEntryNameString,isConvertToDoubleEntry,isApportioned,startDate,endDate){if(isConvertToDoubleEntry===void 0){isConvertToDoubleEntry=false;}if(isApportioned===void 0){isApportioned=false;}if(startDate===void 0){startDate="";}if(endDate===void 0){endDate="";}this.transSummaryProxy=this.$resource(this.apiRoot+"TransactionSummaryService/UpdateCreditOrDebit",{},{UpdateCreditOrDebit:{method:"POST"}});var payload={viewModel:viewModel.transactionSummary,sectionKey:sectionKey,subSectionKey:subSectionKey,lineNumber:lineNumber,ledgerEntryName:ledgerEntryName,ledgerEntryNameString:ledgerEntryNameString,amount:amount,isApportioned:isApportioned,startDate:startDate,endDate:endDate,isConvertToDoubleEntry:isConvertToDoubleEntry};this.transSummaryProxy.UpdateCreditOrDebit({},payload).$promise.then(function(sr){viewModel.transactionSummary=sr.response.viewModel;console.log(sr);},function(error){console.log(error);});};TransactionalSummaryService.prototype.RemoveCreditOrDebit=function(viewModel,sectionKey,subSectionKey,lineNumber,recalcCallback){this.transSummaryProxy=this.$resource(this.apiRoot+"TransactionSummaryService/RemoveCreditOrDebit",{},{RemoveCreditOrDebit:{method:"POST"}});var payload={viewModel:viewModel.transactionSummary,sectionKey:sectionKey,subSectionKey:subSectionKey,lineNumber:lineNumber};this.transSummaryProxy.RemoveCreditOrDebit({},payload).$promise.then(function(sr){viewModel.transactionSummary=sr.response.viewModel;recalcCallback();console.log(sr);},function(error){recalcCallback();console.log(error);});};TransactionalSummaryService.prototype.GetLoanInfoRequestEnumValue=function(id,wrappedLoan,contextualbar){var value=null;switch(id){case 1:return wrappedLoan.detailsOfTransaction.totalLoanAmount;case 2:return wrappedLoan.getSubjectProperty().purchasePrice;case 3:for(var i in wrappedLoan.detailsOfTransaction.otherCredits){if(wrappedLoan.detailsOfTransaction.otherCredits[i].description=="Cash Deposits"){return wrappedLoan.detailsOfTransaction.otherCredits[i].amount;}}return 0;case 4:if(wrappedLoan.closingCost.totals.lenderCredits&&wrappedLoan.closingCost.totals.lenderCredits>0){return wrappedLoan.closingCost.totals.closingCosts.borrowerPaidAtClosingTotal-wrappedLoan.closingCost.totals.lenderCredits;}else{return wrappedLoan.closingCost.totals.closingCosts.borrowerPaidAtClosingTotal+wrappedLoan.closingCost.totals.lenderCredits;}case 5:return wrappedLoan.closingCost.totals.closingCosts.sellerPaidAtClosingTotal;default:return 0;}};TransactionalSummaryService.prototype.calculate=function(transactionalSummaryViewModel,wrappedLoan){if(!transactionalSummaryViewModel){return 0;}this.atttachGetterForCost(transactionalSummaryViewModel.borrowerCredits.subSectionList,wrappedLoan);this.atttachGetterForCost(transactionalSummaryViewModel.borrowerDebits.subSectionList,wrappedLoan);var borrowerCreditsTotal=this.calculateSectionSum(transactionalSummaryViewModel.borrowerCredits.subSectionList),borrowerDebitsTotal=this.calculateSectionSum(transactionalSummaryViewModel.borrowerDebits.subSectionList);return borrowerCreditsTotal-borrowerDebitsTotal;};TransactionalSummaryService.prototype.calculateSectionSum=function(subSectionList){var sum=0;for(var i=0;i<subSectionList.length;i++){if(Array.isArray(subSectionList[i].records)){for(var k=0;k<subSectionList[i].records.length;k++){if(subSectionList[i].records[k].useLoanInfoRequestKey){var amount=0;if(typeof subSectionList[i].records[k].getAmount=="function"){amount=parseFloat(subSectionList[i].records[k].getAmount());}else{if(subSectionList[i].records[k].amount=="number"){amount=subSectionList[i].records[k].amount;}}if(typeof amount=="number"){sum+=amount;}}else{var amount=parseFloat(subSectionList[i].records[k].amount)||0;if(subSectionList[i].records[k].isRemoved!=true&&typeof amount=="number"){sum+=amount;}}}}}return sum;};TransactionalSummaryService.prototype.atttachGetterForCost=function(subSectionList,wrappedLoan){for(var i=0;i<subSectionList.length;i++){if(Array.isArray(subSectionList[i].records)){for(var k=0;k<subSectionList[i].records.length;k++){if(subSectionList[i].records[k].useLoanInfoRequestKey){subSectionList[i].records[k].getAmount=this.costGetterFunction(wrappedLoan);}}}}};TransactionalSummaryService.prototype.costGetterFunction=function(wrappedLoan){var service=this;return function(){var _amount;if(this&&this.hasOwnProperty("useLoanInfoRequestKey")&&this.useLoanInfoRequestKey){this.amount=_amount=service.GetLoanInfoRequestEnumValue(this.loanInfoRequestKey,wrappedLoan,true);}else{if(this){_amount=this.amount;}}return _amount;};};TransactionalSummaryService.Factory=function(){var service=function($resource,api){return new TransactionalSummaryService($resource,api);};service["$inject"]=["$resource","api"];return service;};return TransactionalSummaryService;})();loancenter.TransactionalSummaryService=TransactionalSummaryService;angular.module("loanCenter").service("TransactionalSummaryService",loancenter.TransactionalSummaryService);})(loancenter||(loancenter={}));(function(){angular.module("contextualBar").controller("ContextualBarTabsCtrl",ContextualBarTabsCtrl);ContextualBarTabsCtrl.$inject=["$rootScope","ContextualBarSvc","enums","wrappedLoan","NavigationSvc","$state","personalUtilities","$modal","applicationData","importFnmSvc","$timeout"];function ContextualBarTabsCtrl($rootScope,ContextualBarSvc,enums,wrappedLoan,NavigationSvc,$state,personalUtilities,$modal,applicationData,importFnmSvc,$timeout){var vm=this;vm.wrappedLoan=wrappedLoan;vm.applicationData=applicationData;vm.addLoanApplications=addLoanApplications;vm.slideContextualBar=slideContextualBar;vm.switchLoanApp=switchLoanApp;vm.createNewLoanApplication=createNewLoanApplication;vm.toggleIsContextualBarCollapsed=toggleIsContextualBarCollapsed;function addLoanApplications(){wrappedLoan.ref.addLoanApplication(new cls.LoanApplicationViewModel(vm.wrappedLoan.ref.getTransactionInfoRef(),null));wrappedLoan.ref.areSixPiecesAcquiredForAllLoanApplications();var tabs=document.getElementsByClassName("imp-contextual-bar-tabs");var tabslength=0;var arrows=document.getElementsByClassName("imp-contextual-arrows");for(var i=0;i<tabs.length;i++){tabslength+=tabs[i].offsetWidth;}if(tabslength>800){for(var i=0;i<arrows.length;i++){arrows[i].style.display="block";}}NavigationSvc.setPersonalAsActiveAndRedirect(false,wrappedLoan.ref.loanId);}function slideContextualBar(left){var element=document.getElementsByTagName("contextual-tabs")[0];var currentPosition=parseInt(element.style.marginLeft.split("px")[0]);if(left&&element.style.marginLeft!="0px"){element.style.marginLeft=currentPosition+50+"px";}else{if(!left){element.style.marginLeft=currentPosition-50+"px";}}}function switchLoanApp(loanapp){wrappedLoan.ref.switchActiveLoanApplication(loanapp);NavigationSvc.setPersonalAsActiveAndRedirect(false,wrappedLoan.ref.loanId);}function createNewLoanApplication(){importFnmSvc.openImportLoanModal(applicationData,true);}function toggleIsContextualBarCollapsed(){wrappedLoan.ref.isContextualBarCollapsed=!wrappedLoan.ref.isContextualBarCollapsed;NavigationSvc.setBodyPosition();}}})();(function(){angular.module("contextualBar").controller("ContextualBarProductAndPricingCtrl",ContextualBarProductAndPricingCtrl);ContextualBarProductAndPricingCtrl.$inject=["$scope","$state","$controller","$modal","$modalStack","wrappedLoan","modalPopoverFactory","BroadcastSvc","controllerData","pricingResultsSvc","applicationData","commonCalculatorSvc"];function ContextualBarProductAndPricingCtrl($scope,$state,$controller,$modal,$modalStack,wrappedLoan,modalPopoverFactory,BroadcastSvc,controllerData,pricingResultsSvc,applicationData,commonCalculatorSvc){var vm=this;vm.wrappedLoan=wrappedLoan;vm.back=back;vm.openImpoundCalculator=openImpoundCalculator;vm.selectedProduct=null;vm.showAdjustmentsPopup=showAdjustmentsPopup;vm.openShareComparisonReportModal=openShareComparisonReportModal;vm.getSelectedProducts=getSelectedProducts;vm.totalAdjustmentsValue=getTotalAdjustmentsValue();$scope.$on("ProductSelected",function(event,args){vm.selectedProduct=args;});function back(){$state.go("loanCenter.loan.loanScenario.sections",{"repricing":controllerData.repricing});}function getTotalAdjustmentsValue(){var tmpTotalAdjustmentsValue=0;for(var i=0;i<vm.wrappedLoan.ref.pricingAdjustments.adjustments.length;i++){if(vm.wrappedLoan.ref.pricingAdjustments.adjustments[i].adjustmentSectionType==2&&(vm.wrappedLoan.ref.pricingAdjustments.adjustments[i].adjustmentTypeId!=1)){tmpTotalAdjustmentsValue+=parseFloat(vm.wrappedLoan.ref.pricingAdjustments.adjustments[i].value);}}tmpTotalAdjustmentsValue=parseFloat(Math.round(tmpTotalAdjustmentsValue*1000)/1000).toFixed(3);return tmpTotalAdjustmentsValue;}function showAdjustmentsPopup(){var tmpTotalAdjustmentsValue=getTotalAdjustmentsValue();var adjustments=new Array();var tmpDesc;var tmpPaidBy;for(var i=0;i<vm.wrappedLoan.ref.pricingAdjustments.adjustments.length;i++){if(vm.wrappedLoan.ref.pricingAdjustments.adjustments[i].adjustmentSectionType==2&&(vm.wrappedLoan.ref.pricingAdjustments.adjustments[i].adjustmentTypeId!=1)){var tempAdjs=vm.wrappedLoan.ref.pricingAdjustments.adjustments[i];tempAdjs.value=parseFloat(Math.round(tempAdjs.value*1000)/1000).toFixed(3);if(applicationData.lookup.loAdjustmentTypes){tmpDesc=applicationData.lookup.loAdjustmentTypes.filter(function(obj){return obj.value==(parseInt(vm.wrappedLoan.ref.pricingAdjustments.adjustments[i].adjustmentTypeId)-1);});tempAdjs.adjustmentTypeDescription=tmpDesc[0].text;}if(applicationData.lookup.loPricePaidBy){tmpPaidBy=applicationData.lookup.loPricePaidBy.filter(function(obj){return obj.value==(parseInt(vm.wrappedLoan.ref.pricingAdjustments.adjustments[i].paidBy)-1);});tempAdjs.adjustmentPaidBy=tmpPaidBy.length>0?tmpPaidBy[0].text:"No Entry";}adjustments.push(tempAdjs);}}var ctrl={adjustments:adjustments,totalAdjustmentsValue:tmpTotalAdjustmentsValue};modalPopoverFactory.openModalPopover("angular/contextualbar/productandpricing/adjustmentspopup.html",ctrl,{},event).result.then(function(data){console.log("clicked somewhere else");});}function openImpoundCalculator(event){if(!vm.selectedProduct){return;}var impoundCalculator=modalPopoverFactory.openModalPopover("angular/common/impoundcalculator/impoundcalculator.html",$controller("impoundCalculatorController",{$scope:$scope.$new()}),{isRefinance:wrappedLoan.ref.loanPurposeType!="1",mortageType:wrappedLoan.ref.financialInfo.mortgageType,loanAmount:vm.selectedProduct.totalLoanAmount,applicationData:applicationData,purchasePrice:wrappedLoan.ref.getSubjectProperty().purchasePrice,costs:vm.selectedProduct.costDetails.reservesCosts,HOAExpens:{preferredPayPeriod:srv.PeriodTypeEnum.Monthly,amountPerMonth:vm.wrappedLoan.ref.housingExpenses.newHoa,amount:vm.wrappedLoan.ref.housingExpenses.newHoa}},event,{className:"tooltip-arrow-right-cost-details",verticalPopupPositionPerHeight:0,horisontalPopupPositionPerWidth:0.695});impoundCalculator.result.then(function(data){BroadcastSvc.broadcastChangedImpounds(data);},function(){console.log("clicked somewhere else");});}function getSelectedProducts(){var selectedProducts=[];var productTypeGroups=_.values(controllerData.sortedProductPricingArray);angular.forEach(productTypeGroups,function(productTypeGroup){var productNameGroups=_.values(productTypeGroup);angular.forEach(productNameGroups,function(productNameGroup){angular.forEach(productNameGroup,function(product){if(product.compare){selectedProducts.push(product);}});});});return selectedProducts;}function openShareComparisonReportModal(){var userSelectedProductCategoriesVM=new srv.cls.UserSelectedProductCategoriesViewModel();userSelectedProductCategoriesVM.firstName=wrappedLoan.ref.active.getBorrower().firstName;userSelectedProductCategoriesVM.lastName=wrappedLoan.ref.active.getBorrower().lastName;userSelectedProductCategoriesVM.email=wrappedLoan.ref.active.getBorrower().userAccount.FilterUsername;userSelectedProductCategoriesVM.borrowerUserAccountId=wrappedLoan.ref.active.getBorrower().userAccount.userAccountId;userSelectedProductCategoriesVM.additionalRecipients=[];userSelectedProductCategoriesVM.sendEmail=false;userSelectedProductCategoriesVM.companyProfileId=applicationData.companyProfile.companyProfileId;userSelectedProductCategoriesVM.channelId=wrappedLoan.ref.channelId;userSelectedProductCategoriesVM.divisionId=wrappedLoan.ref.divisionId;userSelectedProductCategoriesVM.branchId=wrappedLoan.ref.branchId;userSelectedProductCategoriesVM.conciergeId=wrappedLoan.ref.conciergeId;userSelectedProductCategoriesVM.loanId=wrappedLoan.ref.loanId;userSelectedProductCategoriesVM.hearAboutUs=wrappedLoan.ref.hearAboutUs;userSelectedProductCategoriesVM.refinancePurpose=1;userSelectedProductCategoriesVM.propertyType=wrappedLoan.ref.getSubjectProperty().propertyType;userSelectedProductCategoriesVM.occupancyType=wrappedLoan.ref.active.occupancyType;userSelectedProductCategoriesVM.numberOfUnits=wrappedLoan.ref.getSubjectProperty().numberOfUnits;userSelectedProductCategoriesVM.numberOfStories=wrappedLoan.ref.getSubjectProperty().numberOfStories;userSelectedProductCategoriesVM.impounds=wrappedLoan.ref.otherInterviewData.selectedImpoundsOption;userSelectedProductCategoriesVM.decisionScore=commonCalculatorSvc.GetLowestMiddleFicoScore(wrappedLoan,applicationData);userSelectedProductCategoriesVM.loanAmount=wrappedLoan.ref.loanAmount;userSelectedProductCategoriesVM.ltv=wrappedLoan.ref.getSubjectProperty().ltv;userSelectedProductCategoriesVM.cltv=wrappedLoan.ref.getSubjectProperty().cltv;userSelectedProductCategoriesVM.dti=wrappedLoan.ref.financialInfo.dti;userSelectedProductCategoriesVM.purchasePrice=wrappedLoan.ref.getSubjectProperty().purchasePrice;userSelectedProductCategoriesVM.estimatedValue=wrappedLoan.ref.getSubjectProperty().currentEstimatedValue;userSelectedProductCategoriesVM.cashout=wrappedLoan.ref.financialInfo.cashOutAmount;userSelectedProductCategoriesVM.stateName=wrappedLoan.ref.getSubjectProperty().stateName;userSelectedProductCategoriesVM.products=getSelectedProducts();$modal.open({backdrop:"static",dialogFade:false,controller:"ShareComparisonCtrl as ShareComparisonCtrl",templateUrl:"angular/pricingresults/other/sharecomparisonmodal.html",windowClass:"share-comparison-report-content",backdropClass:"custom-modal-backdrop",resolve:{wrappedLoan:function(){return wrappedLoan;},applicationData:function(){return applicationData;},userSelectedProductCategoriesVM:function(){return userSelectedProductCategoriesVM;}}});}}})();(function(){angular.module("contextualBar").controller("ContextualBarQueueCtrl",ContextualBarQueueCtrl);ContextualBarQueueCtrl.$inject=["$scope","$state","BroadcastSvc","applicationData","$stateParams","$modal","importFnmSvc","columnOptionsFactory"];function ContextualBarQueueCtrl($scope,$state,BroadcastSvc,applicationData,$stateParams,$modal,importFnmSvc,columnOptionsFactory){var vm=this;vm.applicationData=applicationData;vm.isUserWholesale=isUserWholesale();vm.createNewLoanApplication=createNewLoanApplication;vm.openColumnOptionsModalWindow=openColumnOptionsModalWindow;vm.refreshQueue=refreshQueue;vm.clearAllFilters=clearAllFilters;vm.totalNumberOfRecords=null;vm.branchId;vm.loadOptions=[];$scope.$on("QueueSizeChanged",function(event,args){vm.totalNumberOfRecords=args;});vm.selectedQueue=$stateParams.queueTitle;function createNewLoanApplication(){importFnmSvc.openImportLoanModal(applicationData,false);}function isUserWholesale(){var user=_.find(applicationData.companyProfile.channels,function(channel){return channel.channelId==applicationData.currentUser.channelId;});if(user){return !!user.isWholesale;}else{return false;}}function clearAllFilters(){BroadcastSvc.broadcastClearAllFilter();}function refreshQueue(){BroadcastSvc.broadcastRefreshQueue();}function openColumnOptionsModalWindow(){var index=-1;for(var i=0;i<vm.applicationData.queueColumns.length;i++){if(vm.applicationData.queueColumns[i].queue==$stateParams.queue){index=i;}}if(index!=-1){columnOptionsFactory.open({modalTitle:"Column Options",availableColumnsTitle:"Available Columns",selectedColumnsTitle:"Selected Columns",availableColumns:applicationData.allQueueColumns,selectedColumns:applicationData.queueColumns[index].columns,update:function(selectedColumns){applicationData.queueColumns[index].columns=selectedColumns;BroadcastSvc.broadcastRefreshGridColumns();}});}else{console.log("Queue not selected!");}}}})();(function(){angular.module("loanCenter").controller("DocumentCtrl",function($scope){var vm=$scope;vm.DownloadDocument=DownloadDocument;vm.OpenDocument=OpenDocument;function DownloadDocument(repositoryId){var downloadLink=getDocumentUrl(repositoryId);if(downloadLink!=""){window.open(downloadLink,"_blank","");}}function OpenDocument(repositoryId,inBrowser,inTab){var downloadLink=getDocumentUrl(repositoryId,inBrowser);if(!common.string.isNullOrWhiteSpace(downloadLink)&&!common.string.isEmptyGuid(downloadLink)){if(inTab){window.open(downloadLink,"_blank","");}else{window.open(downloadLink,"_blank","location=0");}}}function getDocumentUrl(repositoryId,inBrowser){if(repositoryId==null||repositoryId==""){return"";}var encodedRepositoryId=encodeURIComponent(repositoryId);var url="/Downloader.axd?documentType=repositoryItem&repositoryItemId="+encodedRepositoryId;if(inBrowser!="undefined"&&inBrowser){url=url+"&browser=true";}return url;}});})();(function(){angular.module("loanApplication").factory("personalSvc",personalSvc);personalSvc.$inject=["$http","$resource","apiRoot","$q"];function personalSvc($http,$resource,ApiRoot,$q){var personalApiPath=ApiRoot+"personal/";var getHowDidYouHearAboutUsData=$resource(personalApiPath+"GetHowDidYouHearAboutUsData",{method:"GET",params:{loanId:"loanId",useraccountId:"useraccountId"}});var getter=$resource(personalApiPath+"GetPersonalData/");var service={getter:getter,save:save,getHowDidYouHearAboutUsData:getHowDidYouHearAboutUsData};return service;function save(viewModel){if(viewModel.SwitchCoBorrowerToBorrower){var tempPersonal=angular.copy(viewModel.BorrowerInfo.PersonalInfo);angular.copy(viewModel.CoBorrowerInfo.PersonalInfo,viewModel.BorrowerInfo.PersonalInfo);angular.copy(tempPersonal,viewModel.CoBorrowerInfo.PersonalInfo);var tempContact=angular.copy(viewModel.BorrowerInfo.ContactInfo);angular.copy(viewModel.CoBorrowerInfo.ContactInfo,viewModel.BorrowerInfo.ContactInfo);angular.copy(tempContact,viewModel.CoBorrowerInfo.ContactInfo);var tempName=angular.copy(viewModel.BorrowerInfo.NameInfo);angular.copy(viewModel.CoBorrowerInfo.NameInfo,viewModel.BorrowerInfo.NameInfo);angular.copy(tempName,viewModel.CoBorrowerInfo.NameInfo);var tempEmployment=angular.copy(viewModel.BorrowerInfo.EmploymentAndBackgroundInfo);angular.copy(viewModel.CoBorrowerInfo.EmploymentAndBackgroundInfo,viewModel.BorrowerInfo.EmploymentAndBackgroundInfo);angular.copy(tempEmployment,viewModel.CoBorrowerInfo.EmploymentAndBackgroundInfo);var tempId=angular.copy(viewModel.BorrowerInfo.UserAccountId);angular.copy(viewModel.CoBorrowerInfo.UserAccountId,viewModel.BorrowerInfo.UserAccountId);angular.copy(tempId,viewModel.CoBorrowerInfo.UserAccountId);viewModel.CoBorrowerInfo.PersonalInfo.SSN=viewModel.CoBorrowerInfo.PersonalInfo.SSN||"";viewModel.BorrowerInfo.PersonalInfo.SSN=viewModel.BorrowerInfo.PersonalInfo.SSN||"";}var deferred=$q.defer();savePersonalData().save(viewModel,function(data){deferred.resolve(data);},function(error){deferred.reject(error);});return deferred.promise;}function savePersonalData(){return $resource(personalApiPath+"SavePersonalData",{viewModel:"@viewModel"});}}})();(function(){angular.module("loanApplication").controller("personalController",personalController);personalController.$inject=["$log","$scope","$modal","$modalStack","personalSvc","BroadcastSvc","simpleModalWindowFactory","modalPopoverFactory","NavigationSvc","wrappedLoan","isVisible","manageAccountService","controllerData","applicationData","personalUtilities","$state","$timeout"];function personalController($log,$scope,$modal,$modalStack,personalSvc,BroadcastSvc,simpleModalWindowFactory,modalPopoverFactory,NavigationSvc,wrappedLoan,isVisible,manageAccountService,controllerData,applicationData,personalUtilities,$state,$timeout){var vm=this;vm.wrappedLoan=wrappedLoan;vm.controllerData=controllerData;vm.applicationData=applicationData;vm.toggleTabs=toggleTabs;vm.phoneFunctions=[];vm.showPersonalTab=false;vm.showErrorMessage=false;vm.openOnEmailBlur=[];vm.openOnEmailBlur.opened=false;vm.isVisible=isVisible.value;vm.showCitizenshipModal=showCitizenshipModal;vm.onUSCitizenChange=onUSCitizenChange;vm.onPermanentAlienChange=onPermanentAlienChange;vm.onMaritalStatusActionChanged=onMaritalStatusActionChanged;vm.onIsSpouseOnTheLoanChange=onIsSpouseOnTheLoanChange;vm.onIsSpouseOnTheTitleChange=onIsSpouseOnTheTitleChange;vm.populateCoBorrowerEmail=populateCoBorrowerEmail;vm.onTitleHeldInChange=onTitleHeldInChange;vm.showNamesAndManner=showNamesAndManner;vm.onEnterPress=onEnterPress;vm.getHowDidYouHearAboutUsData=getHowDidYouHearAboutUsData();vm.manageAccountsModal=manageAccountsModal;vm.onEmailBlur=onEmailBlur;vm.validatePermanentAlien=validatePermanentAlien;vm.setCbSectionWhenEmailIsEmpty=setCbSectionWhenEmailIsEmpty;vm.closeAllModals=closeAllModals();vm.hasError=hasError;vm.startsWithProspect=startsWithProspect;vm.cleanupUsername=cleanupUsername;function cleanupUsername(userAccount){if(startsWithProspect(userAccount.username)){userAccount.username="";}}function startsWithProspect(username){return(!common.string.isNullOrWhiteSpace(username)&&username.startsWith("newprospect"));}$scope.$watch(function(){return wrappedLoan.ref.active.getCoBorrower().userAccount.username+wrappedLoan.ref.active.getBorrower().userAccount.username;},function(){if(!!wrappedLoan.ref.active.getBorrower().userAccount.username){cleanupUsername(wrappedLoan.ref.active.getBorrower().userAccount);}if(wrappedLoan.ref.active.getCoBorrower()){if(!!wrappedLoan.ref.active.getCoBorrower().userAccount.username){cleanupUsername(wrappedLoan.ref.active.getCoBorrower().userAccount);}}});function hasError(userAccount){if(!userAccount){return false;}var hasError=vm.wrappedLoan.ref.sixPiecesAcquiredForAllLoanApplications&&userAccount.isOnlineUser&&userAccount.username.trim()=="";return hasError;}function getHowDidYouHearAboutUsData(){if(vm.wrappedLoan.ref.loanId==null){personalSvc.getHowDidYouHearAboutUsData.get({loanId:"00000000-0000-0000-0000-000000000000",useraccountId:vm.applicationData.currentUserId}).$promise.then(function(data){vm.applicationData.lookup.howDidYouHearAboutUsList=data.howDidYouHearAboutUsList;},function(error){console.log(error);});}else{if(vm.applicationData.lookup.howDidYouHearAboutUsList.length==0){personalSvc.getHowDidYouHearAboutUsData.get({loanId:vm.wrappedLoan.ref.loanId,useraccountId:vm.applicationData.currentUserId}).$promise.then(function(data){vm.applicationData.lookup.howDidYouHearAboutUsList=data.howDidYouHearAboutUsList;},function(error){console.log(error);});}}}function closeAllModals(){$modalStack.dismissAll("close");}function setCbSectionWhenEmailIsEmpty(){if(!vm.wrappedLoan.ref.active.getCoBorrower().userAccount.username||vm.wrappedLoan.ref.active.getCoBorrower().userAccount.username.trim()==""){vm.wrappedLoan.ref.active.getBorrower().maritalStatus=-1;vm.wrappedLoan.ref.active.isCoBorrowerSectionShown=false;vm.wrappedLoan.ref.active.isSpouseOnTheLoan=false;}}function toggleTabs(){NavigationSvc.LoanAppTabs.all.isDisabled=vm.wrappedLoan.ref.active.areTabsDisabled();}function validatePermanentAlien(permanentAlien){if(permanentAlien){return"0 -19px";}else{if(!permanentAlien&&vm.wrappedLoan.ref.sixPiecesAcquiredForAllLoanApplications){return"0 -38px";}else{return"0 0px";}}}function onUSCitizenChange($event){var checkbox=$event.target;if(checkbox.id=="cbBorrowerCitizen"){if(!checkbox.checked){vm.wrappedLoan.ref.active.getBorrower().permanentAlien=true;}else{vm.wrappedLoan.ref.active.getBorrower().permanentAlien=false;}}else{if(checkbox.id=="cbCoBorrowerCitizen"){if(!checkbox.checked){vm.wrappedLoan.ref.active.getCoBorrower().permanentAlien=true;}else{vm.wrappedLoan.ref.active.getCoBorrower().permanentAlien=false;}}}}loadPersonalDataOnInit();function onPermanentAlienChange($event){var checkbox=$event.target;if(!checkbox.checked){showCitizenshipModal();}}function onEnterPress($event){if($event.keyCode==13||$event.keyCode==32){var id=$event.currentTarget.firstElementChild.id;var event={};event.target=$event.target.firstElementChild;switch(id){case"cbBorrowerTwoYearsOnJob":vm.wrappedLoan.ref.active.getBorrower().isEmployedTwoYears=!vm.wrappedLoan.ref.active.getBorrower().isEmployedTwoYears;break;case"cbCoBorrowerTwoYearsOnJob":vm.wrappedLoan.ref.active.getCoBorrower().isEmployedTwoYears=!vm.wrappedLoan.ref.active.getCoBorrower().isEmployedTwoYears;break;case"cbBorrowerCitizen":vm.wrappedLoan.ref.active.getBorrower().usCitizen=!vm.wrappedLoan.ref.active.getBorrower().usCitizen;event.target.checked=vm.wrappedLoan.ref.active.getBorrower().uSCitizen;vm.onUSCitizenChange(event);break;case"cbCoBorrowerCitizen":vm.wrappedLoan.ref.active.getCoBorrower().usCitizen=!vm.wrappedLoan.ref.active.getCoBorrower().usCitizen;event.target.checked=vm.wrappedLoan.ref.active.getCoBorrower().uSCitizen;vm.onUSCitizenChange(event);break;case"cbBorrowerPermanentResidentAlien":vm.wrappedLoan.ref.active.getBorrower().permanentAlien=!vm.wrappedLoan.ref.active.getBorrower().permanentAlien;event.target.checked=vm.wrappedLoan.ref.active.getBorrower().permanentAlien;vm.onPermanentAlienChange(event);break;case"cbCoBorrowerPermanentResidentAlien":vm.wrappedLoan.ref.active.getCoBorrower().permanentAlien=!vm.wrappedLoan.ref.active.getCoBorrower().permanentAlien;event.target.checked=vm.wrappedLoan.ref.active.getCoBorrower().permanentAlien;vm.onPermanentAlienChange(event);break;}}if($event.keyCode==32){$event.preventDefault();}}function showCitizenshipModal(){var modalInstance=$modal.open({templateUrl:"angular/loanapplication/personal/citizenshipmodal.html",controller:function($scope,$modalInstance){$scope.cancel=function(){$modalInstance.dismiss("cancel");};},size:"sm",resolve:{items:function(){}}});}function loadPersonalDataOnInit(){vm.showPersonalTab=true;vm.showErrorMessage=false;vm.disableFields=false;vm.wrappedLoan.ref.active.getBorrower().originalUsername=vm.wrappedLoan.ref.active.getBorrower().username;vm.wrappedLoan.ref.active.getCoBorrower().maritalStatus=vm.wrappedLoan.ref.active.getBorrower().maritalStatus;showNamesAndManner();populateCoBorrowerEmail();toggleTabs();if($state.current.name=="loanCenter.loan.loanScenario.sections"&&vm.wrappedLoan.ref.loanAmount==0){vm.wrappedLoan.ref.active.isBorrowerSectionShown=false;}else{vm.wrappedLoan.ref.active.isBorrowerSectionShown=true;}}function onMaritalStatusActionChanged(triggerTitleChange){vm.wrappedLoan.ref.active.getCoBorrower().maritalStatus=vm.wrappedLoan.ref.active.getBorrower().maritalStatus;vm.wrappedLoan.ref.active.triggerMaritalStatusRules();populateCoBorrowerEmail();accountStatus();if(triggerTitleChange){onTitleHeldInChange();}else{showNamesAndManner();}}function onIsSpouseOnTheLoanChange(triggerTitleChange){vm.wrappedLoan.ref.active.onIsSpouseOnTheLoanChange(triggerTitleChange);toggleTabs();populateCoBorrowerEmail();if(triggerTitleChange){onTitleHeldInChange();}else{showNamesAndManner();}accountStatus();vm.wrappedLoan.ref.areSixPiecesAcquiredForAllLoanApplications();}function populateCoBorrowerEmail(){if(vm.wrappedLoan.ref.active.getCoBorrower().userAccount.username==""||vm.wrappedLoan.ref.active.getCoBorrower().userAccount.username==null){vm.wrappedLoan.ref.active.getCoBorrower().userAccount.username=vm.wrappedLoan.ref.active.getBorrower().userAccount.username;vm.wrappedLoan.ref.active.getCoBorrower().userAccount.originalUsername=vm.wrappedLoan.ref.active.getBorrower().userAccount.username;}}function onIsSpouseOnTheTitleChange(){vm.wrappedLoan.ref.active.titleInfo.namesOnTitle=personalUtilities.getBorrowerAndCoBorrowerNames(vm.wrappedLoan.ref.active.getBorrower(),vm.wrappedLoan.ref.active.getCoBorrower(),vm.wrappedLoan.ref.active.isSpouseOnTheLoan,vm.wrappedLoan.ref.active.isSpouseOnTheTitle,vm.wrappedLoan.ref.active.titleInfo.nameOfPartner);}function onTitleHeldInChange(){vm.wrappedLoan.ref.active.showNamesAndManner=personalUtilities.onTitleHeldInChange(vm.wrappedLoan.ref.active);}function showNamesAndManner(){if(vm.wrappedLoan.ref.active.titleInfo.titleHeldIn==0){vm.wrappedLoan.ref.active.showNamesAndManner=true;vm.wrappedLoan.ref.active.titleInfo.namesOnTitle=personalUtilities.getBorrowerAndCoBorrowerNames(vm.wrappedLoan.ref.active.getBorrower(),vm.wrappedLoan.ref.active.getCoBorrower(),vm.wrappedLoan.ref.active.isSpouseOnTheLoan,vm.wrappedLoan.ref.active.isSpouseOnTheTitle,vm.wrappedLoan.ref.active.titleInfo.nameOfPartner);}else{vm.wrappedLoan.ref.active.showNamesAndManner=false;vm.wrappedLoan.ref.active.titleInfo.namesOnTitle="";}}function onEmailBlur(borrowerInfo,username){if(username!=null&&username.trim()===""){accountStatus();return;}vm.openOnEmailBlur.opened=true;vm.openOnEmailBlur.isCoBorrower=borrowerInfo.isCoBorrower;manageAccountService.existingUser(vm.wrappedLoan,borrowerInfo.userAccount.username,borrowerInfo.isCoBorrower,null,accountStatus);}function accountStatus(){if(vm.wrappedLoan.ref.active.isSpouseOnTheLoan){vm.wrappedLoan.ref.active.getCoBorrower().userAccount.isCoBorrower=true;}var openModel=vm.openOnEmailBlur.isCoBorrower?vm.wrappedLoan.ref.active.getCoBorrower().userAccount:vm.wrappedLoan.ref.active.getBorrower().userAccount;vm.openOnEmailBlur.opened=vm.openOnEmailBlur.opened&&!openModel.isOnlineUser&&(vm.wrappedLoan.ref.active.getBorrower().userAccount.username!=vm.wrappedLoan.ref.active.getCoBorrower().userAccount.username&&vm.openOnEmailBlur.isCoBorrower||!vm.openOnEmailBlur.isCoBorrower);if(vm.openOnEmailBlur.opened){var element=vm.openOnEmailBlur.isCoBorrower?document.getElementById("coborrowerEmail"):document.getElementById("borrowerEmail");$timeout(function(){element.click();vm.openOnEmailBlur.opened=false;},10);}}function manageAccountsModal(model,isCoBorrower,event){if(model.username==null||model.username==undefined||model.username.trim()===""){return;}if(isCoBorrower&&model.username==vm.wrappedLoan.ref.active.getBorrower().userAccount.username&&!(model.userAccountId>0)){model=angular.copy(vm.wrappedLoan.ref.active.getBorrower().userAccount);model.userAccountId=0;}else{if(vm.wrappedLoan.ref.active.getBorrower().userAccount.username==vm.wrappedLoan.ref.active.getCoBorrower().userAccount.originalUsername&&!(model.userAccountId>0)){var username=model.username;model=new cls.UserAccountViewModel();model.username=username;model.originalUsername=username;model.isOnlineUser=false;model.userAccountId=0;}}model.isCoBorrower=isCoBorrower;var manageUserAccount=new cls.ManageUserAccountsViewModel();manageUserAccount.userAccount=model;if(vm.openOnEmailBlur.opened){manageUserAccount.automaticallyOpen=true;}var confirmationPopup=manageAccountService.openManageAccount(vm.wrappedLoan,manageUserAccount,event,accountStatus,vm.applicationData);confirmationPopup.result.then(function(){});}}})();var loanCenter;(function(loanCenter){var Personal=(function(){function Personal(){this.concatenateFullName=function(firstName,middleName,lastName){return concatenateFullName(firstName,middleName,lastName);};this.getBorrowerAndCoBorrowerNames=function(borrower,coBorrower,isSpouseOnTheLoan,isSpouseOnTheTitle,nameOfPartner){return getBorrowerAndCoBorrowerNames(borrower,coBorrower,isSpouseOnTheLoan,isSpouseOnTheTitle,nameOfPartner);};this.showNamesAndManner=function(loanApplication){return showNamesAndManner(loanApplication);};this.onTitleHeldInChange=function(loanApplication){return onTitleHeldInChange(loanApplication);};this.onConfirmEmailBlur=function(model){var areEmailsValid=!model.invalidEmails;if(areEmailsValid&&model.isEmailChanged){model.sendActivationEmail=true;}};this.onEmailBlur=function(model,isSpouseOnTheLoan,loanId,loanUserAccountIdBorrower,loanUserAccountIdCoBorrower){var coBorrowerNoAccount;if(!isSpouseOnTheLoan){coBorrowerNoAccount=true;}else{coBorrowerNoAccount=loanUserAccountIdBorrower<=0;}if(model.username===model.originalUsername||(loanUserAccountIdCoBorrower<=0&&coBorrowerNoAccount)){model.usernameTaken=false;return;}var areEmailsValid=!model.invalidEmails;};}Personal.$inject=[];return Personal;})();angular.module("loanCenter").service("personalUtilities",Personal);function concatenateFullName(firstName,middleName,lastName){var fullName="";if(firstName!=null&&firstName!=""){fullName+=firstName+" ";}if(middleName!=null&&middleName!=""){fullName+=middleName+" ";}if(lastName!=null&&lastName!=""){fullName+=lastName;}else{fullName=fullName.substring(0,fullName.length-1);}return fullName;}function getBorrowerAndCoBorrowerNames(borrower,coBorrower,isSpouseOnTheLoan,isSpouseOnTheTitle,nameOfPartner){var borrowerName="";var coBorrowerName="";var titleResult="";if(borrower){borrowerName=concatenateFullName(borrower.firstName,borrower.middleName,borrower.lastName);}if(coBorrower){coBorrowerName=concatenateFullName(coBorrower.firstName,coBorrower.middleName,coBorrower.lastName);}if(borrowerName!=""){titleResult=borrowerName;}if(isSpouseOnTheLoan){if(borrowerName!=""&&coBorrowerName!=""){titleResult+=", "+coBorrowerName;}else{if(coBorrowerName!=""){titleResult=coBorrowerName;}}}else{if(isSpouseOnTheTitle){if(nameOfPartner!=null&&nameOfPartner!=""){if(borrowerName!=""){titleResult+=", "+nameOfPartner;}else{titleResult=nameOfPartner;}}}}return titleResult;}function showNamesAndManner(loanApplication){var showNamesAndManner=false;if(!loanApplication.titleInfo){return;}if(loanApplication.titleInfo.titleHeldIn==0){showNamesAndManner=true;loanApplication.titleInfo.namesOnTitle=getBorrowerAndCoBorrowerNames(loanApplication.getBorrower(),loanApplication.getCoBorrower(),loanApplication.isSpouseOnTheLoan,loanApplication.isSpouseOnTheTitle,loanApplication.titleInfo.nameOfPartner);}else{loanApplication.titleInfo.namesOnTitle="";}return showNamesAndManner;}function onTitleHeldInChange(loanApplication){var namesAndMannner=showNamesAndManner(loanApplication);if(!loanApplication.getBorrower()||!loanApplication.titleInfo){return;}switch(loanApplication.getBorrower().maritalStatus.toString()){case"0":loanApplication.titleInfo.mannerTitleHeld="1";break;case"2":loanApplication.titleInfo.mannerTitleHeld="6";break;case"1":default:loanApplication.titleInfo.mannerTitleHeld="9";break;}return namesAndMannner;}})(loanCenter||(loanCenter={}));(function(){angular.module("loanApplication").factory("assetsSvc",assetsSvc);assetsSvc.$inject=["$resource","apiRoot"];function assetsSvc($resource,ApiRoot){var assetsApiPath=ApiRoot+"Assets/";var GetAssetsData=$resource(assetsApiPath,{params:{loanId:"loanId"}});var SaveAssetsData=$resource(assetsApiPath+"SaveAssetsData",{data:"@data"});function CalculateTotalAssets(totalFinancials,totalAutomobiles,totalLifeInsurance){return totalFinancials+totalAutomobiles+totalLifeInsurance;}function CalculateTotalLiquids(totalFinancials,totalLifeInsurance){return totalFinancials+totalLifeInsurance;}function CalculateAssetAmount(section){var total=0;for(var i=0;i<section.length;i++){if(!section[i].isRemoved){total+=section[i].amount?parseFloat(section[i].amount):0;}}return total;}var services={GetAssetsData:GetAssetsData,SaveAssetsData:SaveAssetsData,CalculateTotalAssets:CalculateTotalAssets,CalculateTotalLiquids:CalculateTotalLiquids,CalculateAssetAmount:CalculateAssetAmount};return services;}})();var loanCenter;(function(loanCenter){var assets=(function(){function assets(borrowerId){this.assetsObj={accountNumber:null,assetId:"00000000-0000-0000-0000-000000000000",assetType:15,automobileMake:null,automobileYear:null,borrowerFullName:null,borrowerId:borrowerId,description:null,financialInstitutionName:null,isDownPayment:false,jointAccount:false,lifeInsuranceFaceValue:null,liquidAsset:false,monthlyAmount:null,unpaidBalance:null,financialInstitutionAddress:{propertyId:"00000000-0000-0000-0000-000000000000",addressTypeId:0,cityName:null,counties:[],countyName:null,stateId:null,stateName:null,states:null,streetName:null,unitNumber:null,zipCode:null},institiutionContactInfo:{assetId:"00000000-0000-0000-0000-000000000000",attn:null,companyId:"00000000-0000-0000-0000-000000000000",companyName:null,email:null,fax:null,liabillityFor:null,phone:null,streetAddress1:null,streetAddress2:null,addressViewModel:{propertyId:"00000000-0000-0000-0000-000000000000",addressTypeId:0,cityName:null,counties:null,countyName:null,stateId:null,stateName:null,states:[],streetName:null,unitNumber:null,zipCode:null}}};}return assets;})();})(loanCenter||(loanCenter={}));(function(){angular.module("loanApplication").controller("assetsController",assetsController);assetsController.$inject=["$log","$scope","$modal","assetsSvc","modalPopoverFactory","BroadcastSvc","simpleModalWindowFactory","wrappedLoan","$filter","applicationData"];function assetsController($log,$scope,$modal,assetsSvc,modalPopoverFactory,BroadcastSvc,simpleModalWindowFactory,wrappedLoan,$filter,applicationData){var vm=this;var event={};event.type="click";vm.wrappedLoan=wrappedLoan;vm.showLoader=true;vm.totalAutomobilesAmount=0;vm.totalFinancesAmount=0;vm.totalNetFaceAmount=0;vm.totalLiquidAssets=0;vm.disableFields=false;vm.expandFinancials=true;vm.expandAutomobiles=true;vm.expandLifeInsurance=true;vm.financials;vm.automobiles;vm.lifeInsurance;vm.borrowers=[];vm.applicationData=applicationData;vm.ctrlAsset=new cls.AssetViewModel();vm.assetTypeEnum=srv.AssetTypeEnum;vm.addFinancials=addFinancials;vm.addAutomobiles=addAutomobiles;vm.addInsurances=addInsurances;vm.removeFinancials=removeFinancials;vm.removeAutomobiles=removeAutomobiles;vm.removeInsurances=removeInsurances;vm.collapseExpand=collapseExpand;vm.collapseAll=collapseAll;vm.expandAll=expandAll;vm.showItemInfo=showItemInfo;vm.calculateTotals=calculateTotals;vm.calculateTotal=calculateTotal;vm.checkIteminstitiutionContactInfoModified=checkIteminstitiutionContactInfoModified;vm.toggleAsset=toggleAsset;vm.clearFinancialAssetsValues=clearFinancialAssetsValues;getAssetsData();function toggleAsset(item){item.jointAccount=(item.borrowerFullName==="JointAccount")?true:false;wrappedLoan.ref.active.toggleBorrowerForItem(item,wrappedLoan.ref.active.getBorrower().assets,wrappedLoan.ref.active.getCoBorrower().assets,(item.borrowerFullName==="JointAccount"||item.borrowerFullName===wrappedLoan.ref.active.getBorrower().fullName),item.isUserEntry);}function getAssetsData(){var financials;if(!vm.ctrlAsset){vm.ctrlAsset=new cls.AssetViewModel();}populateBorrowerList();vm.calculateTotals();financials=wrappedLoan.ref.active.getCombinedAssetsFinancials();if(financials.length==0){addFinancials(event);}for(var i=0;i<financials.length;i++){financials[i].institiutionContactInfoModified=vm.ctrlAsset.checkIteminstitiutionContactInfoModified(financials[i].institiutionContactInfo);}vm.showLoader=false;vm.disableFields=false;if(vm.wrappedLoan.ref.active.getCombinedAssetsAutomobiles().length==0){addAutomobiles(event);}if(vm.wrappedLoan.ref.active.getCombinedAssetsLifeInsurence().length==0){addInsurances(event);}}function clearFinancialAssetsValues(item){if(item.assetType==srv.AssetTypeEnum.NotRequired){item.institiutionContactInfo=new cls.CompanyDataViewModel();item.institiutionContactInfoModified=false;item.accountNumber="";item.monthlyAmount=0;calculateTotals();}}function addFinancials(event){addItem(event,new cls.FinancialsAssetViewModel(),vm.expandFinancials,"financials");}function addAutomobiles(event){addItem(event,new cls.AutomobileAssetViewModel(),vm.expandAutomobiles,"automobiles");}function addInsurances(event){addItem(event,new cls.LifeInsuranceAssetViewModel(),vm.expandLifeInsurance,"insurances");}function addItem(event,object,collapse,collapseId){if((event.type==="keypress"&&event.keyCode===13)||event.type==="click"){if(!collapse){vm.collapseExpand(collapseId);}wrappedLoan.ref.active.getBorrower().addAssets(object);window.setTimeout(function(){},200);}}function removeFinancials(obj,index){removeItem(obj);calculateTotal("finances");if(wrappedLoan.ref.active.getCombinedAssetsFinancials().length===0){vm.collapseExpand("financials");}}function removeAutomobiles(obj,index){removeItem(obj);calculateTotal("automobiles");if(wrappedLoan.ref.active.getCombinedAssetsAutomobiles().length===0){vm.collapseExpand("automobiles");}}function removeInsurances(obj,index){removeItem(obj);calculateTotal("insurances");if(wrappedLoan.ref.active.getCombinedAssetsLifeInsurence().length===0){vm.collapseExpand("insurances");}}function removeItem(obj){if(obj.isUserEntry){wrappedLoan.ref.active.deleteFromCollection(obj,wrappedLoan.ref.active.getBorrower().getAssets(),wrappedLoan.ref.active.getCoBorrower().getAssets());}else{wrappedLoan.ref.active.removeFromCollection(obj,wrappedLoan.ref.active.getBorrower().getAssets(),wrappedLoan.ref.active.getCoBorrower().getAssets());}}function collapseExpand(sectionName){if(sectionName){switch(sectionName){case"financials":vm.expandFinancials=vm.expandFinancials?false:true;break;case"automobiles":vm.expandAutomobiles=vm.expandAutomobiles?false:true;break;case"insurances":vm.expandLifeInsurance=vm.expandLifeInsurance?false:true;break;}}}function collapseAll(){vm.expandFinancials=false;vm.expandAutomobiles=false;vm.expandLifeInsurance=false;}function checkIteminstitiutionContactInfoModified(item){if(!vm.ctrlAsset){vm.ctrlAsset=new cls.AssetViewModel();}item.institiutionContactInfoModified=vm.ctrlAsset.checkIteminstitiutionContactInfoModified(item.institiutionContactInfo);}function expandAll(){vm.expandFinancials=true;vm.expandAutomobiles=true;vm.expandLifeInsurance=true;}function calculateTotal(sectionName){switch(sectionName){case"finances":vm.totalFinancesAmount=wrappedLoan.ref.getFinancialsTotal(wrappedLoan.ref.active,"bothForBorrowerAndCoborrower");break;case"automobiles":vm.totalAutomobilesAmount=wrappedLoan.ref.getAutomobilesTotal(wrappedLoan.ref.active,"bothForBorrowerAndCoborrower");break;case"insurances":vm.totalNetFaceAmount=wrappedLoan.ref.getLifeInsuranceTotal(wrappedLoan.ref.active,"bothForBorrowerAndCoborrower");break;}vm.totalLiquidAssets=wrappedLoan.ref.getTotalLiquidAssets();}function calculateTotals(){vm.totalFinancesAmount=wrappedLoan.ref.getFinancialsTotal(wrappedLoan.ref.active,"bothForBorrowerAndCoborrower");vm.totalAutomobilesAmount=wrappedLoan.ref.getAutomobilesTotal(wrappedLoan.ref.active,"bothForBorrowerAndCoborrower");vm.totalNetFaceAmount=wrappedLoan.ref.getLifeInsuranceTotal(wrappedLoan.ref.active,"bothForBorrowerAndCoborrower");vm.totalLiquidAssets=wrappedLoan.ref.getTotalLiquidAssets();}function showItemInfo(item,event){var ctrl={itemContactInfoModalTitle:"Institution Contact Info",DisableFields:vm.disableFields,states:cls.LoanViewModel.getLookups().states};modalPopoverFactory.openModalPopover("angular/common/companycontrol.html",ctrl,item.institiutionContactInfo,event).result.then(function(data){item.institiutionContactInfo=data;checkIteminstitiutionContactInfoModified(item);});}function cloneItem(parentObject){for(var i=0;i<parentObject.length;i++){if(parentObject[i].isRemoved&&parentObject[i].isEmpty){var item=angular.copy(parentObject[i]);item.isRemoved=false;return item;}}}function populateBorrowerList(){vm.borrowers=[];vm.borrowers.push({value:wrappedLoan.ref.active.getBorrower().fullName.trim(),text:wrappedLoan.ref.active.getBorrower().firstName.trim()+" "+wrappedLoan.ref.active.getBorrower().lastName.trim()});if(wrappedLoan.ref.active.isSpouseOnTheLoan){vm.borrowers.push({value:wrappedLoan.ref.active.getCoBorrower().fullName.trim(),text:wrappedLoan.ref.active.getCoBorrower().firstName.trim()+" "+wrappedLoan.ref.active.getCoBorrower().lastName.trim()});vm.borrowers.push({value:"JointAccount",text:"Joint Account"});}}}})();(function(){angular.module("loanApplication").constant("propertyConstant",{PURCHASE:{LABELS:{PRICE:"Purchase Price",PAYMENT:"Down Payment",SOURCE:"Down Payment Source"}},REFINANCE:{LABELS:{PRICE:"Estimated Value",PAYMENT:"Original Purchase Price",SOURCE:"Original Purchase Date"}}});})();(function(){angular.module("loanApplication").factory("propertySvc",propertySvc);propertySvc.$inject=["$resource","apiRoot","propertyConstant"];function propertySvc($resource,ApiRoot,propertyConstant){function showPreviousAddress(years,months){if(!years){if(!months){return false;}return parseInt(months)<12;}return parseInt(years)<2;}function getLabelText(key,value){switch(key){case"subjectPropertyValue":if(value==1){return propertyConstant.PURCHASE.LABELS.PRICE;}else{if(value==2){return propertyConstant.REFINANCE.LABELS.PRICE;}}case"subjectPropertyPayment":if(value==1){return propertyConstant.PURCHASE.LABELS.PAYMENT;}else{if(value==2){return propertyConstant.REFINANCE.LABELS.PAYMENT;}}case"subjectPropertySource":if(value==1){return propertyConstant.PURCHASE.LABELS.SOURCE;}else{if(value==2){return propertyConstant.REFINANCE.LABELS.SOURCE;}}}}function getLabelText(key,value){switch(key){case"subjectPropertyValue":if(value==1){return propertyConstant.PURCHASE.LABELS.PRICE;}else{if(value==2){return propertyConstant.REFINANCE.LABELS.PRICE;}}case"subjectPropertyPayment":if(value==1){return propertyConstant.PURCHASE.LABELS.PAYMENT;}else{if(value==2){return propertyConstant.REFINANCE.LABELS.PAYMENT;}}case"subjectPropertySource":if(value==1){return propertyConstant.PURCHASE.LABELS.SOURCE;}else{if(value==2){return propertyConstant.REFINANCE.LABELS.SOURCE;}}}}function calculateLoanAmount(purchasePrice,downPayment){return purchasePrice-downPayment;}function calculateDownPayment(purchasePrice,loanAmount){return purchasePrice-loanAmount;}function calculateDownPaymentPercentage(purchasePrice,downPayment){return parseFloat((downPayment/purchasePrice)*100);}function calculateDownPaymentByPercentage(purchasePrice,downPaymentPercentage){return purchasePrice*(downPaymentPercentage/100);}var service={showPreviousAddress:showPreviousAddress,getLabelText:getLabelText,calculateLoanAmount:calculateLoanAmount,calculateDownPayment:calculateDownPayment,calculateDownPaymentPercentage:calculateDownPaymentPercentage,calculateDownPaymentByPercentage:calculateDownPaymentByPercentage,};return service;}})();var loanCenter;(function(loanCenter){var PropertyController=(function(){function PropertyController(propertySvc,BroadcastSvc,simpleModalWindowFactory,wrappedLoan,applicationData,commonCalculatorSvc,loanEvent,commonService){var _this=this;this.propertySvc=propertySvc;this.BroadcastSvc=BroadcastSvc;this.simpleModalWindowFactory=simpleModalWindowFactory;this.wrappedLoan=wrappedLoan;this.applicationData=applicationData;this.commonCalculatorSvc=commonCalculatorSvc;this.loanEvent=loanEvent;this.commonService=commonService;this.showLoader=true;this.disableFields=false;this.message="";this.isAgentSectionVisible=false;this.downPaymentValue=0;this.isCoBorrowerAddressDifferent=false;this.enums=[];this.indicators={doesYourAgentAlsoRepresentsSeller:false,downPaymentPercentageToFixed:0,downPaymentPercentageOriginal:0,};this.getFHACountyLoanLimit=function(){_this.wrappedLoan.ref.fhaCountyLoanLimit=_this.commonService.getFHAOrVALoanLimit(_this.applicationData.fhaLoanLimits,_this.wrappedLoan.ref.getSubjectProperty().stateName,_this.wrappedLoan.ref.getSubjectProperty().countyName,_this.wrappedLoan.ref.getSubjectProperty().numberOfUnits);};this.ownershipCurrentResidence=function(ownership){if(angular.isDefined(ownership)){_this.wrappedLoan.ref.active.getBorrower().getCurrentAddress().ownership=+ownership;}return _this.wrappedLoan.ref.active.getBorrower().getCurrentAddress().ownership;};this.onOwnershipPercentageChanged=function(ownership){if(ownership>100){_this.wrappedLoan.ref.active.ownershipPercentage=_this.wrappedLoan.ref.remainingOwnershipCalculation(true);}};this.onOccupancyTypeChanged=function(occupancyType){if(occupancyType!=1){_this.wrappedLoan.ref.active.getBorrower().getCurrentAddress().isSameAsPropertyAddress=false;}_this.loanEvent.broadcastPropertyChangedEvent(30);};this.triggerLoanCalculator=function(){if(!_this.wrappedLoan.ref.active.ownershipPercentage){_this.wrappedLoan.ref.active.ownershipPercentage=0;}var nri=_this.netRentalIncome;_this.loanEvent.broadcastPropertyChangedEvent(30);};this.isValidDate=function(value){return common.date.isValidDate(value);};this.onHomeByingTypeChange=function(item){if(!isNaN(Number(item))){_this.wrappedLoan.ref.homeBuyingType=Number(item);}if(item==3){_this.wrappedLoan.ref.getSubjectProperty().streetName="TBD";}else{_this.wrappedLoan.ref.getSubjectProperty().streetName="";_this.wrappedLoan.ref.sellersAgentContact=_this.indicators.doesYourAgentAlsoRepresentsSeller?_this.wrappedLoan.ref.buyersAgentContact:_this.defaultSellersAgentContact;}_this.wrappedLoan.ref.areSixPiecesAcquiredForAllLoanApplications();};this.onBuyerRepresentSellerChange=function(){_this.wrappedLoan.ref.sellersAgentContact=_this.indicators.doesYourAgentAlsoRepresentsSeller?_this.wrappedLoan.ref.buyersAgentContact:_this.defaultSellersAgentContact;};this.onDownPaymentBlur=function(){_this.loanEvent.broadcastPropertyChangedEvent(25,_this.wrappedLoan.ref.downPayment);_this.calculateDownPayment("DownPayment");};this.onPurchasePriceBlur=function(){_this.loanEvent.broadcastPropertyChangedEvent(2,_this.wrappedLoan.ref.getSubjectProperty().purchasePrice);if(_this.wrappedLoan.ref.loanPurposeType===1){_this.calculateDownPayment("PurchasePrice");}};this.onCurrentEstimatedValue=function(){_this.loanEvent.broadcastPropertyChangedEvent(3,_this.wrappedLoan.ref.getSubjectProperty().currentEstimatedValue);};this.onLoanAmountBlur=function(){_this.wrappedLoan.ref.financialInfo.mortgageAmount=_this.wrappedLoan.ref.loanAmount;_this.loanEvent.broadcastPropertyChangedEvent(0,_this.wrappedLoan.ref.loanAmount);if(_this.wrappedLoan.ref.loanPurposeType===1){_this.calculateDownPayment("LoanAmount");}};this.onDownPaymentPercentageBlur=function(){_this.loanEvent.broadcastPropertyChangedEvent(24,_this.indicators.downPaymentPercentageToFixed);_this.calculateDownPayment("DownPaymentPercentage");};this.calculateDownPayment=function(base){var purchasePrice=_this.wrappedLoan.ref.getSubjectProperty().purchasePrice;var loanAmount=_this.wrappedLoan.ref.loanAmount;var downPayment=_this.downPaymentValue;var downPaymentPercentage=_this.indicators.downPaymentPercentageToFixed;var result=_this.commonCalculatorSvc.recalculateDownPayment(purchasePrice,loanAmount,downPayment,downPaymentPercentage,0,base);_this.wrappedLoan.ref.downPaymentAmount(result.downPayment);_this.downPaymentValue=result.downPayment;_this.wrappedLoan.ref.loanAmount=result.loanAmount;_this.indicators.downPaymentPercentageToFixed=result.downPaymentPercentage;_this.wrappedLoan.ref.getSubjectProperty().purchasePrice=result.purchasePrice;};this.collapseExpand=function(){_this.isAgentSectionVisible=!_this.isAgentSectionVisible;};this.getLabelText=function(key,value){return _this.propertySvc.getLabelText(key,value);};this.showPreviousAddressPerBorrower=function(btyp){if(btyp===void 0){btyp=2;}if(btyp==2){return _this.showPreviousAddressPerBorrower(1)||_this.showPreviousAddressPerBorrower(0);}if(btyp==1&&_this.wrappedLoan.ref.active.isSpouseOnTheLoan&&!_this.coBorrowerCurrentAddressIsDifferentFromBorrower){return false;}var addr;switch(btyp){case 1:addr=_this.wrappedLoan.ref.active.getCoBorrower().getCurrentAddress();break;case 0:addr=_this.wrappedLoan.ref.active.getBorrower().getCurrentAddress();break;default:addr=null;break;}if(addr==null){return false;}else{var isShow=_this.propertySvc.showPreviousAddress(addr.timeAtAddressYears,addr.timeAtAddressMonths);return isShow;}};this.isDownPaymentCompletionRuleSatisfy=function(){return(_this.wrappedLoan.ref.sixPiecesAcquiredForAllLoanApplications&&!(_this.downPaymentValue==0||_this.downPaymentValue));};this.toggleAddressIsSameAs=function(addr,gs,areSame){addr.isSameAsPropertyAddress=areSame;if(gs.g(addr)==areSame){return;}if(!areSame){addr.clearAddress(false);}if(areSame){}gs.s(addr,areSame);};this.gsSubj=new GSSubj();this.gsMail=new GSMail();this.gsPrim=new GSPrim();this.enums["LoanPurposeType"]=srv.LoanPurposeTypeEnum;this.enums["OccupancyType"]=srv.OccupancyType;this.enums["OwnershipType"]=srv.OwnershipStatusTypeEnum;this.indicators={doesYourAgentAlsoRepresentsSeller:wrappedLoan.ref.checkAgentsDifferences(),downPaymentPercentageToFixed:0,downPaymentPercentageOriginal:0,};var borrowerCurrentAddress=this.wrappedLoan.ref.active.getBorrower().getCurrentAddress();borrowerCurrentAddress.isSameAsPropertyAddress=this.borrowerCurrentAddressIsSameAsPropertyAddress;this.defaultSellersAgentContact=this.wrappedLoan.ref.sellersAgentContact;if(this.wrappedLoan.ref.loanPurposeType===1){this.onLoanAmountBlur();}if(this.wrappedLoan.ref.loanPurposeType===2&&this.wrappedLoan.ref.active.OccupancyType==1){borrowerCurrentAddress.isSameAsPropertyAddress=true;}this.applicationData.lookup.currentLoanLicensedStatesForLO=this.wrappedLoan.ref.getLicencedStates(this.applicationData);if(this.wrappedLoan.ref.loanPurposeType===1&&this.wrappedLoan.ref.homeBuyingType==3&&common.string.isNullOrWhiteSpace(wrappedLoan.ref.getSubjectProperty().streetName)){this.wrappedLoan.ref.getSubjectProperty().streetName="TBD";}}Object.defineProperty(PropertyController.prototype,"subjectProperty",{get:function(){return this.wrappedLoan.ref.getSubjectProperty();},set:function(subjProp){},enumerable:true,configurable:true});Object.defineProperty(PropertyController.prototype,"netRentalIncome",{get:function(){return this.subjectProperty.getNetRentalIncome();},set:function(nri){},enumerable:true,configurable:true});Object.defineProperty(PropertyController.prototype,"occupancyType",{get:function(){return this.wrappedLoan.ref.getSubjectProperty().OccupancyType;},set:function(occupancyType){this.wrappedLoan.ref.getSubjectProperty().OccupancyType=occupancyType;var nri=this.netRentalIncome;this.loanEvent.broadcastPropertyChangedEvent(14,this.wrappedLoan.ref.getSubjectProperty());},enumerable:true,configurable:true});Object.defineProperty(PropertyController.prototype,"addressEffectiveBorrowerCurrent",{get:function(){var addr;if(this.borrowerCurrentAddressIsSameAsPropertyAddress){addr=this.wrappedLoan.ref.getSubjectProperty();}else{addr=this.wrappedLoan.ref.active.getBorrower().getCurrentAddress();}return addr;},set:function(addr){},enumerable:true,configurable:true});Object.defineProperty(PropertyController.prototype,"addressEffectiveBorrowerMailing",{get:function(){var addr;if(!this.borrowerMailingAddressIsDifferentFromCurrentAddress){addr=this.addressEffectiveBorrowerCurrent;}else{addr=this.wrappedLoan.ref.active.getBorrower().getMailingAddress();}return addr;},set:function(addr){},enumerable:true,configurable:true});Object.defineProperty(PropertyController.prototype,"borrowerCurrentAddressIsSameAsPropertyAddressIsDisabled",{get:function(){var loanVm=this.wrappedLoan.ref;return loanVm.loanPurposeType==2&&loanVm.getSubjectProperty().OccupancyType==1;},set:function(isDisabled){},enumerable:true,configurable:true});Object.defineProperty(PropertyController.prototype,"borrowerCurrentAddressIsSameAsPropertyAddress",{get:function(){if(this.borrowerCurrentAddressIsSameAsPropertyAddressIsDisabled){return this.wrappedLoan.ref.active.getBorrower().getCurrentAddress().isSameAsPropertyAddress=true;}else{return this.wrappedLoan.ref.active.getBorrower().getCurrentAddress().isSameAsPropertyAddress;}},set:function(areSame){this.toggleAddressIsSameAs(this.wrappedLoan.ref.active.getBorrower().getCurrentAddress(),this.gsSubj,areSame);},enumerable:true,configurable:true});Object.defineProperty(PropertyController.prototype,"borrowerMailingAddressIsDifferentFromCurrentAddress",{get:function(){var areSame=this.wrappedLoan.ref.active.getBorrower().getMailingAddress().isSameMailingAsBorrowerCurrentAddress;return !areSame;},set:function(areDifferent){this.toggleAddressIsSameAs(this.wrappedLoan.ref.active.getBorrower().getMailingAddress(),this.gsMail,!areDifferent);},enumerable:true,configurable:true});Object.defineProperty(PropertyController.prototype,"addressEffectiveCoBorrowerCurrent",{get:function(){var addr;if(this.coBorrowerCurrentAddressIsDifferentFromBorrower){addr=this.wrappedLoan.ref.active.getCoBorrower().getCurrentAddress();}else{addr=this.addressEffectiveBorrowerCurrent;}return addr;},set:function(addr){},enumerable:true,configurable:true});Object.defineProperty(PropertyController.prototype,"addressEffectiveCoBorrowerMailing",{get:function(){var addr;if(!this.coBorrowerMailingAddressIsDifferentFromCurrentAddress){addr=this.addressEffectiveCoBorrowerCurrent;}else{addr=this.wrappedLoan.ref.active.getCoBorrower().getMailingAddress();}return addr;},set:function(addr){},enumerable:true,configurable:true});Object.defineProperty(PropertyController.prototype,"coBorrowerCurrentAddressIsDifferentFromBorrower",{get:function(){var areSame=this.wrappedLoan.ref.active.getCoBorrower().getCurrentAddress().isSameAsPrimaryBorrowerCurrentAddress;return !areSame;},set:function(areDifferent){this.toggleAddressIsSameAs(this.wrappedLoan.ref.active.getCoBorrower().getCurrentAddress(),this.gsPrim,!areDifferent);},enumerable:true,configurable:true});Object.defineProperty(PropertyController.prototype,"coBorrowerMailingAddressIsDifferentFromCurrentAddress",{get:function(){var areSame=this.wrappedLoan.ref.active.getCoBorrower().getMailingAddress().isSameMailingAsBorrowerCurrentAddress;return !areSame;},set:function(areDifferent){this.toggleAddressIsSameAs(this.wrappedLoan.ref.active.getCoBorrower().getMailingAddress(),this.gsMail,!areDifferent);},enumerable:true,configurable:true});PropertyController.$inject=["propertySvc","BroadcastSvc","simpleModalWindowFactory","wrappedLoan","applicationData","commonCalculatorSvc","loanEvent","commonService"];return PropertyController;})();var GSSubj=(function(){function GSSubj(){this.g=function(addr){return addr.isSameAsPropertyAddress;};this.s=function(addr,b){return addr.isSameAsPropertyAddress=b;};}return GSSubj;})();var GSMail=(function(){function GSMail(){this.g=function(addr){return addr.isSameMailingAsBorrowerCurrentAddress;};this.s=function(addr,b){return addr.isSameMailingAsBorrowerCurrentAddress=b;};}return GSMail;})();var GSPrim=(function(){function GSPrim(){this.g=function(addr){return addr.isSameAsPrimaryBorrowerCurrentAddress;};this.s=function(addr,b){addr.isSameAsPrimaryBorrowerCurrentAddress=b;addr.isSameMailingAsBorrowerCurrentAddress=b;};}return GSPrim;})();angular.module("loanApplication").controller("propertyController",PropertyController);})(loanCenter||(loanCenter={}));(function(){angular.module("loanApplication").factory("incomeHelper",incomeHelper);incomeHelper.$inject=["enums","commonService"];function incomeHelper(enums,commonService){var service={areEmploymentDatesValid:areEmploymentDatesValid,calculateBorrowersIncomeInfo:calculateBorrowersIncomeInfo,calculateTotalMonthlyAmount:calculateTotalMonthlyAmount,checkEmploymentInfosHistory:checkEmploymentInfosHistory,disableIncome:disableIncome,getMaxOrderNumberForNewEmploymentInfo:getMaxOrderNumberForNewEmploymentInfo,isAmountValid:isAmountValid,orderEmploymentInfoList:orderEmploymentInfoList,timeDifferenceTwoOrMoreYears:timeDifferenceTwoOrMoreYears};return service;function checkEmploymentInfosHistory(borrower){if(!borrower||!borrower.getCurrentEmploymentInfo()){return;}var twoOrMoreYears=timeDifferenceTwoOrMoreYears(borrower.getCurrentEmploymentInfo().employmentStartDate,borrower.getCurrentEmploymentInfo().employmentEndDate);var isAdditionalEmpInfoTwoOrMoreYears=additionalEmpInfoTwoOrMoreYears(borrower);}function additionalEmpInfoTwoOrMoreYears(borrower){var additionalEmpInfo=borrower.getAdditionalEmploymentInfo();var currentEmpInfoEndDate=borrower.getCurrentEmploymentInfo().employmentEndDate;for(var i=0;i<additionalEmpInfo.length;i++){var empInfo=additionalEmpInfo[i];if(!empInfo.IsRemoved){var areDatesValid=areEmploymentDatesValid(empInfo.employmentStartDate,empInfo.employmentEndDate);if(!areDatesValid){continue;}var twoOrMoreYears=timeDifferenceTwoOrMoreYears(empInfo.employmentStartDate,currentEmpInfoEndDate);if(twoOrMoreYears){return true;}}}return false;}function areEmploymentDatesValid(employmentStartDate,employmentEndDate){if(employmentStartDate==null||employmentEndDate==null){return false;}var empInfoStartDate=moment(employmentStartDate);var empInfoEndDate=moment(employmentEndDate);if(!empInfoStartDate.isValid()||!empInfoEndDate.isValid()){return false;}var currentTime=moment();var isStartDateAfterCurrent=empInfoStartDate.isAfter(currentTime);var isEndDateAfterCurrent=empInfoEndDate.isAfter(currentTime);if(isStartDateAfterCurrent||isEndDateAfterCurrent){return false;}return true;}function calculateBorrowersIncomeInfo(employmentInfoCurrent,employmentInfoAdditional){}function calculateTotalMonthlyAmount(employmentInfo){}function disableIncome(incomeInfoItem,incomeInfoList,incomeTypeEnum){angular.forEach(incomeInfoList,function(income){if(income.incomeTypeId==incomeTypeEnum){if(incomeInfoItem.amount!=0){income.amount=0;income.incomeTypeDisabled=true;}else{income.incomeTypeDisabled=false;}}});}function getMaxOrderNumberForNewEmploymentInfo(employmentInfoList){var orderNumber=1;var employmentInfoListWithoutRemoved=_.filter(employmentInfoList,function(empInfo){return !empInfo.isRemoved;});if(employmentInfoListWithoutRemoved.length>0){var empInfoMaxOrderNumber=_.max(employmentInfoListWithoutRemoved,function(empInfo){return empInfo.orderNumber;});orderNumber=empInfoMaxOrderNumber.orderNumber+1;}return orderNumber;}function orderEmploymentInfoList(employmentInfoList){var index=1;for(var i=0;i<employmentInfoList.length;i++){if(!employmentInfoList[i].isRemoved){employmentInfoList[i].orderNumber=index++;}else{employmentInfoList[i].orderNumber=-1;}}}function sumArrayProperties(arrayOfObjects,propName){return arrayOfObjects.reduce(function(i,j){if(j[propName]!=undefined&&j[propName]!=""){return parseFloat(i)+parseFloat(j[propName]);}j[propName]=0;return parseFloat(i);},0);}function timeDifferenceTwoOrMoreYears(dateTimeFrom,dateTimeTo){return commonService.compareDates(dateTimeFrom,dateTimeTo).asYears()>=2;}function isAmountValid(amount){return amount!=null&&!isNaN(parseFloat(amount));}}})();(function(){angular.module("loanApplication").factory("incomeService",incomeService);incomeService.$inject=["$resource","apiRoot","enums","incomeHelper"];function incomeService($resource,ApiRoot,enums,incomeHelper){var service={addEmploymentInfo:addEmploymentInfo,handleAdditionalSections:handleAdditionalSections,onYearsOnThisJobChanged:onYearsOnThisJobChanged,performBorrowerCalculations:performBorrowerCalculations,sortAdditionalEmploymentInfos:sortAdditionalEmploymentInfos,orderEmpInfoListAndCalculateTotals:orderEmpInfoListAndCalculateTotals};return service;function sortAdditionalEmploymentInfos(loanApplication){sortAdditionalEmploymentInfoForBorrower(loanApplication.getBorrower());if(loanApplication.getCoBorrower()&&loanApplication.isSpouseOnTheLoan){sortAdditionalEmploymentInfoForBorrower(loanApplication.getCoBorrower());}}function sortAdditionalEmploymentInfoForBorrower(borrower){var employmentInfoAdditional=borrower.getAdditionalEmploymentInfo();if(employmentInfoAdditional&&employmentInfoAdditional.length>0){employmentInfoAdditional.sort(function(a,b){if(a.isPresent!=b.isPresent){return a.isPresent?-1:1;}if(a.employmentStartDate&&b.employmentStartDate){if(a.employmentStartDate>b.employmentStartDate){return -1;}else{if(a.employmentStartDate<b.employmentStartDate){return 1;}}}if(a.employmentEndDate&&b.employmentEndDate){if(a.employmentEndDate>b.employmentEndDate){return -1;}else{if(a.employmentEndDate<b.employmentEndDate){return 1;}}}return 0;});}}function onYearsOnThisJobChanged(borrower,employmentInfo){if(borrower==null||borrower.getCurrentEmploymentInfo()==null||borrower.getAdditionalEmploymentInfo()==null){return;}var areDatesValid=incomeHelper.areEmploymentDatesValid(borrower.getCurrentEmploymentInfo().employmentStartDate,borrower.getCurrentEmploymentInfo().employmentEndDate);if(!areDatesValid){return;}if(employmentInfo){areDatesValid=incomeHelper.areEmploymentDatesValid(employmentInfo.employmentStartDate,employmentInfo.employmentEndDate);if(!areDatesValid){return;}}else{borrower.getCurrentEmploymentInfo().orderNumber=0;}toggleEmploymentInfo(borrower);}function handleAdditionalSections(borrower){if(borrower&&!borrower.isTotalEmploymentTwoYears){toggleEmploymentInfo(borrower);}}function toggleEmploymentInfo(borrower){var twoOrMoreYears=incomeHelper.checkEmploymentInfosHistory(borrower);if(!twoOrMoreYears){if(needAdditionalRecord(borrower.getAdditionalEmploymentInfo())===true){addEmploymentInfo(borrower.getAdditionalEmploymentInfo(),true);}}else{removeSections(borrower);}}function needAdditionalRecord(additionalEmpInfo){var addedPreviousList=_.filter(additionalEmpInfo,function(empInfo){var areDatesValid=incomeHelper.areEmploymentDatesValid(empInfo.employmentStartDate,empInfo.employmentEndDate);return !empInfo.isRemoved&&empInfo.isAddedPrevious&&!areDatesValid;});return addedPreviousList.length===0;}function removeSections(borrower){if(borrower.isTotalEmploymentTwoYears===false){return;}var isCurrentEmpInfoTwoOrMoreYears=incomeHelper.timeDifferenceTwoOrMoreYears(borrower.getCurrentEmploymentInfo().employmentStartDate,borrower.getCurrentEmploymentInfo().employmentEndDate);var additionalEmployments=[];if(isCurrentEmpInfoTwoOrMoreYears){additionalEmployments=_.filter(borrower.getAdditionalEmploymentInfo(),function(empInfo){return !empInfo.isAddedPrevious;});borrower.replaceAdditionalEmploymentInfo(additionalEmployments);orderEmpInfoListAndCalculateTotals(borrower.getCurrentEmploymentInfo(),borrower.getAdditionalEmploymentInfo());return;}additionalEmployments=_.reject(borrower.getAdditionalEmploymentInfo(),function(empInfo){var areDatesValid=incomeHelper.areEmploymentDatesValid(empInfo.employmentStartDate,empInfo.employmentEndDate);return empInfo.isAddedPrevious&&!areDatesValid;});borrower.replaceAdditionalEmploymentInfo(additionalEmployments);var removeAdditionalAddedSections=false;additionalEmployments=borrower.getAdditionalEmploymentInfo();for(var i=0;i<additionalEmployments.length;i++){var empInfo=additionalEmployments[i];if(empInfo.isRemoved||!empInfo.isAddedPrevious){continue;}if(removeAdditionalAddedSections){var idx=additionalEmployments.indexOf(empInfo);if(idx>-1){additionalEmployments.splice(idx,1);}i--;}else{removeAdditionalAddedSections=incomeHelper.timeDifferenceTwoOrMoreYears(empInfo.employmentStartDate,borrower.getCurrentEmploymentInfo().employmentEndDate);}}borrower.replaceAdditionalEmploymentInfo(additionalEmployments);orderEmpInfoListAndCalculateTotals(borrower.getCurrentEmploymentInfo(),borrower.getAdditionalEmploymentInfo());}function orderEmpInfoListAndCalculateTotals(employmentInfoCurrent,employmentInfoAdditional){incomeHelper.orderEmploymentInfoList(employmentInfoAdditional);}function addEmploymentInfo(isAddedPrevious){}function performBorrowerCalculations(borrower){handleAdditionalSections(borrower);}}})();(function(){angular.module("loanApplication").controller("incomeController",incomeController);incomeController.$inject=["$rootScope","incomeService","incomeHelper","modalPopoverFactory","BroadcastSvc","simpleModalWindowFactory","wrappedLoan","controllerData","applicationData","loanEvent","$timeout"];function incomeController($rootScope,incomeService,incomeHelper,modalPopoverFactory,BroadcastSvc,simpleModalWindowFactory,wrappedLoan,controllerData,applicationData,loanEvent,$timeout){var vm=this;vm.wrappedLoan=wrappedLoan;vm.controllerData=controllerData;vm.applicationData=applicationData;vm.borrowers=wrappedLoan.ref.active.Borrowers(false,true);vm.coBorrowerExists=wrappedLoan.ref.active.getCoBorrower()&&wrappedLoan.ref.active.isSpouseOnTheLoan;vm.combinedOtherIncome=combinedOtherIncome;vm.addEmploymentInfo=addEmploymentInfo;vm.addOtherIncome=addOtherIncome;vm.deleteOtherIncome=deleteOtherIncome;vm.onYearsOnThisJobChanged=onYearsOnThisJobChanged;vm.removeEmploymentInfo=removeEmploymentInfo;vm.showHistoryInfo=showHistoryInfo;vm.validateEmploymentDuration=validateEmploymentDuration;vm.onOtherIncomeAmountBlur=onOtherIncomeAmountBlur;vm.onOtherIncomeTypeChanged=onOtherIncomeTypeChanged;vm.onOtherIncomePaymentPeriodChanged=onOtherIncomePaymentPeriodChanged;vm.refreshOtherIncomes=refreshOtherIncomes();vm.isminus=false;refreshOtherIncomes();function validateEmploymentDuration(borrower,employmentInfo){if(!borrower){return;}if(!employmentInfo){employmentInfo=borrower.getCurrentEmploymentInfo();if((!employmentInfo.employmentEndDate&&!moment(employmentInfo.employmentEndDate).isValid())||employmentInfo.EmploymentStatusId==1){employmentInfo.employmentEndDate=moment();}}if(borrower.areEmploymentDatesValid(employmentInfo)){if(!borrower.isTotalEmploymentTwoYears){addEmploymentInfo(borrower,true);}}}function onOtherIncomeAmountBlur(otherIncome){loanEvent.broadcastPropertyChangedEvent(events.LoanFieldIdentifier.OtherIncomeAmount,otherIncome);vm.wrappedLoan.ref.areSixPiecesAcquiredForAllLoanApplications();}function onOtherIncomeTypeChanged(otherIncome){loanEvent.broadcastPropertyChangedEvent(events.LoanFieldIdentifier.OtherIncomeType,otherIncome);vm.wrappedLoan.ref.areSixPiecesAcquiredForAllLoanApplications();}function onOtherIncomePaymentPeriodChanged(otherIncome){if(otherIncome.isNetRental){otherIncome.manualChange=true;}loanEvent.broadcastPropertyChangedEvent(events.LoanFieldIdentifier.OtherIncomePaymentPeriod,otherIncome);}function addEmploymentInfo(borrower,isPrevious){borrower.addAdditionalEmploymentInfo(isPrevious);}function removeEmploymentInfo(employmentInfoItem,borrower){var borrowerParent=wrappedLoan.ref.getTransactionInfo().borrower.lookup(employmentInfoItem.borrowerId);borrowerParent.removeOrDeleteEmploymentInfo(employmentInfoItem);incomeService.orderEmpInfoListAndCalculateTotals(borrower.getCurrentEmploymentInfo,borrower.getAdditionalEmploymentInfo());incomeHelper.checkEmploymentInfosHistory(borrower);}function showHistoryInfo(event,model){var ctrl={title:"Other Income Information History"};var confirmationPopup=modalPopoverFactory.openModalPopover("angular/common/historycontrol.html",ctrl,model.companyData,event);confirmationPopup.result.then(function(data){});}function refreshOtherIncomes(){var otherIncomeList=wrappedLoan.ref.active.getBorrower().getOtherIncomes();if(wrappedLoan.ref.active.isSpouseOnTheLoan){otherIncomeList=otherIncomeList.concat(wrappedLoan.ref.active.getCoBorrower().getOtherIncomes());}vm._combinedOtherIncome=otherIncomeList;}function combinedOtherIncome(coi){if(arguments.length>0){}refreshOtherIncomes();return vm._combinedOtherIncome;}function addOtherIncome(){wrappedLoan.ref.active.getBorrower().addOtherIncome();refreshOtherIncomes();}function deleteOtherIncome(incomeInfoItem){var borrowerParent=wrappedLoan.ref.getTransactionInfo().borrower.lookup(incomeInfoItem.borrowerId);borrowerParent.removeOrDeleteIncomeInfoViewModel(incomeInfoItem);refreshOtherIncomes();vm.wrappedLoan.ref.areSixPiecesAcquiredForAllLoanApplications();loanEvent.broadcastPropertyChangedEvent(events.LoanFieldIdentifier.OtherIncomeAmount,incomeInfoItem);}function onYearsOnThisJobChanged(borrower,empInfo){incomeService.onYearsOnThisJobChanged(borrower,empInfo);}}})();(function(){angular.module("loanApplication").directive("incomeInformation",incomeInformation);incomeInformation.$inject=["enums","loanEvent"];function incomeInformation(enums,loanEvent){var directive={scope:{"employmentInfo":"=","isDisabled":"=","amountPeriods":"=","areSixPiecesAcquired":"=","wrappedLoan":"=?"},controller:controller,controllerAs:"incomeInformation",bindToController:true,restrict:"E",templateUrl:"angular/loanapplication/income/incomeinformation.html"};return directive;function controller(){var vm=this;vm.enums=enums;vm.validateIncome=validateIncome;vm.disableIncomeTypes=disableIncomeTypes;vm.onIncomeAmountChanged=onIncomeAmountChanged;vm.onIncomePeriodChanged=onIncomePeriodChanged;vm.validateBaseOrPartSalary=validateBaseOrPartSalary;vm.checkIfSixPiecesAreAcquired=checkIfSixPiecesAreAcquired;function validateIncome(income){disableIncomeTypes();if(String(income.amount).trim()=="-"){income.amount=0;}}function checkIfSixPiecesAreAcquired(){if(vm.wrappedLoan&&typeof vm.wrappedLoan.ref.areSixPiecesAcquiredForAllLoanApplications=="function"){vm.wrappedLoan.ref.areSixPiecesAcquiredForAllLoanApplications();}}function onIncomeAmountChanged(incomeInfoItem){loanEvent.broadcastPropertyChangedEvent(events.LoanFieldIdentifier.IncomeAmountChanged,incomeInfoItem);}function onIncomePeriodChanged(incomeInfoItem){loanEvent.broadcastPropertyChangedEvent(events.LoanFieldIdentifier.IncomePeriodChanged,incomeInfoItem);}function disableIncomeTypes(){if(vm.employmentInfo.EmploymentTypeId==2){var baseIncome=getIncome(16);}else{var baseIncome=getIncome(0);}var partTimeIncome=getIncome(13);if(!toggleIncome(baseIncome,partTimeIncome)){toggleIncome(partTimeIncome,baseIncome);}}function toggleIncome(sourceIncome,targetIncome){var isTargetIncomeDisabled=false;if(sourceIncome&&sourceIncome.amount!=0&&targetIncome){isTargetIncomeDisabled=disableIncome(targetIncome);}else{isTargetIncomeDisabled=enableIncome(targetIncome);}return isTargetIncomeDisabled;}function disableIncome(income){if(!income){return false;}income.amount=0;income.incomeTypeDisabled=true;return true;}function enableIncome(income){if(!income){return;}income.incomeTypeDisabled=false;}function getIncome(incomeType){if(vm.employmentInfo&&vm.employmentInfo.incomeInformationCollection&&vm.employmentInfo.incomeInformationCollection.length>0){var incomes=vm.employmentInfo.incomeInformationCollection.filter(function(incomeInfoItem){return incomeInfoItem.incomeTypeId==incomeType;});}if(incomes&&incomes.length>0){return incomes[0];}}function validateBaseOrPartSalary(incomeInfoItem){if(!(vm.areSixPiecesAcquired&&incomeInfoItem&&!incomeInfoItem.amount)){return false;}switch(incomeInfoItem.incomeTypeId){case 0:case 16:var partTimeIncome=vm.employmentInfo.incomeInfoByTypeId(13);return partTimeIncome&&!partTimeIncome.amount;case 13:var slariedBaseSalaryIncome=vm.employmentInfo.incomeInfoByTypeId(0);var selfEmployedBaseSalaryIncome=vm.employmentInfo.incomeInfoByTypeId(16);return(slariedBaseSalaryIncome&&!slariedBaseSalaryIncome.amount||selfEmployedBaseSalaryIncome&&!selfEmployedBaseSalaryIncome.amount);}}}}angular.module("loanApplication").directive("employmentInfo",employmentInfo);employmentInfo.$inject=["enums","incomeService","loanEvent"];function employmentInfo(enums,incomeService,loanEvent){var directive={scope:{"borrowerWithInfo":"=","defaultMilitaryIncomeInfoList":"=","defaultRegularIncomeInfoList":"=","isDisabled":"=","isAdditionalEmpInfo":"=","dropDownLists":"=","areSixPiecesAcquired":"=","wrappedLoan":"=?","onYearsOnThisJobChangedFn":"&","removeEmploymentInfoFn":"&",},controller:controller,controllerAs:"employmentInfo",bindToController:true,restrict:"E",template:'<ng-include src="employmentInfo.getTemplateUrl()"/>'};return directive;function controller($timeout){var vm=this;var ddls=vm.dropDownLists;vm.enums=enums;vm.additionalEmploymentTypes=ddls.additionalEmploymentTypes;vm.amountPeriods=ddls.paymentPeriodOptions;vm.branches=ddls.branchOfService;vm.employmentStatuses=ddls.employmentStatuses;vm.employmentTypes=ddls.employmentTypes;vm.isMilitary=false;vm.isRetired=false;vm.isOtherUnemployed=false;vm.isRetiredOrUnemployed=false;vm.yearsText="";vm.positionDescription="";vm.additionalEmploymentTypeChanged=additionalEmploymentTypeChanged;vm.employmentStatusChanged=employmentStatusChanged;vm.employmentTypeChanged=employmentTypeChanged;vm.getTemplateUrl=getTemplateUrl;vm.onYearsOnThisJobChanged=onYearsOnThisJobChanged;vm.removeEmploymentInfo=removeEmploymentInfo;vm.validateEmploymentStartAndRetiredDate=validateEmploymentStartAndRetiredDate;vm.validateIsSalariedOrSelfEmployed=validateIsSalariedOrSelfEmployed;vm.validateIsActiveMilitaryDuty=validateIsActiveMilitaryDuty;vm.validateIsSalariedOrSelfEmployedAdditional=validateIsSalariedOrSelfEmployedAdditional;setData();function setData(){setEmploymentTypeFlags();setSpanValues();}function setEmploymentTypeFlags(){if(vm.borrowerWithInfo==null){return;}var empTypeId=vm.borrowerWithInfo.getCurrentEmploymentInfo().EmploymentTypeId;vm.isMilitary=empTypeId==enums.employmentType.activeMilitaryDuty;vm.isRetired=empTypeId==enums.employmentType.retired;vm.isOtherUnemployed=empTypeId==enums.employmentType.otherUnemployed;vm.isRetiredOrUnemployed=vm.isRetired||vm.isOtherUnemployed;}function setSpanValues(){vm.yearsText=vm.isRetired?"Retirement Date":"Years on this job";vm.positionDescription=vm.isMilitary?"Rank":"Position";}function removeEmploymentInfo(employmentInfoItem){vm.removeEmploymentInfoFn()(employmentInfoItem,vm.borrowerWithInfo);loanEvent.broadcastPropertyChangedEvent(events.LoanFieldIdentifier.BorrowerIncome,employmentInfoItem);}function getTemplateUrl(){return"angular/loanapplication/income/"+(vm.isAdditionalEmpInfo?"additionalemployer":"currentemployer")+".html";}function employmentTypeChanged(){var borrowerWithInfo=vm.borrowerWithInfo;setData();borrowerWithInfo.getCurrentEmploymentInfo().isMilitary=vm.isMilitary;resetNegativeValuesAndCalculateMonthly(borrowerWithInfo.getCurrentEmploymentInfo());}function employmentStatusChanged(employmentInfo){if(employmentInfo.EmploymentStatusId==enums.employmentStatus.current){var currentTime=moment();employmentInfo.employmentEndDate=currentTime;}else{employmentInfo.employmentEndDate=null;}loanEvent.broadcastPropertyChangedEvent(events.LoanFieldIdentifier.BorrowerIncome,employmentInfo);}function additionalEmploymentTypeChanged(employmentInfo){resetNegativeValuesAndCalculateMonthly(employmentInfo);}function resetNegativeValuesAndCalculateMonthly(employmentInfo){resetNegativeValues(employmentInfo);loanEvent.broadcastPropertyChangedEvent(events.LoanFieldIdentifier.BorrowerIncome,employmentInfo);}function resetNegativeValues(employmentInfo){if(employmentInfo.EmploymentTypeId!=enums.employmentType.selfEmployed){angular.forEach(employmentInfo.getIncomeInformation(),function(income){if(income.amount<0){income.amount=0;}});}}function onYearsOnThisJobChanged(employmentInfo){$timeout(function(){vm.onYearsOnThisJobChangedFn()(vm.borrowerWithInfo,employmentInfo);});}function validateEmploymentStartAndRetiredDate(model){return vm.areSixPiecesAcquired&&vm.borrowerWithInfo.getCurrentEmploymentInfo().isRetired&&!model;}function validateIsSalariedOrSelfEmployed(model){return vm.areSixPiecesAcquired&&vm.borrowerWithInfo.getCurrentEmploymentInfo().isSalariedEmployeeOrSelfEmployed&&!model;}function validateIsActiveMilitaryDuty(model){return vm.borrowerWithInfo.getCurrentEmploymentInfo().isActiveMilitaryDuty&&vm.areSixPiecesAcquired&&!model;}function validateIsSalariedOrSelfEmployedAdditional(model,empInfo){return vm.areSixPiecesAcquired&&empInfo.isSalariedEmployeeOrSelfEmployed&&!model;}}}})();var credit;(function(credit){(function(creditContext){creditContext[creditContext["borrower"]=0]="borrower";creditContext[creditContext["coBorrower"]=1]="coBorrower";creditContext[creditContext["both"]=2]="both";})(credit.creditContext||(credit.creditContext={}));var creditContext=credit.creditContext;var CreditStateService=(function(){function CreditStateService(CreditSvc,enums,loanEvent,guidService,costDetailsHelpers){var _this=this;this.CreditSvc=CreditSvc;this.enums=enums;this.loanEvent=loanEvent;this.guidService=guidService;this.costDetailsHelpers=costDetailsHelpers;this.basePred=function(liability){return !liability.isRemoved;};this.baseREO=function(liability){return !liability.notMyLoan&&liability.borrowerDebtCommentId!=9;};this.primaryREO=function(liability){return !liability.isSecondaryPartyRecord;};this.calcPred=function(l){return _this.basePred(l)&&l.includeInLiabilitiesTotal;};this.reosPred=function(liability){return _this.basePred(liability)&&liability.isPledged;};this.initializeLoan=function(wrappedLoan){_this.wrappedLoan=wrappedLoan;};this.updateCredit=function(wrappedLoan,showCoBorrrower){_this.wrappedLoan=wrappedLoan;_this.wrappedLoan.ref.active.initializeCredit();_this.setBorrowerDebtAccountOwnershipTypes(wrappedLoan.ref.active);_this.setReoPaymentDisplayValue(_this.wrappedLoan.ref.active.reos);};this.updateREO=function(updatedREO){var isBorrower=_this.isBorrower(updatedREO);_this.addToBorrowerLiabilities(updatedREO,!isBorrower);var allLiabilities=_this.wrappedLoan.ref.active.getBorrower().getLiabilities();if(_this.wrappedLoan.ref.active.isSpouseOnTheLoan&&_this.wrappedLoan.ref.active.getCoBorrower()&&_this.wrappedLoan.ref.active.getCoBorrower().getLiabilities()){allLiabilities=allLiabilities.concat(_this.wrappedLoan.ref.active.getCoBorrower().getLiabilities());}if((!_this.wrappedLoan.ref.housingExpenses.newFloodInsurance)&&(!_this.wrappedLoan.ref.housingExpenses.newHazardInsurance)&&(!_this.wrappedLoan.ref.housingExpenses.newTaxes)&&_this.wrappedLoan.ref.loanPurposeType==2){_this.updateCost();}else{_this.processPropertyExpenses();}_this.wrappedLoan.ref.active.reos=lib.filter(allLiabilities,_this.reosPred);_this.setReoPaymentDisplayValue(_this.wrappedLoan.ref.active.reos);};this.showCollections=function(){return _this.wrappedLoan.ref.active.collections.length&&_this.wrappedLoan.ref.active.collections.length>0;};this.showPublicRecords=function(){return _this.wrappedLoan.ref.active.publicRecords.length&&_this.wrappedLoan.ref.active.publicRecords.length>0;};this.updateCost=function(){_this.wrappedLoan.ref.prepareSave();_this.CreditSvc.UpdateClosingCosts.UpdateClosingCosts(_this.wrappedLoan.ref).$promise.then(function(data){_this.wrappedLoan.ref.closingCost=data.closingCost;_this.costDetailsHelpers.getCostDetailsData();_this.processPropertyExpenses();},function(error){var errmsg="Error:"+JSON.stringify(error);errmsg=errmsg.substr(0,128);console.error(errmsg);});};this.processPropertyExpenses=function(){_this.loanEvent.broadcastPropertyChangedEvent(20,{});};this.deleteREO=function(liability){liability.isRemoved=true;lib.removeFirst(_this.wrappedLoan.ref.active.reos,function(l){return l==liability;});var property=liability.getProperty();if(property!=null){var nri=property.getNetRentalIncome();if(nri!=null){nri.remove();}_this.resetPropertyOwnershipPercentage(property);}};this.resetPropertyOwnershipPercentage=function(property){if(!property){return;}var ti=_this.wrappedLoan.ref.getTransactionInfo();if(!!ti){var liabilitiesWithSameProperty=ti.liabilities.filter(function(li){return !li.isRemoved&&li.isPledged&&li.hasProperty()&&li.getProperty().propertyId==property.propertyId;});if(liabilitiesWithSameProperty.length==0){_this.wrappedLoan.ref.active.ownershipPercentage=null;}}};this.summateTotalREOPropertyValues=function(){var pred=function(l){return _this.basePred(l)&&_this.baseREO(l)&&_this.primaryREO(l)&&l.getProperty()&&l.getProperty().currentEstimatedValue&&(l.lienPosition==1||l.lienPosition==0||l.lienPosition==-1||angular.isUndefined(l.lienPosition)||l.lienPosition==null||""==(""+l.lienPosition).trim());};return lib.summate(_this.wrappedLoan.ref.active.reos,pred,function(l){return l.getProperty().currentEstimatedValue;});};this.summateTotalREOBalance=function(){return lib.summate(_this.wrappedLoan.ref.active.reos,function(l){return _this.basePred(l)&&_this.baseREO(l)&&_this.primaryREO(l);},function(l){return l.unpaidBalance;});};this.summateTotalREOPayment=function(){return lib.summate(_this.wrappedLoan.ref.active.reos,function(l){return _this.basePred(l)&&l.includeInTotalPayment&&_this.primaryREO(l);},function(l){return l.totalPaymentDisplayValue;});};this.addCollection=function(liability,isCoBorrower){_this.wrappedLoan.ref.active.collections.push(liability);_this.addToBorrowerLiabilities(liability,isCoBorrower);};this.deleteCollection=function(liability){liability.isRemoved=true;lib.removeFirst(_this.wrappedLoan.ref.active.collections,function(l){return l==liability;});};this.summateTotalCollectionsPayments=function(){return lib.summate(_this.wrappedLoan.ref.active.collections,_this.calcPred,function(l){return l.minPayment;});};this.summateTotalCollectionsUnpaidBalance=function(){return lib.summate(_this.wrappedLoan.ref.active.collections,_this.calcPred,function(l){return l.unpaidBalance;});};this.summateTotalPublicRecordsAmount=function(){return lib.summate(_this.wrappedLoan.ref.active.publicRecords,function(publicRecord){return publicRecord.publicRecordComment!="4";},function(publicRecord){return publicRecord.amount;});};this.addLiability=function(liability,isCoBorrower){_this.addLiabilityToBorrower(liability,isCoBorrower);};this.deleteLiabilities=function(liability,isCoBorrower){_this.deleteLiability(liability,isCoBorrower);_this.removeJointLiability(liability);};this.removeJointLiability=function(liability){if(liability.isJoint&&!liability.isJointWithSingleBorrowerID){_this.tryDeleteJointLiablity(_this.wrappedLoan.ref.active.borrowerLiabilities[1].liabilities,liability,true)||_this.tryDeleteJointLiablity(_this.wrappedLoan.ref.active.borrowerLiabilities[0].liabilities,liability,false);}};this.tryDeleteJointLiablity=function(liabilities,parentLiability,isCoBorrower){var pred=(lib.IdIsNullOrDefault(parentLiability.liabilityInfoId))?function(l){return l.originalClientId==parentLiability.clientId;}:function(l){return l.originalLiabilityInfoId==parentLiability.liabilityInfoId;};var secondaryLiability=lib.findFirst(liabilities,pred);if(secondaryLiability){_this.deleteLiability(secondaryLiability,isCoBorrower);return true;}return false;};this.deleteLiability=function(liability,isCoBorrower){liability.isRemoved=true;};this.summateLiabiltyUnpaidBalance=function(context){return _this.summateLiabilityValues(context,function(l){return l.unpaidBalance;});};this.summateLiabiltyPayment=function(context){return _this.summateLiabilityValues(context,function(l){return l.minPayment;});};this.summateLiabiltyPaymentPrimary=function(context){return _this.summateLiabilityValuesPrimary(context,function(l){return l.minPayment;});};this.summateLiabilityPaymentAdditionalMortgages=function(context){return _this.summateLiabilityValuesAdditionalMorgages(context,function(l){return l.minPayment;});};this.moveLiabilityBetweenBorrowers=function(liability){if(_this.wrappedLoan.ref.active.isSpouseOnTheLoan){var pred=function(l){return l==liability;};}};this.moveLiabilityToREO=function(liability,isCoBorrower){if(!_this.isValidForMove(liability,isCoBorrower)){return;}_this.CreditSvc.MoveLiabilityToREO.save(liability,function(pledgedAsset){var reos=_this.wrappedLoan.ref.active.reos;var pledgedAssets=lib.filter(reos,function(pa){return !!pa.getProperty()&&pa.getProperty().propertyId==pledgedAsset.propertyId;});liability.clientId=pledgedAssets.length;liability.isPledged=pledgedAsset.isPledged;liability.typeId=pledgedAsset.typeId;liability.liabilityInfoType=pledgedAsset.liabilityInfoType;liability.borrowerDebtCommentId=pledgedAsset.borrowerDebtCommentId;liability.includeInLiabilitiesTotal=pledgedAsset.includeInLiabilitiesTotal;liability.setProperty(new cls.PropertyViewModel(_this.wrappedLoan.ref.getTransactionInfoRef(),pledgedAsset.property));liability.totalPaymentDisplayValue=pledgedAsset.totalPaymentDisplayValue;liability.propertyAddressDisplayValue=pledgedAsset.propertyAddressDisplayValue;liability.borrowerId=pledgedAsset.borrowerId;liability.debtsAccountOwnershipType=isCoBorrower?_this.coBorrowerDebtAccountOwnershipTypes[0].value:_this.borrowerDebtAccountOwnershipTypes[0].value;liability.propertyId=null;_this.wrappedLoan.ref.active.reos.push(liability);_this.removeJointLiability(liability);},function(error){var errmsg="Error:"+JSON.stringify(error);errmsg=errmsg.substr(0,128);console.error(errmsg);});};this.moveREOToLiability=function(pledgedAsset,isCoBorrower){if(!_this.isValidForMove(pledgedAsset,isCoBorrower)){return;}var loanApp=_this.wrappedLoan.ref.active;var property=pledgedAsset.getProperty();_this.removeNetRental(property);var targetBorrowerId=isCoBorrower?_this.wrappedLoan.ref.active.getCoBorrower().borrowerId:_this.wrappedLoan.ref.active.getBorrower().borrowerId;var isLiabilityTransferred=pledgedAsset.borrowerId!=targetBorrowerId;_this.CreditSvc.moveREOToLiability.save(pledgedAsset,function(liability){pledgedAsset.clientId=_this.wrappedLoan.ref.active.borrowerLiabilities[0].liabilities.length+(_this.wrappedLoan.ref.active.borrowerLiabilities[1]?_this.wrappedLoan.ref.active.borrowerLiabilities[1].liabilities.length:0);pledgedAsset.debtCommentId=liability.debtCommentId;pledgedAsset.liabilityInfoType=liability.liabilityInfoType;pledgedAsset.includeInDTI=liability.includeInDTI;pledgedAsset.includeInLiabilitiesTotal=liability.includeInLiabilitiesTotal;pledgedAsset.typeId=liability.typeId;pledgedAsset.isPledged=liability.isPledged;pledgedAsset.debtType=liability.debtType;pledgedAsset.accountOwnershipTypeToolTipText=liability.accountOwnershipTypeToolTipText;pledgedAsset.accountOwnershipTypeIndicator=liability.accountOwnershipTypeIndicator;pledgedAsset.debtsAccountOwnershipType=isCoBorrower?_this.coBorrowerDebtAccountOwnershipTypes[0].value:_this.borrowerDebtAccountOwnershipTypes[0].value;pledgedAsset.borrowerId=targetBorrowerId;_this.removeLiablityFromREO(pledgedAsset);if(isLiabilityTransferred){var liablityTarget=new cls.LiabilityViewModel(_this.wrappedLoan.ref.getTransactionInfoRef(),pledgedAsset);liablityTarget.setProperty(pledgedAsset.getProperty());liablityTarget.liabilityInfoId=lib.getEmptyGuid();_this.guidService.getNewGuid().then(function(response){liablityTarget.liabilityInfoId=response.data;});var targetBorrower;var sourceBorrower;if(isCoBorrower){sourceBorrower=_this.wrappedLoan.ref.active.getBorrower();targetBorrower=_this.wrappedLoan.ref.active.getCoBorrower();}else{targetBorrower=_this.wrappedLoan.ref.active.getBorrower();sourceBorrower=_this.wrappedLoan.ref.active.getCoBorrower();}pledgedAsset.isRemoved=true;targetBorrower.addLiability(liablityTarget);}},function(error){var errmsg="Error:"+JSON.stringify(error);errmsg=errmsg.substr(0,128);console.error(errmsg);});};this.getCombinedDebtAccountOwnershipTypes=function(borrowerName,coBorrowerName){var debtAccountOwnershipTypes=new Array();debtAccountOwnershipTypes.push(new cls.LookupItem(borrowerName,(0).toString()));debtAccountOwnershipTypes.push(new cls.LookupItem(borrowerName+" with Other",(3).toString()));debtAccountOwnershipTypes.push(new cls.LookupItem(coBorrowerName,(1).toString()));debtAccountOwnershipTypes.push(new cls.LookupItem(coBorrowerName+" with Other",(4).toString()));debtAccountOwnershipTypes.push(new cls.LookupItem(borrowerName+", "+coBorrowerName,(2).toString()));return debtAccountOwnershipTypes;};this.getCompanyDataForCollection=function(liability,disableFields){return _this.getCompanyDataForBaseLiability(liability,false,disableFields);};this.getCompanyDataForLiability=function(liability,disableFields){return _this.getCompanyDataForBaseLiability(liability,true,disableFields);};this.getCompanyDataForBaseLiability=function(liability,isLiabiity,disableFields){if(!liability.debtsAccountOwnershipType){liability.debtsAccountOwnershipType=_this.wrappedLoan.ref.lookup.debtAccountOwnershipTypes[0].value;}var data={title:"Company Information",isLiabilities:isLiabiity,unpaidBalance:liability.unpaidBalance,minPayment:liability.minPayment,debtsAccountOwnershipType:liability.debtsAccountOwnershipType,debtAccountOwnershipTypes:_this.wrappedLoan.ref.lookup.debtAccountOwnershipTypes,disableFields:disableFields||liability.isSecondaryPartyRecord,liabilityTypes:_this.wrappedLoan.ref.lookup.liabilityTypes,states:_this.wrappedLoan.ref.lookup.allStates};return data;};this.getCompanyDataForPublicRecord=function(publicRecord,disableFields){var liabilityTypes=_this.wrappedLoan.ref.active.LiabilitiesFor();if(!publicRecord.companyData.liabillityFor||publicRecord.companyData.liabillityFor=="Individual"||(publicRecord.companyData.liabillityFor=="Joint"&&liabilityTypes.length==1)){publicRecord.companyData.liabillityFor=liabilityTypes[0].value;}var data={title:"Company Information",isLiabilities:false,unpaidBalance:publicRecord.originalAmount,minPayment:0,debtsAccountOwnershipType:null,debtAccountOwnershipTypes:null,disableFields:disableFields,liabilityTypes:null,states:_this.wrappedLoan.ref.lookup.allStates};};this.processRulesForLiabilityOwnershipType=function(liability){var hasChanges=liability.companyData.hasChanges;_this.CreditSvc.ProcessRulesForLiabilityOwnershipType.save(liability,function(liabilities){angular.extend(liability,liabilities[0]);liability.companyData.hasChanges=hasChanges;var originalBorrowerId=liability.borrowerId;if(liability.debtsAccountOwnershipType==_this.enums.DebtsAccountOwnershipType.CoBorrower||liability.debtsAccountOwnershipType==_this.enums.DebtsAccountOwnershipType.CoBorrowerWithOther){liability.borrowerId=_this.wrappedLoan.ref.active.getCoBorrower().borrowerId;}else{liability.borrowerId=_this.wrappedLoan.ref.active.getBorrower().borrowerId;}if(liability.debtsAccountOwnershipType!=_this.enums.DebtsAccountOwnershipType.Joint||originalBorrowerId!=liability.borrowerId){_this.removeJointLiability(liability);}if(liabilities.length==2){if(liability.borrowerId=_this.wrappedLoan.ref.active.getBorrower().borrowerId){liabilities[1].borrowerId=_this.wrappedLoan.ref.active.getCoBorrower().borrowerId;}else{liabilities[1].borrowerId=_this.wrappedLoan.ref.active.getBorrower().borrowerId;}var collection=new cls.LiabilityViewModel(_this.wrappedLoan.ref.getTransactionInfoRef(),liabilities[1]);_this.addCollection(collection,true);}},function(error){var errmsg="Error:"+JSON.stringify(error);errmsg=errmsg.substr(0,128);console.error(errmsg);});};this.setBorrowerDebtAccountOwnershipTypes=function(loanApplication){var borrowerFullName=loanApplication.getBorrower().fullName;var coBorrowerFullName=loanApplication.isSpouseOnTheLoan?loanApplication.getCoBorrower().fullName:"";_this.borrowerDebtAccountOwnershipTypes=new Array();_this.borrowerDebtAccountOwnershipTypes.push(new cls.LookupItem(borrowerFullName,(0).toString()));if(loanApplication.isSpouseOnTheLoan){_this.borrowerDebtAccountOwnershipTypes.push(new cls.LookupItem(borrowerFullName+", "+coBorrowerFullName,(2).toString()));}_this.borrowerDebtAccountOwnershipTypes.push(new cls.LookupItem(borrowerFullName+" with Other",(3).toString()));if(loanApplication.isSpouseOnTheLoan){_this.coBorrowerDebtAccountOwnershipTypes=new Array();_this.coBorrowerDebtAccountOwnershipTypes.push(new cls.LookupItem(coBorrowerFullName,(1).toString()));_this.coBorrowerDebtAccountOwnershipTypes.push(new cls.LookupItem(coBorrowerFullName+", "+borrowerFullName,(2).toString()));_this.coBorrowerDebtAccountOwnershipTypes.push(new cls.LookupItem(coBorrowerFullName+" with Other",(4).toString()));}if(loanApplication.isSpouseOnTheLoan){_this.debtAccountOwnershipTypes=_this.getCombinedDebtAccountOwnershipTypes(borrowerFullName,coBorrowerFullName);}else{_this.debtAccountOwnershipTypes=_this.borrowerDebtAccountOwnershipTypes;}};this.getDebtAccountOwnershipTypes=function(){return _this.debtAccountOwnershipTypes;};this.setCompanyDataName=function(source){var action=function(liability){return liability.companyData.companyName=(liability.typeId==2||liability.typeId==3)&&!liability.companyData.companyName&&!liability.isNewRow?"Not specified":liability.companyData.companyName;};lib.forEach(source,action);};this.setReoPaymentDisplayValue=function(source){var action=function(liability){return liability.totalPaymentDisplayValue=_this.setTotalPaymentsDisplayValue(liability);};lib.forEach(source,action);};this.summateLiabilityValuesPrimary=function(context,accessor){var total=0;var pred=function(l){return l.typeId==2&&!l.isPledged&&!l.isSecondaryPartyRecord&&_this.calcPred(l);};total+=_this.sumateLiabilityValuesHelper(_this.wrappedLoan.ref.primary,context,accessor,pred);return total;};this.summateLiabilityValuesAdditionalMorgages=function(context,accessor){var total=0;var pred=function(l){return l.typeId==2&&!l.isPledged&&!l.isSecondaryPartyRecord&&_this.calcPred(l);};angular.forEach(_this.wrappedLoan.ref.getLoanApplications(),function(loanApplication){if(!loanApplication.isPrimary){total+=_this.sumateLiabilityValuesHelper(loanApplication,context,accessor,pred);}});return total;};this.sumateLiabilityValuesHelper=function(loanApplication,context,accessor,pred){var total=0;if(loanApplication!=null&&context!=null){if(context==0||context==2){total+=lib.summate(loanApplication.borrowerLiabilities[0].liabilities,pred,accessor);}if(loanApplication.borrowerLiabilities[1]&&(context==1||context==2)){total+=lib.summate(loanApplication.borrowerLiabilities[1].liabilities,function(l){return pred(l);},accessor);}}return total;};this.getBorrowerLiabilities=function(liability){return _this.isBorrower(liability)?_this.wrappedLoan.ref.active.getBorrower().getLiabilities():_this.wrappedLoan.ref.active.getCoBorrower().getLiabilities();};this.isBorrower=function(liablity){if(liablity.borrowerId==_this.wrappedLoan.ref.active.getBorrower().borrowerId){return true;}else{if(liablity.borrowerId==_this.wrappedLoan.ref.active.getCoBorrower().borrowerId){return false;}else{throw"The liability "+liablity.liabilityInfoId+" is not associated to either the brorrower or coBorrower";}}};this.addToBorrowerLiabilities=function(liability,isCoBorrower){if(!isCoBorrower){_this.wrappedLoan.ref.active.getBorrower().addLiability(liability);}else{_this.wrappedLoan.ref.active.getCoBorrower().addLiability(liability);}};this.removeLiablityFromREO=function(liability){lib.removeFirst(_this.wrappedLoan.ref.active.reos,function(l){return l==liability;});};this.isValidForMove=function(liability,isCoBorrower){return !liability||(isCoBorrower&&!_this.wrappedLoan.ref.active.isSpouseOnTheLoan)?false:true;};this.addLiabilityToBorrower=function(liability,isCoBorrower){isCoBorrower=_this.wrappedLoan.ref.active.isSpouseOnTheLoan&&isCoBorrower;var borrowerTgt=isCoBorrower?_this.wrappedLoan.ref.active.getCoBorrower():_this.wrappedLoan.ref.active.getBorrower();borrowerTgt.addLiability(liability);var idx=isCoBorrower?1:0;_this.wrappedLoan.ref.active.borrowerLiabilities[idx].liabilities.push(liability);return liability;};this.setTotalPaymentsDisplayValue=function(liability){var paymentDisplayValue=liability.minPayment;var totalPropertyExpenses=0;var propertyExpensesExist=(liability.getProperty()&&liability.getProperty().propertyExpenses);var isFirstLienPosition=liability.lienPosition==1;var isNotMyLoan=liability.borrowerDebtCommentId==6;if(propertyExpensesExist&&liability.getProperty().propertyExpenses.length>0){totalPropertyExpenses+=lib.summate(liability.getProperty().propertyExpenses,function(e){return !e.impounded;},function(e){return e.monthlyAmount;});}if(liability.borrowerDebtCommentId==_this.enums.PledgedAssetComment.PaidOffFreeAndClear){return totalPropertyExpenses;}if(isNotMyLoan||!propertyExpensesExist||!isFirstLienPosition){return paymentDisplayValue;}return paymentDisplayValue+totalPropertyExpenses;};}CreditStateService.prototype.removeNetRental=function(property){if(property!=null){var nri=property.getNetRentalIncome();if(nri!=null){nri.remove();}}};CreditStateService.prototype.summateLiabilityValues=function(context,accessor){var _this=this;var total=0;var pred=function(l){return l.typeId==2&&!l.isPledged&&!l.isSecondaryPartyRecord&&_this.calcPred(l);};if(context==0||context==2){total+=lib.summate(this.wrappedLoan.ref.active.borrowerLiabilities[0].liabilities,pred,accessor);}if(this.wrappedLoan.ref.active.borrowerLiabilities[1]&&(context==1||context==2)){total+=lib.summate(this.wrappedLoan.ref.active.borrowerLiabilities[1].liabilities,function(l){return pred(l);},accessor);}return total;};CreditStateService.$inject=["CreditSvc","enums","loanEvent","guidService","costDetailsHelpers"];CreditStateService.className="CreditStateService";return CreditStateService;})();credit.CreditStateService=CreditStateService;angular.module("loanApplication").service(CreditStateService.className,CreditStateService);})(credit||(credit={}));(function(){angular.module("util").factory("CreditSvc",CreditSvc);CreditSvc.$inject=["$resource","apiRoot"];function CreditSvc($resource,ApiRoot){var CreditApiPath=ApiRoot+"Credit/";var CreditServices=$resource(CreditApiPath+":path",{path:"@path"},{RunCredit:{method:"GET",params:{loanApplicationId:"loanApplicationId",userAccountId:"userAccountId",isReRunReport:"isReRunReport",borrowerId:"borrowerId"}},GetEmptyLiabilityRecord:{method:"GET",isArray:true,params:{debtAccountOwnershipType:"debtAccountOwnershipType",borrowerId:"borrowerId",secondaryBorrowerId:"secondaryBorrowerId"}},GetCreditStatus:{method:"GET",params:{loanApplicationId:"loanApplicationId",accountId:"accountId"}},});var MoveLiabilityToREO=$resource(CreditApiPath+"MoveLiabilityToREOEx",{liability:"@liability"});var moveREOToLiability=$resource(CreditApiPath+"MoveREOToLiability",{pledgedAsset:"@pledgedAsset"});var ProcessRulesForCollectionComment=$resource(CreditApiPath+"ProcessRulesForCollectionCommentEx",{debtViewModel:"@debtViewModel"});var ProcessRulesForLiabilityComment=$resource(CreditApiPath+"ProcessRulesForLiabilityCommentEx",{debtViewModel:"@debtViewModel"});var ProcessRulesForPublicRecordComment=$resource(CreditApiPath+"ProcessRulesForPublicRecordCommentEx",{publicRecordViewModel:"@publicRecordViewModel"});var RefreshPledgedAssets=$resource(CreditApiPath+"RefreshPledgedAssets",{realEstateViewModel:"@realEstateViewModel"});var ProcessRulesForLiabilityOwnershipType=$resource(CreditApiPath+"ProcessRulesForLiabilityOwnershipTypeEx",{debtViewModel:"@debtViewModel"},{"save":{method:"POST",isArray:true}});var UpdateClosingCosts=$resource(CreditApiPath+"UpdateClosingCosts",{},{UpdateClosingCosts:{method:"POST"}});var ProcessPropertyExpenses=$resource(CreditApiPath+"ProcessPropertyExpenses",{},{ProcessPropertyExpenses:{method:"POST"}});function formatFICOScore(value){if(!!Number(value)){return value;}else{return"N/A";}}var service={CreditServices:CreditServices,moveREOToLiability:moveREOToLiability,MoveLiabilityToREO:MoveLiabilityToREO,ProcessRulesForCollectionComment:ProcessRulesForCollectionComment,ProcessRulesForLiabilityComment:ProcessRulesForLiabilityComment,ProcessRulesForPublicRecordComment:ProcessRulesForPublicRecordComment,RefreshPledgedAssets:RefreshPledgedAssets,ProcessRulesForLiabilityOwnershipType:ProcessRulesForLiabilityOwnershipType,UpdateClosingCosts:UpdateClosingCosts,ProcessPropertyExpenses:ProcessPropertyExpenses,formatFICOScore:formatFICOScore};return service;}})();(function(){angular.module("loanApplication").factory("CreditHelpers",CreditHelpers);CreditHelpers.$inject=["CreditSvc","enums","BroadcastSvc"];function CreditHelpers(CreditSvc,enums,BroadcastSvc){var cloneEmptyRow=cloneEmptyRow;var service={collectionsCommentChanged:collectionsCommentChanged,PublicRecordCommentChanged:PublicRecordCommentChanged,liabilitiesCommentChanged:liabilitiesCommentChanged,deleteRealEstateRow:deleteRealEstateRow,processJointLiabilityRecords:processJointLiabilityRecords,addEmptyRow:addEmptyRow,removeRow:removeRow,getRunCreditItems:getRunCreditItems,CoBorrowerExists:CoBorrowerExists,ProcessRulesForLiabilityOwnershipType:ProcessRulesForLiabilityOwnershipType,setInvalidValidationFlag:setInvalidValidationFlag,resetInvalidValidationFlag:resetInvalidValidationFlag,setTouchedValidationFlag:setTouchedValidationFlag,resetTouchedValidationFlag:resetTouchedValidationFlag,getCompanyInfoData:getCompanyInfoData,companyHasChanges:companyHasChanges};return service;function collectionsCommentChanged(collections,collection){CreditSvc.ProcessRulesForCollectionComment.save(collection,function(data){angular.extend(collection,data);},function(err){console.log("Error: ",err);});}function PublicRecordCommentChanged(publicRecordViewModel){CreditSvc.ProcessRulesForPublicRecordComment.save(publicRecordViewModel,function(data){angular.extend(publicRecordViewModel,data);},function(err){console.log("Error: ",err);});}function liabilitiesCommentChanged(vm,liability){CreditSvc.ProcessRulesForLiabilityComment.save(liability,function(data){angular.extend(liability,data);processJointLiabilityRecords(vm,liability.LiabilityInfoId);},function(err){console.log("Error: ",err);});}function deleteRealEstateRow(wrappedLoan,clientId){removeRow(wrappedLoan.ref.active.realEstate.pledgedAssets,clientId);}function DeleteSecondaryLiabilitiesRow(vm,originalDebtId){if(originalDebtId!="00000000-0000-0000-0000-000000000000"&&originalDebtId!=null){angular.forEach(vm.wrappedLoan.ref.active.groupedLiabilities,function(debt){if(debt.OriginalLiabilityInfoId===originalDebtId){debt.IsRemoved=true;return false;}});}}function processJointLiabilityRecords(liabilities,liabilityInfoId){var originalLiability={};var jointLiability=null;if(liabilityInfoId==="00000000-0000-0000-0000-000000000000"){return;}angular.forEach(liabilities,function(item){if(item.liabilityInfoId===liabilityInfoId){originalLiability=item;}else{if(item.originalLiabilityInfoId===liabilityInfoId){jointLiability={};jointLiability=item;}}});if(jointLiability==null){return;}if(originalLiability.companyData!=null){if(jointLiability.companyData==null){jointLiability.companyData={};}jointLiability.companyData.companyName=originalLiability.companyData.companyName;jointLiability.debtType=originalLiability.debtType;jointLiability.accountNumber=originalLiability.accountNumber;jointLiability.monthsLeft=originalLiability.monthsLeft;jointLiability.unpaidBalance=originalLiability.unpaidBalance;jointLiability.minPayment=originalLiability.minPayment;jointLiability.debtComment=originalLiability.debtComment;}}function addEmptyRow(viewModel){viewModel.push(cloneEmptyRow(viewModel));}function cloneEmptyRow(viewModel){for(var i=0;i<viewModel.length;i++){if(viewModel[i].isRemoved&&viewModel[i].isUserEntry){var result=angular.copy(viewModel[i]);result.isRemoved=false;return result;}}}function removeRow(viewModel,index){if(viewModel[index].isUserEntry){viewModel.splice(index,1);angular.forEach(viewModel,function(vm,idx){vm.clientId=idx;});}else{viewModel[index].isRemoved=true;}}function getRunCreditItems(borrower,coBorrower,isSpouseOnTheLoan){var RunCreditButtonItems=[{id:"0",name:"Run New Credit Report",Action:"run",What:"Credit Report",borrowerId:borrower.borrowerId}];if(isSpouseOnTheLoan&&coBorrower){RunCreditButtonItems.push({id:"1",name:"Remove "+borrower.fullName,Action:"remove",What:"Credit Report",For:borrower.fullName,borrowerId:borrower.borrowerId},{id:"2",name:"Remove "+coBorrower.fullName,Action:"remove",What:"Credit Report",For:coBorrower.fullName,coborrowerId:coBorrower.borrowerId});}return RunCreditButtonItems;}function CoBorrowerExists(vm){return vm!=null&&vm.CreditTabViewModel!=null&&vm.CreditTabViewModel.getCoBorrower()!=null&&vm.CreditTabViewModel.CoborrowerExists!=null&&vm.CreditTabViewModel.CoborrowerExists===true;}function ProcessRulesForLiabilityOwnershipType(model,vm){var hasChanges=model.companyData.hasChanges;CreditSvc.ProcessRulesForLiabilityOwnershipType.save(model,function(data){angular.extend(model,data[0]);model.companyData.hasChanges=hasChanges;var originalBorrowerId=model.borrowerId;if(model.DebtsAccountOwnershipType==enums.DebtsAccountOwnershipType.CoBorrower||model.DebtsAccountOwnershipType==enums.DebtsAccountOwnershipType.CoBorrowerWithOther){model.borrowerId=vm.wrappedLoan.ref.active.getCoBorrower().borrowerId;}else{model.borrowerId=vm.wrappedLoan.ref.active.getBorrower().borrowerId;}if(model.DebtsAccountOwnershipType!=enums.DebtsAccountOwnershipType.Joint||originalBorrowerId!=model.borrowerId){DeleteSecondaryLiabilitiesRow(vm,model.LiabilityInfoId);}if(data.length==2){var newDebtSecondaryBorrower=data[1];if(model.borrowerId=vm.wrappedLoan.ref.active.getBorrower().borrowerId){newDebtSecondaryBorrower.borrowerId=vm.wrappedLoan.ref.active.getCoBorrower().borrowerId;var collection=new cls.LiabilityViewModel(vm.wrappedLoan.ref.getTransactionInfoRef(),newDebtSecondaryBorrower);collection.fullName=vm.wrappedLoan.ref.active.getCoBorrower().fullName;vm.CreditStateService.addCollection(collection,true);}else{newDebtSecondaryBorrower.borrowerId=vm.wrappedLoan.ref.active.getBorrower().borrowerId;var collection=new cls.LiabilityViewModel(vm.wrappedLoan.ref.getTransactionInfoRef(),newDebtSecondaryBorrower);collection.fullName=vm.wrappedLoan.ref.active.getCoBorrower().fullName;vm.CreditStateService.addCollection(collection,false);}}},function(err){console.log("Error: ",err);});}function setInvalidValidationFlag(formElement){formElement.$touched=true;formElement.$invalid=true;var element=angular.element(document.querySelector("[name="+formElement.$name+"]"));if(element!=null&&element.length>0){element.removeClass("ng-pristine").removeClass("ng-untouched").removeClass("ng-valid-parse").removeClass("ng-valid").removeClass("ng-valid-required");element.addClass("ng-touched ng-invalid ng-invalid-required");}}function resetInvalidValidationFlag(formElement){formElement.$touched=false;formElement.$invalid=false;var element=angular.element(document.querySelector("[name="+formElement.$name+"]"));if(element!=null&&element.length>0){element.removeClass("ng-touched").removeClass("ng-dirty").removeClass("ng-invalid ng-invalid-required");}}function setTouchedValidationFlag(formElement){formElement.$touched=true;var element=angular.element(document.querySelector("[name="+formElement.$name+"]"));if(element!=null&&element.length>0){element.addClass("ng-touched");}}function resetTouchedValidationFlag(formElement){formElement.$touched=false;var element=angular.element(document.querySelector("[name="+formElement.$name+"]"));if(element!=null&&element.length>0){element.removeClass("ng-touched").removeClass("ng-dirty");}}function getCompanyInfoData(model,isPublicRecord,liabilityTypes,debtAccountOwnershipTypes,isLiabilities,isSecondaryPartyRecord,disableFields,states){if(isPublicRecord&&(!model.companyData.liabillityFor||model.companyData.liabillityFor=="Individual"||(model.companyData.liabillityFor=="Joint"&&liabilityTypes.length==1))){model.companyData.liabillityFor=liabilityTypes[0].value;}if(!model.debtsAccountOwnershipType&&debtAccountOwnershipTypes){model.debtsAccountOwnershipType=debtAccountOwnershipTypes[0].value;}var data={title:"Company Information",isLiabilities:isLiabilities,unpaidBalance:isPublicRecord?model.originalAmount:model.originalUnpaidBalance,minPayment:isPublicRecord?0:model.minPayment,debtsAccountOwnershipType:model.DebtsAccountOwnershipType,debtAccountOwnershipTypes:debtAccountOwnershipTypes,disableFields:disableFields||isSecondaryPartyRecord,liabilityTypes:isPublicRecord?liabilityTypes:null,states:states};return data;}function companyHasChanges(initialModel,model,result){return model.companyData.hasChanges||!angular.equals(model.companyData,initialModel)||!angular.equals(model.companyData.addressViewModel,model.companyData.addressViewModel)||model.debtsAccountOwnershipType!=result.debtsAccountOwnershipType;}}})();var credit;(function(credit){(function(SubjPropRelationEnum){SubjPropRelationEnum[SubjPropRelationEnum["IsSame"]=1]="IsSame";SubjPropRelationEnum[SubjPropRelationEnum["IsDiff"]=2]="IsDiff";})(credit.SubjPropRelationEnum||(credit.SubjPropRelationEnum={}));var SubjPropRelationEnum=credit.SubjPropRelationEnum;(function(ReoCategorizationEnum){ReoCategorizationEnum[ReoCategorizationEnum["SubjectProperty"]=1<<0]="SubjectProperty";ReoCategorizationEnum[ReoCategorizationEnum["NonSubjectProperty"]=1<<1]="NonSubjectProperty";ReoCategorizationEnum[ReoCategorizationEnum["CurrentResidence"]=1<<2]="CurrentResidence";ReoCategorizationEnum[ReoCategorizationEnum["NonCurrentResidence"]=1<<3]="NonCurrentResidence";ReoCategorizationEnum[ReoCategorizationEnum["AdHoc"]=1<<4]="AdHoc";ReoCategorizationEnum[ReoCategorizationEnum["NonAdHoc"]=1<<5]="NonAdHoc";})(credit.ReoCategorizationEnum||(credit.ReoCategorizationEnum={}));var ReoCategorizationEnum=credit.ReoCategorizationEnum;credit.ReoCategorizationFlg=lib.createFlaggedEnum(ReoCategorizationEnum,1<<5);credit.reoCategorizationFlgFromEnums=function(reoCtgCds){var reoCtgCd=new credit.ReoCategorizationFlg(0);for(var i=0;i<reoCtgCds.length;i++){reoCtgCd=reoCtgCd.add(reoCtgCds[i]);}return reoCtgCd;};})(credit||(credit={}));var credit;(function(credit){var OccupancyMtx=(function(){function OccupancyMtx(_loanPurposeCd,_subjOccupancyCd,_residenceSubjCd,_residenceOwnership,_reoCtgCd,_comments,_occupancyTypeList,_isDisabled){var _this=this;this._loanPurposeCd=_loanPurposeCd;this._subjOccupancyCd=_subjOccupancyCd;this._residenceSubjCd=_residenceSubjCd;this._residenceOwnership=_residenceOwnership;this._reoCtgCd=_reoCtgCd;this._comments=_comments;this._occupancyTypeList=_occupancyTypeList;this._isDisabled=_isDisabled;this.locate=function(lookup){OccupancyMtx.configureLocator(lookup);var sets=null;if(_this.getLoanPurpose()==2){sets=[OccupancyMtx._collPreemptive,OccupancyMtx._collRefi];}else{sets=[OccupancyMtx._collPreemptive,OccupancyMtx._collPurch];}var omtxFound=null;for(var i=0;omtxFound==null&&i<sets.length;i++){omtxFound=lib.findFirst(sets[i],function(o){return o.matches(_this);});}if(!omtxFound){omtxFound=OccupancyMtx.genomtx(lookup,null,null,null,null,null,null,[],true);omtxFound._isValidComments=false;}return omtxFound;};this.matches=function(omtx){if(!omtx){return false;}if(!_this.matchesLoanPurpose(omtx.getLoanPurpose())){return false;}if(!_this.matchesSubjOccupancyCd(omtx.getSubjOccupancyCd())){return false;}if(!_this.matchesResidenceSubjCd(omtx.getResidenceSubjCd())){return false;}if(!_this.matchesResidenceOwnership(omtx.getResidenceOwnership())){return false;}if(!_this.matchesReoCtgCd(omtx.getReoCtgCd())){return false;}if(!_this.matchesComments(omtx.getComments())){return false;}return true;};this.comparePrimative=function(ival,fval){if(ival==null){return true;}var cval=fval();return ival==cval;};this.compareFlaggedEnum=function(ival,fval){if(ival==null){return true;}var cval=fval();var matches=(cval.contains(ival)||ival.contains(cval));return matches;};this.getLoanPurpose=function(){return _this._loanPurposeCd;};this.matchesLoanPurpose=function(loanPurpose){return _this.comparePrimative(loanPurpose,_this.getLoanPurpose);};this.getSubjOccupancyCd=function(){return _this._subjOccupancyCd;};this.matchesSubjOccupancyCd=function(subjOccupancyCd){return _this.comparePrimative(subjOccupancyCd,_this.getSubjOccupancyCd);};this.getResidenceSubjCd=function(){return _this._residenceSubjCd;};this.matchesResidenceSubjCd=function(residenceSubjCd){return _this.comparePrimative(residenceSubjCd,_this.getResidenceSubjCd);};this.getResidenceOwnership=function(){return _this._residenceOwnership;};this.matchesResidenceOwnership=function(residenceOwnership){return _this.comparePrimative(residenceOwnership,_this.getResidenceOwnership);};this.getReoCtgCd=function(){return _this._reoCtgCd;};this.matchesReoCtgCd=function(reoCtgCd){return _this.compareFlaggedEnum(reoCtgCd,_this.getReoCtgCd);};this.getComments=function(){return _this._comments;};this.matchesComments=function(comments){return _this.compareFlaggedEnum(comments,_this.getComments);};this._isValidComments=true;}Object.defineProperty(OccupancyMtx.prototype,"occupancyTypeList",{get:function(){return this._occupancyTypeList;},set:function(readOnly){},enumerable:true,configurable:true});Object.defineProperty(OccupancyMtx.prototype,"isDisabled",{get:function(){return this._isDisabled;},set:function(readOnly){},enumerable:true,configurable:true});Object.defineProperty(OccupancyMtx.prototype,"isValidComments",{get:function(){return this._isValidComments;},set:function(readOnly){},enumerable:true,configurable:true});OccupancyMtx._isConfigured=false;OccupancyMtx._collPreemptive=null;OccupancyMtx._collRefi=null;OccupancyMtx._collPurch=null;OccupancyMtx._pledgedAssetComments=null;OccupancyMtx._occupancyTypes=null;OccupancyMtx.getAllOccupancyTypes=function(){return lib.getLookupStrings(OccupancyMtx._occupancyTypes);};OccupancyMtx.getAllComments=function(excludeSales,excludeDuplicate,excludeNotMyLoan,excludeNotAMortgage){if(excludeSales===void 0){excludeSales=true;}if(excludeDuplicate===void 0){excludeDuplicate=true;}if(excludeNotMyLoan===void 0){excludeNotMyLoan=true;}if(excludeNotAMortgage===void 0){excludeNotAMortgage=true;}var retVal=lib.getLookupStrings(OccupancyMtx._pledgedAssetComments);if(excludeNotMyLoan){retVal=OccupancyMtx.getFilteredCommentCollection(retVal,6);}if(excludeNotAMortgage){retVal=OccupancyMtx.getFilteredCommentCollection(retVal,8);}if(excludeSales){retVal=OccupancyMtx.getFilteredCommentCollection(retVal,7);retVal=OccupancyMtx.getFilteredCommentCollection(retVal,5);}if(excludeDuplicate){retVal=OccupancyMtx.getFilteredCommentCollection(retVal,9);}return retVal;};OccupancyMtx.getFilteredCommentCollection=function(inputCommentCollection,commentType){var exclude=lib.findFirst(OccupancyMtx._pledgedAssetComments,function(comment){return comment.value==String(commentType);});if(!!exclude){return lib.filter(inputCommentCollection,function(i){return i!=exclude.text;});}return inputCommentCollection;};OccupancyMtx.getOccupancyStringsByEnum=function(occupancyTypes){return lib.getLookupStringsByEnum(OccupancyMtx._occupancyTypes,occupancyTypes);};OccupancyMtx.getCommentStringsByEnum=function(commentTypes){return lib.getLookupStringsByEnum(OccupancyMtx._pledgedAssetComments,commentTypes);};OccupancyMtx.configureLocator=function(lookup){if(OccupancyMtx._isConfigured){return;}OccupancyMtx._pledgedAssetComments=lookup.pledgetAssetComments;OccupancyMtx._occupancyTypes=lookup.occupancyTypeList;var omx=null;omx=[];omx.push(OccupancyMtx.genomtx(lookup,null,null,null,null,null,OccupancyMtx.getCommentStringsByEnum([8,6]),[],true));OccupancyMtx._collPreemptive=omx;omx=[];omx.push(OccupancyMtx.genomtx(lookup,2,1,1,0,[credit.ReoCategorizationEnum.SubjectProperty],OccupancyMtx.getAllComments(true,false),OccupancyMtx.getAllOccupancyTypes(),true));omx.push(OccupancyMtx.genomtx(lookup,2,1,1,0,[credit.ReoCategorizationEnum.NonSubjectProperty],OccupancyMtx.getAllComments(false),OccupancyMtx.getOccupancyStringsByEnum([3,2]),false));omx.push(OccupancyMtx.genomtx(lookup,2,2,2,0,[credit.ReoCategorizationEnum.SubjectProperty],OccupancyMtx.getAllComments(true,false),OccupancyMtx.getAllOccupancyTypes(),true));omx.push(OccupancyMtx.genomtx(lookup,2,2,2,0,[credit.ReoCategorizationEnum.CurrentResidence],OccupancyMtx.getAllComments(),OccupancyMtx.getAllOccupancyTypes(),true));omx.push(OccupancyMtx.genomtx(lookup,2,2,2,0,[credit.ReoCategorizationEnum.NonSubjectProperty,credit.ReoCategorizationEnum.NonCurrentResidence],OccupancyMtx.getAllComments(false),OccupancyMtx.getOccupancyStringsByEnum([3,2]),false));omx.push(OccupancyMtx.genomtx(lookup,2,2,2,1,[credit.ReoCategorizationEnum.SubjectProperty],OccupancyMtx.getAllComments(true,false),OccupancyMtx.getAllOccupancyTypes(),true));omx.push(OccupancyMtx.genomtx(lookup,2,2,2,1,[credit.ReoCategorizationEnum.NonSubjectProperty],OccupancyMtx.getAllComments(false),OccupancyMtx.getOccupancyStringsByEnum([3,2]),false));omx.push(OccupancyMtx.genomtx(lookup,2,2,2,2,[credit.ReoCategorizationEnum.NonSubjectProperty],OccupancyMtx.getAllComments(false),OccupancyMtx.getOccupancyStringsByEnum([3,2]),false));omx.push(OccupancyMtx.genomtx(lookup,2,2,2,2,[credit.ReoCategorizationEnum.SubjectProperty],OccupancyMtx.getAllComments(true,false),OccupancyMtx.getAllOccupancyTypes(),true));omx.push(OccupancyMtx.genomtx(lookup,2,3,2,0,[credit.ReoCategorizationEnum.SubjectProperty],OccupancyMtx.getAllComments(true,false),OccupancyMtx.getAllOccupancyTypes(),true));omx.push(OccupancyMtx.genomtx(lookup,2,3,2,0,[credit.ReoCategorizationEnum.CurrentResidence],OccupancyMtx.getAllComments(),OccupancyMtx.getAllOccupancyTypes(),true));omx.push(OccupancyMtx.genomtx(lookup,2,3,2,0,[credit.ReoCategorizationEnum.NonSubjectProperty,credit.ReoCategorizationEnum.NonCurrentResidence],OccupancyMtx.getAllComments(false),OccupancyMtx.getOccupancyStringsByEnum([3,2]),false));omx.push(OccupancyMtx.genomtx(lookup,2,3,2,1,[credit.ReoCategorizationEnum.SubjectProperty],OccupancyMtx.getAllComments(true,false),OccupancyMtx.getAllOccupancyTypes(),true));omx.push(OccupancyMtx.genomtx(lookup,2,3,2,1,[credit.ReoCategorizationEnum.NonSubjectProperty],OccupancyMtx.getAllComments(false),OccupancyMtx.getOccupancyStringsByEnum([3,2]),false));omx.push(OccupancyMtx.genomtx(lookup,2,3,2,2,[credit.ReoCategorizationEnum.SubjectProperty],OccupancyMtx.getAllComments(true,false),OccupancyMtx.getAllOccupancyTypes(),true));omx.push(OccupancyMtx.genomtx(lookup,2,3,2,2,[credit.ReoCategorizationEnum.NonSubjectProperty],OccupancyMtx.getAllComments(false),OccupancyMtx.getOccupancyStringsByEnum([3,2]),false));OccupancyMtx._collRefi=omx;omx=[];omx.push(OccupancyMtx.genomtx(lookup,1,1,2,0,[credit.ReoCategorizationEnum.CurrentResidence],OccupancyMtx.getCommentStringsByEnum([7,5]),OccupancyMtx.getOccupancyStringsByEnum([1]),true));omx.push(OccupancyMtx.genomtx(lookup,1,1,2,0,[credit.ReoCategorizationEnum.CurrentResidence],OccupancyMtx.getCommentStringsByEnum([0,1]),OccupancyMtx.getOccupancyStringsByEnum([3,2]),false));omx.push(OccupancyMtx.genomtx(lookup,1,1,2,0,[credit.ReoCategorizationEnum.NonSubjectProperty],OccupancyMtx.getCommentStringsByEnum([0,1,7,5]),OccupancyMtx.getOccupancyStringsByEnum([3,2]),false));omx.push(OccupancyMtx.genomtx(lookup,1,1,2,1,[credit.ReoCategorizationEnum.NonSubjectProperty],OccupancyMtx.getCommentStringsByEnum([0,1,7,5]),OccupancyMtx.getOccupancyStringsByEnum([3,2]),false));omx.push(OccupancyMtx.genomtx(lookup,1,1,2,2,[credit.ReoCategorizationEnum.NonSubjectProperty],OccupancyMtx.getCommentStringsByEnum([0,1,7,5]),OccupancyMtx.getOccupancyStringsByEnum([3,2]),false));omx.push(OccupancyMtx.genomtx(lookup,1,2,2,0,[credit.ReoCategorizationEnum.CurrentResidence],OccupancyMtx.getCommentStringsByEnum([0,1]),OccupancyMtx.getOccupancyStringsByEnum([1]),true));omx.push(OccupancyMtx.genomtx(lookup,1,2,2,0,[credit.ReoCategorizationEnum.NonSubjectProperty,credit.ReoCategorizationEnum.NonCurrentResidence],OccupancyMtx.getCommentStringsByEnum([7,5,0,1]),OccupancyMtx.getOccupancyStringsByEnum([3,2]),false));omx.push(OccupancyMtx.genomtx(lookup,1,2,2,1,[credit.ReoCategorizationEnum.NonSubjectProperty],OccupancyMtx.getCommentStringsByEnum([0,1,7,5]),OccupancyMtx.getOccupancyStringsByEnum([3,2]),false));omx.push(OccupancyMtx.genomtx(lookup,1,2,2,2,[credit.ReoCategorizationEnum.NonSubjectProperty],OccupancyMtx.getCommentStringsByEnum([0,1,7,5]),OccupancyMtx.getAllOccupancyTypes(),false));omx.push(OccupancyMtx.genomtx(lookup,1,3,2,0,[credit.ReoCategorizationEnum.CurrentResidence],OccupancyMtx.getCommentStringsByEnum([0,1]),OccupancyMtx.getOccupancyStringsByEnum([1]),true));omx.push(OccupancyMtx.genomtx(lookup,1,3,2,0,[credit.ReoCategorizationEnum.NonSubjectProperty,credit.ReoCategorizationEnum.NonCurrentResidence],OccupancyMtx.getCommentStringsByEnum([7,5,0,1]),OccupancyMtx.getOccupancyStringsByEnum([3,2]),false));omx.push(OccupancyMtx.genomtx(lookup,1,3,2,1,[credit.ReoCategorizationEnum.NonSubjectProperty],OccupancyMtx.getCommentStringsByEnum([0,1,7,5]),OccupancyMtx.getOccupancyStringsByEnum([3,2]),false));omx.push(OccupancyMtx.genomtx(lookup,1,3,2,2,[credit.ReoCategorizationEnum.NonSubjectProperty],OccupancyMtx.getCommentStringsByEnum([0,1,7,5]),OccupancyMtx.getAllOccupancyTypes(),false));OccupancyMtx._collPurch=omx;OccupancyMtx._isConfigured=true;};OccupancyMtx.genomtx=function(lookup,loanPurpCd,subjOccupancy,residenceSubjCd,residenceOwnership,reoCtgCds,commentsStr,occupancyTypesStr,isDisabled){reoCtgCds=!!reoCtgCds?reoCtgCds:[];var reoCtgCd=credit.reoCategorizationFlgFromEnums(reoCtgCds);commentsStr=!!commentsStr?commentsStr:[];var comments=lookup.pledgetAssetCommentsFlgFromNames(commentsStr);occupancyTypesStr=!!occupancyTypesStr?occupancyTypesStr:[];var occupancyTypes=lookup.occupancyTypeListsByNames(occupancyTypesStr);var omx=new OccupancyMtx(loanPurpCd,subjOccupancy,residenceSubjCd,residenceOwnership,reoCtgCd,comments,occupancyTypes,isDisabled);return omx;};return OccupancyMtx;})();credit.OccupancyMtx=OccupancyMtx;})(credit||(credit={}));var credit;(function(credit){var CreditController=(function(){function CreditController($scope,$modal,$resource,$controller,modalPopoverFactory,simpleModalWindowFactory,CreditHelpers,NavigationSvc,$q,$interval,CreditSvc,wrappedLoan,applicationData,controllerData,enums,CreditStateService){var _this=this;this.$scope=$scope;this.$modal=$modal;this.$resource=$resource;this.$controller=$controller;this.modalPopoverFactory=modalPopoverFactory;this.simpleModalWindowFactory=simpleModalWindowFactory;this.CreditHelpers=CreditHelpers;this.NavigationSvc=NavigationSvc;this.$q=$q;this.$interval=$interval;this.CreditSvc=CreditSvc;this.wrappedLoan=wrappedLoan;this.applicationData=applicationData;this.controllerData=controllerData;this.enums=enums;this.CreditStateService=CreditStateService;this.showLoader=true;this.showErrorContainer=false;this.runCreditItemOpen=false;this.SavingDataInProgress=false;this.disableFields=false;this.showCollections=function(){return _this.CreditStateService.showCollections();};this.showPublicRecords=function(){return _this.CreditStateService.showPublicRecords();};this.displayCreditScores=function(){return !!_this.wrappedLoan.ref.active.credit&&!!_this.wrappedLoan.ref.active.credit.creditExceptionsResolved&&!!_this.wrappedLoan.ref.active.getBorrower().ficoScore;};this.displayCreditReportMessage=function(creditViewModel){return creditViewModel.creditStatus!=_this.enums.creditReportStatus.retrieving&&!common.string.isNullOrWhiteSpace(creditViewModel.creditReportMessage)&&creditViewModel.creditStatus!=_this.enums.creditReportStatus.undefined;};this.toggleGrid=function(isCollapsed){_this.controllerData.isCollapsed.liabilities=_this.controllerData.isCollapsed.realEstate=_this.controllerData.isCollapsed.collections=_this.controllerData.isCollapsed.miscExpenses=_this.controllerData.isCollapsed.publicRecords=isCollapsed;};this.borrowerMainInfoExists=function(user){return _this.isDataFilledIn(user.firstName)&&_this.isDataFilledIn(user.lastName)&&_this.isDataFilledIn(user.ssn)&&user.ssn!="0"&&_this.isDataFilledIn(user.confirmSsn)&&user.confirmSsn!="0"&&user.ssn==user.confirmSsn&&_this.isDataFilledIn(user.dateOfBirth)&&_this.isDateOfBirthValid(user.dateOfBirth);};this.isDataFilledIn=function(data){return data!=null&&data!=undefined&&data.length!=0;};this.isDateOfBirthValid=function(date){if(!date){return true;}var minAdultsAge=18;var dateRegEx=new RegExp("^((0?[1-9]|1[012])[- /.](0?[1-9]|[12][0-9]|3[01])[- /.](17|18|19|20|21|22)?[0-9]{2})*$");return(dateRegEx.test(date)&&(_this.getAge(new Date(date))>=minAdultsAge));};this.getAge=function(birth){var b=moment(birth);var age=moment().diff(b,"years");return age;};this.disableReRunCreditButton=function(){return !_this.borrowerMainInfoExists(_this.wrappedLoan.ref.active.getBorrower())||(_this.wrappedLoan.ref.active.isSpouseOnTheLoan&&!_this.borrowerMainInfoExists(_this.wrappedLoan.ref.active.getCoBorrower()))||_this.wrappedLoan.ref.active.isCreditRunning;};this.formatFICOScore=function(value){return _this.CreditSvc.formatFICOScore(value);};angular.extend(this,$controller("DocumentCtrl",{$scope:this}));this.modalWindowDependecy=this.simpleModalWindowFactory;this.showLoader=false;this.showErrorContainer=false;this.disableFields=false;this.debtAccountOwnershipTypes=CreditStateService.debtAccountOwnershipTypes;this.wrappedLoan.ref.active.credit.disableReRunCreditButton=this.disableReRunCreditButton();}Object.defineProperty(CreditController.prototype,"totalLiabilities",{get:function(){var app=this.wrappedLoan.ref.active;var tot=0;var totLiabilities=app.getLiabilitesBalanceTotal();tot+=totLiabilities;var totReo=this.CreditStateService.summateTotalREOBalance();tot+=totReo;var totCollections=app.getCollectionsTotalUnpaidBalance();tot+=totCollections;return tot;},enumerable:true,configurable:true});Object.defineProperty(CreditController.prototype,"totalPaymentAmount",{get:function(){var app=this.wrappedLoan.ref.active;var tot=0;var totReoPayments=this.CreditStateService.summateTotalREOPayment();tot+=totReoPayments;var totLiabilitiesPayments=app.getLiabilitesPaymentTotal();tot+=totLiabilitiesPayments;var totCollectionsPayments=app.getCollectionsTotalPayment();tot+=totCollectionsPayments;var totMiscExpensesPayments=app.getMiscExpensesTotal();tot+=totMiscExpensesPayments;return tot;},enumerable:true,configurable:true});Object.defineProperty(CreditController.prototype,"totalNetWorth",{get:function(){var app=this.wrappedLoan.ref.active;var tot=0;var totAssets=app.getTotalAssetsAmount();tot+=totAssets;var totReo=app.getReoEstimatedValueTotal;tot+=totReo;var totLiabilities=this.totalLiabilities;tot-=totLiabilities;return tot;},enumerable:true,configurable:true});CreditController.$inject=["$scope","$modal","$resource","$controller","modalPopoverFactory","simpleModalWindowFactory","CreditHelpers","NavigationSvc","$q","$interval","CreditSvc","wrappedLoan","applicationData","controllerData","enums","CreditStateService"];return CreditController;})();angular.module("loanApplication").controller("creditController",CreditController);})(credit||(credit={}));(function(){angular.module("loanApplication").controller("liabilitiesController",liabilitiesController);liabilitiesController.$inject=["$scope","wrappedLoan","CreditHelpers","modalPopoverFactory","CreditSvc","controllerData","applicationData","loanEvent","CreditStateService","guidService"];function liabilitiesController($scope,wrappedLoan,CreditHelpers,modalPopoverFactory,CreditSvc,controllerData,applicationData,loanEvent,CreditStateService,guidService){var vm=this;vm.wrappedLoan=wrappedLoan;vm.isCollapsed=controllerData.isCollapsed;vm.totalPayments=null;vm.totalLiabilities=null;vm.flags=controllerData.liabilities.flags;vm.applicationData=applicationData;vm.debtAccountOwnershipTypes=[];vm.showCompanyInfo=showCompanyInfo;vm.addLiabilitiesRow=addLiabilitiesRow;vm.moveLiabilityToREO=moveLiabilityToREO;vm.deleteLiabilitiesRow=deleteLiabilitiesRow;vm.processJointLiabilityRecords=processJointLiabilityRecords;vm.getAccountOwnershipTypeIndicator=getAccountOwnershipTypeIndicator;vm.onLiabilityTypeChanged=onLiabilityTypeChanged;vm.onLiabilityMonthsLeftChanged=onLiabilityMonthsLeftChanged;vm.onLiabilityUnpaidBalanceChanged=onLiabilityUnpaidBalanceChanged;vm.onLiabilityMinPaymentChanged=onLiabilityMinPaymentChanged;vm.onLiabilityCommentIDChanged=onLiabilityCommentIDChanged;vm.getBorrowerLiabilities=function(){return wrappedLoan.ref.active.borrowerLiabilities;};vm.summateLiabiltyUnpaidBalance=CreditStateService.summateLiabiltyUnpaidBalance;vm.summateLiabiltyPayment=CreditStateService.summateLiabiltyPayment;vm.borrowerDebtAccountOwnershipTypes=CreditStateService.borrowerDebtAccountOwnershipTypes;vm.coBorrowerDebtAccountOwnershipTypes=CreditStateService.coBorrowerDebtAccountOwnershipTypes;vm.debtAccountOwnershipTypes=CreditStateService.debtAccountOwnershipTypes;function onLiabilityTypeChanged(liability){if(liability.isSecondaryPartyRecord==true){return;}loanEvent.broadcastPropertyChangedEvent(events.LoanFieldIdentifier.LiabilityType,liability);}function onLiabilityMonthsLeftChanged(liability){if(liability.isSecondaryPartyRecord==true){return;}loanEvent.broadcastPropertyChangedEvent(events.LoanFieldIdentifier.LiabilityMonthsLeft,liability);}function onLiabilityUnpaidBalanceChanged(liability){if(liability.isSecondaryPartyRecord==true){return;}loanEvent.broadcastPropertyChangedEvent(events.LoanFieldIdentifier.LiabilityUnpaidBalance,liability);}function onLiabilityMinPaymentChanged(liability){if(liability.isSecondaryPartyRecord==true){return;}loanEvent.broadcastPropertyChangedEvent(events.LoanFieldIdentifier.LiabilityMinPayment,liability);}function onLiabilityCommentIDChanged(liability){if(liability.isSecondaryPartyRecord==false||angular.isUndefined(liability.isSecondaryPartyRecord)){loanEvent.broadcastPropertyChangedEvent(events.LoanFieldIdentifier.LiabilityCommentID,liability);}this.wrappedLoan.ref.active.handleJointWithCoBorrowerLiability(liability);liability.handleCommentChange();}function addLiabilitiesRow(isMainBorrower,debtsAccountOwnershipType){var coborrowerLiabilitiesCount=!wrappedLoan.ref.active.isSpouseOnTheLoan||!wrappedLoan.ref.active.getCoBorrower().getLiabilities()?0:wrappedLoan.ref.active.getCoBorrower().getLiabilities().length;var liability=createNewLiability(wrappedLoan.ref.active.getBorrower().getLiabilities().length+coborrowerLiabilitiesCount+1);guidService.getNewGuid().then(function(response){liability.liabilityInfoId=String(response.data);switch(debtsAccountOwnershipType){case String(srv.DebtsAccountOwnershipType.Borrower):case String(srv.DebtsAccountOwnershipType.CoBorrower):setLiabilityAccountOwnershipType(liability,String(srv.LiabilitiesAccountOwnershipType.Individual),debtsAccountOwnershipType,false);addLiabilityToList(liability,isMainBorrower);break;case String(srv.DebtsAccountOwnershipType.Joint):setLiabilityAccountOwnershipType(liability,String(srv.LiabilitiesAccountOwnershipType.JointContractualLiability),debtsAccountOwnershipType,false);liability.isJoint=true;addLiabilityToList(liability,isMainBorrower);if(!wrappedLoan.ref.active.isSpouseOnTheLoan){break;}var coBorrowerLiability=createNewLiability(wrappedLoan.ref.active.getCoBorrower().getLiabilities().length+1);guidService.getNewGuid().then(function(response){coBorrowerLiability.liabilityInfoId=String(response.data);coBorrowerLiability.isSecondaryPartyRecord=true;coBorrowerLiability.originalLiabilityInfoId=liability.liabilityInfoId;coBorrowerLiability.liabilityDisabled=true;coBorrowerLiability.originalClientId=liability.clientId;setLiabilityAccountOwnershipType(coBorrowerLiability,String(srv.LiabilitiesAccountOwnershipType.JointContractualLiability),debtsAccountOwnershipType,false);addLiabilityToList(coBorrowerLiability,!isMainBorrower);});break;case String(srv.DebtsAccountOwnershipType.BorrowerWithOther):case String(srv.DebtsAccountOwnershipType.CoBorrowerWithOther):setLiabilityAccountOwnershipType(liability,String(srv.LiabilitiesAccountOwnershipType.JointContractualLiability),debtsAccountOwnershipType,true);liability.isJoint=true;addLiabilityToList(liability,isMainBorrower);break;}});}function addLiabilityToList(liability,isMainBorrower){CreditStateService.addLiability(liability,!isMainBorrower);}function setLiabilityAccountOwnershipType(liability,type,debtsAccountOwnershipType,isJointWithSingleBorrowerID){liability.liabilitiesAccountOwnershipType=type;liability.isJointWithSingleBorrowerID=isJointWithSingleBorrowerID;liability.DebtsAccountOwnershipType=debtsAccountOwnershipType;}function createNewLiability(clientId){var liability=new cls.LiabilityViewModel(vm.wrappedLoan.ref.getTransactionInfoRef(),{typeId:2,isUserEntry:true,unpaidBalance:0,clientId:clientId,includeInLiabilitiesTotal:true,includeInDTI:true,currentratingType:null,isNewRow:true,companyData:new cls.CompanyDataViewModel()});return liability;}function deleteLiabilitiesRow(item,isCoBorrower){CreditStateService.deleteLiabilities(item,isCoBorrower);}function getAccountOwnershipTypeIndicator(liability){if(liability.accountOwnershipTypeIndicator==""){return"display-none";}return"imp-icon-"+liability.accountOwnershipTypeIndicator;}function moveLiabilityToREO(liability,isCoborrower){var moved=CreditStateService.moveLiabilityToREO(liability,isCoborrower);}function processJointLiabilityRecords(liabilityInfoId){CreditHelpers.processJointLiabilityRecords(wrappedLoan.ref.active.getLiabilities(),liabilityInfoId);}function showCompanyInfo(liability,event){var initialModel=angular.copy(liability.companyData);var result=CreditHelpers.getCompanyInfoData(liability,false,wrappedLoan.ref.lookup.liabilityTypes,CreditStateService.getDebtAccountOwnershipTypes(),true,liability.isSecondaryPartyRecord,vm.flags.isDisableFields,wrappedLoan.ref.lookup.allStates);var confirmationPopup=modalPopoverFactory.openModalPopover("angular/loanapplication/credit/companycreditcontrol.html",result,liability.companyData,event);confirmationPopup.result.then(function(data){liability.companyData.hasChanges=CreditHelpers.companyHasChanges(initialModel,liability,result);var shouldUpdateDTI=liability.debtsAccountOwnershipType!=result.debtsAccountOwnershipType;liability.debtsAccountOwnershipType=result.debtsAccountOwnershipType;CreditHelpers.ProcessRulesForLiabilityOwnershipType(liability,vm);if(shouldUpdateDTI){loanEvent.broadcastPropertyChangedEvent(events.LoanFieldIdentifier.LiabilityOwnershipType,liability);}});}}})();var credit;(function(credit){var CallCreditController=(function(){function CallCreditController($scope,$q,$interval,wrappedLoan,CreditHelpers,modalPopoverFactory,CreditSvc,controllerData,$state,applicationData,NavigationSvc,BroadcastSvc,enums,loanEvent,CreditStateService,$timeout,creditSvcExt){var _this=this;this.$scope=$scope;this.$q=$q;this.$interval=$interval;this.wrappedLoan=wrappedLoan;this.CreditHelpers=CreditHelpers;this.modalPopoverFactory=modalPopoverFactory;this.CreditSvc=CreditSvc;this.controllerData=controllerData;this.$state=$state;this.applicationData=applicationData;this.NavigationSvc=NavigationSvc;this.BroadcastSvc=BroadcastSvc;this.enums=enums;this.loanEvent=loanEvent;this.CreditStateService=CreditStateService;this.$timeout=$timeout;this.creditSvcExt=creditSvcExt;this._runningCreditCall=false;this.runCreditButtonActions=[];this.counter=0;this.activeLoanApplication=function(){if(!!_this.activeLoanApplicationId){return _this.wrappedLoan.ref.getLoanApplication(_this.activeLoanApplicationId);}else{return null;}};this.saveAndCheckCreditStatus=function(active,userAccountId,borrowerId,isReRun){var adx=_this.wrappedLoan.ref.selectedAppIndex=_this.wrappedLoan.ref.getLoanApplications().indexOf(active);_this.NavigationSvc.SaveAndUpdateWrappedLoan(_this.applicationData.currentUserId,_this.wrappedLoan,function(wrappedLoanCb){var activeCb=wrappedLoanCb.ref.getLoanApplications()[adx];var loanWithoutPricing=!_this.wrappedLoan.ref.financialInfo.noteRate;var paidOffFreeAndClear=_this.wrappedLoan.ref.loanPurposeType==2&&!_this.wrappedLoan.ref.otherInterviewData.firstMortgage&&!loanWithoutPricing;_this.activeLoanApplicationId=activeCb.loanApplicationId;_this.CreditStateService.setBorrowerDebtAccountOwnershipTypes(activeCb);_this.saveAndRunCreditVx(_this.activeLoanApplicationId,userAccountId,paidOffFreeAndClear,borrowerId,isReRun);},function(error){console.log(error);},"Saving Loan and Running Credit...");};this.disableRunCreditButton=function(){return _this.runningCreditCall||_this.wrappedLoan.ref.active.credit.disableReRunCreditButton||_this.wrappedLoan.ref.disableRunCreditButton();};this.initializeRunButton=function(){_this.runCreditButtonActions=_this.CreditHelpers.getRunCreditItems(_this.wrappedLoan.ref.active.getBorrower(),_this.wrappedLoan.ref.active.getCoBorrower(),_this.wrappedLoan.ref.active.isSpouseOnTheLoan);_this.selectedRunCreditAction=_this.runCreditButtonActions[0];};this.updateCredit=function(creditDataWithBorrowers,loanApplicationId){var loan=_this.wrappedLoan.ref;loan.financialInfo.ficoScore=creditDataWithBorrowers.loanDecisionScore;var loanApplication=loan.getLoanApplication(loanApplicationId);if(loanApplication){loanApplication.isCreditRunning=false;loanApplication.credit=new cls.CreditViewModel(creditDataWithBorrowers.creditViewModel);loanApplication.credit.creditReportMessageVisible=_this.creditSvcExt.getCreditReportMessageVisiblity(creditDataWithBorrowers.creditViewModel);_this.creditSvcExt.updatedBorrower(_this.wrappedLoan.ref,creditDataWithBorrowers.borrower,loanApplication.getBorrower());if(loanApplication.isSpouseOnTheLoan){_this.creditSvcExt.updatedBorrower(_this.wrappedLoan.ref,creditDataWithBorrowers.coBorrower,loanApplication.getCoBorrower());}if(loanApplication==_this.wrappedLoan.ref.active){_this.CreditStateService.updateCredit(_this.wrappedLoan);_this.initializeRunButton();_this.loanEvent.broadcastPropertyChangedEvent(30,{});}lib.forEach(loanApplication.documents,function(doc){if(doc.documentCategoryId==26){doc.documentId=creditDataWithBorrowers.creditViewModel.creditReportId;doc.borrowerId=creditDataWithBorrowers.borrower.borrowerId;}});_this.BroadcastSvc.broadcastCotextualBar();}};this.useCreditSvcExt=true;this.saveAndRunCredit=function(loanApplicationId,userAccountId,paidOffFreeAndClear,borrowerId,isReRun){if(_this.useCreditSvcExt){_this.saveAndRunCreditEx(loanApplicationId,userAccountId,paidOffFreeAndClear,borrowerId,isReRun);}else{_this.saveAndRunCreditVx(loanApplicationId,userAccountId,paidOffFreeAndClear,borrowerId,isReRun);}};this.saveAndRunCreditEx=function(loanApplicationId,userAccountId,paidOffFreeAndClear,borrowerId,isReRun){_this.runningCreditCall=true;_this.counter=1;var isReRunReport=!!_this.wrappedLoan.ref.active.credit.creditFileStoreItemId;if(isReRun){isReRunReport=true;}var rqst=new credit.RunCreditRqst(loanApplicationId,userAccountId,isReRunReport,paidOffFreeAndClear,borrowerId);_this.creditSvcExt.runCredit(rqst,_this.wrappedLoan.ref,_this.runCreditShouldCancel,_this.runCreditSuccess,_this.runCreditFailure);};this.runCreditShouldCancel=function(){var timeOut=180;if((_this.counter*5)>timeOut&&_this.runningCreditCall){_this.runCreditComplete(false,null,null);return true;}else{_this.counter++;return false;}};this.runCreditSuccess=function(creditDataWithBorrowers){_this.runCreditComplete(true,creditDataWithBorrowers);};this.runCreditFailure=function(error){_this.runCreditComplete(false,null,error);};this.runCreditComplete=function(isSuccess,creditDataWithBorrowers,error){_this.runningCreditCall=false;if(isSuccess){var loanApplication=_this.activeLoanApplication();if(loanApplication==_this.wrappedLoan.ref.active){_this.CreditStateService.updateCredit(_this.wrappedLoan);_this.initializeRunButton();_this.loanEvent.broadcastPropertyChangedEvent(30,{});}_this.BroadcastSvc.broadcastCotextualBar();}else{_this.displayErrorMessage(_this.activeLoanApplicationId);}};this.saveAndRunCreditVx=function(loanApplicationId,userAccountId,paidOffFreeAndClear,borrowerId,isReRun){var timeOut=180;_this.counter=1;_this.runningCreditCall=true;var isReRunReport=!!_this.wrappedLoan.ref.active.credit.creditFileStoreItemId;if(isReRun){isReRunReport=true;}_this.CreditSvc.CreditServices.RunCredit({loanApplicationId:loanApplicationId,userAccountId:userAccountId,isReRunReport:isReRunReport,paidOffFreeAndClear:paidOffFreeAndClear,borrowerId:borrowerId}).$promise.then(function(creditViewModel){if(!creditViewModel.creditDataAvailable){var timer=_this.$interval(function(){_this.CreditSvc.CreditServices.GetCreditStatus({loanApplicationId:loanApplicationId,accountId:userAccountId}).$promise.then(function(creditDataWithBorrowers){if(creditDataWithBorrowers.creditViewModel.creditDataAvailable){_this.$interval.cancel(timer);_this.runningCreditCall=false;_this.updateCredit(creditDataWithBorrowers,loanApplicationId);}if(_this.counter*5>timeOut&&_this.wrappedLoan.ref.active.isCreditRunning==true){_this.$interval.cancel(timer);_this.runningCreditCall=false;_this.displayErrorMessage(loanApplicationId);}_this.counter++;},function(error){_this.$interval.cancel(timer);_this.runningCreditCall=false;_this.displayErrorMessage(loanApplicationId);});},5000);}else{_this.runningCreditCall=false;_this.displayErrorMessage(loanApplicationId);}},function(error){_this.runningCreditCall=false;_this.displayErrorMessage(loanApplicationId);});};this.setRunCreditAction=function(item){_this.selectedRunCreditAction=item;return _this.selectedRunCreditAction;};this.showRunCreditActionInfo=function(event){var borrowerOrCoborrowerId=lib.getEmptyGuid();var isReRun=false;if(_this.selectedRunCreditAction.id==1){borrowerOrCoborrowerId=_this.selectedRunCreditAction.borrowerId;isReRun=!!_this.wrappedLoan.ref.active.credit.creditFileStoreItemId;}if(_this.selectedRunCreditAction.id==2){borrowerOrCoborrowerId=_this.selectedRunCreditAction.coborrowerId;isReRun=!!_this.wrappedLoan.ref.active.credit.creditFileStoreItemId;}var creditRequest=function(){return _this.saveAndCheckCreditStatus(_this.wrappedLoan.ref.active,_this.applicationData.currentUserId,borrowerOrCoborrowerId,isReRun);};if(_this.selectedRunCreditAction.id==1||_this.selectedRunCreditAction.id==2){var confirmationPopup=_this.modalPopoverFactory.openModalPopover("angular/loanapplication/credit/creditrunconfirmcontrol.html",{},_this.selectedRunCreditAction,event);confirmationPopup.result.then(function(){_this.wrappedLoan.ref.active.isSpouseOnTheLoan=false;if(_this.selectedRunCreditAction.id==1){_this.wrappedLoan.ref.active.switchCoBorrowerToBorrower=true;_this.wrappedLoan.ref.active.getBorrower().isActive=false;}else{_this.wrappedLoan.ref.active.getCoBorrower().isActive=false;}creditRequest();});}else{creditRequest();}};this.getAuthorizationMessage=function(){var borrowerAndCoborrower;borrowerAndCoborrower=_this.wrappedLoan.ref.active.getBorrower().fullName+(_this.wrappedLoan.ref.active.isSpouseOnTheLoan?", "+_this.wrappedLoan.ref.active.getCoBorrower().fullName:"");return{message:"I / We ("+borrowerAndCoborrower+") authorize lender or its designated representatives to obtain a credit report from the national credit reporting agencies in connection with my/our home loan application."};};this.runCreditClicked=function(event){if(!_this.wrappedLoan.ref.active.isRunCreditAuthorized){var confirmationPopup=_this.modalPopoverFactory.openModalPopover("angular/loanapplication/credit/creditrunbutton/authorizationpopup.html",{},_this.getAuthorizationMessage(),event);confirmationPopup.result.then(function(){_this.wrappedLoan.ref.active.isRunCreditAuthorized=true;var self=_this;_this.$timeout(function(){self.showRunCreditActionInfo(event);},700);});}else{_this.showRunCreditActionInfo(event);}};this.CreditStateService.updateCredit(wrappedLoan);this.initializeRunButton();}Object.defineProperty(CallCreditController.prototype,"runningCreditCall",{get:function(){var activeApp=this.activeLoanApplication();if(!!activeApp){this._runningCreditCall=activeApp.isCreditRunning;}return this._runningCreditCall;},set:function(runningCreditCall){var activeApp=this.activeLoanApplication();if(!!activeApp){activeApp.isCreditRunning=runningCreditCall;}this._runningCreditCall=runningCreditCall;},enumerable:true,configurable:true});CallCreditController.prototype.displayErrorMessage=function(loanApplicationId){var loan=this.wrappedLoan.ref;var loanApplication=loan.getLoanApplication(loanApplicationId);if(loanApplication&&this.wrappedLoan.ref&&loanApplication==this.wrappedLoan.ref.active){loanApplication.isCreditRunning=false;if(!loanApplication.credit){loanApplication.credit=new cls.CreditViewModel();}loanApplication.credit.creditReportMessage="We were unable to get a credit report at this time. Please try again later.";loanApplication.credit.creditReportMessageVisible=true;}};CallCreditController.$inject=["$scope","$q","$interval","wrappedLoan","CreditHelpers","modalPopoverFactory","CreditSvc","controllerData","$state","applicationData","NavigationSvc","BroadcastSvc","enums","loanEvent","CreditStateService","$timeout","CreditSvcExt"];CallCreditController.className="runCreditController";return CallCreditController;})();credit.CallCreditController=CallCreditController;angular.module("loanApplication").controller("runCreditController",CallCreditController);})(credit||(credit={}));var credit;(function(credit){var publicRecordsController=(function(){function publicRecordsController(wrappedLoan,creditHelpers,modalPopoverFactory,controllerData,applicationData,loanEvent,CreditStateService){var _this=this;this.wrappedLoan=wrappedLoan;this.creditHelpers=creditHelpers;this.modalPopoverFactory=modalPopoverFactory;this.controllerData=controllerData;this.applicationData=applicationData;this.loanEvent=loanEvent;this.CreditStateService=CreditStateService;this.showCompanyInfo=function(model,event){var initialModel=angular.copy(model.companyData);var result=_this.creditHelpers.getCompanyInfoData(model,true,_this.wrappedLoan.ref.active.LiabilitiesFor(),null,false,false,_this.commonData.disableFields,_this.wrappedLoan.ref.lookup.allStates);var self=_this;var confirmationPopup=_this.modalPopoverFactory.openModalPopover("angular/loanapplication/credit/companycreditcontrol.html",result,model.companyData,event);confirmationPopup.result.then(function(data){model.companyData.hasChanges=self.creditHelpers.companyHasChanges(initialModel,model,result);var shouldUpdate=model.debtsAccountOwnershipType!=model.companyData.liabillityFor;model.debtsAccountOwnershipType=model.companyData.liabillityFor;if(shouldUpdate){self.loanEvent.broadcastPropertyChangedEvent(11,model);}self.creditHelpers.ProcessRulesForLiabilityOwnershipType(model,self);});};this.publicRecordsCommentChanged=function(publicRecord){publicRecord.includeInTotalAmount(publicRecord);};this.isCollapsed=controllerData.isCollapsed;this.commonData=controllerData.common;this.summateTotalPublicRecordsAmount=this.CreditStateService.summateTotalPublicRecordsAmount;this.getPublicRecords=function(){return _this.wrappedLoan.ref.active.publicRecords;};}publicRecordsController.className="PublicRecordsController";publicRecordsController.$inject=["wrappedLoan","CreditHelpers","modalPopoverFactory","controllerData","applicationData","loanEvent","CreditStateService"];return publicRecordsController;})();credit.publicRecordsController=publicRecordsController;angular.module("loanApplication").controller("publicRecordsController",publicRecordsController);})(credit||(credit={}));(function(){angular.module("loanApplication").controller("collectionsController",collectionsController);collectionsController.$inject=["wrappedLoan","CreditHelpers","modalPopoverFactory","applicationData","controllerData","CreditStateService"];function collectionsController(wrappedLoan,CreditHelpers,modalPopoverFactory,applicationData,controllerData,CreditStateService){var vm=this;vm.wrappedLoan=wrappedLoan;vm.isCollapsed=controllerData.isCollapsed;vm.disableFields=false;vm.borrowers=wrappedLoan.ref.active.Borrowers(false,true,false);vm.debtAccountOwnershipTypes=CreditStateService.debtAccountOwnershipTypes;vm.applicationData=applicationData;vm.showCompanyInfo=showCompanyInfo;vm.addCollectionsRow=addCollectionsRow;vm.deleteCollectionsRow=deleteCollectionsRow;vm.collectionsCommentChanged=collectionsCommentChanged;vm.moveCollectionBetweenBorrowerAndCoBorrower=moveCollectionBetweenBorrowerAndCoBorrower;vm.getCollections=function(){return vm.wrappedLoan.ref.active.collections;};vm.CreditStateService=CreditStateService;vm.summateTotalCollectionsUnpaidBalance=CreditStateService.summateTotalCollectionsUnpaidBalance;vm.summateTotalCollectionsPayments=CreditStateService.summateTotalCollectionsPayments;function showCompanyInfo(model,event){var initialModel=angular.copy(model.companyData);var result=CreditHelpers.getCompanyInfoData(model,false,wrappedLoan.ref.lookup.liabilityTypes,vm.debtAccountOwnershipTypes,false,false,vm.disableFields,wrappedLoan.ref.lookup.allStates);var confirmationPopup=modalPopoverFactory.openModalPopover("angular/loanapplication/credit/companycreditcontrol.html",result,model.companyData,event);confirmationPopup.result.then(function(data){model.companyData.hasChanges=CreditHelpers.companyHasChanges(initialModel,model,result);model.debtsAccountOwnershipType=result.debtsAccountOwnershipType;CreditHelpers.ProcessRulesForLiabilityOwnershipType(model,vm);});}function addCollectionsRow(){var liablity=new cls.LiabilityViewModel(vm.wrappedLoan.ref.getTransactionInfoRef());liablity.typeId=3;liablity.isUserEntry=true;liablity.minPayment="0";liablity.monthsLeft="1";liablity.debtCommentId=-1;liablity.companyData.companyName="";liablity.isNewRow=true;liablity.currentratingType="Collection";CreditStateService.addCollection(liablity);}function deleteCollectionsRow(index){CreditStateService.deleteCollection(vm.getCollections()[index]);}function collectionsCommentChanged(collection){collection.includeCollectionInLiabilitesTotalAmount(collection);}function moveCollectionBetweenBorrowerAndCoBorrower(item){if(item.borrowerId){CreditStateService.moveLiabilityBetweenBorrowers(item);}}}})();(function(){angular.module("loanApplication").controller("miscellaneousExpensesController",miscellaneousExpensesController);miscellaneousExpensesController.$inject=["wrappedLoan","CreditHelpers","controllerData","enums","applicationData","$scope","loanEvent"];function miscellaneousExpensesController(wrappedLoan,CreditHelpers,controllerData,enums,applicationData,$scope,loanEvent){var vm=this;vm.wrappedLoan=wrappedLoan;vm.enums=enums;vm.isCollapsed=controllerData.isCollapsed;vm.applicationData=applicationData;vm.commonData=controllerData.common;vm.addMiscExpensesRow=addMiscExpensesRow;vm.deleteMiscExpensesRow=deleteMiscExpensesRow;vm.moveDebtBetweenBorrowerAndCoBorrower=moveDebtBetweenBorrowerAndCoBorrower;vm.miscellaneousDebtMonthsChanged=miscellaneousDebtMonthsChanged;vm.onMiscellaneousAmountChanged=onMiscellaneousAmountChanged;function addMiscExpensesRow(){var miscExpenses=new cls.MiscellaneousDebtViewModel(null,srv.MiscellaneousDebtTypes.EmptyDebt,true,vm.wrappedLoan.ref.active.getBorrower().getFullName);miscExpenses.clientIdForOrder=wrappedLoan.ref.active.getCombinedMiscDebts().length;wrappedLoan.ref.active.getBorrower().addMiscDebts(miscExpenses);vm.combinedMiscDebts=wrappedLoan.ref.active.getCombinedMiscDebts();}function miscellaneousDebtMonthsChanged(miscDebt){loanEvent.broadcastPropertyChangedEvent(events.LoanFieldIdentifier.MiscellaneousDebtMonthsChanged,miscDebt);}function onMiscellaneousAmountChanged(miscDebt){loanEvent.broadcastPropertyChangedEvent(events.LoanFieldIdentifier.MiscellaneousDebtAmountChanged,miscDebt);}function deleteMiscExpensesRow(item){item.isRemoved=true;vm.combinedMiscDebts=wrappedLoan.ref.active.getCombinedMiscDebts();}function moveDebtBetweenBorrowerAndCoBorrower(item){if(item.borrowerId){wrappedLoan.ref.active.switchBorrowerForMiscItem(item,wrappedLoan.ref.active.getBorrower().getMiscDebts(),wrappedLoan.ref.active.getCoBorrower().getMiscDebts());vm.combinedMiscDebts=wrappedLoan.ref.active.getCombinedMiscDebts();}}}})();var credit;(function(credit){var RealEstateController=(function(){function RealEstateController(wrappedLoan,CreditHelpers,modalPopoverFactory,$modal,applicationData,controllerData,enums,loanEvent,CreditStateService){var _this=this;this.wrappedLoan=wrappedLoan;this.CreditHelpers=CreditHelpers;this.modalPopoverFactory=modalPopoverFactory;this.$modal=$modal;this.applicationData=applicationData;this.controllerData=controllerData;this.enums=enums;this.loanEvent=loanEvent;this.CreditStateService=CreditStateService;this.disableFields=false;this.getReos=function(){return _this.wrappedLoan.ref.active.reos.filter(function(item){return !item.isSecondaryPartyRecord;});};this.deleteRealEstateRow=function(item){_this.CreditStateService.deleteREO(item);};this.editRealEstateItem=function(pledgedAsset){_this.addEditRealEstateItem(pledgedAsset,false);};this.addRealEstateItem=function(){var newReo=new cls.LiabilityViewModel(_this.wrappedLoan.ref.getTransactionInfoRef());newReo.borrowerDebtCommentId=_this.enums.PledgedAssetComment.DoNotPayoff;newReo.isUserEntry=true;_this.addEditRealEstateItem(newReo,true);};this.addEditRealEstateItem=function(pledgedAsset,isNew){if(isNew||(pledgedAsset.unpaidBalance==0&&!pledgedAsset.isLenderSectionVisible)){pledgedAsset.unpaidBalance=0;}if(isNew||(pledgedAsset.minPayment==0&&!pledgedAsset.isLenderSectionVisible)){pledgedAsset.minPayment=0;}if(!pledgedAsset.lienPosition){pledgedAsset.lienPosition=0;}var modalInstance=_this.$modal.open({templateUrl:"angular/loanapplication/credit/realestate/realestateitem.html",controller:"realEstateItemController",controllerAs:"realEstateItemCtrl",backdrop:"static",windowClass:"imp-modal flyout imp-modal-real-estate-information",resolve:{isNew:function(){return isNew;},originalPledgedAssetModel:function(){return pledgedAsset;},disableFields:function(){return _this.disableFields;},wrappedLoan:function(){return _this.wrappedLoan;},debtAccountOwnershipTypes:function(){return _this.debtAccountOwnershipTypes;},lookup:function(){return _this.applicationData.lookup;},generalSettings:function(){return _this.applicationData.generalSettings;},loanEvent:function(){return _this.loanEvent;}}});modalInstance.result.then(function(){});};this.moveREOToLiability=function(pledgedAsset,isCoborrower){_this.CreditStateService.moveREOToLiability(pledgedAsset,isCoborrower);};this.isCollapsed=controllerData.isCollapsed;this.borrowerDebtAccountOwnershipTypes=CreditStateService.borrowerDebtAccountOwnershipTypes;this.coBorrowerDebtAccountOwnershipTypes=CreditStateService.coBorrowerDebtAccountOwnershipTypes;this.debtAccountOwnershipTypes=CreditStateService.debtAccountOwnershipTypes;this.applicationData=applicationData;this.summateTotalREOPropertyValues=CreditStateService.summateTotalREOPropertyValues;this.summateTotalREOBalance=CreditStateService.summateTotalREOBalance;this.summateTotalREOPayment=CreditStateService.summateTotalREOPayment;}RealEstateController.$inject=["wrappedLoan","CreditHelpers","modalPopoverFactory","$modal","applicationData","controllerData","enums","loanEvent","CreditStateService"];return RealEstateController;})();angular.module("loanApplication").controller("realEstateController",RealEstateController);})(credit||(credit={}));var credit;(function(credit){var RealEstateItemController=(function(){function RealEstateItemController($modalInstance,$interval,CreditSvc,CreditHelpers,enums,isNew,originalPledgedAssetModel,disableFields,wrappedLoan,debtAccountOwnershipTypes,lookup,generalSettings,loanEvent,commonModalWindowFactory,modalWindowType,CreditStateService,guidService,modalPopoverFactory){var _this=this;this.$modalInstance=$modalInstance;this.$interval=$interval;this.CreditSvc=CreditSvc;this.CreditHelpers=CreditHelpers;this.enums=enums;this.isNew=isNew;this.originalPledgedAssetModel=originalPledgedAssetModel;this.disableFields=disableFields;this.wrappedLoan=wrappedLoan;this.debtAccountOwnershipTypes=debtAccountOwnershipTypes;this.lookup=lookup;this.generalSettings=generalSettings;this.loanEvent=loanEvent;this.commonModalWindowFactory=commonModalWindowFactory;this.modalWindowType=modalWindowType;this.CreditStateService=CreditStateService;this.guidService=guidService;this.modalPopoverFactory=modalPopoverFactory;this.submitted=false;this.isReoValidationRequired=false;this.reoPropertyList=[];this.propertyExpenseDefaults=[{type:1,preferredPayPeriod:String(2),impounded:true},{type:4,preferredPayPeriod:String(1),impounded:false},{type:3,preferredPayPeriod:String(1),impounded:true},{type:2,preferredPayPeriod:String(2),impounded:true},{type:5,preferredPayPeriod:String(1),impounded:true},];this.shouldResetLienPosition=false;this._lienPositionLookups=null;this.buildLienPositionLookupList=function(){if(!_this.hasProperty){return[];}var property=_this.pledgedAssetModel.getProperty();var activeBorrower=_this.activeLoanApplication.getBorrower().borrowerId;var activeCoBorrower=_this.activeLoanApplication.getCoBorrower().borrowerId;var takenLienPositions=lib.filterWithProjection(_this.tiCopy.liability.getValues(),function(o){return o.propertyId==property.propertyId&&o.liabilityInfoId!=_this.pledgedAssetModel.liabilityInfoId&&(o.borrowerId==activeBorrower||o.borrowerId==activeCoBorrower)&&!o.isRemoved;},function(o){return o.lienPosition;});var lienPositionLookups=RealEstateItemController.buildLienPositionLookupListDflt(_this.lookup.lienPosition);lienPositionLookups.forEach(function(lu){var exists=(0<lib.findFirst(takenLienPositions,function(o){return o==parseInt(lu.value);}));lu.disabled=exists;});return lienPositionLookups;};this.getPropertyTypes=function(){if(_this.pledgedAssetModel.getProperty().isSubjectProperty){return _this.lookup.subjectPropertyTypes;}return _this.lookup.nonSubjectPropertyTypes;};this.initializePropertyExpenses=function(){if(_this.pledgedAssetModel.getProperty()){_this.propertyTaxExpense=_this.getPropertyExpense(1);_this.homeOwnerExpense=_this.getPropertyExpense(2);_this.floodInsuranceExpense=_this.getPropertyExpense(5);_this.mortgageInsuranceExpense=_this.getPropertyExpense(3);_this.hoaDuesExpense=_this.getPropertyExpense(4);_this._propertyTax=_this.formatAmount(_this.propertyTaxExpense);_this._homeOwner=_this.formatAmount(_this.homeOwnerExpense);_this._floodInsurance=_this.formatAmount(_this.floodInsuranceExpense);_this._hoaDues=_this.formatAmount(_this.hoaDuesExpense);_this._mortgageInsurance=_this.formatAmount(_this.mortgageInsuranceExpense);}};this.updateExpense=function(propertyExpense,amount){if(propertyExpense.preferredPayPeriod==String(2)){amount/=12;}else{if(propertyExpense.preferredPayPeriod==String(6)){amount/=6;}else{if(propertyExpense.preferredPayPeriod==String(5)){amount/=3;}}}propertyExpense.monthlyAmount=amount;};this.propertyTax=function(amount){if(!angular.isDefined(amount)){return _this._propertyTax;}else{_this._propertyTax=amount;}};this.propertyTaxPayPeriodChanged=function(){_this.updateExpense(_this.propertyTaxExpense,_this._propertyTax);};this.hoaDues=function(amount){if(!angular.isDefined(amount)){return _this._hoaDues;}else{_this._hoaDues=amount;}};this.hoaDuesPayPeriodChanged=function(){_this.updateExpense(_this.hoaDuesExpense,_this._hoaDues);};this.mortgageInsurance=function(amount){if(!angular.isDefined(amount)){return _this._mortgageInsurance;}else{_this._mortgageInsurance=amount;}};this.triggerOwnership=function(){if(!_this.pledgedAssetModel.getProperty().OwnershipPercentage){_this.pledgedAssetModel.getProperty().OwnershipPercentage=0;}};this.mortgageInsurancePayPeriodChanged=function(){_this.updateExpense(_this.mortgageInsuranceExpense,_this._mortgageInsurance);};this.homeOwner=function(amount){if(!angular.isDefined(amount)){return _this._homeOwner;}else{_this._homeOwner=amount;}};this.homeOwnerPayPeriodChanged=function(){_this.updateExpense(_this.homeOwnerExpense,_this._homeOwner);};this.floodInsurance=function(amount){if(!angular.isDefined(amount)){return _this._floodInsurance;}else{_this._floodInsurance=amount;}};this.floodInsurancePayPeriodChanged=function(){_this.updateExpense(_this.floodInsuranceExpense,_this._floodInsurance);};this.formatAmount=function(propertyExpense){if(propertyExpense.preferredPayPeriod==String(2)){return Math.round(propertyExpense.monthlyAmount*12*10000)/10000;}else{if(propertyExpense.preferredPayPeriod==String(6)){return Math.round(propertyExpense.monthlyAmount*6*10000)/10000;}else{if(propertyExpense.preferredPayPeriod==String(5)){return Math.round(propertyExpense.monthlyAmount*3*10000)/10000;}else{return propertyExpense.monthlyAmount;}}}};this.getPropertyExpense=function(expenseType){var propertyExpense=lib.findFirst(_this.pledgedAssetModel.getProperty().propertyExpenses,function(pe){return pe.type==expenseType.toString();});if(!propertyExpense){var expenseDefault=lib.findFirst(_this.propertyExpenseDefaults,function(ped){return ped.type==expenseType;});propertyExpense={type:expenseType.toString(),preferredPayPeriod:expenseDefault.preferredPayPeriod,monthlyAmount:0,impounded:expenseDefault.impounded};_this.pledgedAssetModel.getProperty().propertyExpenses.push(propertyExpense);}return propertyExpense;};this.setPropertyExpenseImpounds=function(){_this.hoaDuesExpense.impounded=false;_this.mortgageInsuranceExpense.impounded=true;_this.propertyTaxExpense.impounded=false;_this.homeOwnerExpense.impounded=false;_this.floodInsuranceExpense.impounded=false;var selectedImpound=_this.pledgedAssetModel.selectedImpound;if(selectedImpound==0||selectedImpound==1){_this.propertyTaxExpense.impounded=true;}if(selectedImpound==0||selectedImpound==2){_this.homeOwnerExpense.impounded=true;_this.floodInsuranceExpense.impounded=true;}};this.setSelectedImpound=function(){if(_this.pledgedAssetModel.getProperty()){if(_this.propertyTaxExpense.impounded&&_this.homeOwnerExpense.impounded&&_this.floodInsuranceExpense.impounded){_this.pledgedAssetModel.selectedImpound=0;}else{if(_this.propertyTaxExpense.impounded){_this.pledgedAssetModel.selectedImpound=1;}else{if(_this.homeOwnerExpense.impounded&&_this.floodInsuranceExpense.impounded){_this.pledgedAssetModel.selectedImpound=2;}else{_this.pledgedAssetModel.selectedImpound=3;}}}}};this.setValuesFromGeneralSettings=function(){angular.forEach(_this.generalSettings,function(setting){if(setting.settingName=="Show Investment Property"){_this.realEstateViewModel.showInvestmentProperty=setting?setting.status:true;}if(setting.settingName=="Show Investment Property"){_this.realEstateViewModel.showSecondVacationHome=setting?setting.status:true;}});};this.buildAddressesList=function(){_this.realEstateViewModel.addressForDropDown=[];var uniqueProperties=_this.activeLoanApplication.getUniqueProperties();uniqueProperties.forEach(function(p){return _this.reoPropertyList.push(new cls.PropertySnapshot(p,_this.tiCopy));});var reosWithProperties=lib.filter(_this.activeLoanApplication.getAllLiabilitiesCombined(),function(l){return l.isPledged&&!!l.propertyId;});_this.reoPropertyList.forEach(function(propertyItem){_this.realEstateViewModel.addressForDropDown.push(new cls.LookupItem(propertyItem.fullAddressString,propertyItem.propertyId));var reosWithLienPositions=lib.filter(reosWithProperties,function(reo){return reo.propertyId==propertyItem.propertyId&&reo.lienPosition>0;});});var newProperty=_this.createNewDefaultProperty();_this.newPropertyId=newProperty.propertyId;_this.realEstateViewModel.addressForDropDown.push(new cls.LookupItem("Not listed - add a property",newProperty.propertyId));_this.reoPropertyList.push(newProperty);};this.createNewDefaultProperty=function(){var defaultProperty=new cls.PropertySnapshot();defaultProperty.addressTypeId=6;defaultProperty.occupancyType=0;defaultProperty.OwnershipPercentage=100;defaultProperty.vacancyPercentage=75;defaultProperty.isSubjectProperty=false;return defaultProperty;};this.onREOAddressChange=function(){if(_this.pledgedAssetModel.getProperty()&&_this.pledgedAssetModel.getProperty().isSubjectProperty){_this.pledgedAssetModel.getProperty().OwnershipPercentage=_this.activeLoanApplication.ownershipPercentage;}if(_this.loanType==_this.enums.LoanTransactionTypes.Refinance){if(_this.pledgedAssetModel.getProperty()&&_this.pledgedAssetModel.getProperty().isSubjectProperty){_this.borrowerDebtCommentId=_this.enums.PledgedAssetComment.PayoffAtClose;}else{_this.borrowerDebtCommentId=_this.enums.PledgedAssetComment.DoNotPayoff;}}};this.validateReo=function(){if(_this.areSixPiecesAcquiredForAllLoanApplications){if(_this.pledgedAssetModel&&(_this.pledgedAssetModel.borrowerDebtCommentId!==0||_this.pledgedAssetModel.borrowerDebtCommentId)&&_this.pledgedAssetModel.borrowerDebtCommentId==6){_this.isReoValidationRequired=false;}else{_this.isReoValidationRequired=true;}}};this.helocHighLimitValidation=function(){if(!_this.areReoValidationAndSixPiecesRequired()){return false;}if(_this.pledgedAssetModel.liabilityDisabled||_this.pledgedAssetModel.pledgedAssetLoanType!=_this.enums.PledgedAssetLoanType.Heloc){return false;}return !_this.pledgedAssetModel.maximumCreditLine;};this.isLienPositionFirstValidation=function(){return _this.areReoValidationAndSixPiecesRequired()&&!_this.pledgedAssetModel.liabilityDisabled&&_this.pledgedAssetModel.lienPosition==1;};this.areReoValidationAndSixPiecesRequired=function(){return(_this.areSixPiecesAcquiredForAllLoanApplications&&_this.isReoValidationRequired);};this.harpMortgageInsuranceChanged=function(value){_this.pledgedAssetModel.getProperty().doYouPayMortgageInsurance=value;_this.disableMortgageInsurance=!_this.pledgedAssetModel.getProperty().doYouPayMortgageInsurance;_this.mortgageInsuranceExpense.preferredPayPeriod="1";};this.reoCommentChanged=function(){var unmodifiedBalance=_this.pledgedAssetModel.unpaidBalance;var unmodifiedPayment=_this.pledgedAssetModel.minPayment;_this.validateReo();_this.processRulesForREOComment(_this.pledgedAssetModel);if(!unmodifiedBalance){_this.pledgedAssetModel.unpaidBalance=0;}if(!unmodifiedPayment){_this.pledgedAssetModel.minPayment=0;}if(!_this.pledgedAssetModel.companyData){_this.pledgedAssetModel.companyData=new cls.CompanyDataViewModel();}_this.updateOccupancyTypeAttributes();};this.processRulesForREOComment=function(pledgedAssetModel){var pledgedAssetComment=parseInt(pledgedAssetModel.borrowerDebtCommentId);pledgedAssetModel.liabilityDisabled=_this.isReoDisabled(pledgedAssetComment);pledgedAssetModel.notMyLoan=pledgedAssetModel.borrowerDebtCommentId==_this.enums.PledgedAssetComment.NotMyLoan;if(pledgedAssetModel.borrowerDebtCommentId==_this.enums.PledgedAssetComment.PaidOffFreeAndClear){lib.conditionalForEach(_this.pledgedAssetModel.getProperty().propertyExpenses,function(pe){return +pe.type!=3;},function(pe){return pe.impounded=false;});_this.pledgedAssetModel.selectedImpound=3;_this.pledgedAssetModel.unpaidBalance=0;}};this._isDisabledComment=false;this.isReoDisabled=function(pledgedAssetComment){switch(pledgedAssetComment){case _this.enums.PledgedAssetComment.DoNotPayoff:case _this.enums.PledgedAssetComment.PayoffAtClose:case _this.enums.PledgedAssetComment.PayoffAtClosingAndCloseAccount:case _this.enums.PledgedAssetComment.PayoffAtClosingAndDontCloseAccount:case _this.enums.PledgedAssetComment.PendingSale:case _this.enums.PledgedAssetComment.Sold:return false;case _this.enums.PledgedAssetComment.NotAMortgage:case _this.enums.PledgedAssetComment.NotMyLoan:return true;}return false;};this.resetLienPositionsAsynchIdx=-1;this.resetLienPositionsAsynchCtx=null;this.resetLienPositionsAsynch=function(){_this.resetLienPositionsAsynchIdx=1;_this.resetLienPositionsAsynchCtx=_this.$interval(_this.resetLienPositionsCb,128);};this.resetLienPositionsCb=function(){_this.resetLienPositionsSynch();if(0>--_this.resetLienPositionsAsynchIdx){_this.$interval.cancel(_this.resetLienPositionsAsynchCtx);}};this.resetLienPositionsSynch=function(){try{var luDflt=RealEstateItemController.buildLienPositionLookupListDflt(_this.lookup.lienPosition);var luTx=_this.buildLienPositionLookupList();_this._lienPositionLookups=luDflt;_this._lienPositionLookups=luTx;if(_this.shouldResetLienPosition){_this.lienPosition=null;}_this.resetLienPositionsJQuery();}catch(e){console.error(e.toString());}};this.resetLienPositionsJQuery=function(){var bry=lib.filterWithProjection(_this._lienPositionLookups,function(o){return true;},function(o){return o.disabled;});var theSelectElement=$("select[name=lienPosition]");$("option[value!=''][value!='?']",theSelectElement).each(function(i,e){$(this).attr("disabled",(bry[i]?"":null));});};this.loanTypeChanged=function(asset){if(asset.pledgedAssetLoanType!=_this.enums.PledgedAssetLoanType.Heloc){asset.maximumCreditLine="";}};this.updateOccupancyTypeAttributes=function(){var listOccupancyType=[];var isDisabledOccupancyType=false;if(_this.hasProperty){listOccupancyType=_this.copyListOccupancyType();var pvm=_this.pledgedAssetModel.getProperty();var omtx=_this.locateOccupancyMtx(pvm);if(!!omtx){for(var i=0;i<listOccupancyType.length;i++){var enabled=!!lib.findFirst(omtx.occupancyTypeList,function(o){return o.text==listOccupancyType[i].text;});listOccupancyType[i].disabled=!enabled;}isDisabledOccupancyType=omtx.isDisabled;_this._isValidComments=omtx.isValidComments;if(_this.wrappedLoan.ref.loanPurposeType==1){if(pvm.OccupancyType!=0&&!isDisabledOccupancyType){var currentOccupancyLookupItem=lib.findSingle(listOccupancyType,function(o){return o.value==String(pvm.OccupancyType);});if(!!currentOccupancyLookupItem&&currentOccupancyLookupItem.disabled&&String(pvm.OccupancyType)==currentOccupancyLookupItem.value){pvm.OccupancyType=0;}}if(isDisabledOccupancyType&&_this._isValidComments){pvm.OccupancyType=1;}}}}_this._listOccupancyType=listOccupancyType;_this._isDisabledOccupancyType=isDisabledOccupancyType;};this.copyListOccupancyType=function(){var listOccupancyType=[];for(var i=0;i<_this.lookup.occupancyTypeList.length;i++){var li=cls.LookupItem.fromLookupItem(_this.lookup.occupancyTypeList[i]);li.selected=false;li.disabled=false;listOccupancyType.push(li);}return listOccupancyType;};this._listOccupancyType=[];this._isDisabledOccupancyType=false;this._isValidComments=true;this.locateOccupancyMtx=function(pvm){var omtxInp=_this.buildOccupancyMtx(pvm);var omtxOut=omtxInp.locate(_this.lookup);return omtxOut;};this.buildOccupancyMtx=function(pvm){var loanPurpCd=_this.loanType;var subjOccupancy=_this.subjPropOccupancy;var residenceSubjCd=_this.isCurentResidenceSameAsSubject;var residenceOwnership=_this.currentResidenceOwnership;var reoCtgCd=_this.calculateReoCategorization(pvm);var comments=_this.lookup.pledgetAssetCommentsFlgFromValues([_this.pledgedAssetModel.borrowerDebtCommentId.toString()]);var omtx=new credit.OccupancyMtx(loanPurpCd,subjOccupancy,residenceSubjCd,residenceOwnership,reoCtgCd,comments);return omtx;};this.calculateReoCategorization=function(pvm){var reoctgcd=new credit.ReoCategorizationFlg(0);var isSubjectProperty=_this.isSubjectProperty(pvm);if(isSubjectProperty){reoctgcd=reoctgcd.add(credit.ReoCategorizationEnum.SubjectProperty);}else{reoctgcd=reoctgcd.add(credit.ReoCategorizationEnum.NonSubjectProperty);}var isCurrentResidence;if(pvm.propertyId==_this.wrappedLoan.ref.active.getBorrower().getCurrentAddress().propertyId){isCurrentResidence=true;}else{if(isSubjectProperty&&_this.wrappedLoan.ref.active.getBorrower().getCurrentAddress().isSameAsPropertyAddress){isCurrentResidence=true;}else{isCurrentResidence=false;}}if(isCurrentResidence){reoctgcd=reoctgcd.add(credit.ReoCategorizationEnum.CurrentResidence);}else{reoctgcd=reoctgcd.add(credit.ReoCategorizationEnum.NonCurrentResidence);}if(!isSubjectProperty&&!isCurrentResidence){reoctgcd=reoctgcd.add(credit.ReoCategorizationEnum.AdHoc);}else{reoctgcd=reoctgcd.add(credit.ReoCategorizationEnum.NonAdHoc);}return reoctgcd;};this.isSubjectProperty=function(propertyVm){return !!propertyVm&&propertyVm.isSubjectProperty;};this.isCurrentResidence=function(propertyVm){if(!propertyVm||!propertyVm.propertyId){return false;}if(!_this.wrappedLoan||!_this.wrappedLoan.ref||!_this.wrappedLoan.ref.active||!_this.wrappedLoan.ref.active.getBorrower()||!_this.wrappedLoan.ref.active.getBorrower().getCurrentAddress()||!_this.wrappedLoan.ref.active.getBorrower().getCurrentAddress()||!_this.wrappedLoan.ref.active.getBorrower().getCurrentAddress().propertyId){return false;}return propertyVm.propertyId==_this.wrappedLoan.ref.active.getBorrower().getCurrentAddress().propertyId;};this.selectedImpound=function(impound){if(!angular.isDefined(impound)){return _this.pledgedAssetModel.selectedImpound;}else{_this.pledgedAssetModel.selectedImpound=impound;_this.setPropertyExpenseImpounds();}};this.displayImpoundList=function(){return _this.pledgedAssetModel.lienPosition==1;};this.cancel=function(){_this.$modalInstance.dismiss("cancel");_this.updateDTI(false);};this._updateDTI=false;this.updateDTI=function(shouldUpdate){_this._updateDTI=shouldUpdate;};this.done=function(form){var ownershipType=parseInt(_this.pledgedAssetModel.debtsAccountOwnershipType);var isCoBorrowerOwner=_this.activeLoanApplication.isSpouseOnTheLoan&&(ownershipType==1||ownershipType==4);_this.pledgedAssetModel.borrowerId=isCoBorrowerOwner?_this.activeLoanApplication.getCoBorrower().borrowerId:_this.activeLoanApplication.getBorrower().borrowerId;_this.pledgedAssetModel.isJoint=ownershipType==2;_this.pledgedAssetModel.isJointWithSingleBorrowerID=ownershipType==4||ownershipType==3;var propertyPndg=_this.pledgedAssetModel.getProperty();var propertyFinl;if(!!propertyPndg){propertyFinl=new cls.PropertyViewModel(_this.wrappedLoan.ref.getTransactionInfoRef(),propertyPndg,_this.wrappedLoan.ref.homeBuyingType);propertyFinl.borrowerId=_this.pledgedAssetModel.borrowerId;if(!propertyFinl.loanId){propertyFinl.loanId=_this.wrappedLoan.ref.loanId;}if(!propertyFinl.loanApplicationId){propertyFinl.loanApplicationId=_this.wrappedLoan.ref.active.loanApplicationId;}propertyFinl.OccupancyType=propertyPndg.OccupancyType;if(propertyFinl.OccupancyType==2){propertyFinl.grossRentalIncome=propertyPndg.grossRentalIncome;propertyFinl.OwnershipPercentage=propertyPndg.OwnershipPercentage;propertyFinl.vacancyPercentage=propertyPndg.vacancyPercentage;}_this.updateExpense(_this.propertyTaxExpense,_this._propertyTax);_this.updateExpense(_this.hoaDuesExpense,_this._hoaDues);_this.updateExpense(_this.mortgageInsuranceExpense,_this._mortgageInsurance);_this.updateExpense(_this.homeOwnerExpense,_this._homeOwner);_this.updateExpense(_this.floodInsuranceExpense,_this._floodInsurance);}else{propertyFinl=null;}var reo=new cls.LiabilityViewModel(_this.wrappedLoan.ref.getTransactionInfoRef(),_this.pledgedAssetModel,_this.pledgedAssetModel.borrowerFullName);reo.isPledged=true;reo.setProperty(propertyFinl);_this.CreditStateService.updateREO(reo);_this.CreditStateService.updateCredit(_this.wrappedLoan);_this.$modalInstance.close();_this.loanEvent.broadcastPropertyChangedEvent(30);};this.getPledgedAssets=function(){return _this.wrappedLoan.ref.active.reos;};this.addressNotSelected=function(){return !_this.pledgedAssetModel.getProperty()||!_this.pledgedAssetModel.getProperty().propertyId;};this.isValid=function(form){_this.validateInputFields(form);if(form.propertyTax.$invalid||form.currentEstimatedValue.$invalid||form.subjectPropertyTypes.$invalid||form.occupancyTypeList.$invalid||form.mortgageInsurance.$invalid){return false;}if(_this.isInvestmentProperty&&(form.ownershipPercentage.$invalid||form.vacancyPercentage.$invalid)){return false;}if(form.realEstateItemStreetName.$invalid||form.realEstateItemCityName.$invalid||form.realEstateItemStateName.$invalid||form.realEstateItemZipCode.$invalid){return false;}return true;};this.validateInputFields=function(form){if(_this.pledgedAssetModel.getProperty().currentEstimatedValue==undefined||_this.pledgedAssetModel.getProperty().currentEstimatedValue==0){_this.CreditHelpers.setInvalidValidationFlag(form.currentEstimatedValue);}else{_this.CreditHelpers.resetInvalidValidationFlag(form.currentEstimatedValue);}if(_this.pledgedAssetModel.getProperty().propertyTaxExpense.monthlyAmount==0){_this.CreditHelpers.setInvalidValidationFlag(form.propertyTax);}else{_this.CreditHelpers.resetInvalidValidationFlag(form.propertyTax);}if(form.highLimit!=undefined&&_this.pledgedAssetModel.pledgedAssetLoanType==_this.enums.PledgedAssetLoanType.Heloc){var highLimitValue=_this.pledgedAssetModel.maximumCreditLine;if(!highLimitValue){_this.CreditHelpers.setInvalidValidationFlag(form.highLimit);}else{_this.CreditHelpers.resetTouchedValidationFlag(form.highLimit);}}if(_this.isLoanHarp&&_this.pledgedAssetModel.getProperty().doYouPayMortgageInsurance){if(!_this.pledgedAssetModel.getProperty().mortgageInsuranceExpense.monthlyAmount){_this.CreditHelpers.setInvalidValidationFlag(form.mortgageInsurance);}else{_this.CreditHelpers.resetTouchedValidationFlag(form.mortgageInsurance);}}if(_this.isInvestmentProperty){if(!_this.isValidPercentage(_this.pledgedAssetModel.getProperty().OwnershipPercentage)){_this.CreditHelpers.setInvalidValidationFlag(form.ownershipPercentage);}else{_this.CreditHelpers.resetTouchedValidationFlag(form.ownershipPercentage);}if(!_this.isValidPercentage(_this.pledgedAssetModel.getProperty().vacancyPercentage)){_this.CreditHelpers.setInvalidValidationFlag(form.vacancyPercentage);}else{_this.CreditHelpers.resetTouchedValidationFlag(form.vacancyPercentage);}}if(_this.submitted&&_this.pledgedAssetModel.isLenderSectionVisible){_this.CreditHelpers.setTouchedValidationFlag(form.debtsAccountOwnershipType);_this.CreditHelpers.setTouchedValidationFlag(form.companyName);_this.CreditHelpers.setTouchedValidationFlag(form.lienPosition);_this.CreditHelpers.setTouchedValidationFlag(form.unpaidBalance);_this.CreditHelpers.setTouchedValidationFlag(form.minPayment);}if(_this.submitted){_this.CreditHelpers.setTouchedValidationFlag(form.realEstateItemStreetName);_this.CreditHelpers.setTouchedValidationFlag(form.realEstateItemCityName);_this.CreditHelpers.setTouchedValidationFlag(form.realEstateItemStateName);_this.CreditHelpers.setTouchedValidationFlag(form.realEstateItemZipCode);}};this.isValidPercentage=function(value){return value!=null&&value!=undefined&&value!=""&&!isNaN(value);};this.getMortgageInsurancePreferredPayPeriodStyle=function(form){return(_this.pledgedAssetModel.liabilityDisabled||_this.disableMortgageInsurance||_this.addressNotSelected())?"disabled":((_this.isLoanHarp&&_this.pledgedAssetModel.getProperty().doYouPayMortgageInsurance)&&(_this.submitted||form.mortgageInsurance.$touched)&&(form.mortgageInsurance.$invalid||_this._mortgageInsurance==0))?"ng-invalid ng-dirty":"";};this.isPropertyInvestment=function(){_this.isInvestmentProperty=_this.pledgedAssetModel.getProperty()&&_this.pledgedAssetModel.getProperty().OccupancyType==_this.enums.OccupancyTypes.InvestmentProperty;return _this.isInvestmentProperty;};this.showPriorAdverseRatingHistory=function($event,priorAdverseRatings){var ctrl={lookups:_this.lookup};_this.modalPopoverFactory.openModalPopover("angular/loanapplication/credit/realestate/priorAdverseRating.html",ctrl,priorAdverseRatings,event);};this.isValidInvalidComment=function(){return _this.borrowerDebtCommentId!=_this.enums.PledgedAssetComment.NotMyLoan||_this.borrowerDebtCommentId!=_this.enums.PledgedAssetComment.Duplicate;};this.isAddressInvalid=function(){return !_this.pledgedAssetModel.getProperty()&&_this.borrowerDebtCommentId!=_this.enums.PledgedAssetComment.NotMyLoan&&_this.borrowerDebtCommentId!=_this.enums.PledgedAssetComment.NotAMortgage&&!!_this.wrappedLoan.ref.areSixPiecesAcquiredForAllLoanApplications==true;};this.isOccupancyValid=function(){return _this.isReoValidationRequired&&!_this.pledgedAssetModel.getProperty().OccupancyType&&!!_this.pledgedAssetModel.getProperty().propertyId;};this.pledgetAssetCommentsFiltered=function(){if(_this.wrappedLoan.ref.loanPurposeType==1){return lib.filter(_this.lookup.pledgetAssetComments,function(p){return +p.value!=9;});}return _this.lookup.pledgetAssetComments;};var tiOrig=wrappedLoan.ref.getTransactionInfo();this.tiCopy=tiOrig.cloneTransactionInfo();var pledgedAssetModel=this.tiCopy.liability.lookup(originalPledgedAssetModel.liabilityInfoId);if(!pledgedAssetModel){pledgedAssetModel=new cls.LiabilityViewModel(this.tiCopy,originalPledgedAssetModel,originalPledgedAssetModel.borrowerFullName);}pledgedAssetModel.companyData=new cls.CompanyDataViewModel(originalPledgedAssetModel.companyData);pledgedAssetModel.reoInfo=new cls.REOInfoViewModel(originalPledgedAssetModel.reoInfo);this.pledgedAssetModel=pledgedAssetModel;this.activeLoanApplication=this.tiCopy.loanApplication.lookup(wrappedLoan.ref.active.loanApplicationId);this.realEstateViewModel=this.activeLoanApplication.realEstate;this.realEstateViewModel.loanType=wrappedLoan.ref.loanPurposeType;this.loanType=wrappedLoan.ref.loanPurposeType;this.isLoanHarp=wrappedLoan.ref.loanIsHarp;this.disableMortgageInsurance=wrappedLoan.ref.loanIsHarp&&this.pledgedAssetModel.getProperty()&&!this.pledgedAssetModel.getProperty().doYouPayMortgageInsurance;this.areSixPiecesAcquiredForAllLoanApplications=wrappedLoan.ref.sixPiecesAcquiredForAllLoanApplications;this.originalPropertyId=this.pledgedAssetModel.getProperty()&&this.pledgedAssetModel.getProperty().propertyId;this.originalLienPosition=this.pledgedAssetModel.lienPosition;this.initializePropertyExpenses();if(this.disableFields||this.isReoDisabled(this.borrowerDebtCommentId)){this.pledgedAssetModel.liabilityDisabled=true;}this.setValuesFromGeneralSettings();this.updateOccupancyTypeAttributes();this.displayImpoundList();this.setSelectedImpound();this.validateReo();this.buildAddressesList();if(this.isNew){this.pledgedAssetModel.pledgedAssetLoanType=this.enums.PledgedAssetLoanType.Fixed;}if(!!originalPledgedAssetModel.property){this.propertyId=originalPledgedAssetModel.property.propertyId;}}Object.defineProperty(RealEstateItemController.prototype,"tiCopy",{get:function(){return this._tiCopy;},set:function(tiCopy){this._tiCopy=tiCopy;},enumerable:true,configurable:true});Object.defineProperty(RealEstateItemController.prototype,"lienPosition",{get:function(){return this.pledgedAssetModel.lienPosition;},set:function(lienPosition){this.pledgedAssetModel.lienPosition=lienPosition;},enumerable:true,configurable:true});Object.defineProperty(RealEstateItemController.prototype,"lienPositionLookups",{get:function(){if(this._lienPositionLookups==null){this._lienPositionLookups=this.buildLienPositionLookupList();}return this._lienPositionLookups;},set:function(readOnly){},enumerable:true,configurable:true});Object.defineProperty(RealEstateItemController.prototype,"borrowerDebtCommentId",{get:function(){return this.pledgedAssetModel.borrowerDebtCommentId;},set:function(borrowerDebtCommentId){this.pledgedAssetModel.borrowerDebtCommentId=borrowerDebtCommentId;this.reoCommentChanged();},enumerable:true,configurable:true});Object.defineProperty(RealEstateItemController.prototype,"disableComment",{get:function(){return this.disableFields||this._isDisabledComment;},set:function(disableComment){this._isDisabledComment=disableComment;},enumerable:true,configurable:true});Object.defineProperty(RealEstateItemController.prototype,"hasProperty",{get:function(){return !!this.pledgedAssetModel&&!!this.pledgedAssetModel.getProperty()&&!!this.pledgedAssetModel.getProperty().propertyId&&this.pledgedAssetModel.getProperty().propertyId!=lib.getEmptyGuid();},set:function(hasProperty){},enumerable:true,configurable:true});Object.defineProperty(RealEstateItemController.prototype,"propertyId",{get:function(){return this.pledgedAssetModel.getProperty()?this.pledgedAssetModel.getProperty().propertyId:lib.getEmptyGuid();},set:function(propertyId){this.shouldResetLienPosition=propertyId!=(this.pledgedAssetModel.hasProperty()&&this.pledgedAssetModel.getProperty().propertyId);this.pledgedAssetModel.setProperty(lib.findFirst(this.reoPropertyList,function(l){return l.propertyId==propertyId;}));this.initializePropertyExpenses();this.setSelectedImpound();this.disableComment=false;this.updateOccupancyTypeAttributes();this.displayImpoundList();this.resetLienPositionsAsynch();},enumerable:true,configurable:true});Object.defineProperty(RealEstateItemController.prototype,"isInvestmentProperty",{get:function(){return this.hasProperty&&this.pledgedAssetModel.getProperty().OccupancyType==this.enums.OccupancyTypes.InvestmentProperty;},set:function(readOnly){},enumerable:true,configurable:true});Object.defineProperty(RealEstateItemController.prototype,"listOccupancyType",{get:function(){return this._listOccupancyType;},set:function(readOnly){},enumerable:true,configurable:true});Object.defineProperty(RealEstateItemController.prototype,"isDisabledOccupancyType",{get:function(){return this._isDisabledOccupancyType;},set:function(readOnly){},enumerable:true,configurable:true});Object.defineProperty(RealEstateItemController.prototype,"isValidComments",{get:function(){return this._isValidComments;},set:function(readOnly){},enumerable:true,configurable:true});Object.defineProperty(RealEstateItemController.prototype,"subjPropOccupancy",{get:function(){return this.wrappedLoan.ref.getSubjectProperty().OccupancyType;},set:function(occupancy){},enumerable:true,configurable:true});Object.defineProperty(RealEstateItemController.prototype,"isCurentResidenceSameAsSubject",{get:function(){if(this.wrappedLoan.ref.active.getBorrower().getCurrentAddress().isSameAsPropertyAddress){return 1;}else{return 2;}},set:function(isSame){},enumerable:true,configurable:true});Object.defineProperty(RealEstateItemController.prototype,"currentResidenceOwnership",{get:function(){return this.wrappedLoan.ref.active.getBorrower().getCurrentAddress().ownership;},set:function(ownership){},enumerable:true,configurable:true});RealEstateItemController.$inject=["$modalInstance","$interval","CreditSvc","CreditHelpers","enums","isNew","originalPledgedAssetModel","disableFields","wrappedLoan","debtAccountOwnershipTypes","lookup","generalSettings","loanEvent","commonModalWindowFactory","modalWindowType","CreditStateService","guidService","modalPopoverFactory"];RealEstateItemController.buildLienPositionLookupListDflt=function(lookups){var lienPositionLookups=[];lookups.forEach(function(lu){return lienPositionLookups.push(cls.LookupItem.fromLookupItem(lu));});return lienPositionLookups;};return RealEstateItemController;})();angular.module("loanApplication").controller("realEstateItemController",RealEstateItemController);})(credit||(credit={}));(function(){angular.module("loanApplication").controller("declarationsController",function($scope,$compile,$http,$log,BroadcastSvc,simpleModalWindowFactory,wrappedLoan,applicationData,enums){var vm=this;vm.wrappedLoan=wrappedLoan;vm.showErrorMessage=false;vm.disableFields=false;vm.showDeclarationsTab=true;vm.miscDebts={};vm.applicationData=applicationData;vm.getDeclarationsData=getDeclarationsData();vm.payeeChange=payeeChange;vm.monthsLeftChange=monthsLeftChange;vm.addRow=addRow;vm.removeRow=removeRow;vm.addLiability=addChildAlimony;vm.removeLiability=removeChildAlimony;vm.isInterviewFaceToFace=isInterviewFaceToFace;vm.isIdentificationOther=isIdentificationOther;vm.isAfterIssued=isAfterIssued;function isInterviewFaceToFace(){return vm.wrappedLoan.ref.active.declarations.loanOriginatorSource==enums.loanOriginatorSource.faceToFaceInterview;}function isIdentificationOther(borrower){return borrower.declarationsInfo.certificationId==enums.certificationId.other;}function isBorrowerCheckedYesChildAlimony(){return vm.wrappedLoan.ref.active.getBorrower().declarationsInfo.alimonyChildSupportObligation==1||vm.wrappedLoan.ref.active.getBorrower().declarationsInfo.alimonyChildSupportObligation==null?false:true;}function isCoBorrowerCheckedYesChildAlimony(){return vm.wrappedLoan.ref.active.getCoBorrower().declarationsInfo.alimonyChildSupportObligation==1||vm.wrappedLoan.ref.active.getCoBorrower().declarationsInfo.alimonyChildSupportObligation==null||!vm.wrappedLoan.ref.active.isSpouseOnTheLoan?false:true;}function getDeclarationsData(){if(!wrappedLoan.ref.active.borrowerHasChildAlimony()&&wrappedLoan.ref.active.getBorrower().declarationsInfo.alimonyChildSupportObligation!=null){vm.wrappedLoan.ref.active.getBorrower().declarationsInfo.alimonyChildSupportObligation=1;}else{if(wrappedLoan.ref.active.borrowerHasChildAlimony()){vm.wrappedLoan.ref.active.getBorrower().declarationsInfo.alimonyChildSupportObligation=0;}}if(wrappedLoan.ref.active.isSpouseOnTheLoan){if(!wrappedLoan.ref.active.coBorrowerHasChildAlimony()&&wrappedLoan.ref.active.getCoBorrower().declarationsInfo.alimonyChildSupportObligation!=null){vm.wrappedLoan.ref.active.getCoBorrower().declarationsInfo.alimonyChildSupportObligation=1;}else{if(wrappedLoan.ref.active.coBorrowerHasChildAlimony()){vm.wrappedLoan.ref.active.getCoBorrower().declarationsInfo.alimonyChildSupportObligation=0;}}}vm.miscDebts=wrappedLoan.ref.separateMiscDebts(isBorrowerCheckedYesChildAlimony(),isCoBorrowerCheckedYesChildAlimony());}function payeeChange(value,index){vm.miscDebts[index][1].payee=value;vm.miscDebts=wrappedLoan.ref.separateMiscDebts(isBorrowerCheckedYesChildAlimony(),isCoBorrowerCheckedYesChildAlimony());}function monthsLeftChange(value,index){vm.miscDebts[index][1].monthsLeft=value;}function addRow(){if(wrappedLoan.ref.getDefaultRowChildAlimony()!=undefined){if(wrappedLoan.ref.getDefaultRowChildAlimony()[""]!=undefined){wrappedLoan.ref.updateDefaultStatus();}else{wrappedLoan.ref.updateDefaultStatus();addNewMiscDebt();}}else{if(!vm.miscDebts||!vm.miscDebts[""]){addNewMiscDebt();}}vm.miscDebts=wrappedLoan.ref.separateMiscDebts(isBorrowerCheckedYesChildAlimony(),isCoBorrowerCheckedYesChildAlimony());}function addNewMiscDebt(){var newDebt=new cls.MiscellaneousDebtViewModel();newDebt.typeId=srv.MiscellaneousDebtTypes.ChildCareExpensesForVALoansOnly;newDebt.amount=0;newDebt.monthsLeft=0;newDebt.payee="";newDebt.isUserEntry=true;newDebt.isCoBorrower=!isBorrowerCheckedYesChildAlimony();if(isBorrowerCheckedYesChildAlimony()){wrappedLoan.ref.active.getBorrower().addMiscDebts(newDebt);}else{if(isCoBorrowerCheckedYesChildAlimony()){wrappedLoan.ref.active.getCoBorrower().addMiscDebts(newDebt);}}}function removeRow(key){wrappedLoan.ref.active.getBorrower().removeMiscDebts(vm.miscDebts[key][0]);wrappedLoan.ref.active.getBorrower().removeMiscDebts(vm.miscDebts[key][1]);wrappedLoan.ref.active.getCoBorrower().removeMiscDebts(vm.miscDebts[key][0]);wrappedLoan.ref.active.getCoBorrower().removeMiscDebts(vm.miscDebts[key][1]);wrappedLoan.ref.active.addDefaultChildAlimonyIfLastRemoved();delete vm.miscDebts[key];}function removeChildAlimony(isCoBorrower){for(var key in vm.miscDebts){if(vm.miscDebts[key][0].isCoBorrower==isCoBorrower){wrappedLoan.ref.active.getBorrower().removeMiscDebts(vm.miscDebts[key][0]);wrappedLoan.ref.active.getCoBorrower().removeMiscDebts(vm.miscDebts[key][0]);}else{wrappedLoan.ref.active.getBorrower().removeMiscDebts(vm.miscDebts[key][1]);wrappedLoan.ref.active.getCoBorrower().removeMiscDebts(vm.miscDebts[key][1]);}}wrappedLoan.ref.active.addDefaultChildAlimonyIfLastRemoved();vm.miscDebts=wrappedLoan.ref.separateMiscDebts(isBorrowerCheckedYesChildAlimony(),isCoBorrowerCheckedYesChildAlimony());}function addChildAlimony(isCoBorrower){vm.miscDebts=wrappedLoan.ref.separateMiscDebts(isBorrowerCheckedYesChildAlimony(),isCoBorrowerCheckedYesChildAlimony());}function isAfterIssued(isCoBorrower){if(!isCoBorrower){return new cls.DeclarationInfoViewModel(wrappedLoan.ref.active.getBorrower().declarationsInfo).expiredAfterIssued();}else{return new cls.DeclarationInfoViewModel(wrappedLoan.ref.active.getCoBorrower().declarationsInfo).expiredAfterIssued();}}});})();(function(){angular.module("loanApplication").service("DeclarationsSvc",DeclarationsSvc);DeclarationsSvc.$inject=["$resource","apiRoot"];function DeclarationsSvc($resource,ApiRoot){var DeclarationsApiPath=ApiRoot+"Declarations/";var SaveDeclarationsData=$resource(DeclarationsApiPath+"SaveDeclarationsData",{viewModel:"@viewModel"});var DeclarationsServices=$resource(DeclarationsApiPath+":path",{path:"@path"},{GetDeclarationsData:{method:"GET",params:{loanId:"loanId",accountId:"accountId"}}});var declarationsService={DeclarationsServices:DeclarationsServices,SaveDeclarationsData:SaveDeclarationsData};return declarationsService;}})();impDirectives.directive("impAddressControl",[function(){return{restrict:"E",replace:true,templateUrl:"/angular/common/addresscontrol/addresscontroltemplate.html",require:"ngModel",scope:{states:"=?",isCountyVisible:"@",isUnitVisible:"@",placeholderStreetName:"@",placeholderCityName:"@",model:"=ngModel",isDisabled:"=ngDisabled",required:"=ngRequired",namePrefix:"@",formName:"=",zipEnabled:"@",firstRowDisabled:"=",zipRequired:"=",zipBlurValidation:"=",isLicensedStates:"=",isSubjectProperty:"=",onStreetNameChangeFn:"&",onStateChangeFn:"&?",noChangeEventForStreetName:"=",validation:"=?",zipAsterisksRequired:"=",runLoanCalculatorOnZipBlur:"=",customCallbacks:"="},link:function(scope,element,attrs){if(!attrs.isCountyVisible){attrs.isCountyVisible=false;}if(!attrs.isUnitVisible){attrs.isUnitVisible=true;}if(!attrs.placeholderStreetName){attrs.placeholderStreetName="Street";}if(!attrs.placeholderCityName){attrs.placeholderCityName="City";}if(!attrs.isLicensedStates){attrs.isLicensedStates=false;}if(!attrs.onStreetNameChangeFn){attrs.noChangeEventForStreetName=true;}},controller:function($scope,$timeout,ZipCodeSvc,loanEvent){var vm=$scope;vm.fetchZipData=fetchZipData;vm.fetchCounty=fetchCounty;vm.getStateContainerClass=getStateContainerClass;vm.validateZipOnBlur=validateZipOnBlur;vm.isExistingState=isExistingState;vm.invalidZipCode=false;vm.isLicencedZipCode=true;vm.onStreetNameChange=onStreetNameChange;if(!vm.states&&!!vm.model&&!!vm.model.states){vm.states=vm.model.states;}if(vm.isCountyVisible=="true"&&!!vm.model){if(vm.model.zipCode&&vm.model.zipCode.length>1&&(!vm.model.counties||vm.model.counties.length==0)){if(vm.model.countyName){vm.model.counties=[{Selected:true,Text:vm.model.countyName,Value:vm.model.countyName}];}ZipCodeSvc.GetZipData(vm.model).then(function(data){vm.model.counties=data.counties;});}else{if(vm.model.countyName&&(!vm.model.counties||vm.model.counties.length==0)){vm.model.counties=[{Selected:true,Text:vm.model.countyName,Value:vm.model.countyName}];}}}$scope.$watch(function(){return !!vm.model?vm.model.stateName:"";},function(newValue,oldValue){if(!!vm.model&&!!vm.model.counties&&vm.model.counties.length!=0){vm.counties=vm.model.counties;}});function isExistingState(stateName){for(var i=0;i<vm.states.length;i++){if(vm.states[i].text==stateName){return true;}}return false;}function updatePropertyAddressFromZipData(zipData){if(zipData.zipCode==null||!isExistingState(zipData.stateName)){vm.model.cityName="";vm.model.countyName="";vm.model.stateName="";vm.model.zipCode="";vm.model.stateId=0;vm.model.counties=[];vm.isLicencedZipCode=false;}else{vm.model.cityName=zipData.cityName;vm.model.countyName=zipData.countyName;vm.model.stateName=zipData.stateName;vm.model.zipCode=zipData.zipCode;vm.model.counties=zipData.counties;SetStateId();vm.isLicencedZipCode=true;}}function fetchZipData(){if(!vm.model||!vm.model.zipCode||vm.model.zipCode.length!=5){return;}vm.model.isLicensedStates=vm.isLicensedStates;ZipCodeSvc.GetZipData(vm.model).then(function(data){updatePropertyAddressFromZipData(data);});onStateChange();}function onStateChange(){if(angular.isDefined(vm.onStateChangeFn())){$timeout(function(){vm.onStateChangeFn();});}}function fetchCounty(){if(!vm.model){return;}vm.model.zipCode="";vm.model.cityName=vm.model.cityName||"";if(!vm.isCountyVisible||vm.isCountyVisible=="false"){SetStateId();return;}ZipCodeSvc.GetCounties(vm.model).then(function(data){angular.extend(vm.model,data);vm.model.counties=data.counties;SetStateId();});onStateChange();}function SetStateId(){if(!vm.model){return;}angular.forEach(vm.states,function(state){if(state.text==vm.model.stateName){if(vm.model.stateId==null){vm.model.stateId={};}vm.model.stateId=state.value;return false;}});}function getStateContainerClass(formElement){if(vm.validation&&(vm.validation.sixPicesCompleted&&vm.validation.validate&&(!!vm.model&&!vm.model.stateName))){return"imp-has-error";}if(vm.isDisabled){return"disabled";}if(formElement==undefined){return"";}var stateNameElement=formElement[vm.namePrefix+"StateName"];if(stateNameElement==undefined){return"";}if((vm.required==true||vm.required=="required")&&(stateNameElement.$touched||stateNameElement.$dirty)&&stateNameElement.$invalid){return"ng-invalid ng-dirty";}}function validateZipOnBlur(zipCode){if(vm.customCallbacks){for(var i=0;i<vm.customCallbacks.length;i++){vm.customCallbacks[0]();}}if(vm.runLoanCalculatorOnZipBlur){loanEvent.broadcastPropertyChangedEvent(events.LoanFieldIdentifier.SubjectPropertyZipCode,vm.model.zipCode);}if(vm.zipBlurValidation){if(zipCode==null||zipCode.length!=5){vm.invalidZipCode=true;}else{vm.invalidZipCode=false;}}}function onStreetNameChange(){if(vm.noChangeEventForStreetName!=true&&typeof this.onStreetNameChangeFn=="function"){var _controller=this;$timeout(function(){_controller.onStreetNameChangeFn();});}}}};}]);var util;(function(util){var addressWidget=(function(){function addressWidget(ZipCodeSvc){var _this=this;this.template='<div ng-include src="contentUrl"></div>';this.isExistingState=function($scope,stateName){for(var i=0;i<$scope.states.length;i++){if($scope.states[i].text==stateName){return true;}}return false;};this.updatePropertyAddressFromZipData=function($scope,zipData){console.log("It is required ::: "+$scope.required);if(zipData.zipCode==null||!_this.isExistingState($scope,zipData.stateName)){$scope.cityName="";$scope.countyName="";$scope.stateName="";$scope.zipCode="";$scope.stateId=0;$scope.counties=[];$scope.isLicencedZipCode=false;}else{$scope.cityName=zipData.cityName;$scope.countyName=zipData.countyName;$scope.stateName=zipData.stateName;$scope.zipCode=zipData.zipCode;$scope.counties=zipData.counties;_this.SetStateId($scope);$scope.isLicencedZipCode=true;}};this.fetchZipData=function($scope,ZipCodeSvc){if(!$scope.zipCode||$scope.zipCode.length!=5){return;}var payload={isLicensedStates:true,cityName:$scope.cityName,countyName:$scope.countyName,stateName:$scope.stateName,zipCode:$scope.zipCode};ZipCodeSvc.GetZipData(payload).then(function(data){_this.updatePropertyAddressFromZipData($scope,data);});};this.SetStateId=function($scope){angular.forEach($scope.states,function(state){if(state.text==$scope.stateName){if($scope.stateId==null){$scope.stateId={};}$scope.stateId=state.value;return false;}});};this.validateZipOnBlur=function($scope){if($scope.zipBlurValidation){if($scope.zipCode==null||$scope.zipCode.length!=5){$scope.invalidZipCode=true;}else{$scope.invalidZipCode=false;}}};this.getStates=function(){return[{"selected":false,"text":"AL","value":"0","disabled":false,"contextFlags":null},{"selected":false,"text":"AK","value":"1","disabled":false,"contextFlags":null},{"selected":false,"text":"AZ","value":"2","disabled":false,"contextFlags":null},{"selected":false,"text":"AR","value":"3","disabled":false,"contextFlags":null},{"selected":false,"text":"CA","value":"4","disabled":false,"contextFlags":null},{"selected":false,"text":"CO","value":"5","disabled":false,"contextFlags":null},{"selected":false,"text":"CT","value":"6","disabled":false,"contextFlags":null},{"selected":false,"text":"DC","value":"50","disabled":false,"contextFlags":null},{"selected":false,"text":"DE","value":"7","disabled":false,"contextFlags":null},{"selected":false,"text":"FL","value":"8","disabled":false,"contextFlags":null},{"selected":false,"text":"GA","value":"9","disabled":false,"contextFlags":null},{"selected":false,"text":"HI","value":"10","disabled":false,"contextFlags":null},{"selected":false,"text":"ID","value":"11","disabled":false,"contextFlags":null},{"selected":false,"text":"IL","value":"12","disabled":false,"contextFlags":null},{"selected":false,"text":"IN","value":"13","disabled":false,"contextFlags":null},{"selected":false,"text":"IA","value":"14","disabled":false,"contextFlags":null},{"selected":false,"text":"KS","value":"15","disabled":false,"contextFlags":null},{"selected":false,"text":"KY","value":"16","disabled":false,"contextFlags":null},{"selected":false,"text":"LA","value":"17","disabled":false,"contextFlags":null},{"selected":false,"text":"ME","value":"18","disabled":false,"contextFlags":null},{"selected":false,"text":"MD","value":"19","disabled":false,"contextFlags":null},{"selected":false,"text":"MA","value":"20","disabled":false,"contextFlags":null},{"selected":false,"text":"MI","value":"21","disabled":false,"contextFlags":null},{"selected":false,"text":"MN","value":"22","disabled":false,"contextFlags":null},{"selected":false,"text":"MS","value":"23","disabled":false,"contextFlags":null},{"selected":false,"text":"MO","value":"24","disabled":false,"contextFlags":null},{"selected":false,"text":"MT","value":"25","disabled":false,"contextFlags":null},{"selected":false,"text":"NE","value":"26","disabled":false,"contextFlags":null},{"selected":false,"text":"NV","value":"27","disabled":false,"contextFlags":null},{"selected":false,"text":"NH","value":"28","disabled":false,"contextFlags":null},{"selected":false,"text":"NJ","value":"29","disabled":false,"contextFlags":null},{"selected":false,"text":"NM","value":"30","disabled":false,"contextFlags":null},{"selected":false,"text":"NY","value":"31","disabled":false,"contextFlags":null},{"selected":false,"text":"NC","value":"32","disabled":false,"contextFlags":null},{"selected":false,"text":"ND","value":"33","disabled":false,"contextFlags":null},{"selected":false,"text":"OH","value":"34","disabled":false,"contextFlags":null},{"selected":false,"text":"OK","value":"35","disabled":false,"contextFlags":null},{"selected":false,"text":"OR","value":"36","disabled":false,"contextFlags":null},{"selected":false,"text":"PA","value":"37","disabled":false,"contextFlags":null},{"selected":false,"text":"RI","value":"38","disabled":false,"contextFlags":null},{"selected":false,"text":"SC","value":"39","disabled":false,"contextFlags":null},{"selected":false,"text":"SD","value":"40","disabled":false,"contextFlags":null},{"selected":false,"text":"TN","value":"41","disabled":false,"contextFlags":null},{"selected":false,"text":"TX","value":"42","disabled":false,"contextFlags":null},{"selected":false,"text":"UT","value":"43","disabled":false,"contextFlags":null},{"selected":false,"text":"VT","value":"44","disabled":false,"contextFlags":null},{"selected":false,"text":"VA","value":"45","disabled":false,"contextFlags":null},{"selected":false,"text":"WA","value":"46","disabled":false,"contextFlags":null},{"selected":false,"text":"WV","value":"47","disabled":false,"contextFlags":null},{"selected":false,"text":"WI","value":"48","disabled":false,"contextFlags":null},{"selected":false,"text":"WY","value":"49","disabled":false,"contextFlags":null}];};this.restrict="E";this.replace=true;this.scope={states:"=?",isCountyVisible:"@",isUnitVisible:"@",placeholderStreetName:"@",placeholderCityName:"@",placeholderStateName:"@",placeholderZipCodeName:"@",model:"=?ngModel",streetName:"=",unitNumber:"=?",cityName:"=",stateName:"=",zipCode:"=",countyName:"=?",isDisabled:"=ngDisabled",required:"=ngRequired",namePrefix:"@",formName:"=",zipEnabled:"@",firstRowDisabled:"=",zipRequired:"@",zipBlurValidation:"=",isLicensedStates:"=",isSubjectProperty:"=",onStreetNameChangeFn:"&",noChangeEventForStreetName:"=",validation:"=?",zipAsterisksRequired:"=",cityWidth:"@",stateWidth:"@",zipWidth:"@",contentUrl:"=?",};this.controller=function($scope){if(!$scope.states){$scope.states=_this.getStates();}if(!$scope.zipRequired){$scope.zipRequired=true;}if($scope.zipBlurValidation){$scope.zipBlurValidation=false;}if($scope.stateName){_this.SetStateId($scope);}if(!$scope.contentUrl){$scope.contentUrl="/angular/common/address/address.html";}$scope.fetchZipData=function(){return _this.fetchZipData($scope,ZipCodeSvc);};$scope.isExistingState=function(stateName){return _this.isExistingState($scope,stateName);};$scope.invalidZipCode=false;$scope.isLicencedZipCode=true;$scope.validateZipOnBlur=function(){$scope.invalidZipCode=($scope.zipBlurValidation&&($scope.zipCode==null||$scope.zipCode.length!=5))?true:false;};};this.compile=function(element,attrs){if(!attrs.isCountyVisible){attrs.isCountyVisible=false;}if(!attrs.isUnitVisible){attrs.isUnitVisible=true;}if(!attrs.placeholderStreetName){attrs.placeholderStreetName="Street";}if(!attrs.placeholderCityName){attrs.placeholderCityName="City";}if(!attrs.placeholderStateName){attrs.placeholderStateName="State";}if(!attrs.isLicensedStates){attrs.isLicensedStates=false;}if(!attrs.onStreetNameChangeFn){attrs.noChangeEventForStreetName=true;}attrs.cityWidth=attrs.cityWidth==null?"100%":attrs.cityWidth+"px";attrs.stateWidth=attrs.stateWidth==null?"100%":attrs.stateWidth+"px";attrs.zipWidth=attrs.zipWidth==null?"100%":attrs.zipWidth+"px";};}addressWidget.Factory=function(){var directive=function(ZipCodeSvc){return new addressWidget(ZipCodeSvc);};directive["$inject"]=["ZipCodeSvc"];return directive;};return addressWidget;})();util.addressWidget=addressWidget;angular.module("util").directive("addressWidget",addressWidget.Factory());})(util||(util={}));angular.module("iMP.Directives").directive("includeReplace",function(){return{require:"ngInclude",restrict:"A",link:function(scope,el,attrs){el.replaceWith(el.children());}};});impDirectives.directive("impValidateEmail",[function(){return{require:"ngModel",restrict:"A",replace:true,scope:{model:"=ngModel"},link:function(scope,elm,attrs,ctrl){if(scope.model&&scope.model.startsWith("newprospect")){scope.model="";}}};}]);(function(){angular.module("iMP.Directives").directive("impTemplateControl",templateControl);templateControl.$inject=[];function templateControl(){var directive={scope:{"ngModel":"=","additionalModel":"=","templateUrl":"=",},controller:controller,controllerAs:"templateControlCtrl",bindToController:true,restrict:"E",template:'<ng-include src="templateControlCtrl.getTemplateUrl()"/>'};return directive;function controller(){var vm=this;vm.getTemplateUrl=getTemplateUrl;function getTemplateUrl(){return vm.templateUrl;}}}})();(function(){angular.module("util").factory("ZipCodeSvc",["$rootScope","$q","apiRoot",function($rootScope,$q,apiRoot){return{GetZipData:function(model){var deferred=$q.defer();$.ajax({type:"POST",url:apiRoot+"ZipData/ZipDataCalculation",data:JSON.stringify(model),dataType:"json",contentType:"application/json",success:function(msg){deferred.resolve(msg);},error:function(xhr,ajaxOptions,thrownError){var tempModel=GetEmptyObject(model);tempModel.states=model.states;deferred.resolve(tempModel);}});return deferred.promise;},GetCounties:function(model){var deferred=$q.defer();$.ajax({type:"POST",url:apiRoot+"ZipData/Counties",data:JSON.stringify(model),dataType:"json",contentType:"application/json",success:function(msg){deferred.resolve(msg);},error:function(xhr,ajaxOptions,thrownError){var tempModel=GetEmptyObject(model);tempModel.states=model.states;deferred.resolve(tempModel);}});return deferred.promise;}};}]);})();var loanCenter;(function(loanCenter){var itemizedPropertyTaxCalculatorController=(function(){function itemizedPropertyTaxCalculatorController(paymentPeriodMonths,costDetailsSvc){var _this=this;this.paymentPeriodMonths=paymentPeriodMonths;this.costDetailsSvc=costDetailsSvc;this.basePred=function(itemizedPropertyTax){return itemizedPropertyTax.amount!=null;};this.recalculateAmount=function(model){model.amountForYear=lib.summate(model.itemizedPropertyTaxes,function(l){return _this.basePred(l);},function(l){return l.amount;});model.amountPerMonth=model.amountForYear/12;};this.paymentPeriodMonths=paymentPeriodMonths;this.costDetailsSvc=costDetailsSvc;}itemizedPropertyTaxCalculatorController.prototype.initialize=function(model){if(model.itemizedPropertyTaxes.length==0){this.costDetailsSvc.initializeItemizedPropertyTaxes.query({costId:model.costId}).$promise.then(function(data){model.itemizedPropertyTaxes=angular.copy(data);},function(error){console.log(error);});}this.recalculateAmount(model);};itemizedPropertyTaxCalculatorController.className="itemizedPropertyTaxCalculatorController";itemizedPropertyTaxCalculatorController.$inject=["paymentPeriodMonths","costDetailsSvc"];return itemizedPropertyTaxCalculatorController;})();loanCenter.itemizedPropertyTaxCalculatorController=itemizedPropertyTaxCalculatorController;angular.module("loanCenter").controller("itemizedPropertyTaxCalculatorController",itemizedPropertyTaxCalculatorController);})(loanCenter||(loanCenter={}));var loanCenter;(function(loanCenter){var manageAccountService=(function(){function manageAccountService(ApiRoot,modalPopoverFactory,$resource,$q,enums){var _this=this;this.ApiRoot=ApiRoot;this.modalPopoverFactory=modalPopoverFactory;this.$resource=$resource;this.$q=$q;this.enums=enums;this.activeUserAccounts=null;this.activeUserName=null;this.openManageAccount=function(wrappedLoan,openModel,event,callback,applicationData){var self=_this;var templateUrl="angular/loanapplication/manageaccount/manageaccount.html";_this.wrappedLoan=wrappedLoan;_this.applicationData=applicationData;_this.currentUserAccountId=applicationData.currentUserId;_this.usernameBeforeOpenModal=openModel.userAccount.username;var borrower=wrappedLoan.ref.active.getBorrower();_this.model=_this.coBorrowerManageUserAccount&&openModel.userAccount.isCoBorrower?angular.copy(_this.coBorrowerManageUserAccount):_this.borrowerManageUserAccount&&!openModel.userAccount.isCoBorrower?angular.copy(_this.borrowerManageUserAccount):angular.copy(openModel);_this.model.automaticallyOpen=openModel.automaticallyOpen||_this.model.automaticallyOpen;_this.model.originalUserAccountId=openModel.userAccount.userAccountId;if(borrower&&borrower.userAccount){_this.model.borrowerUserAccountId=borrower.userAccount.userAccountId;_this.model.borrowerUsername=borrower.userAccount.username;}self.prepareModel(_this.model);var ctrl={};var selfCtrl=_this.accountController(_this.model,ctrl,_this.wrappedLoan,callback);if(_this.model.automaticallyOpen&&!_this.model.isVerifyAccountInformationVisible&&!_this.model.userAccount.isCoBorrower){_this.model.userAccount.isOnlineUser=true;}if((_this.borrowerManageUserAccount&&!_this.model.userAccount.isCoBorrower&&!_this.borrowerManageUserAccount.userAccount.isOnlineUser&&_this.borrowerManageUserAccount.userAccount.isActivated)||(_this.coBorrowerManageUserAccount&&_this.model.userAccount.isCoBorrower&&!_this.coBorrowerManageUserAccount.userAccount.isOnlineUser&&_this.coBorrowerManageUserAccount.userAccount.isActivated)){_this.model.userAccount.isOnlineUser=false;_this.model.automaticallyOpen=false;}var confirmationPopup=_this.modalPopoverFactory.openModalPopover(templateUrl,selfCtrl,_this.model,event);ctrl.confirmationPopup=confirmationPopup;confirmationPopup.result.then(function(data){},function(){self.cancelChanges(self.model);});return confirmationPopup;};this.prepareModel=function(model){var vm=_this;model.accountOptions=vm.applicationData.lookup.accountOptions;model.securityQuestions=vm.wrappedLoan.ref.lookup.securityQuestions;model.userAccount.currentUserAccountId=_this.currentUserAccountId;model.userAccount.loanId=vm.wrappedLoan.ref.loanId;model.userAccount.resetPassword=false;model.userAccount.originalUsername=_this.model.userAccount.username;model.userAccount.originalSecurityQuestionId=_this.model.userAccount.securityQuestionId;model.userAccount.originalSecurityAnswer=_this.model.userAccount.securityAnswer;if(model.userAccount.userAccountId==undefined){model.userAccount.userAccountId=0;}if(model.userAccount.isActivated&&(_this.model.originalUserAccountId!=0||_this.model.originalUserAccountId!=_this.model.userAccount.userAccountId)){model.userAccount.sendActivationEmail=true;}else{model.userAccount.sendActivationEmail=false;}};this.accountController=function(model,ctrl,wrappedLoan,callback){model.isJointAccount=wrappedLoan.ref.active.getBorrower().userAccount.username==wrappedLoan.ref.active.getCoBorrower().userAccount.username&&wrappedLoan.ref.active.isSpouseOnTheLoan;model.isSeparateAccount=false;ctrl.IsResendActive=model.userAccount.isActivated?true:false;ctrl.isBorrowerOnline=_this.wrappedLoan.ref.active.getBorrower().userAccount.isOnlineUser;ctrl.isDisabledActionBtn=_this.isDisabledActionBtn;ctrl.onEmailBlur=_this.onEmailBlur;ctrl.onConfirmEmailBlur=_this.onConfirmEmailBlur;ctrl.preventPaste=_this.preventPaste;ctrl.saveUserAccount=_this.saveUserAccount;ctrl.resetPasswordChanged=_this.resetPasswordChanged;ctrl.sendActivationEmailChanged=_this.sendActivationEmailChanged;ctrl.onAccountOptionChange=_this.onAccountOptionChange;ctrl.callback=callback;ctrl.cancelChanges=_this.cancelChanges;model.sendVerification=false;if(model.userAccount.username==_this.wrappedLoan.ref.active.getBorrower().userAccount.username){model.coBorrowerAccountOptionId=_this.enums.accountOptions.jointWithBorrower;model.userAccount.isOnlineUser=ctrl.isBorrowerOnline;}else{model.coBorrowerAccountOptionId=_this.enums.accountOptions.separateFromBorrower;model.isSeparateAccount=true;model.userAccount.isOnlineUser=ctrl.isBorrowerOnline;}ctrl.cancelButton=model.userAccount.isCoBorrower&&model.coBorrowerAccountOptionId==_this.enums.accountOptions.jointWithBorrower?"Close":"Cancel";model.isSecurityVisible=common.string.isNullOrWhiteSpace(model.userAccount.securityAnswer)&&!model.userAccount.isOnlineUser;return ctrl;};this.sendActivationEmailChanged=function(model,value,event){};this.resetPasswordChanged=function(model,value,event){};this.onAccountOptionChange=function(model,ctrl){model.isSeparateAccount=model.coBorrowerAccountOptionId==_this.enums.accountOptions.separateFromBorrower;if(model.isSeparateAccount){model.userAccount.username="";model.userAccount.confirmEmail="";model.userAccount.securityAnswer="";model.userAccount.securityQuestionId=0;model.userAccount.isActivated=false;}ctrl.cancelButton=model.userAccount.isCoBorrower&&model.coBorrowerAccountOptionId==_this.enums.accountOptions.jointWithBorrower?"Close":"Cancel";};this.isDisabledActionBtn=function(model,ctrl){var invalid=false;if(typeof model.userAccount.username==="undefined"||model.userAccount.username.trim()===""){invalid=true;}if(typeof model.userAccount.confirmEmail==="undefined"||model.userAccount.confirmEmail.trim()===""){invalid=true;}if(!invalid&&model.userAccount.username.trim().toLowerCase()!==model.userAccount.confirmEmail.trim().toLowerCase()){invalid=true;}if((typeof model.userAccount.securityAnswer==="undefined"||model.userAccount.securityAnswer==null||model.userAccount.securityAnswer.trim()==="")&&model.userAccount.isOnlineUser){invalid=true;}if(model.coBorrowerAccountOptionId==_this.enums.accountOptions.separateFromBorrower&&model.userAccount.isCoBorrower&&model.userAccount.username==_this.wrappedLoan.ref.active.getBorrower().userAccount.username){invalid=true;}if(model.coBorrowerAccountOptionId==_this.enums.accountOptions.jointWithBorrower&&model.userAccount.isCoBorrower&&model.userAccount.username!=_this.wrappedLoan.ref.active.getBorrower().userAccount.username){invalid=true;}if(model.isVerifyAccountInformationVisible&&(!model.VerifyBorrowerName&&model.isVerifyBorrowerNameVisible||!model.VerifyCoBorrowerName&&model.isVerifyCoBorrowerNameVisible||!model.VerifySubjectPropertyAddress&&model.isVerifySubjectPropertyAddressVisible||!model.VerifySecurityQuestion&&model.isVerifySecurityQuestionVisible)){invalid=true;}return invalid;};this.sendVerificationMail=function(model,ctrl){if(model.userAccount.username!=null&&model.userAccount.username.trim().toLowerCase()!=model.userAccount.originalUsername.trim().toLowerCase()&&model.userAccount.confirmEmail!=null&&model.userAccount.username.trim().toLowerCase()===model.userAccount.confirmEmail.trim().toLowerCase()){model.sendVerification=true;}else{model.sendVerification=false;}model.userAccount.sendActivationEmail=!model.userAccount.isActivated;model.userAccount.sendVerificationEmail=model.userAccount.isActivated;};this.onConfirmEmailBlur=function(model,ctrl){model.userAccount.invalidConfirm=model.userAccount.confirmEmail==null||model.userAccount.confirmEmail.trim()==="";if(!model.userAccount.invalidConfirm){model.userAccount.invalidConfirm=model.userAccount.username.trim().toLowerCase()!==model.userAccount.confirmEmail.trim().toLowerCase();}_this.sendVerificationMail(model,ctrl);};this.onEmailBlur=function(manageModel,ctrl){var vm=_this;var username=manageModel.userAccount.username;vm.model=manageModel;if(manageModel.userAccount.username!=vm.wrappedLoan.ref.active.getBorrower().userAccount.username&&!manageModel.userAccount.isCoBorrower||manageModel.userAccount.isCoBorrower&&manageModel.userAccount.username!=vm.wrappedLoan.ref.active.getCoBorrower().userAccount.username){vm.existingUser(vm.wrappedLoan,manageModel.userAccount.username,manageModel.userAccount.isCoBorrower,vm.updateIn,ctrl.callback);vm.model.isSeparateAccount=manageModel.userAccount.isCoBorrower;if(vm.model.userAccount.userAccountId!=0){ctrl.IsResendActive=true;vm.model.userAccount.sendActivationEmail=true;}}else{vm.model.userAccount.usernameTaken=false;vm.model.isSeparateAccount=false;}_this.sendVerificationMail(vm.model,ctrl);};this.existingUser=function(wrappedLoan,username,isCoBorrower,callBackFrom,callback){var vm=_this;vm.wrappedLoan=wrappedLoan;vm.coBorrowerManageUserAccount=null;vm.borrowerManageUserAccount=null;if(callBackFrom==null){callBackFrom=vm.updateFromPage;vm.model=new cls.ManageUserAccountsViewModel();vm.model.userAccount=new cls.UserAccountViewModel();}vm.getUserAccounts(username,false).then(function(data){if(callBackFrom){callBackFrom(data,vm.wrappedLoan,isCoBorrower,callback);}vm.wrappedLoan=wrappedLoan;});};this.updateFromPage=function(manageUserAccounts,wrappedLoan,isCoBorrower,callback,connect){if(connect===void 0){connect=false;}var vm=_this;vm.setUserAcounts(manageUserAccounts,wrappedLoan,isCoBorrower);vm.connectUserAccount(vm.wrappedLoan,vm.borrowerManageUserAccount&&(!vm.borrowerManageUserAccount.userAccount.isActivated||connect),vm.coBorrowerManageUserAccount&&(!vm.coBorrowerManageUserAccount.userAccount.isActivated||connect),isCoBorrower);if(callback){callback();}};this.updateIn=function(manageUserAccounts,wrappedLoan,isCoBorrower,callback){var vm=_this;vm.setUserAcounts(manageUserAccounts,wrappedLoan,isCoBorrower);var temp=isCoBorrower&&vm.coBorrowerManageUserAccount?angular.copy(vm.coBorrowerManageUserAccount):vm.borrowerManageUserAccount?angular.copy(vm.borrowerManageUserAccount):vm.cretaNewManageUserAccountModel(isCoBorrower);temp.userAccount.username=vm.model.userAccount.username;temp.originalUserAccountId=vm.model.userAccount.userAccountId;temp.userAccount.isCoBorrower=vm.model.userAccount.isCoBorrower;vm.model.userAccount=angular.copy(temp.userAccount);vm.model.recentSubjectPropertyAddress=angular.copy(temp.recentSubjectPropertyAddress);vm.model.borrowerFirstName=temp.borrowerFirstName;vm.model.coBorrowerFirstName=temp.coBorrowerFirstName;vm.model.borrowerLastName=temp.borrowerLastName;vm.model.coBorrowerLastName=temp.coBorrowerLastName;vm.model.automaticallyOpen=true;vm.prepareModel(vm.model);};this.cretaNewManageUserAccountModel=function(isCoBorrower){var result=new cls.ManageUserAccountsViewModel();result.userAccount=isCoBorrower?angular.copy(_this.wrappedLoan.ref.active.getCoBorrower().userAccount):angular.copy(_this.wrappedLoan.ref.active.getBorrower().userAccount);result.recentSubjectPropertyAddress=new cls.PropertyViewModel();result.userAccount.isOnlineUser=isCoBorrower?_this.wrappedLoan.ref.active.getBorrower().userAccount.isOnlineUser:false;return result;};this.getUserAccounts=function(username,forceReload){if(forceReload===void 0){forceReload=null;}var vm=_this;var def=vm.$q.defer();if(vm.activeUserAccounts==null||vm.model&&vm.model.userAccount&&vm.model.userAccount.originalUsername!=username||forceReload){vm.userAccounts.get({username:username}).$promise.then(function(data){vm.activeUserAccounts=data;if(vm.model&&vm.model.userAccount){vm.model.userAccount.username=username;}def.resolve(data.manageUserAccountsList);},function(errorMsg){def.reject(errorMsg);});}else{def.resolve(vm.activeUserAccounts);}return def.promise;};this.setUserAcounts=function(manageUserAccounts,wrappedLoan,isCoBorrower){var vm=_this;if(manageUserAccounts.length==0){vm.coBorrowerManageUserAccount=vm.borrowerManageUserAccount=null;}if(manageUserAccounts.length>0){var coBorrowerUserAccount=wrappedLoan.ref.active.getCoBorrower().userAccount;if(manageUserAccounts[0].userAccount.isCoBorrower==true&&coBorrowerUserAccount.userAccountId==0||manageUserAccounts[0].userAccount.userAccountId==coBorrowerUserAccount.userAccountId||manageUserAccounts.length==1&&isCoBorrower&&vm.wrappedLoan.ref.active.getBorrower().userAccount.username!=manageUserAccounts[0].userAccount.username||manageUserAccounts.length==2&&manageUserAccounts[0].userAccount.userAccountId>manageUserAccounts[1].userAccount.userAccountId){vm.coBorrowerManageUserAccount=new cls.ManageUserAccountsViewModel(manageUserAccounts[0]);vm.coBorrowerManageUserAccount.recentSubjectPropertyAddress=new cls.PropertyViewModel(wrappedLoan.ref.getTransactionInfoRef(),manageUserAccounts[0].recentSubjectPropertyAddress);vm.coBorrowerManageUserAccount.userAccount.isCoBorrower=true;}else{vm.borrowerManageUserAccount=new cls.ManageUserAccountsViewModel(manageUserAccounts[0]);vm.borrowerManageUserAccount.recentSubjectPropertyAddress=new cls.PropertyViewModel(wrappedLoan.ref.getTransactionInfoRef(),manageUserAccounts[0].recentSubjectPropertyAddress);}}if(manageUserAccounts.length>1){if(vm.borrowerManageUserAccount==null){vm.borrowerManageUserAccount=new cls.ManageUserAccountsViewModel(manageUserAccounts[1]);vm.borrowerManageUserAccount.recentSubjectPropertyAddress=new cls.PropertyViewModel(wrappedLoan.ref.getTransactionInfoRef(),manageUserAccounts[1].recentSubjectPropertyAddress);}else{vm.coBorrowerManageUserAccount=new cls.ManageUserAccountsViewModel(manageUserAccounts[1]);vm.coBorrowerManageUserAccount.recentSubjectPropertyAddress=new cls.PropertyViewModel(wrappedLoan.ref.getTransactionInfoRef(),manageUserAccounts[1].recentSubjectPropertyAddress);}}if(vm.coBorrowerManageUserAccount&&vm.model.coBorrowerAccountOptionId!=_this.enums.accountOptions.separateFromBorrower){if(vm.borrowerManageUserAccount){vm.borrowerManageUserAccount.userAccount.jointAccountId=vm.coBorrowerManageUserAccount.userAccount.userAccountId;}vm.coBorrowerManageUserAccount.userAccount.jointAccountId=vm.borrowerManageUserAccount==null?null:vm.borrowerManageUserAccount.userAccount.userAccountId;vm.coBorrowerManageUserAccount.userAccount.isCoBorrower=true;}};this.setBorrowerAccount=function(userAccountModel,serverModel,isCoBorrower){if(userAccountModel.userAccountId==undefined||userAccountModel.userAccountId<=0){userAccountModel=new cls.UserAccountViewModel(serverModel);}else{userAccountModel.username=userAccountModel.originalUsername;userAccountModel.isEmailValid=true;}userAccountModel.isOnlineUser=serverModel.isOnlineUser;userAccountModel.isCoBorrower=isCoBorrower;};this.saveUserAccount=function(model,ctrl){var vm=_this;model.userAccount.saveAccount=true;model.loanApplicationId=vm.wrappedLoan.ref.active.loanApplicationId;if(model.isVerifyAccountInformationVisible){vm.connectUserAccount(vm.wrappedLoan,true,true,model.userAccount.isCoBorrower);ctrl.confirmationPopup.close();}else{if(model.userAccount.isCoBorrower){if(model.userAccount.username==vm.wrappedLoan.ref.active.getBorrower().userAccount.username){model.userAccount.jointAccountId=vm.wrappedLoan.ref.active.getBorrower().userAccount.userAccountId;}else{model.userAccount.jointAccountId=null;}model.userAccount.firstName=vm.wrappedLoan.ref.active.getCoBorrower().firstName;model.userAccount.lastName=vm.wrappedLoan.ref.active.getCoBorrower().lastName;}else{model.userAccount.firstName=vm.wrappedLoan.ref.active.getBorrower().firstName;model.userAccount.lastName=vm.wrappedLoan.ref.active.getBorrower().lastName;}_this.$resource(_this.apiPath+"SaveUserAccount/").save(model).$promise.then(function(data){vm.updateFromPage(data.manageUserAccountsList,_this.wrappedLoan,vm.model.userAccount.isCoBorrower,ctrl.callback,true);ctrl.confirmationPopup.close();},function(errorMsg){model.userAccount.usernameTaken=true;console.log(errorMsg);});}};this.connectUserAccount=function(wrappedLoan,isUpdatedBorrower,isUpdatedCoBorrower,isCoBorrower){var self=_this;if(self.borrowerManageUserAccount&&self.borrowerManageUserAccount.userAccount&&isUpdatedBorrower){if(!isCoBorrower){wrappedLoan.ref.active.getBorrower().userAccount=self.borrowerManageUserAccount.userAccount;}else{if(!self.coBorrowerManageUserAccount&&self.wrappedLoan.ref.active.getBorrower().userAccount.username!=self.wrappedLoan.ref.active.getCoBorrower().userAccount.username){wrappedLoan.ref.active.getCoBorrower().userAccount=self.borrowerManageUserAccount.userAccount;}}if(wrappedLoan.ref.active.isPrimary){wrappedLoan.ref.otherInterviewData.interviewId=self.borrowerManageUserAccount.userAccount.interviewId;}self.wrappedLoan.ref.active.docDelivery=self.wrappedLoan.ref.active.getBorrower().userAccount.isOnlineUser?1:0;}if(self.coBorrowerManageUserAccount&&self.coBorrowerManageUserAccount.userAccount&&isUpdatedCoBorrower){wrappedLoan.ref.active.getCoBorrower().userAccount=self.coBorrowerManageUserAccount.userAccount;}if(self.borrowerManageUserAccount==null||self.borrowerManageUserAccount.userAccount==null){wrappedLoan.ref.active.getBorrower().userAccount.jointAccountId=null;}};this.preventPaste=function(e){e.preventDefault();};this.cancelChanges=function(ctrl){if(_this.model&&_this.model.userAccount&&_this.model.userAccount.isActivated&&_this.model.originalUserAccountId!=_this.model.userAccount.userAccountId&&_this.model.isVerifyAccountInformationVisible){if(_this.model.userAccount.isCoBorrower){_this.wrappedLoan.ref.active.getCoBorrower().userAccount.username="";_this.wrappedLoan.ref.active.getCoBorrower().userAccount.isOnlineUser=false;_this.wrappedLoan.ref.active.getCoBorrower().userAccount.isActivated=false;}else{_this.wrappedLoan.ref.active.getBorrower().userAccount.username="";_this.wrappedLoan.ref.active.getBorrower().userAccount.isOnlineUser=false;_this.wrappedLoan.ref.active.getBorrower().userAccount.isActivated=false;}}if(_this.model){_this.model=null;}if(_this.borrowerManageUserAccount){_this.borrowerManageUserAccount=null;}if(_this.coBorrowerManageUserAccount){_this.coBorrowerManageUserAccount=null;}if(ctrl&&ctrl.confirmationPopup){ctrl.confirmationPopup.close();}};var vm=this;vm.modalPopoverFactory=modalPopoverFactory;vm.apiPath=ApiRoot+"user/";vm.enums=enums;vm.userAccounts=vm.$resource(vm.apiPath+"UserAccounts?username=:username",{username:"@username"});}manageAccountService.className="ManageAccountService";manageAccountService.$inject=["apiRoot","modalPopoverFactory","$resource","$q","enums"];return manageAccountService;})();loanCenter.manageAccountService=manageAccountService;angular.module("loanApplication").service("manageAccountService",manageAccountService);})(loanCenter||(loanCenter={}));var loanCenter;(function(loanCenter){var directives;(function(directives){function impAccountStatus(){return{restrict:"EA",replace:true,bindToController:true,scope:{currentBorrower:"=ngModel",spouseBorrowerModel:"=spouseModel",isSpouseOnTheLoan:"=",isCoBorrower:"="},link:function(scope,elm,attrs,ctrl){var vm=scope;scope.$watch(function(){accountStatus(vm);});function accountStatus(scope){var vm=scope;var modelClass="";vm.model=vm.currentBorrower.userAccount;vm.spouseModel=vm.spouseBorrowerModel.userAccount;if(vm.model==undefined||vm.spouseModel==undefined||vm.model.username==null||vm.model.username.trim()===""||vm.model.username==undefined){vm.currentBorrower.accountStatus=modelClass;}else{vm.model.isCoBorrower=vm.currentBorrower.isCoBorrower;vm.spouseModel.isCoBorrower=vm.spouseBorrowerModel.isCoBorrower;if(vm.spouseModel.isCoBorrower&&vm.spouseModel.username==vm.model.originalUsername){vm.spouseModel.username=vm.model.originalUsername=vm.model.username;}if(!vm.model.isCoBorrower&&vm.model.username==vm.spouseModel.username&&vm.model.originalUsername!=null&&vm.model.originalUsername.trim()!=""){vm.model.username=vm.model.originalUsername;vm.model.isEmailValid=true;}if(vm.model.isOnlineUser||(vm.model.isCoBorrower&&vm.model.username==vm.spouseModel.username&&vm.spouseModel.isOnlineUser)){modelClass+=" online";}else{modelClass+=" offline";}if(vm.model.username==vm.spouseModel.username&&vm.isSpouseOnTheLoan){modelClass+=" dual";}if(vm.model.isActivated||(vm.model.isCoBorrower&&vm.model.username==vm.spouseModel.username&&vm.spouseModel.isActivated)){modelClass+=" active";}else{modelClass+=" inactive";}vm.currentBorrower.accountStatus=modelClass;}}}};}directives.impAccountStatus=impAccountStatus;angular.module("iMP.Directives").directive("impAccountStatus",impAccountStatus);})(directives=loanCenter.directives||(loanCenter.directives={}));})(loanCenter||(loanCenter={}));(function(){angular.module("CalculatorModule",["ngResource"]);})();(function(){angular.module("CalculatorModule").factory("commonCalculatorSvc",commonCalculatorSvc);commonCalculatorSvc.$inject=["$resource","apiRoot"];function commonCalculatorSvc($resource,ApiRoot){var hcltvCalculatorApiPath=ApiRoot+"HcltvCalculator/";var cltvCalculatorApiPath=ApiRoot+"CltvCalculator/";var cashOutCalculatorApiPath=ApiRoot+"CashoutCalculator/CalculateCashoutRules";var CalculateCashoutAmountChangedApiPath=ApiRoot+"CashoutCalculator/CalculateCashoutAmountChanged";var CalculateCltv=$resource(cltvCalculatorApiPath,{},{CalculateCltv:{method:"POST",params:{}}});var CalculateHcltv=$resource(hcltvCalculatorApiPath,{},{CalculateHcltv:{method:"POST"}});var CalculateCashOut=$resource(cashOutCalculatorApiPath,{},{CalculateCashOut:{method:"POST"}});var CalculateCashOutChange=$resource(CalculateCashoutAmountChangedApiPath,{},{CalculateCashOutChange:{method:"POST"}});function RoundToTwoDecimalPlaces(number){return(Math.round(number*100))/100;}function CalculateDownPaymentPercentage(downPayment,purchasePrice){return RoundToTwoDecimalPlaces((downPayment/purchasePrice)*100);}function CalculateDti(totalDebts,totalBorrowerIncome,borrowerIncomePeriod,totalCoBorrowerIncome,coBorrowerIncomePeriod){var dtiCalculated=0;if(totalDebts==null||totalDebts==undefined){return{dti:dtiCalculated};}if(totalBorrowerIncome==null||totalBorrowerIncome==undefined){totalBorrowerIncome=0;}if(totalCoBorrowerIncome==null||totalCoBorrowerIncome==undefined){totalCoBorrowerIncome=0;}totalDebts=parseFloat(totalDebts);totalBorrowerIncome=parseFloat(totalBorrowerIncome);totalCoBorrowerIncome=parseFloat(totalCoBorrowerIncome);if(borrowerIncomePeriod=="2"){totalBorrowerIncome=totalBorrowerIncome/12;}if(coBorrowerIncomePeriod=="2"){totalCoBorrowerIncome=totalCoBorrowerIncome/12;}var totalIncome=totalBorrowerIncome+totalCoBorrowerIncome;if(totalIncome==0){dtiCalculated=0;}else{dtiCalculated=(totalDebts/totalIncome)*100;}return{dti:dtiCalculated};}function numToPercentage(num){var numToString=new String(Math.round(num*1000)/1000);var dec=numToString.split(".");if(dec==null||dec.length==0){return"0.000 %";}if(dec.length==1){return dec[0]+".000 %";}for(var i=0;i<3-dec[1].length;i++){numToString+="0";}if(numToString=="000"){numToString="0.000";}return numToString+" %";}function CalculateLtv(loanAmount,propertyValue){if(propertyValue==0){return 0;}var ltv=(loanAmount/propertyValue)*100;ltv=Math.round(ltv*1000)/1000;return ltv;}function RecalculateDownPayment(purchasePrice,loanAmount,downPayment,downPaymentPercentage,concurrent2ndMortgage,base){var result={purchasePrice:0,loanAmount:0,downPayment:0,downPaymentPercentage:0,concurrent2ndMortgage:0};switch(base){case"PurchasePrice":(function(){if(loanAmount>purchasePrice){result.loanAmount=loanAmount;result.concurrent2ndMortgage=concurrent2ndMortgage;result.purchasePrice=loanAmount+downPayment+concurrent2ndMortgage;result.downPayment=downPayment;result.downPaymentPercentage=CalculateDownPaymentPercentage(result.downPayment,result.purchasePrice);}else{result.purchasePrice=purchasePrice;if(loanAmount==0){result.loanAmount=purchasePrice;}else{result.loanAmount=loanAmount;}result.concurrent2ndMortgage=concurrent2ndMortgage;result.downPayment=purchasePrice-result.loanAmount-result.concurrent2ndMortgage;result.downPaymentPercentage=CalculateDownPaymentPercentage(result.downPayment,result.purchasePrice);}})();break;case"LoanAmount":(function(){if(loanAmount>purchasePrice){result.loanAmount=loanAmount;result.concurrent2ndMortgage=concurrent2ndMortgage;result.purchasePrice=loanAmount+downPayment+concurrent2ndMortgage;result.downPayment=downPayment;result.downPaymentPercentage=CalculateDownPaymentPercentage(result.downPayment,result.purchasePrice);}else{result.purchasePrice=purchasePrice;result.concurrent2ndMortgage=concurrent2ndMortgage;result.loanAmount=loanAmount;result.downPayment=purchasePrice-loanAmount-concurrent2ndMortgage;result.downPaymentPercentage=CalculateDownPaymentPercentage(result.downPayment,result.purchasePrice);}})();break;case"DownPayment":(function(){result.purchasePrice=purchasePrice;result.downPayment=Number.isNaN(parseFloat(downPayment))?0:downPayment;if(!result.purchasePrice<1||!result.downPayment<0){result.loanAmount=(1-(result.downPayment/result.purchasePrice))*result.purchasePrice;}else{result.loanAmount=loanAmount;}result.downPaymentPercentage=CalculateDownPaymentPercentage(result.downPayment,result.purchasePrice);})();break;case"DownPaymentPercentage":(function(){result.purchasePrice=purchasePrice;result.downPaymentPercentage=RoundToTwoDecimalPlaces(downPaymentPercentage);if(CalculateDownPaymentPercentage(downPayment,purchasePrice)==downPaymentPercentage){result.downPayment=downPayment;result.loanAmount=loanAmount;}else{result.downPayment=(result.downPaymentPercentage/100)*result.purchasePrice;result.loanAmount=(1-(result.downPaymentPercentage/100))*result.purchasePrice;}})();break;}return result;}function GetLowestMiddleFicoScore(wLoan,applicationData){var midFicoScore=Number.MAX_VALUE;if(wLoan.ref.financialInfo.ficoScore){return wLoan.ref.financialInfo.ficoScore;}if(midFicoScore==Number.MAX_VALUE&&wLoan.ref.otherInterviewData.selectedDecisionScoreRange!=-1){var ficoText=applicationData.lookup.ficoScore[wLoan.ref.otherInterviewData.selectedDecisionScoreRange-(-1)].text;return ficoText.length>3?ficoText.substring(ficoText.indexOf("(")+1,ficoText.indexOf(")")):ficoText;}return midFicoScore==Number.MAX_VALUE?"":midFicoScore;}function GetFicoScore(wLoan,applicationData){var midFicoScore=-1;lib.forEach(wLoan.ref.transactionInfo.borrowers,function(borrower){if(borrower.ficoScore.midFicoScore<midFicoScore&&borrower.ficoScore.midFicoScore>0){midFicoScore=borrower.ficoScore.midFicoScore;}});if(midFicoScore==-1&&wLoan.ref.otherInterviewData.selectedDecisionScoreRange!="-1"){var a=lib.filter(applicationData.lookup.ficoScore,function(item){return item.value==wLoan.ref.otherInterviewData.selectedDecisionScoreRange;});return a[0].stringValue;}else{if(midFicoScore==-1){return wLoan.ref.active.getBorrower().ficoScore.decisionScore;}}return midFicoScore;}var calculatorService={calculateDti:CalculateDti,calculateLtv:CalculateLtv,calculateCltv:CalculateCltv,calculateHcltv:CalculateHcltv,recalculateDownPayment:RecalculateDownPayment,calculateCashOut:CalculateCashOut,calculateCashOutChange:CalculateCashOutChange,GetLowestMiddleFicoScore:GetLowestMiddleFicoScore,GetFicoScore:GetFicoScore};return calculatorService;}})();(function(){angular.module("impoundCalculator",["ngResource"]);})();(function(){angular.module("impoundCalculator").factory("impoundCalculatorSvc",impoundCalculatorSvc);impoundCalculatorSvc.$inject=["$resource","apiRoot"];function impoundCalculatorSvc($resource,apiRoot){var miCalculatorApiPath=apiRoot+"MICalculator/";var CalculateMiAmount=$resource(miCalculatorApiPath+"CalculateMiAmount/");var impoundService={calculateMiAmount:CalculateMiAmount};return impoundService;}})();(function(){angular.module("impoundCalculator").controller("impoundCalculatorController",impoundCalculatorController);impoundCalculatorController.$inject=["costDetailsHelpers","enums","impoundCalculatorSvc"];function impoundCalculatorController(costDetailsHelpers,enums,impoundCalculatorSvc){var vm=this;vm.recalculateCost=recalculateCost;vm.isPeriodDisabled=isPeriodDisabled;vm.costDetailsHelpers=costDetailsHelpers;vm.enums=enums;vm.model={};vm.init=init;vm.setTotalEstimatedReserves=setTotalEstimatedReserves;vm.getTotalMonthlyImpounds=getTotalMonthlyImpounds;vm.getTotalEstReserves=getTotalEstReserves;vm.setHoaMontlyAmount=setHoaMontlyAmount;vm.getTotalMonthlyAmountIncludingHOA=getTotalMonthlyAmountIncludingHOA;vm.showAmountMethod=showAmountMethod;vm.isAmountMethodDisabled=isAmountMethodDisabled;vm.getAmountMethods=getAmountMethods;vm.isAmountDisabled=isAmountDisabled;vm.isFactorDisabled=isFactorDisabled;vm.onAmountMethodChange=onAmountMethodChange;vm.getNumberOfMonthsBasedOnPreferredPaymentPeriod=getNumberOfMonthsBasedOnPreferredPaymentPeriod;vm.clearItemizedPropertyTaxes=clearItemizedPropertyTaxes;vm.initializePeriodPaymentMonths=initializePeriodPaymentMonths;vm.removeAllPeriodPaymentMonths=removeAllPeriodPaymentMonths;vm.preferredPaymentPeriodChanged=preferredPaymentPeriodChanged;vm.isSingleMI=isSingleMI;vm.isMonthOfReservesEditable=isMonthOfReservesEditable;vm.onMonthsOfReservesBlur=onMonthsOfReservesBlur;vm.isPeriodPaymentMonthsDisabled=isPeriodPaymentMonthsDisabled;function init(model){vm.model=model;model.costs=model.costs.filter(function(c){if(c.hudLineNumber==1002||c.hudLineNumber==1003||c.hudLineNumber==1004||c.hudLineNumber==1006||(c.isRemoved!=true&&vm.costDetailsHelpers.isOtherInsurance(c))){return c;}});for(var i=0;i<model.costs.length;i++){var cost=model.costs[i];if(cost.hudLineNumber==1004){cost.sortName="01_PropertyTax";cost.displayName="Property Tax";if(!cost.preferredPaymentPeriod){cost.preferredPaymentPeriod=srv.PeriodTypeEnum.Annually;}if(cost.amountMethod==undefined){cost.amountMethod=vm.model.isRefinance?srv.AmountMethodEnum.Manual:srv.AmountMethodEnum.Calculated;}cost.monthsToBePaid=cost.monthsToBePaid>0?cost.monthsToBePaid:3;costCalculation(cost);}else{if(cost.hudLineNumber==1002){cost.sortName="02_HomeOwnerInsurance";cost.displayName="Homeowner Ins.";if(!cost.preferredPaymentPeriod){cost.preferredPaymentPeriod=srv.PeriodTypeEnum.Annually;}if(cost.amountMethod==undefined){cost.amountMethod=vm.model.isRefinance?srv.AmountMethodEnum.Manual:srv.AmountMethodEnum.Calculated;}cost.monthsToBePaid=cost.monthsToBePaid>0?cost.monthsToBePaid:2;costCalculation(cost);}else{if(cost.hudLineNumber==1006){cost.sortName="03_FloodInsurance";cost.displayName="Flood Insurance";if(!cost.preferredPaymentPeriod){cost.preferredPaymentPeriod=srv.PeriodTypeEnum.Monthly;}cost.monthsToBePaid=cost.monthsToBePaid>0?cost.monthsToBePaid:3;costCalculation(cost);}else{if(cost.hudLineNumber==1010||cost.originalHUDLineNumber==1010){cost.sortName="04_EarthquakeInsurance";cost.displayName="Earthquake Ins.";if(!cost.preferredPaymentPeriod){cost.preferredPaymentPeriod=srv.PeriodTypeEnum.Monthly;}costCalculation(cost);}else{if(cost.hudLineNumber==1007||cost.originalHUDLineNumber==1007){cost.sortName="05_Hurricane Insurance";cost.displayName="Hurricane Ins.";if(!cost.preferredPaymentPeriod){cost.preferredPaymentPeriod=srv.PeriodTypeEnum.Monthly;}costCalculation(cost);}else{if(cost.hudLineNumber==1012||cost.originalHUDLineNumber==1012){cost.sortName="06_USDAInsurance";cost.displayName=cost.name;if(!cost.preferredPaymentPeriod){cost.preferredPaymentPeriod=srv.PeriodTypeEnum.Monthly;}costCalculation(cost);}else{if(cost.hudLineNumber==1003){cost.sortName="07_MortgageInsurance";cost.displayName="Mortgage Ins.";if(cost.amountMethod==null||cost.amountMethod==undefined){cost.amountMethod=srv.AmountMethodEnum.MonthlyMI;}cost.preferredPaymentPeriod=srv.PeriodTypeEnum.Monthly;if(cost.amountPerMonth>0&&cost.amountMethod==srv.AmountMethodEnum.MonthlyMI){cost.impounded=true;}if(!cost.monthsToBePaid){cost.monthsToBePaid=0;}costCalculation(cost);}}}}}}}vm.initializePeriodPaymentMonths(cost);}}function getNumberOfMonthsBasedOnPreferredPaymentPeriod(preferredPaymentPeriod){if(preferredPaymentPeriod==srv.PeriodTypeEnum.Annually){return 12;}if(preferredPaymentPeriod==srv.PeriodTypeEnum.SemiAnnually){return 6;}if(preferredPaymentPeriod==srv.PeriodTypeEnum.Quarterly){return 3;}return 1;}function recalculateCost(cost){if(cost.percent>0&&!vm.model.isRefinance&&cost.amountMethod==srv.AmountMethodEnum.Calculated){if(cost.hudLineNumber==1002){cost.amountForYear=(roundToFourDecimalPlaces((cost.percent*vm.model.loanAmount/1200)*12));}else{if(cost.hudLineNumber==1004){cost.amountForYear=(roundToFourDecimalPlaces((cost.percent*vm.model.purchasePrice/1200)*12));}}}var periodMonths=vm.getNumberOfMonthsBasedOnPreferredPaymentPeriod(cost.preferredPaymentPeriod);cost.amountPerMonth=cost.amountForYear/periodMonths;if(cost.hudLineNumber==1003&&cost.amountPerMonth>0&&cost.amountMethod==srv.AmountMethodEnum.MonthlyMI){cost.impounded=true;}vm.setTotalEstimatedReserves(cost);}function setTotalEstimatedReserves(cost){cost.amount=(cost.monthsToBePaid*Math.round(cost.amountPerMonth*100)/100)*(cost.impounded?1:0);}function getTotalMonthlyImpounds(){if(vm.model&&vm.model.costs){var i;var sum=0;for(i=0;i<vm.model.costs.length;i++){var cost=vm.model.costs[i];if(isSingleMI(cost)){continue;}if(cost.amountPerMonth){sum=sum+parseFloat(cost.amountPerMonth);}}return sum;}}function getTotalEstReserves(hoaAmount){var sum=hoaAmount;if(vm.model&&vm.model.costs){var i;var sum=0;for(i=0;i<vm.model.costs.length;i++){if(vm.model.costs[i].amount){sum=sum+parseFloat(vm.model.costs[i].amount);}}}return sum;}function setHoaMontlyAmount(){if(vm.model&&vm.model.HOAExpens){var periodMonths=vm.getNumberOfMonthsBasedOnPreferredPaymentPeriod(vm.model.HOAExpens.preferredPayPeriod);vm.model.HOAExpens.amountPerMonth=(Math.round((vm.model.HOAExpens.amount/periodMonths)*100)/100);}}function getTotalMonthlyAmountIncludingHOA(hoaAmountPerMonth){return getTotalMonthlyImpounds()+hoaAmountPerMonth;}function costCalculation(cost,purchasePrice,loanAmount,type){var amountForYear;var periodMonths=vm.getNumberOfMonthsBasedOnPreferredPaymentPeriod(cost.preferredPaymentPeriod);var monthlyAmount=cost.amountPerMonth?cost.amountPerMonth:cost.amount/cost.monthsToBePaid;if(cost.hudLineNumber==1002){amountForYear=(cost.percent==0||cost.amountMethod!=srv.AmountMethodEnum.Calculated)?(monthlyAmount*periodMonths):(roundToFourDecimalPlaces((cost.percent*vm.model.loanAmount/1200)*12));}else{if(cost.hudLineNumber==1004){amountForYear=(cost.percent==0||cost.amountMethod!=srv.AmountMethodEnum.Calculated)?(monthlyAmount*periodMonths):(roundToFourDecimalPlaces((cost.percent*vm.model.purchasePrice/1200)*12));}else{amountForYear=monthlyAmount*periodMonths;}}cost.amountPerMonth=roundToFourDecimalPlaces(amountForYear/periodMonths);cost.amountForYear=roundToFourDecimalPlaces(amountForYear);vm.setTotalEstimatedReserves(cost);}function roundToFourDecimalPlaces(number){return(Math.round(number*10000))/10000;}function showAmountMethod(cost,isRefinance,applicationData){if(isRefinance&&cost.hudLineNumber!=1004&&cost.hudLineNumber!=1003){return false;}if(cost.hudLineNumber!=1004&&cost.hudLineNumber!=1002&&cost.hudLineNumber!=1003){return false;}return true;}function isAmountMethodDisabled(isExtended,cost,mortageType){if(!isExtended&&cost.hudLineNumber!=1003){return true;}var isGovtLoan=mortageType===srv.MortageType.FHA||mortageType===srv.MortageType.VA||mortageType===srv.MortageType.USDA;if(cost.hudLineNumber==1003&&isGovtLoan){return true;}return false;}function getAmountMethods(cost,isRefinance,applicationData){if(isRefinance&&cost.hudLineNumber==1004){return applicationData.lookup.costAmountMethodsRefiTax;}if(cost.hudLineNumber==1004){return applicationData.lookup.costAmountMethodsPurchaseTax;}if(cost.hudLineNumber==1002){return applicationData.lookup.costAmountMethodsPurchaseHoi;}if(cost.hudLineNumber==1003){return applicationData.lookup.costAmountMethodsMI;}}function isAmountDisabled(cost,isRefinance){if(cost.hudLineNumber==1004&&cost.amountMethod==srv.AmountMethodEnum.Itemized){return true;}if(!isRefinance&&(cost.amountMethod==undefined||cost.amountMethod==srv.AmountMethodEnum.Calculated)){return cost.percent!=0&&(cost.hudLineNumber==1004||cost.hudLineNumber==1002);}return false;}function isFactorDisabled(cost){if((cost.amountMethod==srv.AmountMethodEnum.Calculated)&&(cost.hudLineNumber==1004||cost.hudLineNumber==1002)){return false;}if(cost.amountMethod==undefined){return false;}return true;}function isPeriodDisabled(cost){var isPurchasePropertyTaxHOIAndCalculated=!vm.model.isRefinance&&cost.amountMethod&&cost.amountMethod==srv.AmountMethodEnum.Calculated&&(cost.hudLineNumber==1004||cost.hudLineNumber==1002);var isPropertyTaxAndItemized=cost.amountMethod==srv.AmountMethodEnum.Itemized&&cost.hudLineNumber==1004;var isMortgageInsurance=cost.hudLineNumber==1003;var isPropertyTaxAndHasNotUserRight=vm.model.isExtended&&cost.hudLineNumber==1004&&!vm.model.applicationData.currentUser.hasPrivilege(vm.enums.privileges.CanEditEscrowsPeriodPayments);var isPropertyTaxAndIsNotEditable=!vm.model.isExtended&&cost.hudLineNumber==1004&&(!vm.model.impoundSchedule||(vm.model.impoundSchedule&&!vm.model.impoundSchedule.editable));return isPurchasePropertyTaxHOIAndCalculated||isPropertyTaxAndItemized||isMortgageInsurance||isPropertyTaxAndHasNotUserRight||isPropertyTaxAndIsNotEditable;}function onAmountMethodChange(cost){if(!vm.model.isRefinance&&cost.amountMethod&&cost.amountMethod==srv.AmountMethodEnum.Calculated&&(cost.hudLineNumber==1004||cost.hudLineNumber==1002)){cost.preferredPaymentPeriod=srv.PeriodTypeEnum.Annually;vm.recalculateCost(cost);}else{if(cost.amountMethod&&cost.amountMethod==srv.AmountMethodEnum.Itemized&&cost.hudLineNumber==1004){cost.preferredPaymentPeriod=srv.PeriodTypeEnum.Annually;cost.amountPerMonth=0;cost.amountForYear=0;vm.recalculateCost(cost);}else{if(cost.hudLineNumber==1003){cost.editMode=false;cost.isLocked=false;if(cost.amountMethod==srv.AmountMethodEnum.MonthlyMI){cost.impounded=true;cost.upfrontPreferredPaymentPeriod=null;}else{cost.impounded=false;if(!cost.upfrontPreferredPaymentPeriod){cost.upfrontPreferredPaymentPeriod=srv.UpfrontPreferredPaymentPeriodEnum.Financed;}}vm.model.MICalculatorRequest.amountMethod=cost.amountMethod;vm.model.MICalculatorRequest.percent=cost.percent;vm.model.MICalculatorRequest.TotalLoanAmount=vm.model.loanAmount;impoundCalculatorSvc.calculateMiAmount.save(vm.model.MICalculatorRequest).$promise.then(function(data){cost.amountPerMonth=data.response.amount;cost.amountForYear=data.response.amount;cost.percent=data.response.percent;},function(err){console.log("Error: ",err);});}}}if(cost.amountMethod&&cost.amountMethod!=srv.AmountMethodEnum.Itemized&&cost.hudLineNumber==1004){vm.clearItemizedPropertyTaxes(cost.itemizedPropertyTaxes);}vm.initializePeriodPaymentMonths(cost);}function clearItemizedPropertyTaxes(itemizedPropertyTaxes){for(var i=0;i<itemizedPropertyTaxes.length;i++){itemizedPropertyTaxes[i].month=0;itemizedPropertyTaxes[i].amount=0;}}function initializePeriodPaymentMonths(cost){if(!!cost.amountPerMonth&&cost.impounded&&cost.amountMethod!=srv.AmountMethodEnum.Itemized&&cost.preferredPaymentPeriod!=srv.PeriodTypeEnum.Monthly&&cost.hudLineNumber!=1003){var numberOfPayments=1;if(cost.preferredPaymentPeriod==srv.PeriodTypeEnum.SemiAnnually){numberOfPayments=2;}if(cost.preferredPaymentPeriod==srv.PeriodTypeEnum.Quarterly){numberOfPayments=4;}if(_.where(cost.periodPaymentMonths,{isRemoved:false}).length==numberOfPayments){return;}var month=1;for(var i=0;i<numberOfPayments;i++){var matchingCost=_.where(cost.periodPaymentMonths,{order:i});if(matchingCost.length==0){var periodPaymentMonth={periodPaymentMonthId:null,costId:matchingCost.costId,order:i,month:null,isRemoved:false};cost.periodPaymentMonths.push(periodPaymentMonth);}else{matchingCost[0].isRemoved=false;matchingCost[0].month=null;}month+=3;}for(var i=0;i<cost.periodPaymentMonths.length;i++){if(cost.periodPaymentMonths[i].order+1>numberOfPayments){cost.periodPaymentMonths[i].isRemoved=true;}}}else{vm.removeAllPeriodPaymentMonths(cost);}}function removeAllPeriodPaymentMonths(cost){for(var i=0;i<cost.periodPaymentMonths.length;i++){cost.periodPaymentMonths[i].isRemoved=true;}}function preferredPaymentPeriodChanged(cost){vm.initializePeriodPaymentMonths(cost);vm.recalculateCost(cost);}function isSingleMI(cost){if(cost.hudLineNumber!=1003){return false;}return(cost.amountMethod==srv.AmountMethodEnum.SinglePremiumNonRefundable||cost.amountMethod==srv.AmountMethodEnum.SinglePremiumRefundable);}function isMonthOfReservesEditable(cost){return cost.hudLineNumber!=1004?false:vm.model.impoundSchedule&&vm.model.impoundSchedule.editable&&cost.impounded;}function onMonthsOfReservesBlur(cost){cost.isLocked=true;}function isPeriodPaymentMonthsDisabled(cost){var isPropertyTaxAndHasNotUserRight=vm.model.isExtended&&cost.hudLineNumber==1004&&!vm.model.applicationData.currentUser.hasPrivilege(vm.enums.privileges.CanEditEscrowsPeriodPayments);var isPropertyTaxAndIsNotEditable=!vm.model.isExtended&&cost.hudLineNumber==1004&&(!vm.model.impoundSchedule||(vm.model.impoundSchedule&&!vm.model.impoundSchedule.editable));return isPropertyTaxAndIsNotEditable||isPropertyTaxAndHasNotUserRight;}}})();var impoundCalculator;(function(impoundCalculator){var ImpoundCalculatorHelpersSvc=(function(){function ImpoundCalculatorHelpersSvc(){this.findImpoundScheduleByStateAndClosingMonth=function(impoundSchedules,state,closingMonth){return lib.findFirst(impoundSchedules,function(item){return item.state==state&&item.month==closingMonth;},null);};this.createMiRequestModel=function(loanVm){var refinancePurposeType=1;if(loanVm.financialInfo.cashOut=="0"){refinancePurposeType=2;}var subjectProperty=loanVm.getSubjectProperty();var miRequest=new srv.cls.MICalculatorRequest();miRequest.amortizationType=loanVm.financialInfo.amortizationType;miRequest.loanAmount=loanVm.loanAmount;miRequest.mortgageType=loanVm.financialInfo.mortgageType;miRequest.term=loanVm.financialInfo.term;miRequest.rate=loanVm.financialInfo.baseInterestRate;miRequest.fixedRateTerm=loanVm.financialInfo.fixedRateTerm;miRequest.mortgageInsuranceType=loanVm.financialInfo.mortgageInsuranceType;miRequest.fico=loanVm.financialInfo.ficoScore;miRequest.state=subjectProperty.stateName,miRequest.currentEstimatedValue=subjectProperty.currentEstimatedValue;miRequest.purchasePrice=subjectProperty.purchasePrice;miRequest.loanPurposeType=loanVm.loanPurposeType;miRequest.refinancePurposeType=refinancePurposeType;miRequest.occupancyType=subjectProperty.occupancyType;return miRequest;};}ImpoundCalculatorHelpersSvc.$inject=[];ImpoundCalculatorHelpersSvc.className="ImpoundCalculatorHelpersSvc";return ImpoundCalculatorHelpersSvc;})();impoundCalculator.ImpoundCalculatorHelpersSvc=ImpoundCalculatorHelpersSvc;angular.module("impoundCalculator").service(ImpoundCalculatorHelpersSvc.className,ImpoundCalculatorHelpersSvc);})(impoundCalculator||(impoundCalculator={}));(function(){angular.module("loanDetails",["multiborrowerPopover"]);})();(function(){angular.module("loanDetails").provider("loanDetailsResolver",loanDetailsResolver);function loanDetailsResolver(){this.$get=function(){return resolver;};function resolver(enums,$stateParams){var service={getLockColor:getLockColor,getLockExpirationText:getLockExpirationText,productInfoHeight:false,repricing:false};service.repricing=$stateParams["repricing"];function getLockColor(){return enums.iconColors.active;}function getLockExpirationText(){return"Expired";}return service;}}})();(function(){angular.module("loanDetails").factory("loanDetailsSvc",loanDetailsSvc);loanDetailsSvc.$inject=["$resource","apiRoot","enums","CreditStateService"];function loanDetailsSvc($resource,ApiRoot,enums,CreditStateService){var loanDetailsApiPath=ApiRoot+"LoanDetails/";var loanDetailsSectionVIIPopupApiPath=ApiRoot+"SectionVIIPopup/";var closingDateApiPath=ApiRoot+"ClosingDatePopup/";var pricingResultsApiPath=ApiRoot+"PricingResults/";var repriceEngine=$resource(pricingResultsApiPath,{},{reprice:{method:"PUT",params:{currentUserId:"currentUserId"}}});var getLiabilitesBalance=getLiabilitesBalance;function getLiabilitesBalance(borrower){var calculateModel=borrower.getLiability();return sumTotalLiabilityBalance(calculateModel);}function calculatePaymentAndMI(payment,mortgageInsurance){return +payment.toFixed(2)+ +mortgageInsurance.toFixed(2);}function getMIAmount(isNewLoan,costsFunc,loanPurposeType,occupancyType,subjectPropertyFunc,borrowerCurrentAddressFunc,mtgExpenseEnum){if(!isNewLoan){return getCurrentExpenseByType(loanPurposeType,occupancyType,subjectPropertyFunc,borrowerCurrentAddressFunc,mtgExpenseEnum).monthlyAmount;}return getCosts(1003,costsFunc).amountPerMonth;}var getPrice=getPrice;function getPrice(wrappedLoan){return{pricingEngine:100-wrappedLoan.financialInfo.adjustedPoints,amount:wrappedLoan.financialInfo.adjustedPoints/100*wrappedLoan.detailsOfTransaction.totalLoanAmount};}var UpdateData=$resource(loanDetailsSectionVIIPopupApiPath+":id",{},{UpdateVIIPoupData:{method:"PUT"}});var updateClosingDate=$resource(closingDateApiPath,{},{updateClosingDate:{method:"PUT",params:{loanId:"loanId",userAccountId:"userAccountId"}}});var getFinancialInfo=$resource(loanDetailsApiPath+"GetFinancialInfo",{},{getFinancialInfo:{method:"GET",params:{loanId:"loanId"}}});var getComplianceDate=$resource(loanDetailsApiPath+"GetComplianceDate",{},{getComplianceDate:{method:"GET",params:{appDate:"appDate",stateName:"stateName"}}});var exportAditionalFieldsToEncompass=$resource(ApiRoot+"/Encompass/ExportAdditionalFields",{loanVm:"@loanVm"},{exportData:{method:"POST"}});function getCurrentProperty(loanPurposeType,occupancyType,subjectPropertyCb,currentAddressCb){occupancyType=parseInt(occupancyType);loanPurposeType=parseInt(loanPurposeType);var currentProperty=null;if(loanPurposeType==srv.LoanPurposeTypeEnum.Refinance&&occupancyType==srv.PropertyUsageTypeEnum.PrimaryResidence){currentProperty=subjectPropertyCb();}else{currentProperty=currentAddressCb();}return currentProperty;}function getCurrentPropertyExpenseValue(propertyExpense){if(propertyExpense){return propertyExpense;}return{monthlyAmount:0,impounded:false};}function getCosts(hudLineNumber,getCostsCb){var costs=getCostsCb();if(costs){for(var i=0;i<costs.length;i++){if((!costs[i].originalHUDLineNumber||costs[i].originalHUDLineNumber==0||costs[i].originalHUDLineNumber==hudLineNumber)&&costs[i].hudLineNumber==hudLineNumber){return costs[i];}}}return{amountPerMonth:0,impounded:false};}function getCurrentExpenseByType(loanPurposeType,occupancyType,subjectPropertyCb,currentAddressCb,expenseType){var currentProperty=getCurrentProperty(loanPurposeType,occupancyType,subjectPropertyCb,currentAddressCb);if(currentProperty){switch(expenseType){case enums.housingExpenses.homeOwnerExpense:return getCurrentPropertyExpenseValue(currentProperty.homeOwnerExpense);case enums.housingExpenses.floodInsuranceExpense:return getCurrentPropertyExpenseValue(currentProperty.floodInsuranceExpense);case enums.housingExpenses.mortgageInsuranceExpense:return getCurrentPropertyExpenseValue(currentProperty.mortgageInsuranceExpense);case enums.housingExpenses.propertyTaxExpense:return getCurrentPropertyExpenseValue(currentProperty.propertyTaxExpense);case enums.housingExpenses.HOAExpense:return getCurrentPropertyExpenseValue(currentProperty.hoaDuesExpense);}}return{monthlyAmount:0,impounded:false};}function totalCurrentExpenses(rent,firtMtgPi,secondMtgPi,loanPurposeType,occupancyType,subjectPropertyCb,currentAddressCb,addlMortgagees){var total=0;total+=roundToFourDecimalPlaces(rent);total+=roundToFourDecimalPlaces(firtMtgPi);total+=roundToFourDecimalPlaces(secondMtgPi);total+=roundToFourDecimalPlaces(getCurrentExpenseByType(loanPurposeType,occupancyType,subjectPropertyCb,currentAddressCb,enums.housingExpenses.homeOwnerExpense).monthlyAmount);total+=roundToFourDecimalPlaces(getCurrentExpenseByType(loanPurposeType,occupancyType,subjectPropertyCb,currentAddressCb,enums.housingExpenses.floodInsuranceExpense).monthlyAmount);total+=roundToFourDecimalPlaces(getCurrentExpenseByType(loanPurposeType,occupancyType,subjectPropertyCb,currentAddressCb,enums.housingExpenses.propertyTaxExpense).monthlyAmount);total+=roundToFourDecimalPlaces(getCurrentExpenseByType(loanPurposeType,occupancyType,subjectPropertyCb,currentAddressCb,enums.housingExpenses.mortgageInsuranceExpense).monthlyAmount);total+=roundToFourDecimalPlaces(getCurrentExpenseByType(loanPurposeType,occupancyType,subjectPropertyCb,currentAddressCb,enums.housingExpenses.HOAExpense).monthlyAmount);if(!(common.objects.isNullOrUndefined(addlMortgagees))){total+=addlMortgagees;}return total;}function getAdditionalMortgages(loanApplications,loanPurposeType,occupancyType,subjectPropertyCb,currentAddressCb,getPrimaryLoanAppCb){var total=0;var usedPropertyID=[];usedPropertyID=checkIfpropertyExpensesHaveBeenAlreadyInculede(loanPurposeType,occupancyType,subjectPropertyCb,currentAddressCb,getPrimaryLoanAppCb,usedPropertyID);for(var i=0;i<loanApplications.length;i++){if(!loanApplications[i].isPrimary){var loanApp=loanApplications[i];if(loanApp.getBorrower().getCurrentAddress()&&loanApp.getBorrower().getCurrentAddress().monthlyRent&&loanApp.getBorrower().getCurrentAddress().ownership==1){total+=roundToFourDecimalPlaces(loanApp.getBorrower().getCurrentAddress().monthlyRent);}if(loanApp.getCoBorrower()&&loanApp.getCoBorrower().getCurrentAddress()&&loanApp.getCoBorrower().getCurrentAddress().monthlyRent&&loanApp.getCoBorrower().getCurrentAddress().ownership==1){total+=roundToFourDecimalPlaces(loanApp.getCoBorrower().getCurrentAddress().monthlyRent);}if(loanApp.reos&&loanApp.reos.length>0){for(var j=0;j<loanApp.reos.length;j++){if(loanApp.reos[j].property&&loanApp.getBorrower()&&loanApp.getBorrower().getCurrentAddress()&&loanApp.reos[j].property.propertyId==loanApp.getBorrower().getCurrentAddress().propertyId&&loanApp.reos[j].payoffCommentId!=enums.PledgedAssetComment.PaidOffFreeAndClear&&loanApp.reos[j].payoffCommentId!=enums.PledgedAssetComment.Sold&&loanApp.reos[j].payoffCommentId!=enums.PledgedAssetComment.NotMyLoan){total+=roundToFourDecimalPlaces(loanApp.reos[j].minPayment);if(usedPropertyID.indexOf(loanApp.reos[j].property.propertyId)<0){usedPropertyID.push(loanApp.reos[j].property.propertyId);total+=sumNonImpoundedExpeses(loanApp.reos[j].property);}}}}}}return total;}function isMoreThan2Mortgages(pledgedAssets){var filteredPledgedAssets=null;if(pledgedAssets&&pledgedAssets.length>0){filteredPledgedAssets=pledgedAssets.filter(function(pa){return pa.lienPosition>1&&pa.borrowerDebtCommentId!=srv.pledgedAssetCommentType.Sold&&pa.borrowerDebtCommentId!=srv.pledgedAssetCommentType.NotMyLoan&&pa.borrowerDebtCommentId!=srv.pledgedAssetCommentType.PaidOffFreeAndClear&&pa.getProperty()&&(pa.getProperty().occupancyType==srv.PropertyUsageTypeEnum.PrimaryResidence||pa.getProperty().addressTypeId==srv.AddressTypeEnum.Present);});}return(filteredPledgedAssets&&filteredPledgedAssets.length>1);}var loanDetailService={UpdateVIIPoupData:UpdateData,updateClosingDate:updateClosingDate,getLiabilitesBalance:getLiabilitesBalance,getPrice:getPrice,RepriceEngine:repriceEngine,getComplianceDate:getComplianceDate,getCurrentProperty:getCurrentProperty,getCosts:getCosts,totalCurrentExpenses:totalCurrentExpenses,getCurrentExpenseByType:getCurrentExpenseByType,getCurrentPropertyExpenseValue:getCurrentPropertyExpenseValue,getAdditionalMortgages:getAdditionalMortgages,getOtherPayments:getOtherPayments,getCacheFlowAdditionalMorgages:getCacheFlowAdditionalMorgages,calculatePaymentAndMI:calculatePaymentAndMI,getMIAmount:getMIAmount,isMoreThan2Mortgages:isMoreThan2Mortgages,exportAdditionalFieldsToEncompassCb:exportAdditionalFieldsToEncompassCb};function sumTotalLiabilityBalance(model){var total=0;angular.forEach(model,function(item){if(!item.isRemoved&&item.minPayment){total+=parseFloat(item.minPayment);}});return total;}function roundToFourDecimalPlaces(value){return value?Math.round(value*10000)/10000:0;}function checkIfpropertyExpensesHaveBeenAlreadyInculede(loanPurposeType,occupancyType,subjectPropertyCb,currentAddressCb,getPrimaryLoanAppCb,usedPropertyID){var result=false;var currentPrimaryProperty=getCurrentProperty(loanPurposeType,occupancyType,subjectPropertyCb,currentAddressCb);if(currentPrimaryProperty&&getPrimaryLoanAppCb()&&getPrimaryLoanAppCb().reos){var primaryBorrowerREOs=getPrimaryLoanAppCb().reos;for(var n=0;n<primaryBorrowerREOs.length;n++){if(primaryBorrowerREOs.property){if(primaryBorrowerREOs[n].property.propertyId==currentPrimaryProperty.propertyId){usedPropertyID.push(currentPrimaryProperty.propertyId);break;}}else{continue;}}}return usedPropertyID;}function sumNonImpoundedExpeses(propertyItem){var total=0;if(propertyItem&&propertyItem.propertyExpenses){for(var k=0;k<propertyItem.propertyExpenses.length;k++){total+=propertyItem.propertyExpenses[k].impounded?0:roundToFourDecimalPlaces(propertyItem.propertyExpenses[k].monthlyAmount);}}return total;}function getOtherPayments(context,loanPurposeType,usePrimaryLoanApp){if(usePrimaryLoanApp===undefined||usePrimaryLoanApp==null){return 0;}if(usePrimaryLoanApp==true){var otherPaymentTotal=CreditStateService.summateLiabiltyPaymentPrimary(context);}else{var otherPaymentTotal=CreditStateService.summateLiabilityPaymentAdditionalMortgages(context);}var primaryPayment=0;var additionalLiabilitiesPayment=0;if(loanPurposeType==enums.LoanTransactionTypes.Refinance){angular.forEach(CreditStateService.wrappedLoan.ref.getLoanApplications(),function(loanApplication){if((context==srv.BorrowerContextTypeEnum.Borrower&&loanApplication.getBorrower())||(context==srv.BorrowerContextTypeEnum.CoBorrower&&loanApplication.getCoBorrower()&&loanApplication.isSpouseOnTheLoan)||context==srv.BorrowerContextTypeEnum.Both){if(usePrimaryLoanApp&&loanApplication.isPrimary){primaryPayment+=getOtherPaymentsFromReo(loanApplication.reos);}else{if(!usePrimaryLoanApp&&!loanApplication.isPrimary){additionalLiabilitiesPayment+=getOtherPaymentsFromReo(loanApplication.reos);}}}});}var pred=function(miscDebt){return miscDebt.typeId==srv.MiscellaneousDebtTypes.ChildCareExpensesForVALoansOnly;};var accessor=function(l){return l.amount;};var childCareExpenses=0;if((context==srv.BorrowerContextTypeEnum.Borrower||context==srv.BorrowerContextTypeEnum.Both)&&CreditStateService.wrappedLoan.ref.primary.getBorrower()&&CreditStateService.wrappedLoan.ref.primary.getBorrower().getMiscDebts()&&CreditStateService.wrappedLoan.ref.primary.getBorrower().getMiscDebts().filter(function(i){return(i.typeId==srv.MiscellaneousDebtTypes.ChildCareExpensesForVALoansOnly);})){if(usePrimaryLoanApp){childCareExpenses+=lib.summate(CreditStateService.wrappedLoan.ref.primary.getBorrower().getMiscDebts(),pred,accessor);}else{if(!usePrimaryLoanApp){childCareExpenses+=getChildCareForAdditionalApp(pred,accessor,srv.BorrowerTypeEnum.Borrower);}}}if((context==srv.BorrowerContextTypeEnum.CoBorrower||context==srv.BorrowerContextTypeEnum.Both)&&CreditStateService.wrappedLoan.ref.primary.isSpouseOnTheLoan&&CreditStateService.wrappedLoan.ref.primary.getCoBorrower()&&CreditStateService.wrappedLoan.ref.primary.getCoBorrower().getMiscDebts()&&CreditStateService.wrappedLoan.ref.primary.getCoBorrower().getMiscDebts().filter(function(i){return(i.typeId==srv.MiscellaneousDebtTypes.ChildCareExpensesForVALoansOnly);})){if(usePrimaryLoanApp){childCareExpenses+=lib.summate(CreditStateService.wrappedLoan.ref.primary.getCoBorrower().getMiscDebts(),pred,accessor);}else{if(!usePrimaryLoanApp){childCareExpenses+=getChildCareForAdditionalApp(pred,accessor,srv.BorrowerTypeEnum.CoBorrower);}}}return otherPaymentTotal+primaryPayment+additionalLiabilitiesPayment+childCareExpenses;}function getChildCareForAdditionalApp(pred,accessor,borrowerType){var childCareExpenses=0;angular.forEach(CreditStateService.wrappedLoan.ref.getLoanApplications(),function(loanApplication){if(!loanApplication.isPrimary){if(borrowerType==srv.BorrowerTypeEnum.Borrower){childCareExpenses+=lib.summate(loanApplication.getBorrower().getMiscDebts(),pred,accessor);}if(borrowerType==srv.BorrowerTypeEnum.CoBorrower){childCareExpenses+=lib.summate(loanApplication.getCoBorrower().getMiscDebts(),pred,accessor);}}});return childCareExpenses;}function getOtherPaymentsFromReo(reos){var otherPaymentTotal=0;angular.forEach(reos,function(reoItem){if(!reoItem.isRemoved&&reoItem.getProperty()&&reoItem.getProperty().OccupancyType==srv.PropertyUsageTypeEnum.SecondVacationHome){if(!reoItem.getProperty().isSubjectProperty){if(reoItem.payoffCommentId==enums.PledgedAssetComment.PayoffAtClose||(reoItem.pledgedAssetLoanType!=enums.PledgedAssetLoanType.Heloc&&(reoItem.payoffCommentId==enums.PledgedAssetComment.PayoffAtClosingAndDontCloseAccount||reoItem.payoffCommentId==enums.PledgedAssetComment.PayoffAtClosingAndCloseAccount))){otherPaymentTotal+=roundToFourDecimalPlaces(reoItem.getProperty().sumPropertyExpenses());}else{if(reoItem.payoffCommentId==enums.PledgedAssetComment.DoNotPayoff){otherPaymentTotal+=roundToFourDecimalPlaces(CreditStateService.setTotalPaymentsDisplayValue(reoItem));}}}}});return otherPaymentTotal;}function getCacheFlowAdditionalMorgages(isNegative,context){var total=0;angular.forEach(CreditStateService.wrappedLoan.ref.getLoanApplications(),function(loanApplication){if(!loanApplication.isPrimary){if(context==srv.BorrowerContextTypeEnum.Borrower){total+=CreditStateService.wrappedLoan.ref.getCashFlowForNetRentalIncomes(loanApplication.getBorrower(),isNegative);}else{if(context==srv.BorrowerContextTypeEnum.CoBorrower){total+=CreditStateService.wrappedLoan.ref.getCashFlowForNetRentalIncomes(loanApplication.getCoBorrower(),isNegative);}}}});return total;}function exportAdditionalFieldsToEncompassCb(wrappedLoan){if(wrappedLoan.ref.housingExpenses){wrappedLoan.ref.housingExpenses.paymentWithMI=wrappedLoan.ref.housingExpenses.firstMtgPi+getCurrentExpenseByType(wrappedLoan.ref.loanPurposeType,wrappedLoan.ref.getSubjectProperty().occupancyType,wrappedLoan.ref.getSubjectProperty,wrappedLoan.ref.primary.getBorrower().getCurrentAddress,enums.housingExpenses.mortgageInsuranceExpense).monthlyAmount;wrappedLoan.ref.housingExpenses.totalMonthlyMortgageObligation=totalCurrentExpenses(wrappedLoan.ref.housingExpenses.rent,wrappedLoan.ref.housingExpenses.firstMtgPi,wrappedLoan.ref.housingExpenses.secondMtgPi,wrappedLoan.ref.loanPurposeType,wrappedLoan.ref.getSubjectProperty(),wrappedLoan.ref.getSubjectProperty(),wrappedLoan.ref.primary.getBorrower().getCurrentAddress)+getAdditionalMortgages(wrappedLoan.ref.getLoanApplications(),wrappedLoan.ref.loanPurposeType,wrappedLoan.ref.getSubjectProperty().occupancyType,wrappedLoan.ref.getSubjectProperty,wrappedLoan.ref.primary.getBorrower().getCurrentAddress,function(){return wrappedLoan.ref.primary;});}exportAditionalFieldsToEncompass.exportData(wrappedLoan.ref).$promise.then(function(success){console.log("Additional fields successfully exported!");},function(error){console.warn("exportAdditionalFieldsToEncompassCb:: Updating additional fields failed!");});}return loanDetailService;}})();(function(){angular.module("loanDetails").controller("loanDetailsController",loanDetailsController);loanDetailsController.$inject=["$log","$scope","$modal","$modalStack","$state","$filter","loanDetailsSvc","modalPopoverFactory","calculatorSvc","$controller","$interval","wrappedLoan","controllerData","applicationData","enums","encompassSvc","NavigationSvc","digitaldocSvc","loanEvent","commonModalWindowFactory","modalWindowType","costDetailsHelpers","$timeout","BroadcastSvc","costDetailsSvc","discloseActions","exportToEncompassActions","userAccountId","DocumentsService","commonCalculatorSvc","vaCenterService","CreditStateService"];function loanDetailsController($log,$scope,$modal,$modalStack,$state,$filter,loanDetailsSvc,modalPopoverFactory,calculatorSvc,$controller,$interval,wrappedLoan,controllerData,applicationData,enums,encompassSvc,NavigationSvc,digitaldocSvc,loanEvent,commonModalWindowFactory,modalWindowType,costDetailsHelpers,$timeout,BroadcastSvc,costDetailsSvc,discloseActions,exportToEncompassActions,userAccountId,DocumentsService,commonCalculatorSvc,vaCenterService,CreditStateService){var vm=this;vm.wrappedLoan=wrappedLoan;vm.canFlip=vm.wrappedLoan.ref.leadManagerId!==undefined&&vm.wrappedLoan.ref.leadManagerId.length>0&&(vm.wrappedLoan.ref.product.programName==""||vm.wrappedLoan.ref.product.programName==undefined||vm.wrappedLoan.ref.product.programName==null);vm.flipPurpose=flipPurpose;CreditStateService.initializeLoan(wrappedLoan);vm.loanDetailsSvc=loanDetailsSvc;vm.controllerData=controllerData;vm.LoanDetailsViewModel=[];vm.CalculatorViewModel=[];vm.applicationData=applicationData;vm.borrowers=[{name:"Anakin Sykwalker",coname:"Luke Skywalker",price:"$100.00"},{name:"Anakin Sykwalker",coname:"Luke Skywalker",price:"$100.00"},{name:"Anakin Sykwalker",coname:"Luke Skywalker",price:"$100.00"},{name:"Luke Skywalker",coname:"Tim Skywalker",price:"$50.00"},{name:"Darth Vader",coname:"Murga Skywalker",price:"$900.00"}];vm.amortizationType=null;vm.showClosingDate=showClosingDate;vm.onDownPaymentChange=onDownPaymentChange;vm.onDownPaymentPercentChange=onDownPaymentPercentChange;vm.onPurchasePriceChange=onPurchasePriceChange;vm.onLoanAmountChange=onLoanAmountChange;vm.enums=enums;vm.grandTotal=getGrandTotal();vm.userAccountId=userAccountId;vm.getDownPaymentSourceText=getDownPaymentSourceText;vm.getDefaultPricingAction=getDefaultPricingAction;vm.checkExportToEncompassActions=checkExportToEncompassActions;vm.pricingActions=[{name:"Update pricing",value:1},{name:"Shop for Rates",value:2}];vm.saveDiscloseActions=discloseActions;vm.exportToEncompassActions=exportToEncompassActions;vm.complianceDate="";initializeComplianceDate();checkSaveDiscloseActions();vm.pricingAction=getDefaultPricingAction();vm.saveDiscloseAction=getDefaultSaveDiscloseAction();vm.showPricingAction=showPricingAction;vm.callPricingAction=callPricingAction;vm.pricingInfo=pricingInfo;vm.showAppraisalContingencyDatePopup=showAppraisalContingencyDatePopup;vm.showApprovalContingencyDatePopup=showApprovalContingencyDatePopup;vm.showSaveDiscloseAction=showSaveDiscloseAction;vm.callSaveDiscloseAction=callSaveDiscloseAction;vm.callExportToEncompassAction=callExportToEncompassAction;vm.disablePricingButton=disablePricingButton;vm.disableExportToEncompass=disableExportToEncompass;vm.exportToEncompass=exportToEncompass;vm.disableDisclosuresCall=false;vm.closeAllModals=closeAllModals();vm.repriceLoan=repriceLoan;vm.bottomButtonPricingAction=bottomButtonPricingAction;vm.submitForApproval=submitForApproval;vm.submitForApprovalAction=submitForApprovalAction;vm.isApprovalDisabled=isApprovalDisabled;vm.checkPricingTimespan=checkPricingTimespan;vm.lowerDecisionScore=getLowestMiddleFicoScore;vm.cancel=cancel;vm.bankStatementForIncome=getBankStatementsForIncome();vm.getBorrowerOtherPayment=getBorrowerOtherPayment;vm.getCoBorrowerOtherPayment=getCoBorrowerOtherPayment;vm.getAdditionalMortgages=getAdditionalMortgages;vm.additionalMortgageesIncome=getAdditionalMortgageesIncome();vm.getOtherIncomeBorrower=getOtherIncomeBorrower();vm.getOtherIncomeCoBorrower=getOtherIncomeCoBorrower();vm.otherIncomeTotalForBorrowerAndCoborrower=getOtherIncomeTotalForBorrowerAndCoborrower();function getOtherIncomeBorrower(){var result=wrappedLoan.ref.getOtherIncomeSumForBorrowerWithMiscExpenses(wrappedLoan.ref.primary.getBorrower());return result;}function getOtherIncomeCoBorrower(){var result=wrappedLoan.ref.getOtherIncomeSumForBorrowerWithMiscExpenses(wrappedLoan.ref.primary.getCoBorrower());return result;}function getOtherIncomeTotalForBorrowerAndCoborrower(){var result=getOtherIncomeBorrower()+getOtherIncomeCoBorrower();return result;}function getBorrowerOtherPayment(){return loanDetailsSvc.getOtherPayments(0,wrappedLoan.ref.loanPurposeType,true);}function getCoBorrowerOtherPayment(){return loanDetailsSvc.getOtherPayments(1,wrappedLoan.ref.loanPurposeType,true);}function getAdditionalMortgageesIncome(){var total=0;var pred=function(miscDebt){return miscDebt.typeId==srv.MiscellaneousDebtTypes.Expenses2106FromTaxReturns;};var accessor=function(l){return l.amount;};for(var i=0;i<wrappedLoan.ref.getLoanApplications().length;i++){if(!wrappedLoan.ref.getLoanApplications()[i].isPrimary){total+=wrappedLoan.ref.getCashFlowForNetRentalIncomes(wrappedLoan.ref.getLoanApplications()[i].getBorrower(),false)+wrappedLoan.ref.incomeTotalForBorrowerWithMiscExpenses(wrappedLoan.ref.getLoanApplications()[i].getBorrower(),true);total+=wrappedLoan.ref.getCashFlowForNetRentalIncomes(wrappedLoan.ref.getLoanApplications()[i].getCoBorrower(),false)+wrappedLoan.ref.incomeTotalForBorrowerWithMiscExpenses(wrappedLoan.ref.getLoanApplications()[i].getCoBorrower(),true);if(wrappedLoan.ref.getLoanApplications()[i].getBorrower()&&wrappedLoan.ref.getLoanApplications()[i].getBorrower().getMiscDebts()){total-=lib.summate(wrappedLoan.ref.getLoanApplications()[i].getBorrower().getMiscDebts(),pred,accessor);}if(wrappedLoan.ref.getLoanApplications()[i].isSpouseOnTheLoan&&wrappedLoan.ref.getLoanApplications()[i].getCoBorrower()&&wrappedLoan.ref.getLoanApplications()[i].getCoBorrower().getMiscDebts()){total-=lib.summate(wrappedLoan.ref.getLoanApplications()[i].getCoBorrower().getMiscDebts(),pred,accessor);}}}return total;}NavigationSvc.contextualType=enums.ContextualTypes.LoanDetails;function pricingInfo(){return loanDetailsSvc.getPrice(wrappedLoan.ref);}function getLowestMiddleFicoScore(){var midFicoScore=commonCalculatorSvc.GetLowestMiddleFicoScore(vm.wrappedLoan,applicationData);return midFicoScore;}function getBankStatementsForIncome(){var bankStatementIncome="";if(wrappedLoan.ref.otherInterviewData.searchCriteria.bankStatementsIncome=="0"){bankStatementIncome="NA (Stated or Paystubs / W-2)";}else{if(wrappedLoan.ref.otherInterviewData.searchCriteria.bankStatementsIncome=="1"){bankStatementIncome="6 Months";}else{if(wrappedLoan.ref.otherInterviewData.searchCriteria.bankStatementsIncome=="2"){bankStatementIncome="12 Months";}else{if(wrappedLoan.ref.otherInterviewData.searchCriteria.bankStatementsIncome=="3"){bankStatementIncome="24 Months";}}}}return bankStatementIncome;}function repriceLoan(successAdditionalCallback){commonModalWindowFactory.open({type:modalWindowType.loader,message:"Updating Pricing"});if(wrappedLoan.ref.getSubjectProperty().stateName==""){try{wrappedLoan.ref.getSubjectProperty().stateName=applicationData.lookup.states.filter(function(e){return e.value==wrappedLoan.ref.getSubjectProperty().stateId.toString();})[0].text;}catch(e){return;}}loanDetailsSvc.RepriceEngine.reprice({currentUserId:applicationData.currentUserId},wrappedLoan.ref).$promise.then(function(data){wrappedLoan.ref=new cls.LoanViewModel(data,$filter);costDetailsHelpers.initializeCostService(wrappedLoan);costDetailsHelpers.getCostDetailsData();loanEvent.broadcastPropertyChangedEvent(events.LoanFieldIdentifier.todo);BroadcastSvc.broadcastUpdateSectionSeven();closeAllModals();if(successAdditionalCallback){successAdditionalCallback();}else{commonModalWindowFactory.open({type:modalWindowType.success,message:"Pricing Updated Successfully!"});}},function(){closeAllModals();commonModalWindowFactory.open({type:modalWindowType.unsuccess,message:"This loan product is no longer eligible, would you like to shop for rates?",ctrl:vm,ctrlButtons:[{title:"Shop for Rates",styleClass:"imp-button-div-hs-ws-prim",width:"140px",height:"30px",callback:"bottomButtonPricingAction"}]});});}function closeAllModals(){$modalStack.dismissAll("close");}if(vm.wrappedLoan.ref.financialInfo.amortizationType){switch(vm.wrappedLoan.ref.financialInfo.amortizationType){case srv.AmortizationType.None:vm.amortizationType="None";return;case srv.AmortizationType.Fixed:vm.amortizationType="Fixed";return;case srv.AmortizationType.ARM:vm.amortizationType="ARM";return;case srv.AmortizationType.GPM:vm.amortizationType="GPM";return;case srv.AmortizationType.Other:vm.amortizationType="Other";return;}}function getAdditionalMortgages(context){var total=0;total+=loanDetailsSvc.getOtherPayments(context,wrappedLoan.ref.loanPurposeType,false);total+=loanDetailsSvc.getCacheFlowAdditionalMorgages(true,context);return total;}function getAdditionalMortgageesAssets(){var total=0;for(var i=0;i<wrappedLoan.ref.getLoanApplications().length;i++){if(!wrappedLoan.ref.getLoanApplications()[i].isPrimary){total+=wrappedLoan.ref.getFinancialsTotal(wrappedLoan.ref.getLoanApplications()[i],"borrower");total+=wrappedLoan.ref.getAutomobilesTotal(wrappedLoan.ref.getLoanApplications()[i],"borrower");total+=wrappedLoan.ref.getLifeInsuranceTotal(wrappedLoan.ref.getLoanApplications()[i],"borrower");total+=wrappedLoan.ref.getFinancialsTotal(wrappedLoan.ref.getLoanApplications()[i],"coborrower");total+=wrappedLoan.ref.getAutomobilesTotal(wrappedLoan.ref.getLoanApplications()[i],"coborrower");total+=wrappedLoan.ref.getLifeInsuranceTotal(wrappedLoan.ref.getLoanApplications()[i],"coborrower");}}return total;}function getGrandTotal(){var total=0;var isJoint;for(var i=0;i<wrappedLoan.ref.getLoanApplications().length;i++){isJoint=wrappedLoan.ref.getLoanApplications()[i].isSpouseOnTheLoan;total+=wrappedLoan.ref.getFinancialsTotal(wrappedLoan.ref.getLoanApplications()[i],"borrower");total+=!isJoint?0:wrappedLoan.ref.getFinancialsTotal(wrappedLoan.ref.getLoanApplications()[i],"coborrower");total+=wrappedLoan.ref.getAutomobilesTotal(wrappedLoan.ref.getLoanApplications()[i],"borrower");total+=!isJoint?0:wrappedLoan.ref.getAutomobilesTotal(wrappedLoan.ref.getLoanApplications()[i],"coborrower");total+=wrappedLoan.ref.getLifeInsuranceTotal(wrappedLoan.ref.getLoanApplications()[i],"borrower");total+=!isJoint?0:wrappedLoan.ref.getLifeInsuranceTotal(wrappedLoan.ref.getLoanApplications()[i],"coborrower");}return total;}function init(){calculatorSvc.GetImpounds.GetImpounds({loanId:$scope.selectedLoanId}).$promise.then(function(data){$log.debug("Retrieved data"+data);vm.CalculatorViewModel=data;},function(error){$log.error("Failure loading Impound Calculator data",error);});}function checkSaveDiscloseActions(){lib.forEach(vm.saveDiscloseActions,function(action){if(action.name==srv.loanDetailsActions.RunComplianceCheck){if(!vm.wrappedLoan.ref.sixPiecesAcquiredForAllLoanApplications||disableExportToEncompass()){action.disabled=true;}else{action.disabled=false;}}if(action.name==srv.loanDetailsActions.CreateInitialDisclosures||action.name==srv.loanDetailsActions.CreateInitialLockDisclosures){if(isDisclosuresButtonDisabled()){action.disabled=true;}else{action.disabled=false;}}});}function initializeComplianceDate(){var appDate=vm.wrappedLoan.ref.applicationDate;if(!vm.wrappedLoan.ref.applicationDate||!common.date.isValidDate(vm.wrappedLoan.ref.applicationDate)){appDate=new Date();}vm.loanDetailsSvc.getComplianceDate.getComplianceDate({appDate:appDate,stateName:vm.wrappedLoan.ref.getSubjectProperty().stateName}).$promise.then(function(data){if(data&&data.complianceDate){vm.complianceDate=(moment(data.complianceDate)).format("MM/DD/YY HH:mm");checkExportToEncompassActions();}},function(errorMsg){$log.error(errorMsg);});}function areDisclosuresSignedByAnyBorrower(){var signed=false;lib.forEach(vm.wrappedLoan.ref.getLoanApplications(),function(la){var borrower=la.getBorrower();if(borrower.eApprovalConfirmation&&borrower.eApprovalConfirmation.confirmationCodeConfirmed){signed=true;return;}var coBorrower=la.getCoBorrower();if(coBorrower.eApprovalConfirmation&&coBorrower.eApprovalConfirmation.confirmationCodeConfirmed){signed=true;return;}});return signed;}function checkExportToEncompassActions(triggeredAsCallback){lib.forEach(vm.exportToEncompassActions,function(action){action.disabled=false;});vm.exportToEncompassAction=lib.findFirst(vm.exportToEncompassActions,function(x){return x.value==enums.requestExportToEncompassAction.ExportToEncompass;});if(vm.wrappedLoan.ref.loanNumber&&vm.wrappedLoan.ref.loanNumber!="Pending"){toggleAction(vm.exportToEncompassActions,enums.requestExportToEncompassAction.ExportToEncompass,true);vm.exportToEncompassAction=lib.findFirst(vm.exportToEncompassActions,function(x){return x.value==enums.requestExportToEncompassAction.UpdateEncompass;});if(areDisclosuresSignedByAnyBorrower()||moment(new Date()).diff(vm.complianceDate)>0){toggleAction(vm.exportToEncompassActions,enums.requestExportToEncompassAction.UpdateEncompass,true);vm.exportToEncompassAction=lib.findFirst(vm.exportToEncompassActions,function(x){return x.value==enums.requestExportToEncompassAction.UpdateiMP;});}if(triggeredAsCallback){loanDetailsSvc.exportAdditionalFieldsToEncompassCb(wrappedLoan);}}else{toggleAction(vm.exportToEncompassActions,enums.requestExportToEncompassAction.UpdateEncompass,true);toggleAction(vm.exportToEncompassActions,enums.requestExportToEncompassAction.UpdateiMP,true);}}function toggleAction(actions,actionName,value){lib.forEach(actions,function(action){if(action.value==actionName){action.disabled=value;}});}function getDefaultSaveDiscloseAction(){return vm.saveDiscloseActions[0];}function showSaveDiscloseAction(item,$event){if(item.value==2&&vm.disableDisclosuresCall){$event.stopPropagation();}else{vm.saveDiscloseAction=item;}}function callSaveDiscloseAction(selectedItem){var canCallDisclosures=checkPricingTimespan();var isTestMode=vm.applicationData.integrationSettings.testModeProductPopup;var isLock=selectedItem.value==enums.requestDisclosureAction.CreateGFELock||selectedItem.value==enums.requestDisclosureAction.CreateTRIDLock;var isComplianceCheck=enums.requestDisclosureAction.ComplianceCheck==selectedItem.value;if(selectedItem.value==enums.requestDisclosureAction.SaveLoanAplication){saveAll();}else{if(vm.wrappedLoan.ref.vaInformation&&vm.wrappedLoan.ref.vaInformation.isvaLoan){vaCenterService.isVAFeeLimitExceeded(vm.wrappedLoan.ref.closingCost,vm.wrappedLoan.ref.detailsOfTransaction.totalLoanAmount).$promise.then(function(data){callActionOnDisclose(data.vaFeeLimitExceededResults,canCallDisclosures,isTestMode,isLock,isComplianceCheck);vm.wrappedLoan.ref.updateGovermentEligibility(srv.MortgageTypeEnum.VA,!data.vaFeeLimitExceededResults.length);},function(error){console.log(error);});}else{callActionOnDisclose(false,canCallDisclosures,isTestMode,isLock,isComplianceCheck);}}}function callActionOnDisclose(vaFeeLimitExceededResults,canDisclose,isTestMode,isLock,isComplianceCheck){if(vaFeeLimitExceededResults.length){return vaCenterService.openVaFeeExceededAlertModal(vaFeeLimitExceededResults);}if(!canDisclose){return showDisclosuresTimespanAlertModal(isLock);}if(isComplianceCheck){return callComplianceCheckAction();}if(isTestMode){return showTestModePopupProduct(isLock);}var discloseAction=isLock?showDisclosureLockModal:saveAndRequestDisclosure;return discloseAction();}function callComplianceCheckAction(){var cashFromToBorrower=wrappedLoan.ref.detailsOfTransaction.cashFromToBorrower;NavigationSvc.SaveAndUpdateWrappedLoan(applicationData.currentUserId,wrappedLoan,function(){requestComplianceCheck(cashFromToBorrower);BroadcastSvc.broadcastUpdateSectionSeven();});}function saveAndRequestDisclosure(lockLoan,lockDate,lockExpDate,loanProductId){if(lockLoan){wrappedLoan.ref.lockingInformation.isLocked=true;wrappedLoan.ref.lockingInformation.lockExpirationDate=lockExpDate.toDate();wrappedLoan.ref.lockingInformation.lockFullfilled=lockDate.toDate();wrappedLoan.ref.lockingInformation.lockStatus=4;}closeAllModals();var cashFromToBorrower=wrappedLoan.ref.detailsOfTransaction.cashFromToBorrower;wrappedLoan.ref.createDocumentsBorrowerNeeds=!wrappedLoan.ref.getLoanApplications().some(function(loanApplication){return DocumentsService.isThereActiveDocuments(loanApplication.documents,applicationData);});NavigationSvc.SaveAndUpdateWrappedLoan(applicationData.currentUserId,wrappedLoan,function(){requestDisclosures(loanProductId,cashFromToBorrower);BroadcastSvc.broadcastUpdateSectionSeven();});}function saveAndRequestComplianceCheck(){closeAllModals();NavigationSvc.SaveAndUpdateWrappedLoan(applicationData.currentUserId,wrappedLoan,function(){requestComplianceCheck();BroadcastSvc.broadcastUpdateSectionSeven();});}function requestComplianceCheck(cashFromToBorrower){digitaldocSvc.requestComplianceCheck(true,"",wrappedLoan,saveAndRequestDisclosure,applicationData.lookup.complianceCheckErrors,checkSaveDiscloseActions);checkExportToEncompassProgress();}function checkExportToEncompassProgress(){if(!wrappedLoan.ref.loanNumber||wrappedLoan.ref.loanNumber=="Pending"){vm.wrappedLoan.ref.isImportToFNMInProgress=true;NavigationSvc.exportToEncompassInProgress=true;encompassSvc.requestDisclosurePackageLoanList.push(wrappedLoan.ref.loanId);encompassSvc.checkExportToEncompassProgress(wrappedLoan,vm.checkExportToEncompassActions,null,true,saveAndRequestDisclosure,applicationData.lookup.complianceCheckErrors,checkSaveDiscloseActions);}vm.saveDiscloseAction=getDefaultSaveDiscloseAction();}function showTestModePopupProduct(isLock){var modalInstance=$modal.open({templateUrl:"angular/loandetails/testmodeproductpopup/testmodeproductpopup.html",backdrop:"static",windowClass:"imp-center-modal imp-test-mode-product-popup-modal",controller:"testModeProductPopupController",controllerAs:"testModeProductPopupCtrl",resolve:{model:function(){return{productId:vm.wrappedLoan.ref.product.ruCode,isLock:isLock};},callBackSaveAndRequestDisclosure:function(){return saveAndRequestDisclosure;},callBackShowDisclosureLockModal:function(){return showDisclosureLockModal;}}});}function showDisclosureLockModal(productId){if(wrappedLoan.ref.lockingInformation.lockExpirationDate&&Date.parse(wrappedLoan.ref.closingDate.dateValue)>=Date.parse(wrappedLoan.ref.lockingInformation.lockExpirationDate)){commonModalWindowFactory.open({type:modalWindowType.success,message:"Please check your Closing Date to insure that it is prior to the Lock Expiration Date and try again.",messageClass:"imp-success-message"});}else{var modalInstance=$modal.open({templateUrl:"angular/loandetails/lockdiclosuresmodals/lockconfirmation.html",backdrop:"static",backdropClass:"custom-modal-backdrop",dialogFade:false,keyboard:false,windowClass:"imp-center-modal confirmation-modal",controller:"lockConfirmationController",controllerAs:"lockConfirmationCtrl",resolve:{model:function(){return{programName:wrappedLoan.ref.product.programName,noteRate:wrappedLoan.ref.financialInfo.noteRate,pricingEngine:vm.pricingInfo().pricingEngine,pricingAmount:vm.pricingInfo().amount,lockPeriod:wrappedLoan.ref.lockingInformation.lockPeriod,productId:productId};},callbackYes:function(){return saveAndRequestDisclosure;}}});}}function saveAll(){NavigationSvc.SaveAndUpdateWrappedLoan(applicationData.currentUserId,wrappedLoan,function(){BroadcastSvc.broadcastUpdateSectionSeven();});}function mapImpoundFees(){var impounds=vm.wrappedLoan.ref.closingCost.costs.filter(function(c){if(c.hudLineNumber==1002||c.hudLineNumber==1003||c.hudLineNumber==1004||c.hudLineNumber==1006){return c;}});var taxesImpounded=false;var taxes=impounds.filter(function(t){if(t.hudLineNumber==1004){return t;}});if(taxes[0]&&taxes[0].impounded==true){taxesImpounded=true;}var insurances=impounds.filter(function(i){if(i.hudLineNumber==1002){return i;}});var insurancesImpounded=false;if(insurances[0]&&insurances[0].impounded==true){insurancesImpounded=true;}if(taxesImpounded&&insurancesImpounded){wrappedLoan.ref.otherInterviewData.selectedImpoundsOption="0";}else{if(taxesImpounded){wrappedLoan.ref.otherInterviewData.selectedImpoundsOption="1";}else{if(insurancesImpounded){wrappedLoan.ref.otherInterviewData.selectedImpoundsOption="2";}else{if(!taxesImpounded&&!insurancesImpounded){wrappedLoan.ref.otherInterviewData.selectedImpoundsOption="3";}}}}}function callPricingAction(){mapImpoundFees();if(vm.pricingAction.value==2){$state.go("loanCenter.loan.loanScenario.sections",{"repricing":true,"contextualBarTitle":true});}else{repriceLoan();}}function getDefaultPricingAction(){return vm.pricingActions[1];}function showPricingAction(item){vm.pricingAction=item;}function disablePricingButton(){return false;}function bottomButtonPricingAction(){$state.go("loanCenter.loan.loanScenario.sections",{"repricing":true});}function flipPurpose(){wrappedLoan.ref.loanPurposeType=wrappedLoan.ref.loanPurposeType==2?1:2;saveAll();}function showClosingDate(event,model){var closingDatePopup=modalPopoverFactory.openModalPopover("angular/common/loandatehistorypopup.html",this,wrappedLoan.ref.closingDate,event);closingDatePopup.result.then(function(data){if((new Date(data.dateValue)>=new Date(data.currentDate))){wrappedLoan.ref.closingDate.dateValue=data.dateValue.toISOString();wrappedLoan.ref.updateLoanDateHistory(new Date(data.dateValue),vm.applicationData.currentUser.fullName,new Date().toISOString(),vm.applicationData.impoundSchedules,data.title);costDetailsHelpers.calculateCostsOnCloseDateChanged(wrappedLoan.ref.closingCost.costs,wrappedLoan.ref.closingDate.dateValue,vm.applicationData.impoundSchedules,wrappedLoan.ref.getSubjectProperty().stateName);loanEvent.broadcastPropertyChangedEvent(events.LoanFieldIdentifier.LoanAmount,wrappedLoan.ref.loanAmount);vm.wrappedLoan=wrappedLoan;}});}function getDownPaymentSourceText(){return wrappedLoan.ref.getSubjectProperty().getDownPaymentSourceText(wrappedLoan.ref.getSubjectProperty().downPaymentSource,applicationData.lookup.downPaymentSourcesTypes);}function getFinancialInfo(){loanDetailsSvc.getFinancialInfo.getFinancialInfo({loanId:$scope.selectedLoanId}).$promise.then(function(data){var dtiData=data;wrappedLoan.ref.financialInfo.dtiDu=dtiData.debtToIncomeRatioDU;wrappedLoan.ref.financialInfo.dtiLp=dtiData.debtToIncomeRatioLP;wrappedLoan.ref.financialInfo.qualifyingDtiDu=dtiData.qualifyingDebtToIncomeRatioDU;wrappedLoan.ref.financialInfo.qualifyingDtiLp=dtiData.qualifyingDebtToIncomeRatioLP;wrappedLoan.ref.financialInfo.housingRatioDu=dtiData.housingRatioDU;wrappedLoan.ref.financialInfo.housingRatioLp=dtiData.housingRatioLP;},function(error){$log.error("Failure getting financial info data",error);});}function onPurchasePriceChange(model){console.log("Purchase Price");loanEvent.broadcastPropertyChangedEvent(events.LoanFieldIdentifier.PurchasePrice,wrappedLoan.ref.loanAmount);var purchasePrice=Number.isNaN(parseFloat(model.PurchasePrice))?0:parseFloat(model.PurchasePrice);var loanAmount=Number.isNaN(parseFloat(model.LoanAmount))?0:parseFloat(model.LoanAmount);var downPayment=Number.isNaN(parseFloat(model.DownPayment))?0:parseFloat(model.DownPayment);var downPaymentPercent=Number.isNaN(parseFloat(model.downPaymentPercent))?0:parseFloat(model.downPaymentPercent);var result=commonCalculatorSvc.recalculateDownPayment(purchasePrice,loanAmount,downPayment,downPaymentPercent,0,"PurchasePrice");model.PurchasePrice=result.purchasePrice;model.LoanAmount=result.loanAmount;model.DownPayment=result.downPayment;model.downPaymentPercent=result.downPaymentPercentage;}function onLoanAmountChange(model){console.log("LoanAmount");loanEvent.broadcastPropertyChangedEvent(events.LoanFieldIdentifier.LoanAmount,wrappedLoan.ref.loanAmount);var purchasePrice=Number.isNaN(parseFloat(model.PurchasePrice))?0:parseFloat(model.PurchasePrice);var loanAmount=Number.isNaN(parseFloat(model.LoanAmount))?0:parseFloat(model.LoanAmount);var downPayment=Number.isNaN(parseFloat(model.DownPayment))?0:parseFloat(model.DownPayment);var downPaymentPercent=Number.isNaN(parseFloat(model.downPaymentPercent))?0:parseFloat(model.downPaymentPercent);var result=commonCalculatorSvc.recalculateDownPayment(purchasePrice,loanAmount,downPayment,downPaymentPercent,0,"LoanAmount");model.PurchasePrice=result.purchasePrice;model.LoanAmount=result.loanAmount;model.DownPayment=result.downPayment;model.downPaymentPercent=result.downPaymentPercentage;}function onDownPaymentChange(model){var purchasePrice=Number.isNaN(parseFloat(model.PurchasePrice))?0:parseFloat(model.PurchasePrice);var loanAmount=Number.isNaN(parseFloat(model.LoanAmount))?0:parseFloat(model.LoanAmount);var downPayment=Number.isNaN(parseFloat(model.DownPayment))?0:parseFloat(model.DownPayment);var downPaymentPercent=Number.isNaN(parseFloat(model.downPaymentPercent))?0:parseFloat(model.downPaymentPercent);var result=commonCalculatorSvc.recalculateDownPayment(purchasePrice,loanAmount,downPayment,downPaymentPercent,0,"DownPayment");model.PurchasePrice=result.purchasePrice;model.LoanAmount=result.loanAmount;model.DownPayment=result.downPayment;model.downPaymentPercent=result.downPaymentPercentage;}function onDownPaymentPercentChange(model){var purchasePrice=Number.isNaN(parseFloat(model.PurchasePrice))?0:parseFloat(model.PurchasePrice);var loanAmount=Number.isNaN(parseFloat(model.LoanAmount))?0:parseFloat(model.LoanAmount);var downPayment=Number.isNaN(parseFloat(model.DownPayment))?0:parseFloat(model.DownPayment);var downPaymentPercent=Number.isNaN(parseFloat(model.downPaymentPercent))?0:parseFloat(model.downPaymentPercent);var result=commonCalculatorSvc.recalculateDownPayment(purchasePrice,loanAmount,downPayment,downPaymentPercent,0,"DownPaymentPercentage");model.PurchasePrice=result.purchasePrice;model.LoanAmount=result.loanAmount;model.DownPayment=result.downPayment;model.downPaymentPercent=result.downPaymentPercentage;}function triggerEncompassExport(action){NavigationSvc.exportToEncompassInProgress=true;vm.saveDiscloseAction=getDefaultSaveDiscloseAction();var message;var messageDetails;if(action.value==enums.requestExportToEncompassAction.ExportToEncompass){message="Export to Encompass In Progress";messageDetails="You will be notified when the export to Encompass is complete.";}else{if(action.value==enums.requestExportToEncompassAction.UpdateEncompass){message="Update Encompass In Progress";messageDetails="You will be notified when the update Encompass is complete.";}}commonModalWindowFactory.open({type:modalWindowType.success,message:message,messageDetails:messageDetails});encompassSvc.exportToEncompass(wrappedLoan,vm.checkExportToEncompassActions,action);}function disableExportToEncompass(){return !((vm.wrappedLoan.ref.active.getBorrower().firstName!=null&&vm.wrappedLoan.ref.active.getBorrower().firstName!="")&&(vm.wrappedLoan.ref.active.getBorrower().lastName!=null&&vm.wrappedLoan.ref.active.getBorrower().lastName!="")&&!NavigationSvc.exportToEncompassInProgress&&!vm.wrappedLoan.ref.isImportToFNMInProgress);}function exportToEncompass(action){commonModalWindowFactory.close("close");NavigationSvc.SaveAndUpdateWrappedLoan(applicationData.currentUserId,wrappedLoan,function(){triggerEncompassExport(action);});}function callExportToEncompassAction(action){if(!disableExportToEncompass()){exportToEncompass(action);}}function requestDisclosures(loanProductId,cashFromToBorrower){digitaldocSvc.requestDisclosurePackages(true,loanProductId,wrappedLoan);checkExportToEncompassProgress();}function submitForApproval(){wrappedLoan.ref.areLoanAntiSteeringOptionsCompleted(wrappedLoan.ref.antiSteeringOptions)?vm.submitForApprovalAction():NavigationSvc.openAntiSteeringModal(vm.wrappedLoan.ref.financialInfo.amortizationType,vm.wrappedLoan.ref.antiSteeringOptions,vm.wrappedLoan.ref.areLoanAntiSteeringOptionsCompleted,vm.submitForApprovalAction);}function submitForApprovalAction(){commonModalWindowFactory.open({type:modalWindowType.loader,message:"Submitting for Approval"});wrappedLoan.ref.currentMilestone=srv.milestoneStatus.submitted;NavigationSvc.SaveAndUpdateWrappedLoan(applicationData.currentUserId,wrappedLoan,function(){commonModalWindowFactory.close("close");commonModalWindowFactory.open({type:modalWindowType.success,message:"Loan Submission Complete"});},function(){commonModalWindowFactory.close("close");},null,false);}function isApprovalDisabled(){return wrappedLoan.ref.currentMilestone&&wrappedLoan.ref.currentMilestone!=srv.milestoneStatus.unsubmitted&&wrappedLoan.ref.currentMilestone!=srv.milestoneStatus.registered&&wrappedLoan.ref.currentMilestone!=srv.milestoneStatus.rejected;}function cancel(){$state.reload();}function updatePricingInfo(newPrice){vm.pricingInfo=newPrice;}function checkPricingTimespan(){if(!NavigationSvc.lastRepricing.timestamp){return false;}else{var lastPricing=new Date(NavigationSvc.lastRepricing.timestamp);var timeNow=new Date().getTime();var time=new Date(timeNow);var timeDifference=Math.abs(time.getTime()-lastPricing.getTime());var minutes=Math.floor(timeDifference/60000);return(minutes>5)?false:true;}}function showDisclosuresTimespanAlertModal(isLock){var message=isLock?"To create Initial Lock Disclosures, Price & Fees \nmust be updated. Click Shop For Rates to update.":"To create Initial Disclosures, Price & Fees must be \nupdated. Click Shop For Rates to update.";showDisclosuresTimeSpanAlert(message);}function showDisclosuresTimeSpanAlert(inputMessage){if(typeof inputMessage==="undefined"){inputMessage="";}commonModalWindowFactory.open({type:modalWindowType.confirmation,ctrl:vm,header:"Update Price & Fees",headerClass:"confirmation-modal-header",message:inputMessage,messageClass:"confirmation-modal-message",btnCloseText:"Cancel",ctrlButtons:[{title:"Shop for Rates",styleClass:"imp-button-div-hs-ws-prim",width:"140px",height:"30px",callback:"bottomButtonPricingAction"}]});}function showAppraisalContingencyDatePopup(event){var appraisalContingencyDatePopup=modalPopoverFactory.openModalPopover("angular/common/loandatehistorypopup.html",this,wrappedLoan.ref.appraisalContingencyDate,event);appraisalContingencyDatePopup.result.then(function(data){if((new Date(data.dateValue)>=new Date(data.currentDate))||data.dateValue==null){wrappedLoan.ref.appraisalContingencyDate.dateValue=data.dateValue==null?data.dateValue:data.dateValue.toISOString();var date=data.dateValue==null?data.dateValue:new Date(data.dateValue);wrappedLoan.ref.updateLoanDateHistory(date,vm.applicationData.currentUser.fullName,new Date().toISOString(),vm.applicationData.impoundSchedules,data.title);vm.wrappedLoan=wrappedLoan;}});}function showApprovalContingencyDatePopup(event){var approvalContingencyDatePopup=modalPopoverFactory.openModalPopover("angular/common/loandatehistorypopup.html",this,wrappedLoan.ref.approvalContingencyDate,event);approvalContingencyDatePopup.result.then(function(data){if((new Date(data.dateValue)>=new Date(data.currentDate))||data.dateValue==null){wrappedLoan.ref.approvalContingencyDate.dateValue=data.dateValue==null?data.dateValue:data.dateValue.toISOString();var date=data.dateValue==null?data.dateValue:new Date(data.dateValue);wrappedLoan.ref.updateLoanDateHistory(date,vm.applicationData.currentUser.fullName,new Date().toISOString(),vm.applicationData.impoundSchedules,data.title);vm.wrappedLoan=wrappedLoan;}});}function isDisclosuresButtonDisabled(){var complianceCheckRequired=_.find(applicationData.generalSettings,function(obj){return obj.settingName=="Compliance Check Required to Create Initial Disclosures?";});var loanApplications=vm.wrappedLoan.ref.getLoanApplications();for(var i=0;i<loanApplications.length;i++){if(loanApplications[i].complianceCheckStatus==null||(loanApplications[i].complianceCheckStatus==srv.ComplianceCheckStatusEnum.Failed&&complianceCheckRequired)||loanApplications[i].complianceCheckStatus==srv.ComplianceCheckStatusEnum.InProgress||loanApplications[i].complianceCheckStatus==srv.ComplianceCheckStatusEnum.NotRun){return true;}}return !vm.wrappedLoan.ref.sixPiecesAcquiredForAllLoanApplications||disableExportToEncompass();}}})();(function(){angular.module("loanDetails").directive("productInfo",productInfo);function productInfo(){return{restrict:"E",scope:{productInfoHeight:"="},templateUrl:"angular/loandetails/sections/productinfodirective.html",link:function(scope,element,attrs){scope.productInfoHeight=element[0].offsetHeight>20;}};}})();(function(){angular.module("loanDetails").factory("calculatorSvc",calculatorSvc);calculatorSvc.$inject=["$resource","apiRoot"];function calculatorSvc($resource,ApiRoot){var calculatorApiPath=ApiRoot+"Calculator/";var GetImpounds=$resource(calculatorApiPath,{},{GetImpounds:{method:"GET",params:{loanId:"loanId"}}});var UpdateImpounds=$resource(calculatorApiPath+":id",{},{UpdateImpounds:{method:"PUT"}});var calculatorService={GetImpounds:GetImpounds,UpdateImpounds:UpdateImpounds};return calculatorService;}})();(function(){angular.module("loanDetails").controller("calculatorController",calculatorController);function calculatorController($log,$modalInstance,calculatorSvc){var vm=this;vm.cancel=Cancel;vm.save=Save;vm.saveclose=SaveAndClose;vm.CalculatorViewModel={};init();function init(){calculatorSvc.GetImpounds({loanId:$scope.selectedLoanId}).$promise.then(function(data){console.log("Retrieved data"+data);vm.CalculatorViewModel=data;},function(error){$log.error("Failure loading Impounds Calculator data",error);});}function Cancel(){console.log("Cancel");$modalInstance.dismiss("cancel");}function Save(){console.log("Save");}function SaveAndClose(){console.log("Save & Close");$modalInstance.dismiss("cancel");}}})();(function(){angular.module("loanDetails").factory("propertyDetailsSvc",propertyDetailsSvc);propertyDetailsSvc.$inject=["$resource","apiRoot"];function propertyDetailsSvc($resource,ApiRoot){var propertyDetailsApiPath=ApiRoot+"PropertyDetails/";var GetPropertyDetailsData=$resource(propertyDetailsApiPath,{},{GetPropertyDetailsData:{method:"GET",params:{loanId:"loanId"}}});var UpdatePropertyDetailsData=$resource(propertyDetailsApiPath+":id",{},{UpdatePropertyDetailsData:{method:"PUT",params:{userId:"userId"}}});var propertyDetailsService={GetPropertyDetailsData:GetPropertyDetailsData,UpdatePropertyDetailsData:UpdatePropertyDetailsData};return propertyDetailsService;}})();(function(){angular.module("loanDetails").controller("propertyDetailsController",propertyDetailsController);propertyDetailsController.$inject=["$log","$modalInstance","propertyDetailsSvc","modalPopoverFactory","propertyDetails","wrappedLoan","loanId","userId","applicationData","loanEvent"];function propertyDetailsController($log,$modalInstance,propertyDetailsSvc,modalPopoverFactory,propertyDetails,wrappedLoan,loanId,userId,applicationData,loanEvent){var vm=this;vm.wrappedLoan=wrappedLoan;vm.lookup=wrappedLoan.ref.lookup;vm.cancel=cancel;vm.save=save;vm.saveclose=saveAndClose;vm.propertyDetailsViewModel;vm.modalPopoverFactory=modalPopoverFactory;vm.fullLegalDescriptionEdit=fullLegalDescriptionEdit;vm.fullLegalDescriptionSave=fullLegalDescriptionSave;vm.applicationData=applicationData;vm.onAppraisedValueChanged=onAppraisedValueChanged;vm.propertyDetailsViewModel=propertyDetails;vm.licencedStates=vm.wrappedLoan.ref.getLicencedStates(vm.applicationData);function cancel(){$modalInstance.dismiss("cancel");}function save(){wrappedLoan.ref.setSubjectProperty(vm.propertyDetailsViewModel);propertyDetailsSvc.UpdatePropertyDetailsData.UpdatePropertyDetailsData({loanId:loanId,userId:userId},vm.propertyDetailsViewModel);}function saveAndClose(){$modalInstance.close(vm.propertyDetailsViewModel);propertyDetailsSvc.UpdatePropertyDetailsData.UpdatePropertyDetailsData({loanId:loanId,userId:userId},vm.propertyDetailsViewModel);loanEvent.broadcastPropertyChangedEvent(events.LoanFieldIdentifier.AppraisedValue,wrappedLoan.ref.getSubjectProperty().appraisedValue);}}function fullLegalDescriptionEdit(event,ctrlPropertyDetails){var sectionSevenPopup=ctrlPropertyDetails.modalPopoverFactory.openModalPopover("angular/loandetails/dynamics/fulllegaldescription.html",this,ctrlPropertyDetails.propertyDetailsViewModel,event,{arrowRight:true,className:"tooltip-arrow-right-border-legal-desc",verticalPopupPositionPerHeight:0.625,horisontalPopupPositionPerWidth:1.03});sectionSevenPopup.result.then(function(data){fullLegalDescriptionSave(data.ctrlMain,data.model.fullLegal);});}function onAppraisedValueChanged(){loanEvent.broadcastPropertyChangedEvent(events.LoanFieldIdentifier.AppraisedValue,wrappedLoan.ref.getSubjectProperty().appraisedValue);}function fullLegalDescriptionSave(ctrlMain,model){ctrlMain.propertyDetailsViewModel.fullLegal=angular.copy(model);}})();(function(){angular.module("loanDetails").factory("appraisedValueHistoryPopupSvc",appraisedValueHistoryPopupSvc);appraisedValueHistoryPopupSvc.$inject=["$resource","apiRoot"];function appraisedValueHistoryPopupSvc($resource,ApiRoot){var appraisedValueHistoryPopupPath=ApiRoot+"AppraisedHistoryPopup/";var GetAppraisedValueHistoryPopupData=$resource(appraisedValueHistoryPopupPath,{},{GetAppraisedValueHistoryPopupData:{method:"GET",params:{loanId:"loanId"}}});var appraisedValueHistoryPopupService={GetAppraisedValueHistoryPopupData:GetAppraisedValueHistoryPopupData,};return appraisedValueHistoryPopupService;}})();(function(){angular.module("loanDetails").controller("appraisedValueHistoryController",appraisedValueHistoryController);function appraisedValueHistoryController($log,modalPopoverFactory,appraisedValueHistoryPopupSvc){var vm=this;vm.appraisedValueHistoryPopupViewModel={};vm.init=init;function init(loanId){appraisedValueHistoryPopupSvc.GetAppraisedValueHistoryPopupData.GetAppraisedValueHistoryPopupData({loanId:loanId}).$promise.then(function(data){vm.appraisedValueHistoryPopupViewModel=data;ShowAppraisedHistoryPopup();},function(error){$log.error("Failure loading Appraised Value History Popup data",error);});}function ShowAppraisedHistoryPopup(){var ctrl={AppraisedValueHistories:vm.appraisedValueHistoryPopupViewModel.AppraisedValueHistories,};var _apprHistoryPopup=modalPopoverFactory.openModalPopover("angular/loandetails/appraisedvaluehistorypopup/appraisedvaluehistorypopup.html",ctrl,vm.appraisedValueHistoryPopupViewModel,vm.event);_apprHistoryPopup.result.then(function(data){});}}})();(function(){angular.module("loanDetails").controller("housingExpensesController",housingExpensesController);housingExpensesController.$inject=["$scope","$controller","BroadcastSvc","wrappedLoan","modalPopoverFactory","calculatorSvc","applicationData","loanDetailsSvc","loanEvent","costDetailsHelpers","enums","LoanCalculator","ImpoundCalculatorHelpersSvc"];function housingExpensesController($scope,$controller,BroadcastSvc,wrappedLoan,modalPopoverFactory,calculatorSvc,applicationData,loanDetailsSvc,loanEvent,costDetailsHelpers,enums,LoanCalculator,ImpoundCalculatorHelpersSvc){var vm=this;vm.wrappedLoan=wrappedLoan;vm.triggerLoanCalc=triggerLoanCalc;vm.totalImpounds=totalImpounds;vm.currentHOAExpense=currentHOAExpense;vm.currentFloodInsuranceExpense=currentFloodInsuranceExpense;vm.currentPropertyTaxExpense=currentPropertyTaxExpense;vm.currentMortgageInsuranceExpense=currentMortgageInsuranceExpense;vm.currentHomeOwnerExpense=currentHomeOwnerExpense;vm.usdaAnnualCost=usdaAnnualCost;vm.floodInsuranceCost=floodInsuranceCost;vm.propertyTaxCost=propertyTaxCost;vm.mortgageInsuranceCost=mortgageInsuranceCost;vm.homeOwnerCost=homeOwnerCost;vm.totalCurrentExpenses=totalCurrentExpenses;vm.getTotalOtherInsuranceCosts=getTotalOtherInsuranceCosts;vm.getAdditionalMortgages=getAdditionalMortgages;vm.isMoreThan2Mortgages=isMoreThan2Mortgages;vm.showConventionalMortgageInsuranceModal=showConventionalMortgageInsuranceModal;function isMoreThan2Mortgages(){return loanDetailsSvc.isMoreThan2Mortgages(vm.wrappedLoan.ref.getCombinedPledgedAssetsForAll1003s());}function currentHOAExpense(){return loanDetailsSvc.getCurrentExpenseByType(vm.wrappedLoan.ref.loanPurposeType,vm.wrappedLoan.ref.getSubjectProperty().OccupancyType,vm.wrappedLoan.ref.getSubjectProperty,vm.wrappedLoan.ref.primary.getBorrower().getCurrentAddress,enums.housingExpenses.HOAExpense);}function currentFloodInsuranceExpense(){return loanDetailsSvc.getCurrentExpenseByType(vm.wrappedLoan.ref.loanPurposeType,vm.wrappedLoan.ref.getSubjectProperty().OccupancyType,vm.wrappedLoan.ref.getSubjectProperty,vm.wrappedLoan.ref.primary.getBorrower().getCurrentAddress,enums.housingExpenses.floodInsuranceExpense);}function currentPropertyTaxExpense(){return loanDetailsSvc.getCurrentExpenseByType(vm.wrappedLoan.ref.loanPurposeType,vm.wrappedLoan.ref.getSubjectProperty().OccupancyType,vm.wrappedLoan.ref.getSubjectProperty,vm.wrappedLoan.ref.primary.getBorrower().getCurrentAddress,enums.housingExpenses.propertyTaxExpense);}function currentMortgageInsuranceExpense(){return loanDetailsSvc.getCurrentExpenseByType(vm.wrappedLoan.ref.loanPurposeType,vm.wrappedLoan.ref.getSubjectProperty().OccupancyType,vm.wrappedLoan.ref.getSubjectProperty,vm.wrappedLoan.ref.primary.getBorrower().getCurrentAddress,enums.housingExpenses.mortgageInsuranceExpense);}function currentHomeOwnerExpense(){return loanDetailsSvc.getCurrentExpenseByType(vm.wrappedLoan.ref.loanPurposeType,vm.wrappedLoan.ref.getSubjectProperty().OccupancyType,vm.wrappedLoan.ref.getSubjectProperty,vm.wrappedLoan.ref.primary.getBorrower().getCurrentAddress,enums.housingExpenses.homeOwnerExpense);}function floodInsuranceCost(floodInsuranceCostItem){return getCosts(1006);}function propertyTaxCost(propertyTaxCostItem){return getCosts(1004);}function mortgageInsuranceCost(mortgageInsuranceCostItem){return getCosts(1003);}function usdaAnnualCost(){return getCosts(1012);}function getTotalOtherInsuranceCosts(){var amount=0;for(var i=0;i<wrappedLoan.ref.closingCost.costs.length;i++){var costItem=wrappedLoan.ref.closingCost.costs[i];if(costItem.isRemoved!=true&&costItem.impounded&&costItem.hudLineNumber!=1002&&costItem.hudLineNumber!=1003&&costItem.hudLineNumber!=1004&&costItem.hudLineNumber!=1006&&costItem.hudLineNumber!=1012){amount+=costItem.amountPerMonth;}}return amount;}function homeOwnerCost(homeOwnerCostItem){return getCosts(1002);}function getCurrentPropertyExpenseValue(propertyExpense){return loanDetailsSvc.getCurrentPropertyExpenseValue(propertyExpense);}function getCosts(hudLineNumber){return loanDetailsSvc.getCosts(hudLineNumber,getCostsCb);}function getCurrentPropertyEx(){}function getCurrentProperty(){return loanDetailsSvc.getCurrentProperty(vm.wrappedLoan.ref.loanPurposeType,vm.wrappedLoan.ref.getSubjectProperty().OccupancyType,vm.wrappedLoan.ref.getSubjectProperty,vm.wrappedLoan.ref.primary.getBorrower().getCurrentAddress);}function triggerLoanCalc(){loanEvent.broadcastPropertyChangedEvent(events.LoanFieldIdentifier.todo);}function getAdditionalMortgages(){var addlMortgages=loanDetailsSvc.getAdditionalMortgages(wrappedLoan.ref.getLoanApplications(),vm.wrappedLoan.ref.loanPurposeType,vm.wrappedLoan.ref.getSubjectProperty().OccupancyType,vm.wrappedLoan.ref.getSubjectProperty,vm.wrappedLoan.ref.primary.getBorrower().getCurrentAddress,getPrimaryLoanAppCb);return addlMortgages;}function totalCurrentExpenses(includeAdditionalMortgagees){return LoanCalculator.getCurrentPaymentAndMi(includeAdditionalMortgagees);}function roundToFourDecimalPlaces(value){return value?Math.round(value*10000)/10000:0;}vm.triggerLoanCalc();vm.applicationData=applicationData;vm.showImpoundCalculator=showImpoundCalculator;function showImpoundCalculator(event){var totalLoanAmount=vm.wrappedLoan.ref.loanAmount;var closingMonth=moment(vm.wrappedLoan.ref.closingDate.dateValue).month()+1;if(!!vm.wrappedLoan.ref.detailsOfTransaction.totalLoanAmount){totalLoanAmount=vm.wrappedLoan.ref.detailsOfTransaction.totalLoanAmount;}var subjectProperty=vm.wrappedLoan.ref.getSubjectProperty();var impoundCalculator=modalPopoverFactory.openModalPopover("angular/common/impoundcalculator/impoundcalculator.html",$controller("impoundCalculatorController",{$scope:$scope.$new()}),{isRefinance:wrappedLoan.ref.loanPurposeType!="1",mortageType:wrappedLoan.ref.financialInfo.mortgageType,isExtended:false,loanAmount:totalLoanAmount,applicationData:applicationData,purchasePrice:subjectProperty.purchasePrice,costs:wrappedLoan.ref.closingCost.costs,HOAExpens:{preferredPayPeriod:srv.PeriodTypeEnum.Monthly,amountPerMonth:vm.wrappedLoan.ref.housingExpenses.newHoa,amount:vm.wrappedLoan.ref.housingExpenses.newHoa},stateImpundLimit:wrappedLoan.ref.stateLtvLimit,impoundSchedule:ImpoundCalculatorHelpersSvc.findImpoundScheduleByStateAndClosingMonth(vm.applicationData.impoundSchedules,subjectProperty.stateName,closingMonth),MICalculatorRequest:ImpoundCalculatorHelpersSvc.createMiRequestModel(vm.wrappedLoan.ref)},event,{className:"tooltip-arrow-right-cost-details",verticalPopupPositionPerHeight:0,horisontalPopupPositionPerWidth:0.695});impoundCalculator.result.then(function(data){costDetailsHelpers.updateImpounds(data,vm.wrappedLoan);triggerLoanCalc();},function(){});}function totalImpounds(){var hoa=vm.homeOwnerCost();var property=vm.propertyTaxCost();var mi=vm.mortgageInsuranceCost();var flood=vm.floodInsuranceCost();var usda=vm.usdaAnnualCost();return(!angular.isUndefined(hoa)&&hoa.impounded?parseFloat(hoa.amountPerMonth):0)+(!angular.isUndefined(property)&&property.impounded?parseFloat(property.amountPerMonth):0)+(!angular.isUndefined(mi)&&mi.impounded?parseFloat(mi.amountPerMonth):0)+(!angular.isUndefined(flood)&&flood.impounded?parseFloat(flood.amountPerMonth):0)+(!angular.isUndefined(usda)&&usda.impounded?parseFloat(usda.amountPerMonth):0);}function showConventionalMortgageInsuranceModal(event,model){var conventionalMortgageInsuranceModal=modalPopoverFactory.openModalPopover("angular/loandetails/sections/housingexpenses/conventionalMortgageInsurance.html",this,vm.wrappedLoan.ref,event,{arrowRight:true,className:"tooltip-arrow-right",verticalPopupPositionPerHeight:0,horisontalPopupPositionPerWidth:0.8333,refExtModelAndCtrl:true});}function getPrimaryLoanAppCb(){return vm.wrappedLoan.ref.primary;}function getCostsCb(){return wrappedLoan.ref.closingCost.costs;}}})();(function(){angular.module("multiborrowerPopover",[]);})();(function(){angular.module("multiborrowerPopover").directive("mbList",mbList).directive("mbPopover",["modalPopoverFactory",mbPopover]);function mbList(){return{restrict:"E",require:"ngModel",replace:true,scope:{model:"=ngModel",borrower:"="},transclude:true,templateUrl:"angular/loandetails/multiborrowerpopover/multiborrowerList.html",bindToController:true,controller:controller,controllerAs:"mbList"};function controller(){var self=this;self.setBorrower=setBorrower;self.isClicked=isClicked;function setBorrower(bor){self.borrower=bor;}function isClicked(bor){return self.borrower===bor;}}}function mbPopover(modalPopoverFactory){return{restrict:"A",bindToController:true,controller:controller,controllerAs:'multiborrowerPopover"',link:link};function link(scope,element,attrs,controller){element.bind("click",openPopover);controller.template=attrs.mbPopover;controller.model=scope.$eval(attrs.ngModel);controller.title=attrs.mbPopoverTitle;function openPopover(event){modalPopoverFactory.openModalPopover("angular/loandetails/multiborrowerpopover/multiborrowerpopover.html",controller,null,event);}}function controller(){var self=this;}}})();(function(){angular.module("loanDetails").controller("housingExpenseController",housingExpenseController);function housingExpenseController(){var vm=this;vm.test="Housing expense";}})();(function(){angular.module("loanDetails").controller("sectionSevenController",sectionSevenController);sectionSevenController.$inject=["$log","$scope","$modal","$filter","loanDetailsSvc","modalPopoverFactory","calculatorSvc","$controller","wrappedLoan","applicationData","enums","loanEvent","commonCalculatorSvc","costDetailsHelpers"];function sectionSevenController($log,$scope,$modal,$filter,loanDetailsSvc,modalPopoverFactory,calculatorSvc,$controller,wrappedLoan,applicationData,enums,loanEvent,commonCalculatorSvc,costDetailsHelpers){var vm=this;vm.wrappedLoan=wrappedLoan;vm.loanDetailsViewModel=[];vm.cashFromBorrower=cashFromBorrower;vm.applicationData=applicationData;vm.downPaymentSource={value:"101",text:"test"};vm.downPaymentRules=downPaymentRules;vm.concurrent2ndMortgageEnable=false;vm.creditLineCapEnable=false;vm.getDownPaymentSourceText=getDownPaymentSourceText;vm.getHudLineNumber=getHudLineNumber;vm.showSectionSeven=showSectionSeven;vm.showSubordinateFinancingDetailsModal=showSubordinateFinancingDetailsModal;vm.calculateMonthlyPayment=calculateMonthlyPayment;vm.setDownPaymentSourceValue=setDownPaymentSourceValue;vm.onCashoutChange=onCashoutChange;vm.getTotalForClosingDisclosure=getTotalForClosingDisclosure;vm.fundingFeeFinancedDetailsModal=fundingFeeFinancedDetailsModal;vm.isAmountFinancedValid=isAmountFinancedValid;vm.maxAllowedFundingFeeAmount=vm.wrappedLoan.ref.detailsOfTransaction.pmiMipFundingFeeFinanced;vm.onConcurrent2ndMortgageChange=onConcurrent2ndMortgageChange;function cashFromBorrower(){if(!!vm.wrappedLoan.ref.detailsOfTransaction){return vm.wrappedLoan.ref.detailsOfTransaction.cashFromToBorrower>0;}else{return false;}}$scope.$on("UpdateSectionSeven",function(data){downPaymentRules(wrappedLoan.ref,"LoanAmount");});function showSectionSeven(event,model){downPaymentRules(wrappedLoan.ref,"LoanAmount",false);var sectionSevenPopup=modalPopoverFactory.openModalPopover("angular/loandetails/sections/sectionseven/sectionsevenpopup.html",this,wrappedLoan.ref,event,{arrowRight:true,className:"tooltip-arrow-right",verticalPopupPositionPerHeight:0,horisontalPopupPositionPerWidth:0.8333});sectionSevenPopup.result.then(function(data){updateSectionVIIData(data);downPaymentRules(wrappedLoan.ref,"LoanAmount");});}function setDownPaymentSourceValue(){var downPaymentTypes=applicationData.lookup.downPaymentSourcesTypes;for(var i=0,length=downPaymentTypes;i<downPaymentTypes.length;i++){if(downPaymentTypes[i].value===vm.wrappedLoan.ref.getSubjectProperty().downPaymentSource||vm.wrappedLoan.ref.getSubjectProperty().downPaymentSource===0){vm.downPaymentSource=downPaymentTypes[i].text;return downPaymentTypes[i].text;}}}function updateSectionVIIData(popupModel){popupModel.financialInfo.mortgageAmount=popupModel.loanAmount;loanDetailsSvc.UpdateVIIPoupData.UpdateVIIPoupData({loanId:wrappedLoan.ref.loanId},popupModel).$promise.then(function(loan){vm.wrappedLoan.ref=new cls.LoanViewModel(loan,$filter,applicationData.currentUser.isWholesale);costDetailsHelpers.initializeCostService(wrappedLoan);costDetailsHelpers.getCostDetailsData();loanEvent.broadcastPropertyChangedEvent(events.LoanFieldIdentifier.todo,{});},function(error){$log.error("Failure saving Loan Details data",error);});}function showSubordinateFinancingDetailsModal(event,model){refreshConcurrent2ndMortgageSection();var subordinateFinancingModal=modalPopoverFactory.openModalPopover("angular/loandetails/sections/sectionseven/subordinatefinancingdetails.html",this,vm.wrappedLoan.ref,event,{arrowRight:true,className:"tooltip-arrow-right",verticalPopupPositionPerHeight:0,horisontalPopupPositionPerWidth:0.8333,refExtModelAndCtrl:true});subordinateFinancingModal.result.then(function(data){vm.wrappedLoan.ref.subordinateFinancingDetails.monthlyPayment=data.subordinateFinancingDetails.monthlyPayment;vm.wrappedLoan.ref.subordinateFinancingDetails.loanAmount=data.subordinateFinancingDetails.loanAmount;vm.wrappedLoan.ref.subordinateFinancingDetails.secondMortgageType=data.subordinateFinancingDetails.secondMortgageType;vm.wrappedLoan.ref.subordinateFinancingDetails.creditLineCap=data.subordinateFinancingDetails.creditLineCap;vm.wrappedLoan.ref.subordinateFinancingDetails.interestRate=data.subordinateFinancingDetails.interestRate;vm.wrappedLoan.ref.subordinateFinancingDetails.termInMonths=data.subordinateFinancingDetails.termInMonths;vm.wrappedLoan.ref.detailsOfTransaction.cashFromToBorrower=parseFloat(wrappedLoan.ref.detailsOfTransaction.cashFromToBorrower)-parseFloat(data.subordinateFinancingDetails.loanAmount)+parseFloat(wrappedLoan.ref.detailsOfTransaction.subordinateFinancing);vm.cashFromBorrower=wrappedLoan.ref.detailsOfTransaction.cashFromToBorrower>0;vm.wrappedLoan.ref.detailsOfTransaction.subordinateFinancing=data.subordinateFinancingDetails.loanAmount;vm.wrappedLoan.ref.housingExpenses.newSecondMtgPi=data.subordinateFinancingDetails.monthlyPayment;loanEvent.broadcastPropertyChangedEvent(events.LoanFieldIdentifier.SubordinateFinancing,wrappedLoan.ref.subordinateFinancingDetails.monthlyPayment);});}function fundingFeeFinancedDetailsModal(event,model){vm.maxAllowedFundingFeeAmount=vm.wrappedLoan.ref.detailsOfTransaction.pmiMipFundingFeeFinanced;if(getHudLineNumber()>0){var cost=getCost(getHudLineNumber());var financedFundingFeeModal=modalPopoverFactory.openModalPopover("angular/loandetails/sections/sectionseven/fundingfeefinanceddetails.html",{isAmountFinancedValid:vm.isAmountFinancedValid},{mortgageType:vm.wrappedLoan.ref.financialInfo.mortgageType,amountFinanced:vm.wrappedLoan.ref.detailsOfTransaction.pmiMipFundingFeeFinanced,costAmount:cost.amount,maxAllowedFundingFeeAmount:vm.maxAllowedFundingFeeAmount},event,{arrowRight:true,className:"tooltip-arrow-right",verticalPopupPositionPerHeight:0.035,horisontalPopupPositionPerWidth:0.7655});financedFundingFeeModal.result.then(function(data){var cost=getCost(getHudLineNumber());if(cost!=null){cost.financedAmount=data.maxAllowedFundingFeeAmount;vm.wrappedLoan.ref.otherInterviewData.usdaInformation.financedAmount=cost.financedAmount;}loanEvent.broadcastPropertyChangedEvent(events.LoanFieldIdentifier.todo);});}}function isAmountFinancedValid(model){var hudLineNumber=getHudLineNumber();if(hudLineNumber>0){var cost=getCost(hudLineNumber);if(model.maxAllowedFundingFeeAmount>cost.amount){model.maxAllowedFundingFeeAmount=cost.amount;return;}}return;}function getHudLineNumber(){var hudLineNumber=-1;switch(wrappedLoan.ref.financialInfo.mortgageType){case 1:hudLineNumber=902;break;case 4:hudLineNumber=905;break;case 5:hudLineNumber=819;break;}return hudLineNumber;}function getCost(hudLineNumber){var cost=null;if(wrappedLoan.ref&&wrappedLoan.ref.closingCost&&wrappedLoan.ref.closingCost.costs){lib.forEach(wrappedLoan.ref.closingCost.costs,function(costItem){if((!costItem.originalHUDLineNumber||costItem.originalHUDLineNumber==0)&&costItem.hudLineNumber==hudLineNumber){cost=costItem;}});}return cost;}function calculateMonthlyPayment(loanAmount,interestRatePercent,termInMonths){if(!loanAmount||!interestRatePercent||!termInMonths){return 0;}var monthlyInterestRate=(interestRatePercent/100)/12;var calc=(Math.pow((1+monthlyInterestRate),termInMonths));var monthlyPayment=loanAmount*(monthlyInterestRate*calc)/(calc-1);return Math.round(monthlyPayment*10000)/10000;}function downPaymentRules(model,keyword,skipLoanCalculatorCall){var purchasePrice=Number.isNaN(parseFloat(model.getSubjectProperty().purchasePrice))?0:parseFloat(model.getSubjectProperty().purchasePrice);var loanAmount=Number.isNaN(parseFloat(model.loanAmount))?0:parseFloat(model.loanAmount);var downPayment=Number.isNaN(parseFloat(model.downPayment))?0:parseFloat(model.downPayment);var downPaymentPercent=Number.isNaN(parseFloat(model.downPaymentPercent))?0:parseFloat(model.downPaymentPercent);var result=commonCalculatorSvc.recalculateDownPayment(purchasePrice,loanAmount,downPayment,downPaymentPercent,0,keyword);vm.wrappedLoan.ref.downPaymentAmount(result.downPayment);model.downPayment=vm.wrappedLoan.ref.downPaymentAmount();model.loanAmount=result.loanAmount;model.downPaymentPercent=result.downPaymentPercentage;if(!skipLoanCalculatorCall){loanEvent.broadcastPropertyChangedEvent(events.LoanFieldIdentifier.LoanAmount,wrappedLoan.ref.loanAmount);}}function onCashoutChange(){wrappedLoan.ref.financialInfo.cashout=wrappedLoan.ref.financialInfo.cashOutAmount?"1":"0";}function getDownPaymentSourceText(){return wrappedLoan.ref.getSubjectProperty().getDownPaymentSourceText(wrappedLoan.ref.getSubjectProperty().downPaymentSource,wrappedLoan.ref.lookup.downPaymentSourcesTypes);}function getTotalForClosingDisclosure(){return Math.abs(vm.wrappedLoan.ref.detailsOfTransaction.cashFromToBorrower)+vm.wrappedLoan.ref.totalAggregateAdjustment;}function onConcurrent2ndMortgageChange(option){switch(parseInt(option)){case srv.Concurrent2ndMortgageEnum.No:vm.concurrent2ndMortgageEnable=false;vm.creditLineCapEnable=false;vm.wrappedLoan.ref.subordinateFinancingDetails.loanAmount=null;vm.wrappedLoan.ref.subordinateFinancingDetails.creditLineCap=null;break;case srv.Concurrent2ndMortgageEnum.Fixed:vm.concurrent2ndMortgageEnable=true;vm.creditLineCapEnable=false;vm.wrappedLoan.ref.subordinateFinancingDetails.creditLineCap=null;break;case srv.Concurrent2ndMortgageEnum.HELOC:vm.concurrent2ndMortgageEnable=true;vm.creditLineCapEnable=true;break;}}function refreshConcurrent2ndMortgageSection(){onConcurrent2ndMortgageChange(vm.wrappedLoan.ref.subordinateFinancingDetails.secondMortgageType);}}})();(function(){angular.module("loanDetails").controller("propertyInfoController",propertyInfoController);propertyInfoController.$inject=["$log","$scope","$modal","loanDetailsSvc","modalPopoverFactory","$controller","wrappedLoan","applicationData","loanEvent"];function propertyInfoController($log,$scope,$modal,loanDetailsSvc,modalPopoverFactory,$controller,wrappedLoan,applicationData,loanEvent){var vm=this;vm.wrappedLoan=wrappedLoan;vm.appraisedValueCtrl={};vm.applicationData=applicationData;vm.loanTypeEnum=srv.LoanPurposeTypeEnum;vm.editPropertyDetails=editPropertyDetails;vm.showAppraisedValuePopup=showAppraisedValuePopup;vm.effectivePropertyValue=effectivePropertyValue;vm.effectivePropertyValueName=effectivePropertyValueName;function editPropertyDetails(){var modalInstance=$modal.open({templateUrl:"angular/loandetails/dynamics/propertydetails.html",controller:"propertyDetailsController",controllerAs:"propertyDetailsController",backdrop:"static",windowClass:"imp-modal flyout imp-flyout-float-to-contextual",resolve:{propertyDetails:function(){return wrappedLoan.ref.getSubjectProperty();},wrappedLoan:function(){return wrappedLoan;},modalPopoverFactory:function(){return modalPopoverFactory;},userId:function(){return $scope.userAccountId;},loanId:function(){return $scope.selectedLoanId;},applicationData:function(){return applicationData;},loanEvent:function(){return loanEvent;}}});modalInstance.result.then(function(data){wrappedLoan.ref.setSubjectProperty(data);});}function effectivePropertyValue(){CheckEffectivePropertyValue();return vm.wrappedLoan.ref.getSubjectProperty().effectivePropertyValue;}function effectivePropertyValueName(){CheckEffectivePropertyValue();return vm.wrappedLoan.ref.getSubjectProperty().effectivePropertyValueName;}function CheckEffectivePropertyValue(){if(vm.wrappedLoan.ref.loanPurposeType&&vm.wrappedLoan.ref.loanPurposeType==1){if(vm.wrappedLoan.ref.getSubjectProperty().appraisedValue>0&&(vm.wrappedLoan.ref.getSubjectProperty().appraisedValue<=vm.wrappedLoan.ref.getSubjectProperty().purchasePrice)){vm.wrappedLoan.ref.getSubjectProperty().effectivePropertyValue=vm.wrappedLoan.ref.getSubjectProperty().appraisedValue;vm.wrappedLoan.ref.getSubjectProperty().effectivePropertyValueName="Appraised Value";}else{vm.wrappedLoan.ref.getSubjectProperty().effectivePropertyValue=vm.wrappedLoan.ref.getSubjectProperty().purchasePrice;vm.wrappedLoan.ref.getSubjectProperty().effectivePropertyValueName="Purchase Value";}}else{if(vm.wrappedLoan.ref.loanPurposeType&&vm.wrappedLoan.ref.loanPurposeType==2){if(vm.wrappedLoan.ref.getSubjectProperty().appraisedValue&&vm.wrappedLoan.ref.getSubjectProperty().appraisedValue>0){vm.wrappedLoan.ref.getSubjectProperty().effectivePropertyValue=vm.wrappedLoan.ref.getSubjectProperty().appraisedValue;vm.wrappedLoan.ref.getSubjectProperty().effectivePropertyValueName="Appraised Value";}else{vm.wrappedLoan.ref.getSubjectProperty().effectivePropertyValue=vm.wrappedLoan.ref.getSubjectProperty().currentEstimatedValue;vm.wrappedLoan.ref.getSubjectProperty().effectivePropertyValueName="Estimated Value";}}else{console.log("Error can't estimate purchase value loan type is unknown!");}}}function showAppraisedValuePopup(event){vm.appraisedValueCtrl=$controller("appraisedValueHistoryController");vm.appraisedValueCtrl.init($scope.selectedLoanId);vm.appraisedValueCtrl.event=event;}}})();var loanDetails;(function(loanDetails){var lockConfirmationController=(function(){function lockConfirmationController(model,$modalInstance,$modalStack,$filter,callbackYes){var _this=this;this.model=model;this.$modalInstance=$modalInstance;this.$modalStack=$modalStack;this.$filter=$filter;this.callbackYes=callbackYes;this.onYesClicked=function(){_this.callbackYes(true,_this.lockDate,_this.lockExpDate,_this.model.productId);};this.onNoClicked=function(){_this.$modalStack.dismissAll("close");};this.lockDate=moment();this.lockExpDate=moment().add(model.lockPeriod,"days");}Object.defineProperty(lockConfirmationController.prototype,"LockExpDate",{get:function(){return moment(this.lockExpDate).format("MM/DD/YY");},enumerable:true,configurable:true});lockConfirmationController.className="lockConfirmationController";lockConfirmationController.$inject=["model","$modalInstance","$modalStack","$filter","callbackYes"];return lockConfirmationController;})();angular.module("loanDetails").controller("lockConfirmationController",lockConfirmationController);})(loanDetails||(loanDetails={}));var loanCenter;(function(loanCenter){var testModeProductPopupController=(function(){function testModeProductPopupController(model,$modalStack,callBackSaveAndRequestDisclosure,callBackShowDisclosureLockModal,productId){var _this=this;this.model=model;this.$modalStack=$modalStack;this.callBackSaveAndRequestDisclosure=callBackSaveAndRequestDisclosure;this.callBackShowDisclosureLockModal=callBackShowDisclosureLockModal;this.productId=productId;this.done=function(){_this.cancel();if(!_this.model.isLock){_this.callBackSaveAndRequestDisclosure(null,null,null,_this.productId);}else{_this.callBackShowDisclosureLockModal(_this.productId);}};this.cancel=function(){_this.$modalStack.dismissAll("close");};if(this.model.productId){this.productId=this.model.productId;}}testModeProductPopupController.className="testModeProductPopupController";testModeProductPopupController.$inject=["model","$modalStack","callBackSaveAndRequestDisclosure","callBackShowDisclosureLockModal"];return testModeProductPopupController;})();loanCenter.testModeProductPopupController=testModeProductPopupController;angular.module("loanCenter").controller("testModeProductPopupController",testModeProductPopupController);})(loanCenter||(loanCenter={}));var loanCenter;(function(loanCenter){var complianceCheckPassedPopupController=(function(){function complianceCheckPassedPopupController(model,$modalStack,callBackSaveAndRequestDisclosure,checkSaveDiscloseActionsCallback){var _this=this;this.model=model;this.$modalStack=$modalStack;this.callBackSaveAndRequestDisclosure=callBackSaveAndRequestDisclosure;this.checkSaveDiscloseActionsCallback=checkSaveDiscloseActionsCallback;this.done=function(){_this.callBackSaveAndRequestDisclosure();_this.cancel();};this.cancel=function(){_this.$modalStack.dismissAll("close");_this.checkSaveDiscloseActionsCallback();};}complianceCheckPassedPopupController.className="complianceCheckPassedPopupController";complianceCheckPassedPopupController.$inject=["model","$modalStack","callBackSaveAndRequestDisclosure","checkSaveDiscloseActionsCallback"];return complianceCheckPassedPopupController;})();loanCenter.complianceCheckPassedPopupController=complianceCheckPassedPopupController;angular.module("loanCenter").controller(complianceCheckPassedPopupController.className,complianceCheckPassedPopupController);})(loanCenter||(loanCenter={}));var loanCenter;(function(loanCenter){var complianceCheckFailedPopupController=(function(){function complianceCheckFailedPopupController(model,$modalStack,callbackOpenDocument,checkSaveDiscloseActionsCallback,errorList){var _this=this;this.model=model;this.$modalStack=$modalStack;this.callbackOpenDocument=callbackOpenDocument;this.checkSaveDiscloseActionsCallback=checkSaveDiscloseActionsCallback;this.errorList=errorList;this.done=function(){_this.callbackOpenDocument(_this.model.documentRepositoryId,true,true);_this.cancel();};this.cancel=function(){_this.$modalStack.dismissAll("close");_this.checkSaveDiscloseActionsCallback();};this.getComplianceCheckErrorText=function(errorId){var complanceError=lib.findFirst(_this.model.complaianceCheckErrors,function(item){return item.value==errorId;},null);if(complanceError){return complanceError.text;}return"";};if(this.model.errorList){this.errorList=this.model.errorList;}}complianceCheckFailedPopupController.className="complianceCheckFailedPopupController";complianceCheckFailedPopupController.$inject=["model","$modalStack","callbackOpenDocument","checkSaveDiscloseActionsCallback"];return complianceCheckFailedPopupController;})();loanCenter.complianceCheckFailedPopupController=complianceCheckFailedPopupController;angular.module("loanCenter").controller(complianceCheckFailedPopupController.className,complianceCheckFailedPopupController);})(loanCenter||(loanCenter={}));(function(){angular.module("encompassModule",[]);})();(function(){angular.module("encompassModule").factory("encompassSvc",encompassSvc);encompassSvc.$inject=["$http","apiRoot","$resource","$state","NavigationSvc","digitaldocSvc","commonModalWindowFactory","modalWindowType","$modalStack","enums"];function encompassSvc($http,ApiRoot,$resource,$state,NavigationSvc,digitaldocSvc,commonModalWindowFactory,modalWindowType,$modalStack,enums){var encompassApiPath=ApiRoot+"Encompass/";function encompassExportDocument(loanId,userAccountId,fileStoreItemId,uploadedFileId,docCategory,documentClass,documentName){return $http.get(encompassApiPath+"ExportDocumentToEncompass",{params:{loanId:loanId,userAccountId:userAccountId,fileStoreItemId:fileStoreItemId,uploadedFileId:uploadedFileId,docCategory:docCategory,documentClass:documentClass,documentName:documentName}}).success(function(data){}).error(function(){});}function GetExportDocumentToEncompassRequestCompleted(restRequestId){return $http.get(encompassApiPath+"GetExportDocumentToEncompassRequestCompleted",{params:{restRequestId:restRequestId}}).success(function(data){}).error(function(){});}var EncompassService=$resource(encompassApiPath+":path",{path:"@path"},{ExportToEncompass:{method:"GET",params:{loanId:"loanId",userAccountId:"userAccountId",homeBuyingType:"homeBuyingType"}},GetLoanNumberExportToEncompassRequestCompleted:{method:"GET",params:{loanId:"loanId"}}});var requestDisclosurePackageLoanList=[];var encompassService={encompassExportDocument:encompassExportDocument,GetExportDocumentToEncompassRequestCompleted:GetExportDocumentToEncompassRequestCompleted,EncompassService:EncompassService,exportToEncompass:exportToEncompass,checkExportToEncompassProgress:checkExportToEncompassProgress,requestDisclosurePackageLoanList:requestDisclosurePackageLoanList,openExportUnsuccessful:openExportUnsuccessful,cancelTimer:cancelTimer};return encompassService;function exportToEncompass(wrappedLoan,callBack,action){EncompassService.ExportToEncompass({loanId:wrappedLoan.ref.loanId,userAccountId:wrappedLoan.ref.active.getBorrower().userAccount.userAccountId,homeBuyingType:wrappedLoan.ref.homeBuyingType}).$promise.then(function(result){checkExportToEncompassProgress(wrappedLoan,callBack,action);},function(error){openExportUnsuccessful(false);});}function checkExportToEncompassProgress(wrappedLoan,callBack,action,requestComplianceCheck,requestDisclosuresCallback,complianceCheckErrors,checkSaveDiscloseActionsCallback){var requestDisclosurePackage=_.contains(requestDisclosurePackageLoanList,wrappedLoan.ref.loanId);var intervalTime=requestDisclosurePackage?20000:5000;var numberOfAttempts=requestDisclosurePackage?240:60;cancelTimer();NavigationSvc.exportToEncompassInProgress=true;NavigationSvc.checkExportToEncompassProgressTimer=impInterval(function(result){if($state.current.name=="loanCenter.queue"){cancelTimer();return;}EncompassService.GetLoanNumberExportToEncompassRequestCompleted({loanId:wrappedLoan.ref.loanId}).$promise.then(function(data){if($state.current.name=="loanCenter.queue"){cancelTimer();return;}if(data.exportCallCompleted){if(data.loanNumberStatus){cancelTimer();$modalStack.dismissAll("close");wrappedLoan.ref.loanNumber=data.loanNumber;wrappedLoan.ref.isImportToFNMInProgress=false;if(!requestDisclosurePackage){if(action){if(action.value==enums.requestExportToEncompassAction.ExportToEncompass){commonModalWindowFactory.open({type:modalWindowType.success,message:"Export to Encompass Successful!"});}else{if(action.value==enums.requestExportToEncompassAction.UpdateEncompass){commonModalWindowFactory.open({type:modalWindowType.success,message:"Update Encompass Successful!"});}}}}else{if(requestComplianceCheck){digitaldocSvc.checkComplianceCheckStatus(wrappedLoan,wrappedLoan.ref.loanId,requestDisclosuresCallback,complianceCheckErrors,checkSaveDiscloseActionsCallback);}else{digitaldocSvc.checkLoanDisclosureStatus(wrappedLoan,wrappedLoan.ref.loanId);requestDisclosurePackageLoanList.pop(wrappedLoan.ref.loanId);}}if(callBack){callBack(wrappedLoan);}}else{onExportError(wrappedLoan);}}},function(error){return onExportError(wrappedLoan);});},intervalTime,numberOfAttempts);NavigationSvc.checkExportToEncompassProgressTimeoutTimer=impInterval(function(){onExportError(wrappedLoan);},660000,1);}function cancelTimer(){if(typeof(NavigationSvc.checkExportToEncompassProgressTimer.cancel)=="function"){NavigationSvc.checkExportToEncompassProgressTimer.cancel();}if(typeof(NavigationSvc.checkExportToEncompassProgressTimeoutTimer.cancel)=="function"){NavigationSvc.checkExportToEncompassProgressTimeoutTimer.cancel();}NavigationSvc.exportToEncompassInProgress=false;}function onExportError(wrappedLoan){wrappedLoan.ref.isImportToFNMInProgress=false;var requestDisclosurePackage=_.contains(requestDisclosurePackageLoanList,wrappedLoan.ref.loanId);requestDisclosurePackageLoanList.pop(wrappedLoan.ref.loanId);return openExportUnsuccessful(requestDisclosurePackage);}function openExportUnsuccessful(requestDisclosurePackage){if(NavigationSvc.exportToEncompassInProgress&&$state.current.name!="loanCenter.queue"){var errorMessage=requestDisclosurePackage?"An error occured while requesting Disclosures during the export to Encompass. Please try again or call support.":"An error occured while exporting this loan to Encompass. Please try again.";commonModalWindowFactory.open({type:modalWindowType.unsuccess,message:errorMessage});}cancelTimer();}}})();(function(){angular.module("digitaldocModule",[]);})();(function(){angular.module("digitaldocModule").factory("digitaldocSvc",digitaldocSvc);digitaldocSvc.$inject=["$http","apiRoot","$resource","NavigationSvc","commonModalWindowFactory","modalWindowType","$state","costDetailsSvc","BroadcastSvc","$modal","docVaultSvc"];function digitaldocSvc($http,ApiRoot,$resource,NavigationSvc,commonModalWindowFactory,modalWindowType,$state,costDetailsSvc,BroadcastSvc,$modal,docVaultSvc){var digitaldocApiPath=ApiRoot+"DigitalDoc/";var DigitalDocService=$resource(digitaldocApiPath+"RequestDisclosurePackages",{},{RequestDisclosurePackages:{method:"POST",params:{loanProductId:"loanProductId",requestComplianceCheck:"requestComplianceCheck"}}});var RetrieveActiveDisclosureDetail=$resource(digitaldocApiPath+"RetrieveActiveDisclosureDetail",{loanId:"@loanId"});var RetrieveComplianceCheckStatus=$resource(digitaldocApiPath+"RetrieveComplianceCheckStatus",{loanId:"@loanId"});var digitalDocService={DigitalDocService:DigitalDocService,RetrieveActiveDisclosureDetail:RetrieveActiveDisclosureDetail,requestDisclosurePackages:requestDisclosurePackages,checkLoanDisclosureStatus:checkLoanDisclosureStatus,cancelTimer:cancelTimer,requestComplianceCheck:requestComplianceCheck,RetrieveComplianceCheckStatus:RetrieveComplianceCheckStatus,checkComplianceCheckStatus:checkComplianceCheckStatus};return digitalDocService;function requestDisclosurePackages(showConfirmation,loanProductId,wrappedLoan){if(showConfirmation){commonModalWindowFactory.open({type:modalWindowType.success,message:"Disclosures Requested",messageDetails:"The disclosures will arrive into the DocVault shortly"});}DigitalDocService.RequestDisclosurePackages({loanProductId:loanProductId,requestComplianceCheck:false},wrappedLoan.ref).$promise.then(function(data){NavigationSvc.exportToDigitalInProgress=true;wrappedLoan.ref.updateDisclosureStatusForAllLoanApplications(srv.DisclosureStatusEnum.RequestInProgress);if(!wrappedLoan.ref.loanNumber||wrappedLoan.ref.loanNumber=="Pending"){return;}checkLoanDisclosureStatus(wrappedLoan,wrappedLoan.ref.loanId);},function(error){console.log("Error:"+JSON.stringify(error));});}function requestComplianceCheck(showConfirmation,loanProductId,wrappedLoan,requestDisclosuresCallback,complianceCheckErrors,checkSaveDiscloseActionsCallback){if(showConfirmation){commonModalWindowFactory.open({type:modalWindowType.success,message:"Compliance Check Requested",messageDetails:"The report will be available in the DocVault shortly."});}DigitalDocService.RequestDisclosurePackages({loanProductId:loanProductId,requestComplianceCheck:true},wrappedLoan.ref).$promise.then(function(data){NavigationSvc.exportToDigitalInProgress=true;wrappedLoan.ref.updateComplianceCheckStatusForAllLoanApplications(srv.ComplianceCheckStatusEnum.InProgress);checkComplianceCheckStatus(wrappedLoan,wrappedLoan.ref.loanId,requestDisclosuresCallback,complianceCheckErrors,checkSaveDiscloseActionsCallback);},function(error){console.log("Error:"+JSON.stringify(error));});}function checkLoanDisclosureStatus(wrappedLoan,selectedLoanId){cancelTimer();NavigationSvc.exportToDigitalInProgress=true;NavigationSvc.checkLoanDisclosureStatusTimer=impInterval(function(){if($state.current.name=="loanCenter.queue"){cancelTimer();return;}RetrieveActiveDisclosureDetail.get({loanId:selectedLoanId}).$promise.then(function(data){if($state.current.name=="loanCenter.queue"){cancelTimer();return;}var eConsented=wrappedLoan.ref.active.docDelivery==srv.docDeliveryTypeEnum.Electronic&&wrappedLoan.ref.active.getBorrower().eConsent.consentStatus!=srv.ConsentStatusEnum.None;if(data.disclosureStatus!=srv.DisclosureStatusEnum.RequestInProgress&&!(data.disclosureStatus==srv.DisclosureStatusEnum.DisclosuresCreated&&eConsented)){cancelTimer();updateDisclosureDetails(wrappedLoan,data.disclosuresDetails,data.disclosureStatus);commonModalWindowFactory.open({type:modalWindowType.success,message:"Disclosures Received",messageDetails:"Go to the DocVault to view your Disclosures."});}},function(error){disclosuresFailed();console.log("Error:"+JSON.stringify(error));});},20000,30);NavigationSvc.checkLoanDisclosureStatusTimeoutTimer=impInterval(function(){disclosuresFailed();},660000,1);}function checkComplianceCheckStatus(wrappedLoan,selectedLoanId,requestDisclosuresCallback,complianceCheckErrors,checkSaveDiscloseActionsCallback){cancelTimer();NavigationSvc.exportToDigitalInProgress=true;NavigationSvc.checkComplianceCheckStatusTimer=impInterval(function(){if($state.current.name=="loanCenter.queue"){cancelTimer();return;}RetrieveComplianceCheckStatus.get({loanId:selectedLoanId}).$promise.then(function(data){if($state.current.name=="loanCenter.queue"){cancelTimer();return;}if(data.complianceStatus!=srv.ComplianceCheckStatusEnum.InProgress){cancelTimer();wrappedLoan.ref.updateComplianceCheckStatusForLoanApplication(data.complianceStatus,selectedLoanId);if(data.complianceStatus==srv.ComplianceCheckStatusEnum.Passed){var modalInstance=$modal.open({templateUrl:"angular/loandetails/compliancecheckpopup/compliancecheckpassedpopup.html",backdrop:"static",windowClass:"imp-center-modal compliance-check-modal",controller:"complianceCheckPassedPopupController",controllerAs:"complianceCheckPassedPopupCtrl",resolve:{model:function(){return{};},callBackSaveAndRequestDisclosure:function(){return requestDisclosuresCallback;},checkSaveDiscloseActionsCallback:function(){return checkSaveDiscloseActionsCallback;}}});}else{if(data.complianceStatus==srv.ComplianceCheckStatusEnum.Failed){var modalInstance=$modal.open({templateUrl:"angular/loandetails/compliancecheckpopup/compliancecheckfailedpopup.html",backdrop:"static",windowClass:"imp-center-modal compliance-check-modal-failed",controller:"complianceCheckFailedPopupController",controllerAs:"complianceCheckFailedPopupCtrl",resolve:{model:function(){return{errorList:data.errorList,complaianceCheckErrors:complianceCheckErrors,documentRepositoryId:data.documentRepositoryId};},callbackOpenDocument:function(){return docVaultSvc.openDocument;},checkSaveDiscloseActionsCallback:function(){return checkSaveDiscloseActionsCallback;}}});}}}},function(error){complianceCheckFailed();console.log("Error:"+JSON.stringify(error));});},20000,30);}function disclosuresFailed(){if(NavigationSvc.exportToDigitalInProgress&&$state.current.name!="loanCenter.queue"){commonModalWindowFactory.open({type:modalWindowType.unsuccess,message:"An error occured while requesting Compliance check report during the export to Digital Docs. Please try again or call support."});}cancelTimer();}function complianceCheckFailed(){if(NavigationSvc.exportToDigitalInProgress&&$state.current.name!="loanCenter.queue"){commonModalWindowFactory.open({type:modalWindowType.unsuccess,message:"An error occured while requesting Disclosures during the export to Digital Docs. Please try again or call support."});}cancelTimer();}function cancelTimer(){if(typeof(NavigationSvc.checkLoanDisclosureStatusTimer.cancel)=="function"){NavigationSvc.checkLoanDisclosureStatusTimer.cancel();}if(typeof(NavigationSvc.checkLoanDisclosureStatusTimeoutTimer.cancel)=="function"){NavigationSvc.checkLoanDisclosureStatusTimeoutTimer.cancel();}if(typeof(NavigationSvc.checkComplianceCheckStatusTimer.cancel)=="function"){NavigationSvc.checkComplianceCheckStatusTimer.cancel();}NavigationSvc.exportToDigitalInProgress=false;}function updateDisclosureDetails(wrappedLoan,data,disclosureStatus){angular.forEach(wrappedLoan.ref.closingCost.disclosuresDetailsViewModel,function(group){group.active=false;});wrappedLoan.ref.closingCost.disclosuresDetailsViewModel.unshift(data);if(wrappedLoan.ref.loanPurposeType==srv.LoanPurposeTypeEnum.Refinance){wrappedLoan.ref.closingCost.calculatedCashToClose.loanEstimates.loanAmount=data.loanAmount;wrappedLoan.ref.closingCost.calculatedCashToClose.loanEstimates.totalClosingCosts=data.totalClosingCosts;wrappedLoan.ref.closingCost.calculatedCashToClose.loanEstimates.closingCostsPaidBeforeClosing=data.closingCostsPaidBeforeClosing;wrappedLoan.ref.closingCost.calculatedCashToClose.loanEstimates.totalPayoffsAndPayments=data.totalPayoffs;}wrappedLoan.ref.updateDisclosureStatusForAllLoanApplications(disclosureStatus);costDetailsSvc.getActiveToleranceGroup().then(function(data){BroadcastSvc.broadcastCostDetailsTotals(wrappedLoan.ref.closingCost.totals);});if($state.current.name=="loanCenter.loan.documents.docvault"){wrappedLoan.ref.documents.documentsLoaded=false;$state.go("loanCenter.loan.refresh",{page:"loanCenter.loan.documents.docvault"});}}}})();(function(){angular.module("integrations.common",[]);})();(function(){angular.module("integrations.common").service("commonintegrationsSvc",commonintegrationsSvc);commonintegrationsSvc.$inject=["$resource","apiRoot","$http"];function commonintegrationsSvc($resource,apiRoot,$http){var commonIntegrationsApiPath=apiRoot+"CommonIntegrations/";var services=$resource(commonIntegrationsApiPath+":path",{path:"@path"},{getLoanServiceStatus:{method:"GET",params:{loanServiceId:"loanServiceId"}},getClosingCorpSSOToken:{method:"GET"}});var commonIntegrationsService={services:services};return commonIntegrationsService;}})();(function(){angular.module("loanDetails").controller("monthlyIncomeController",monthlyIncomeController);function monthlyIncomeController(){var vm=this;vm.test="Monthly Income";}})();(function(){angular.module("loanDetails").controller("monthlyLiabilitiesController",monthlyLiabilitiesController);function monthlyLiabilitiesController(){var vm=this;vm.test="Monthly Liabilities";}})();(function(){angular.module("documents",[]);})();(function(){angular.module("documents").config(config);config.$inject=["$stateProvider"];function config($stateProvider){$stateProvider.state("loanCenter.loan.documents",{url:"/documents",views:{"documents":{templateUrl:"/angular/documents/documents.html",controller:"documentsController as documentsCtrl"}},resolve:{wrappedLoan:function(docVaultResolver,docVaultSvc,applicationData,wrappedLoan,commonModalWindowFactory,modalWindowType){return docVaultResolver(docVaultSvc,applicationData,wrappedLoan,commonModalWindowFactory,modalWindowType);}}}).state("loanCenter.loan.documents.needslist",{url:"/needslist",views:{"documentsContent":{templateUrl:"/angular/documents/needslist/needslist.html",controller:"needslistController as needslistCtrl"}},resolve:{}}).state("loanCenter.loan.documents.docvault",{url:"/docvault",views:{"documentsContent":{templateUrl:"/angular/documents/docvault/docvaultcontent.html",controller:"docVaultController as docVault"}},resolve:{}});}})();var documents;(function(_documents){var DocumentsService=(function(){function DocumentsService($http,apiRoot,docVaultSvc,$log){var _this=this;this.$http=$http;this.apiRoot=apiRoot;this.docVaultSvc=docVaultSvc;this.$log=$log;this.fillDocVaultTypes=function(data,loanAppList,docVaultDocuments,applicationData){_this.docVaultTypes=_.filter(data.documentTypes,function(item){return item.borrowerProvides==true;});_this.recheckToBeCompletedNeedsList(applicationData,loanAppList,docVaultDocuments);};this.recheckToBeCompletedNeedsList=function(applicationData,loanAppList,docVaultDocuments){for(var i=0;i<loanAppList.length;i++){if(!!loanAppList[i].documents){for(var j=0;j<loanAppList[i].documents.length;j++){for(var z=0;z<docVaultDocuments.length;z++){var documentCategoryIds=_this.getDocumentCategoryIdFromMapping(applicationData,_this.getDocumentTypeIdByTypeId(docVaultDocuments[z].documentTypeId));if(documentCategoryIds!=null&&_.some(documentCategoryIds,function(x){return x.documentCategoryId==loanAppList[i].documents[j].documentCategoryId;})&&docVaultDocuments[z].status!=6&&docVaultDocuments[z].uploadedBy==1){loanAppList[i].documents[j].isCompleted=true;loanAppList[i].documents[j].received=new Date(docVaultDocuments[z].lastUpdated);break;}else{loanAppList[i].documents[j].isCompleted=false;}}}}}};this.getDocumentCategoryIdFromMapping=function(applicationData,documentTypeId){var documentMapping=_.filter(applicationData.documentMappings,function(documentMapping){return documentMapping.documentTypeId==documentTypeId;});if(documentMapping!=null){return documentMapping;}return null;};this.getDocumentTypeIdFromMapping=function(applicationData,documentCategoryId){if(documentCategoryId==-1){return -1;}var documentMapping=_.filter(applicationData.documentMappings,function(documentMapping){return documentMapping.documentCategoryId==documentCategoryId;})[0];if(documentMapping!=null){return documentMapping.documentTypeId;}return null;};this.downloadDocument=function(documentId){var downloadLink=_this.getDocumentUrl(documentId,null);if(downloadLink!=""){window.open(downloadLink,"_blank","");}};this.openDocument=function(documentId,inBrowser,inTab){var downloadLink=_this.getDocumentUrl(documentId,inBrowser);if(!common.string.isNullOrWhiteSpace(downloadLink)&&!common.string.isEmptyGuid(downloadLink)){if(inTab){window.open(downloadLink,"_blank","");}else{window.open(downloadLink,"_blank","location=0");}}};this.getDocumentTypeIdByTypeId=function(typeId){if(typeId==null){return null;}var docVaultType=_.filter(_this.docVaultTypes,function(docVaultType){return docVaultType.typeId==typeId;})[0];if(!!docVaultType){return docVaultType.documentTypeId;}return null;};this.getDocumentUrl=function(documentId,inBrowser){if(!documentId){return"";}var encodedRepositoryId=encodeURIComponent(documentId);var url="/Downloader.axd?documentType=repositoryItem&repositoryItemId="+encodedRepositoryId;if(inBrowser!=null&&inBrowser){url=url+"&browser=true";}return url;};this.filterDocumentList=function(documents,applicationData){var self=_this;var list=[];if(!!documents){for(var i=0;i<documents.length;i++){if(documents[i].isUserEntry){list.push(documents[i]);continue;}if(documents[i].isDeleted||documents[i].isCompleted){continue;}for(var j=0;j<applicationData.documentMappings.length;j++){for(var z=0;z<_this.docVaultTypes.length;z++){if(documents[i].documentCategoryId==applicationData.documentMappings[j].documentCategoryId&&applicationData.documentMappings[j].documentTypeId==_this.docVaultTypes[z].documentTypeId&&!!_this.docVaultTypes[z].borrowerProvides){list.push(documents[i]);}}}}if(list&&list.length>1){list.sort(function(x,y){var a=lib.filter(self.DocVaultTypes,function(t){return t.documentTypeId==self.getDocumentTypeIdFromMapping(applicationData,x.documentCategoryId);});var b=lib.filter(self.DocVaultTypes,function(t){return t.documentTypeId==self.getDocumentTypeIdFromMapping(applicationData,y.documentCategoryId);});if(a.length!=0&&b.length!=0){if(a[0].fullDescription>b[0].fullDescription){return 1;}else{return -1;}}return 0;});}}return list;};this.isThereActiveDocuments=function(documents,applicationData){if(!!documents){return _this.filterDocumentList(documents,applicationData).filter(function(item){return !item.isDeleted;}).length>0;}return false;};this.docVaultTypes=[];}Object.defineProperty(DocumentsService.prototype,"DocVaultTypes",{get:function(){return this.docVaultTypes;},enumerable:true,configurable:true});DocumentsService.$inject=["$http","apiRoot","docVaultSvc","$log"];DocumentsService.className="DocumentsService";return DocumentsService;})();_documents.DocumentsService=DocumentsService;moduleRegistration.registerService("documents",DocumentsService);})(documents||(documents={}));var documents;(function(documents){var documentsController=(function(){function documentsController($state,NavigationSvc,enums,wrappedLoan){var _this=this;this.$state=$state;this.NavigationSvc=NavigationSvc;this.enums=enums;this.wrappedLoan=wrappedLoan;this.switchTab=function(state){var command;switch(state){case"loanCenter.loan.documents.needslist":command={navigateToState:"loanCenter.loan.documents.needslist",selectedTab:"NeedsList"};break;case"loanCenter.loan.documents.docvault":command={navigateToState:"loanCenter.loan.documents.docvault",selectedTab:"DocVault"};break;}angular.forEach(_this.NavigationSvc.DocumentsTabs,function(tab,tabName){if(command.selectedTab.toLowerCase()===tabName.toLowerCase()){tab.isSelected=true;}else{tab.isSelected=false;}});_this.$state.go(command.navigateToState);};this.documentsTabs=NavigationSvc.DocumentsTabs;NavigationSvc.contextualType=enums.ContextualTypes.Documents;var vm=this;vm.wrappedLoan=wrappedLoan;}documentsController.$inject=["$state","NavigationSvc","enums","wrappedLoan"];return documentsController;})();documents.documentsController=documentsController;angular.module("documents").controller("documentsController",documentsController);})(documents||(documents={}));var documents;(function(documents){var NeedsListService=(function(){function NeedsListService($http,apiRoot){var _this=this;this.$http=$http;this.apiRoot=apiRoot;this.getCoverLetterId=function(loanId,documentClass,userAccountId){var getDataApiUrl=_this.apiRoot+"/CreateCoverLetterAndGetId";var parameters={loanId:loanId,coverLetter:documentClass,userAccountId:userAccountId};var config={params:parameters};return _this.triggerRequest(getDataApiUrl,config);};this.sendCoverLetter=function(loanId,fileStoreItemId,recipients){var getDataApiUrl=_this.apiRoot+"/SendBorrowersNeedsListCoverLetter";var parameters={loanId:loanId,fileStoreItemId:fileStoreItemId,recipients:recipients};var config={params:parameters};return _this.triggerRequest(getDataApiUrl,config);};this.triggerRequest=function(url,config){return _this.$http.get(url,config).then(function(response){return response.data;});};this.apiRoot=apiRoot+"Document";}NeedsListService.prototype.isEmailValid=function(email){return email&&email.indexOf("newprospect")==-1;};NeedsListService.$inject=["$http","apiRoot"];NeedsListService.className="needsListService";return NeedsListService;})();documents.NeedsListService=NeedsListService;moduleRegistration.registerService("documents",NeedsListService);})(documents||(documents={}));var documents;(function(_documents){var needslistController=(function(){function needslistController(wrappedLoan,applicationData,$modal,NavigationSvc,$state,docVaultSvc,$log,guidService,enums,$timeout,needsListService,DocumentsService,commonModalWindowFactory,modalWindowType){var _this=this;this.wrappedLoan=wrappedLoan;this.applicationData=applicationData;this.$modal=$modal;this.NavigationSvc=NavigationSvc;this.$state=$state;this.docVaultSvc=docVaultSvc;this.$log=$log;this.guidService=guidService;this.enums=enums;this.$timeout=$timeout;this.needsListService=needsListService;this.DocumentsService=DocumentsService;this.commonModalWindowFactory=commonModalWindowFactory;this.modalWindowType=modalWindowType;this.setPropertyAddresses=function(loanApplication){var dropDownAddress=[];loanApplication.getUniqueProperties().forEach(function(property){if(property){dropDownAddress.push(new cls.LookupItem(property.fullAddressString,property.propertyId));}});return dropDownAddress;};this.downloadDocument=function(repositoryId){_this.docVaultSvc.downloadDocument(repositoryId);};this.getDocVaultTypes=function(){return _this.DocumentsService.DocVaultTypes;};this.getDocumentTypeIdByTypeId=function(typeId){return _this.DocumentsService.getDocumentTypeIdByTypeId(_this.applicationData,typeId);};this.getDocumentCategoryIdFromMapping=function(documentTypeId){if(documentTypeId==null){return null;}return _this.DocumentsService.getDocumentCategoryIdFromMapping(_this.applicationData,documentTypeId);};this.updateDocumentCategoryIdFromMapping=function(item,documentTypeId){if(documentTypeId==null){return null;}var documentMapping=_.filter(_this.applicationData.documentMappings,function(documentMapping){return documentMapping.documentTypeId==documentTypeId;})[0];if(documentMapping!=null){item.documentCategoryId=documentMapping.documentCategoryId;}};this.getDocumentTypeIdFromMapping=function(documentCategoryId){return _this.DocumentsService.getDocumentTypeIdFromMapping(_this.applicationData,documentCategoryId);};this.getDescription=function(item){if(item.description==null||item.description===""){var documentCategory=_.filter(_this.applicationData.documentCategories,function(documentCategory){return item.documentCategoryId==documentCategory.categoryId;})[0];if(documentCategory!=null){item.description=documentCategory.description;}}return item.description;};this.populateSendList=function(loanApplication){var sendList=[];sendList.push({name:"Email to "+loanApplication.getBorrower().fullName,disabled:_this.needsListService.isEmailValid(loanApplication.getBorrower().userAccount.username)?false:true,email:loanApplication.getBorrower().userAccount.username,selected:true});if(loanApplication.isSpouseOnTheLoan){sendList.push({name:"Email to "+loanApplication.getCoBorrower().fullName,disabled:_this.needsListService.isEmailValid(loanApplication.getCoBorrower().userAccount.username)?false:true,email:loanApplication.getCoBorrower().userAccount.username,selected:false});sendList.push({name:"Email to "+loanApplication.getBorrower().firstName+", "+loanApplication.getCoBorrower().firstName,disabled:(!_this.needsListService.isEmailValid(loanApplication.getBorrower().userAccount.username)||!_this.needsListService.isEmailValid(loanApplication.getCoBorrower().userAccount.username))?true:false,email:loanApplication.getBorrower().userAccount.username?loanApplication.getBorrower().userAccount.username+";"+loanApplication.getCoBorrower().userAccount.username:"",selected:false});}_this.selectedBorrowerFromSendList=sendList[0];return sendList;};this.chooseBorrowerFromSendList=function(item,collection,loanApplication){if(!collection||!item){_this.$log.error("Collection or item is undenfined in Send button list");return;}for(var i=collection.length-1;i>=0;i--){collection[i].selected=false;}item.selected=true;_this.selectedBorrowerFromSendList=item;_this.sendList(item,loanApplication);};this.disableSendListButton=function(sendList){if(!sendList){_this.$log.error("Send list is undenfined");return;}for(var i=0,length=sendList.length;i<length;i++){if(_this.needsListService.isEmailValid(sendList[i].email)){return false;}}return true;};this.createNeedsListButton=function(loanApplication){var self=_this;self.wrappedLoan.ref.createDocumentsBorrowerNeeds=true;self.NavigationSvc.SaveAndUpdateWrappedLoan(self.applicationData.currentUserId,self.wrappedLoan,function(wrappedLoan){self.commonModalWindowFactory.open({type:self.modalWindowType.success,message:"Borrower Needs List Has Been Created"});self.refresh();},null,"Saving loan and creating Borrowers Needs List");};this.triggerSendListButton=function(loanApplication){var email;var self=_this;var sendList=_this.populateSendList(loanApplication);if(sendList!=null){self.sendList(sendList[0],loanApplication);}};this.toggleEditMode=function(item){item.isInEditMode=!item.isInEditMode;if(item.isInEditMode){item.isItemClicked=false;}else{_this.DocumentsService.recheckToBeCompletedNeedsList(_this.applicationData,_this.wrappedLoan.ref.getLoanApplications(),_this.wrappedLoan.ref.documents.docVaultDocuments);}if(item.isAdded===true){item.isAdded=false;}};this.filterDocumentList=function(documents){return _this.DocumentsService.filterDocumentList(documents,_this.applicationData);};this.isThereActiveDocuments=function(documents){return _this.DocumentsService.isThereActiveDocuments(documents,_this.applicationData);};this.toggleSections=function(object,value){for(var item in object){if(object.hasOwnProperty(item)){object[item]=value;}}};this.openContactFlyout=function(){var self=_this;var modalInstance=_this.$modal.open({templateUrl:"angular/loanparticipants/loanparticipants.html",backdrop:"static",windowClass:"imp-modal flyout imp-modal-agents-parties",controller:"LoanParticipantsModal",controllerAs:"modalCtrl",resolve:{wrappedLoan:function(){return self.wrappedLoan;},applicationData:function(){return self.applicationData;}}});};this.setRowClicked=function(documents,item){for(var i=0;i<documents.length;i++){documents[i].isItemClicked=false;}if(!item.isInEditMode){item.isItemClicked=true;}};this.pupulateBorrowerList=function(loanApplication){var tempBorrowerList=loanApplication.borrowerList(true);return tempBorrowerList;};this.refresh=function(){_this.$state.go("loanCenter.loan.refresh",{page:"loanCenter.loan.documents.needslist"});};this.saveAll=function(){var self=_this;_this.NavigationSvc.SaveAndUpdateWrappedLoan(_this.applicationData.currentUserId,_this.wrappedLoan,function(wrappedLoan){self.refresh();},function(error){this.$log.error(error);});};this.cancelChanges=function(){_this.NavigationSvc.cancelChanges(_this.wrappedLoan.ref.loanId);};this.deleteItem=function(loanApplication,item){var index=loanApplication.documents.indexOf(item);if(index===-1){console.error("Borrower needs list, item is not contained in array ",item);return;}if(loanApplication.documents[index].isUserEntry){loanApplication.documents.splice(index,1);}else{loanApplication.documents[index].isDeleted=true;}};this.addItem=function(loanApplication){var document=new cls.DocumentsViewModel();if(!loanApplication.documents){loanApplication.documents=[];}_this.guidService.getNewGuid().then(function(response){document.documentId=response.data;});document.loanId=_this.wrappedLoan.ref.loanId;document.isUserEntry=true;document.dateCreated=new Date();document.isInEditMode=true;document.isDeleted=false;document.isAdded=true;document.documentCategoryId=0;document.isCompleted=false;document.documentCategoryId=0;document.status=1;document.documentNotification="";_this.$timeout(function(){loanApplication.documents.push(document);},0);};this.getBatchIdFromMetadata=function(metadata){var batchObject=metadata.filter(function(item){return item.key==="Batch ID";})[0];return batchObject?batchObject.value:"";};this.enableAddressField=function(documentTypeId){if(documentTypeId==null){return false;}var docVaultType=_.filter(_this.getDocVaultTypes(),function(item){return item&&item.documentTypeId==documentTypeId;})[0];if(docVaultType==null||docVaultType.metadata==null){return false;}for(var i=0;i<docVaultType.metadata.length;i++){if(docVaultType.metadata[i].type==="REOAddressList"){return true;}}return false;};this.getBatchIdForBorrowerUploadedSection=function(repositoryItemId){var docValut=_this.wrappedLoan.ref.documents.docVaultDocuments,docValutMetadata;for(var i=0,length=docValut.length;i<length;i++){if(docValut[i].repositoryId===repositoryItemId){docValutMetadata=docValut[i].metadata;}}return docValutMetadata?_this.getBatchIdFromMetadata(docValutMetadata):"";};this.getStatusByValue=function(status){for(var key in _this.enums.uploadedFileStatus){if(_this.enums.uploadedFileStatus.hasOwnProperty(key)){if(_this.enums.uploadedFileStatus[key]===status){return key.charAt(0).toUpperCase()+key.slice(1);}}}};this.previewList=function(loanId){var self=_this;self.commonModalWindowFactory.open({type:self.modalWindowType.loader,message:"Generating preview list"});_this.NavigationSvc.SaveAndUpdateWrappedLoan(_this.applicationData.currentUserId,_this.wrappedLoan,function(wrappedLoan){self.needsListService.getCoverLetterId(loanId,21,self.applicationData.currentUser.userAccountId).then(function(data){self.DocumentsService.openDocument(data,true,true);self.commonModalWindowFactory.close();});},function(error){self.$log.error(error);},null,false);};this.sendList=function(item,loanApplication){var self=_this;self.commonModalWindowFactory.open({type:self.modalWindowType.loader,message:"Sending an e-mail"});_this.NavigationSvc.SaveAndUpdateWrappedLoan(_this.applicationData.currentUserId,_this.wrappedLoan,function(wrappedLoan){self.needsListService.getCoverLetterId(loanApplication.loanApplicationId,21,self.applicationData.currentUser.userAccountId).then(function(data){if(item.email){self.needsListService.sendCoverLetter(loanApplication.loanApplicationId,data,item.email).then(function(data){self.commonModalWindowFactory.close();},function(error){self.commonModalWindowFactory.open({type:self.modalWindowType.error,message:"We could not send an e-mail at this time, please try again later. Thank you."});self.commonModalWindowFactory.close();});}},function(error){self.$log.error(error);self.commonModalWindowFactory.close();});},function(error){self.$log.error(error);},null,false);};var self=this;docVaultSvc.DocumentsServices.GetDocTypeFields().$promise.then((function(data){self.DocumentsService.fillDocVaultTypes(data,self.wrappedLoan.ref.getLoanApplications(),self.wrappedLoan.ref.documents.docVaultDocuments,self.applicationData);}).bind(self),function(error){$log.error("Failure in Document Type retrieval",error);});var listOfCategoryIds=[];this.wrappedLoan.ref.getLoanApplications().forEach(function(loanApp){loanApp.documents.forEach(function(document){document.description=_this.getDescription(document);if(!document.isDeleted){listOfCategoryIds.push(document.documentCategoryId);}});});self.receivedFromBorrower=_.filter(self.wrappedLoan.ref.documents.docVaultDocuments,function(item){return item&&item.category!="Unclassified"&&item.uploadedBy==1&&!!_.some(self.getDocVaultTypes(),function(docVaultType){return docVaultType.typeId==item.documentTypeId;})&&_.some(listOfCategoryIds,function(categoryId){return item.categoryId===categoryId;});});}needslistController.$inject=["wrappedLoan","applicationData","$modal","NavigationSvc","$state","docVaultSvc","$log","guidService","enums","$timeout","needsListService","DocumentsService","commonModalWindowFactory","modalWindowType"];return needslistController;})();_documents.needslistController=needslistController;angular.module("documents").controller("needslistController",needslistController);})(documents||(documents={}));(function(){angular.module("docVault",["loanCenter.core"]);})();(function(){angular.module("docVault").factory("docVaultSvc",docVaultSvc);docVaultSvc.$inject=["$log","$resource","apiRoot","modalPopoverFactory","$modal","enums","$q","$controller"];function docVaultSvc($log,$resource,ApiRoot,modalPopoverFactory,$modal,enums,$q,$controller){var docVaultApiPath=ApiRoot+"DocVault/";var docVaultServiceApiPath=ApiRoot+"DocVaultService/";var docVaultButtonSelected=0;var vm=this;var documentCtrl=angular.extend(this,$controller("DocumentCtrl",{$scope:vm}));function setDocVaultButtonSelected(value){docVaultButtonSelected=value;}function getDocVaultButtonSelected(){return docVaultButtonSelected;}function openDocVaultMenu(event,wrappedLoan,document,groupedDocuments){vm.wrappedLoan=wrappedLoan;vm.groupedDocuments=groupedDocuments;var menuPopup=modalPopoverFactory.openModalPopover("angular/documents/docvault/docvaultmenu.html",this,document,event);}function openDocVaultFlyoutMenu(event,document){return modalPopoverFactory.openModalPopover("angular/documents/docvault/docvaultflyoutmenu.html",this,document,event);}function groupDocuments(documents,isFlyout){var extDocuments=[];if(documents!=null){for(var i=0;i<documents.length;i++){extDocuments.push(new cls.DocVaultDocumentViewModel(documents[i]));}}var groupedDocuments=new lib.referenceWrapper(_.groupBy(_.where(extDocuments,{deleted:false}),"categorySortName"));if(_.size(groupedDocuments.ref)&&!isFlyout){groupedDocuments.ref[Object.keys(groupedDocuments.ref).sort()[0]].isExpanded=true;}if("01Unclassified" in groupedDocuments.ref){groupedDocuments.ref["01Unclassified"].isUnclassified=true;}return groupedDocuments;}function showDocuments(docVaultDocuments){vm.groupedDocuments.ref=_.groupBy(_.where(docVaultDocuments,{deleted:false}),"categorySortName");if(_.size(vm.groupedDocuments.ref)){vm.groupedDocuments.ref[Object.keys(vm.groupedDocuments.ref).sort()[0]].isExpanded=true;}else{}if("01Unclassified" in vm.groupedDocuments.ref){vm.groupedDocuments.ref["01Unclassified"].isUnclassified=true;}return vm.groupedDocuments;}function classifyDocument(event,document){showDocumentClassificationPopup(document,event).then(function(data){showDocuments(vm.wrappedLoan.ref.documents.docVaultDocuments);},function(error){});}function showDocumentClassificationPopup(document,event){var documentTypes;var q=$q.defer();DocumentsServices.GetDocTypeFields().$promise.then(function(data){documentTypes=data.documentTypes;var classifyPopup=$modal.open({templateUrl:"angular/documents/docvault/docvaultclassify.html",controller:"docVaultClassifyController as controller",windowClass:"imp-center-modal docvault-classifydocument-popup",backdrop:"static",resolve:{documentTypes:function(){return documentTypes;},wrappedLoan:function(){return vm.wrappedLoan;},document:function(){return document;}}});classifyPopup.result.then(function(classifiedDocument){for(var i=0;i<vm.wrappedLoan.ref.documents.docVaultDocuments.length;i++){if(vm.wrappedLoan.ref.documents.docVaultDocuments[i].uploadedFileId==classifiedDocument.uploadedFileId){vm.wrappedLoan.ref.documents.docVaultDocuments[i]=classifiedDocument;q.resolve(vm.wrappedLoan);}}},function(error){if(error!="cancel"){$log.error("Failure in Document Classification",error);}q.reject(error);});},function(error){$log.error("Failure in Document Type retrieval",error);});return q.promise;}function rejectDocument(document){if(vm.wrappedLoan.ref.documents.docVaultDocuments==null){return null;}for(var i=0;i<vm.wrappedLoan.ref.documents.docVaultDocuments.length;i++){if(vm.wrappedLoan.ref.documents.docVaultDocuments[i].uploadedFileId==document.uploadedFileId){vm.wrappedLoan.ref.documents.docVaultDocuments[i].status=enums.uploadedFileStatus.rejected;vm.wrappedLoan.ref.documents.docVaultDocuments[i].modified=true;vm.wrappedLoan.ref.documents.docVaultDocuments[i].classified=true;vm.wrappedLoan.ref.documents.docVaultDocuments[i].categorySortName="04Rejected";vm.wrappedLoan.ref.documents.docVaultDocuments[i].rejectReasonEdit=true;vm.wrappedLoan.ref.documents.docVaultDocuments[i].rejected=true;showDocuments(vm.wrappedLoan.ref.documents.docVaultDocuments);}}}function documentStatusChanged(wrappedLoan,groupedDocuments,document,category){vm.wrappedLoan=wrappedLoan;vm.groupedDocuments=groupedDocuments;for(var i=0;i<vm.wrappedLoan.ref.documents.docVaultDocuments.length;i++){if(vm.wrappedLoan.ref.documents.docVaultDocuments[i].uploadedFileId==document.uploadedFileId){vm.wrappedLoan.ref.documents.docVaultDocuments[i].modified=true;vm.wrappedLoan.ref.documents.docVaultDocuments[i].rejected=false;vm.wrappedLoan.ref.documents.docVaultDocuments[i].rejectReason="";vm.wrappedLoan.ref.documents.docVaultDocuments[i].status=document.status;if(document.status==enums.uploadedFileStatus.inReview){vm.wrappedLoan.ref.documents.docVaultDocuments[i].submitToEdgeMac=false;}if(document.status==enums.uploadedFileStatus.rejected){rejectDocument(document);}else{if(document.categorySortName=="04Rejected"){document.categorySortName=documentSortName(document.category);}}}}}function documentSelectedChanged(category,groupedDocuments){groupedDocuments.ref[category].classifyEnabled=groupedDocuments.ref[category].some(function(e){return e.submitToEdgeMac==true;});groupedDocuments.ref[category].importEnabled=groupedDocuments.ref[category].some(function(e){return e.shouldImport==true;});groupedDocuments.ref[category].selectedAll=isSelectedAll(groupedDocuments,category);}function downloadDocument(repositoryId){documentCtrl.DownloadDocument(repositoryId);}function openDocument(repositoryId,inBrowser,inTab){documentCtrl.OpenDocument(repositoryId,inBrowser,inTab);}function browserSupported(contentType){if(contentType=="pdf"){return true;}return false;}function isSelectedAll(groupedDocuments,category){return !groupedDocuments.ref[category].some(function(e){return e.submitToEdgeMac==false&&!selectDisabled(e);});}function selectDisabled(document){if(document.status==enums.uploadedFileStatus.inReview||!edgeMacSupported(document.contentType)){return true;}return false;}function edgeMacSupported(contentType){if(contentType=="pdf"||contentType=="doc"||contentType=="docx"||contentType=="tif"){return true;}return false;}function documentSortName(category){switch(category.toLowerCase()){case"unclassified":return"01"+category;case"unassigned":return"02"+category;case"rejected":return"04"+category;default:return"03"+category;}}function formatCategoryName(categoryName){if(common.string.isNullOrWhiteSpace(categoryName)){return categoryName;}return categoryName.replace("01","").replace("02","").replace("03","").replace("04","");}function toggleGrid(isExpanded,documentsRef){for(var key in documentsRef){if(documentsRef.hasOwnProperty(key)){documentsRef[key].isExpanded=isExpanded;}}}function importDocs(groupedDocuments,loanId,borrowerId,userAccountId){if(groupedDocuments==null){return;}var importDocuments=[];for(var key in groupedDocuments.ref){for(var i=0;i<groupedDocuments.ref[key].length;i++){if(groupedDocuments.ref[key][i].shouldImport){importDocuments.push(groupedDocuments.ref[key][i]);}}}var docVaultViewModel={DocVaultDocuments:importDocuments};return DocumentsServices.ImportDocuments({userAccountId:userAccountId,loanId:loanId,borrowerId:borrowerId},docVaultViewModel);}var DocumentsServices=$resource(docVaultApiPath+":path",{path:"@path"},{GetDocVaultData:{method:"GET",params:{loanId:"loanId",userAccountId:"userAccountId"}},SaveDocVaultData:{method:"POST",params:{userAccountId:"userAccountId"}},GetDocTypeFields:{method:"GET",params:{}},ImportDocuments:{method:"POST",params:{userAccountId:"userAccountId",loanId:"loanId",borrowerId:"borrowerId"},url:docVaultApiPath+"ImportDocuments"}});var DocVaultServices=$resource(docVaultServiceApiPath+":path",{path:"@path"},{FilterByLoanNumber:{method:"GET",params:{loanNumber:"loanNumber",counter:"counter",currentUserId:"currentUserId"}}});var documentsService={DocumentsServices:DocumentsServices,DocVaultServices:DocVaultServices,classifyDocument:classifyDocument,rejectDocument:rejectDocument,showDocuments:showDocuments,openDocVaultMenu:openDocVaultMenu,openDocVaultFlyoutMenu:openDocVaultFlyoutMenu,documentStatusChanged:documentStatusChanged,documentSelectedChanged:documentSelectedChanged,selectDisabled:selectDisabled,downloadDocument:downloadDocument,browserSupported:browserSupported,openDocument:openDocument,isSelectedAll:isSelectedAll,formatCategoryName:formatCategoryName,groupDocuments:groupDocuments,toggleGrid:toggleGrid,importDocs:importDocs,setDocVaultButtonSelected:setDocVaultButtonSelected,getDocVaultButtonSelected:getDocVaultButtonSelected};return documentsService;}})();(function(){angular.module("docVault").provider("docVaultResolver",docVaultResolver);function docVaultResolver(){this.$get=function($q){this.q=$q;return resolver.bind(this);};function resolver(docVaultSvc,applicationData,wrappedLoan,commonModalWindowFactory,modalWindowType){if(wrappedLoan.ref.documents.documentsLoaded){return wrappedLoan;}commonModalWindowFactory.open({type:modalWindowType.loader,message:"Loading Documents..."});var documents={docVaultDocuments:[]};var promises=[];angular.forEach(wrappedLoan.ref.getLoanApplications(),function(loanApplication){promises.push(docVaultSvc.DocumentsServices.GetDocVaultData({loanId:loanApplication.loanApplicationId,userAccountId:applicationData.currentUserId}).$promise);});return this.q.all(promises).then(function(data){angular.forEach(data,function(object){documents.docVaultDocuments=documents.docVaultDocuments.concat(object.docVaultDocuments);});wrappedLoan.ref.documents=documents;wrappedLoan.ref.documents.documentsLoaded=true;commonModalWindowFactory.close();return wrappedLoan;});}}})();(function(){angular.module("docVault").controller("docVaultController",docVaultController);function docVaultController($log,$scope,$state,$modal,$controller,docVaultSvc,encompassSvc,NavigationSvc,enums,$interval,modalPopoverFactory,wrappedLoan,applicationData,simpleModalWindowFactory,$timeout,DocVaultService,$q,limitToFilter,commonModalWindowFactory,modalWindowType){var vm=this;vm.wrappedLoan=wrappedLoan;vm.applicationData=applicationData;vm.documentTypes=null;vm.classifyDocuments=classifyDocuments;vm.selectAll=selectAll;vm.unselectAll=unselectAll;vm.documentSelectedChanged=documentSelectedChanged;vm.showDocumentHistory=showDocumentHistory;vm.deleteDocument=deleteDocument;vm.save=save;vm.cancel=cancel;vm.toggleGrid=toggleGrid;vm.openUploadFiles=openUploadFiles;vm.browserSupported=browserSupported;vm.exportDocumentToEncompass=exportDocumentToEncompass;vm.openDocVaultMenu=openDocVaultMenu;vm.documentStatusChanged=documentStatusChanged;vm.downloadDocument=downloadDocument;vm.selectDisabled=selectDisabled;vm.formatCategoryName=formatCategoryName;NavigationSvc.contextualType=enums.ContextualTypes.DocVault;vm.changeDocVaultButtonOption=changeDocVaultButtonOption;vm.callDocVaultButtonOption=callDocVaultButtonOption;vm.openImportDocsFlyout=openImportDocsFlyout;vm.docVaultButtonOptions=[{"id":0,"text":"Upload"},{"id":1,"text":"Import from Loan"}];vm.docVaultButtonSelected=docVaultSvc.getDocVaultButtonSelected();var _searchCounter=0;var _filterTextTimeout;if(applicationData.generalSettings){vm.enableExportDocumentToEncompass=_.find(applicationData.generalSettings,function(obj){return obj.settingName=="Enable Export Document To Encompass";});}vm.groupedDocuments=docVaultSvc.groupDocuments(vm.wrappedLoan.ref.documents.docVaultDocuments);function formatCategoryName(categoryName){return docVaultSvc.formatCategoryName(categoryName);}function save(){vm.savingDataInProgress=true;NavigationSvc.SaveAndUpdateWrappedLoan(applicationData.currentUserId,wrappedLoan,function(wrappedLoan){vm.savingDataInProgress=false;refresh();},function(error){$log.error(error);simpleModalWindowFactory.trigger("ERROR_SAVE_MODAL");vm.savingDataInProgress=false;});}function addDocumentHistory(document,status){document.documentHistory.push({modifiedBy:applicationData.currentUser.firstName+" "+applicationData.currentUser.lastName,statusChange:status,modifiedDate:new Date().format("M/d/yyyy h:mm:ss tt")});}function exportDocumentToEncompass(document){document.runningExportToEncompass=true;var counter=1;var timeOut=180;encompassSvc.encompassExportDocument(vm.wrappedLoan.ref.loanId,applicationData.currentUserId,document.repositoryId,document.uploadedFileId,document.documentCategory,document.category,document.name).then(function(result){var timer=$interval(function(){encompassSvc.GetExportDocumentToEncompassRequestCompleted(result.data).then(function(result){if(result.data==2){addDocumentHistory(document,"Exported");$interval.cancel(timer);document.exportDocumentToEncompassStatus=result.data;document.runningExportToEncompass=false;}if(result.data==3){addDocumentHistory(document,"Export Failed");$interval.cancel(timer);document.exportDocumentToEncompassStatus=result.data;document.runningExportToEncompass=false;}if(counter*5>timeOut){$interval.cancel(timer);document.runningExportToEncompass=false;$log.error("GetExportDocumentToEncompassRequestCompleted:: Timeout occurred!");}counter++;},function(error){addDocumentHistory(document,"Export Failed");$interval.cancel(timer);document.runningExportToEncompass=false;});},5000);},function(error){$log.error("Failure exporting Document to Encompass",error);addDocumentHistory(document,"Export Failed");});}function documentStatusChanged(document,categoryName){docVaultSvc.documentStatusChanged(vm.wrappedLoan,vm.groupedDocuments,document,categoryName);}function classifyDocuments(){for(var key in vm.groupedDocuments.ref){for(var i=0;i<vm.groupedDocuments.ref[key].length;i++){if(vm.groupedDocuments.ref[key][i].submitToEdgeMac&&vm.groupedDocuments.ref[key][i].status!=enums.uploadedFileStatus.inReview){var doc=lib.findFirst(vm.wrappedLoan.ref.documents.docVaultDocuments,function(x){return x.repositoryId==vm.groupedDocuments.ref[key][i].repositoryId;});doc.submitToEdgeMac=true;doc.status=enums.uploadedFileStatus.inReview;doc.modified=true;}}}save();}function selectDisabled(document){return docVaultSvc.selectDisabled(document);}function downloadDocument(repositoryId){docVaultSvc.downloadDocument(repositoryId);}function selectAll(category){for(var i=0;i<vm.groupedDocuments.ref[category].length;i++){if(!docVaultSvc.selectDisabled(vm.groupedDocuments.ref[category][i])){vm.groupedDocuments.ref[category][i].submitToEdgeMac=true;}}if(vm.groupedDocuments.ref[category].some(function(e){return e.submitToEdgeMac==true;})){vm.groupedDocuments.ref[category].classifyEnabled=true;vm.groupedDocuments.ref[category].selectedAll=true;}}function unselectAll(category){for(var i=0;i<vm.groupedDocuments.ref[category].length;i++){vm.groupedDocuments.ref[category][i].submitToEdgeMac=false;}vm.groupedDocuments.ref[category].classifyEnabled=false;vm.groupedDocuments.ref[category].selectedAll=false;}function documentSelectedChanged(category){docVaultSvc.documentSelectedChanged(category,vm.groupedDocuments);}function openDocVaultMenu(event,document){docVaultSvc.openDocVaultMenu(event,vm.wrappedLoan,document,vm.groupedDocuments);}function showDocumentHistory($event,document){var ctrl={documentHistory:document.documentHistory,};var _docHistoryPopup=modalPopoverFactory.openModalPopover("angular/documents/docvault/docvaulthistory.html",ctrl,document.documentHistory,$event,{arrowRight:true,className:"tooltip-arrow-right-dochistory",verticalPopupPositionPerHeight:0,horisontalPopupPositionPerWidth:0.915});_docHistoryPopup.result.then(function(data){});}function deleteDocument(document){for(var i=0;i<vm.wrappedLoan.ref.documents.docVaultDocuments.length;i++){if(vm.wrappedLoan.ref.documents.docVaultDocuments[i]==document){vm.wrappedLoan.ref.documents.docVaultDocuments[i].removed=true;}}}function reloadLoan(){cancel();}function cancel(){NavigationSvc.cancelChanges(wrappedLoan.ref.loanId);}function toggleGrid(isExpanded){docVaultSvc.toggleGrid(isExpanded,vm.groupedDocuments.ref);}function openUploadFiles(event){var docCategory=applicationData.documentCategories.find(function(documentCategory){return documentCategory.documentClassId==13&&documentCategory.name=="Others";});var ctrl={loanId:wrappedLoan.ref.loanId,borrowerId:wrappedLoan.ref.primary.getBorrower().borrowerId,userAccountId:applicationData.currentUser.userAccountId,documentCategoryId:docCategory.categoryId,};var menuPopup=modalPopoverFactory.openModalPopover("angular/common/uploadfiles/uploadfiles.html",ctrl,vm.wrappedLoan.ref.documents,event,{preventAutoClose:true});menuPopup.result.then(function(data){menuPopup.close();save();});}function openImportDocsFlyout(context){var self=this;commonModalWindowFactory.open({type:modalWindowType.loader,message:"Opening documents for import..."});var modalInstance=$modal.open({templateUrl:"angular/documents/docvault/importdocsflyout.html",windowClass:"imp-modal flyout imp-modal-real-estate-information",controller:function(context,groupedDocuments,$modalInstance){commonModalWindowFactory.close();this.loanNumber=context.loanNumber;this.borrowerName=context.borrowerName;this.borrowerId=context.borrowerId;this.loanId=context.loanId;this.groupedDocuments=groupedDocuments;this.formatCategoryName=function(categoryName){return docVaultSvc.formatCategoryName(categoryName);};this.toggleGrid=function(shouldToggleFlag){return docVaultSvc.toggleGrid(shouldToggleFlag,groupedDocuments.ref);};this.selectAll=function(categoryName){toggleDocumentImport(true,groupedDocuments,self,categoryName);};this.unselectAll=function(categoryName){toggleDocumentImport(false,groupedDocuments,self,categoryName);};this.documentSelectedChanged=function(categoryName,document){if(document.shouldImport){this.groupedDocuments.ref[categoryName].selectedAll=true;}else{var toImportExist=this.groupedDocuments.ref[categoryName].some(function(doc){return doc.shouldImport==true;});if(!toImportExist){this.groupedDocuments.ref[categoryName].selectedAll=false;}}};this.downloadDocument=function(repositoryId){docVaultSvc.downloadDocument(repositoryId);};this.openDocVaultFlyoutMenu=function(event,document){docVaultSvc.openDocVaultFlyoutMenu(event,document);};this.cancel=function(){$modalInstance.dismiss("cancel");};this.importDocs=function(){$modalInstance.dismiss("cancel");commonModalWindowFactory.open({type:modalWindowType.loader,message:"Importing Documents..."});docVaultSvc.importDocs(groupedDocuments,vm.wrappedLoan.ref.loanId,vm.wrappedLoan.ref.primary.getBorrower().borrowerId,vm.applicationData.currentUserId).$promise.then(function(result){commonModalWindowFactory.close();reloadLoan();},function(error){commonModalWindowFactory.open({type:modalWindowType.error,message:"Erorr while importing documents!"});commonModalWindowFactory.close();$log.error("Error while importing documents!",error);});};this.importDisabled=function(){for(var key in groupedDocuments.ref){if(lib.findFirst(groupedDocuments.ref[key],function(item){return item.shouldImport==true;})){return false;}}return true;};},controllerAs:"importDocCtrl",resolve:{context:function(){return context;},groupedDocuments:function(){var documents={docVaultDocuments:[]};var promises=[];angular.forEach(context.loanApplicationIds,function(loanApplicationId){promises.push(docVaultSvc.DocumentsServices.GetDocVaultData({loanId:loanApplicationId,userAccountId:vm.applicationData.currentUserId}).$promise);});return $q.all(promises).then(function(data){angular.forEach(data,function(object){documents.docVaultDocuments=documents.docVaultDocuments.concat(object.docVaultDocuments);});return docVaultSvc.groupDocuments(documents.docVaultDocuments,true);});}}});}function toggleDocumentImport(flag,groupedDocuments,_this,categoryName){groupedDocuments.ref[categoryName].forEach(function(document){if(document.categoryId!=26){document.shouldImport=flag;document.importEnabled=flag;}});groupedDocuments.ref[categoryName].selectedAll=flag;}function browserSupported(contentType){if(contentType=="pdf"){return true;}return false;}function refresh(){$state.go("loanCenter.loan.refresh",{page:"loanCenter.loan.documents.docvault"});}function changeDocVaultButtonOption(optionId){docVaultSvc.setDocVaultButtonSelected(optionId);vm.docVaultButtonSelected=optionId;}function callDocVaultButtonOption(optionId,event){switch(optionId){case 0:openUploadFiles(event);break;case 1:var ctrl={onLoanNumberFilterChanged:onLoanNumberFilterChanged,onSelect:onSelect,openImportDocsFlyout:openImportDocsFlyout};var importDocsPopup=modalPopoverFactory.openModalPopover("angular/documents/docvault/docvaultimportdocs.html",ctrl,vm.wrappedLoan.ref.documents,event);break;}}function onLoanNumberFilterChanged(loanNumber){if(loanNumber==null){return;}var self=this;var deferred=$q.defer();if(_filterTextTimeout){$timeout.cancel(_filterTextTimeout);}_filterTextTimeout=$timeout(function(){docVaultSvc.DocVaultServices.FilterByLoanNumber({loanNumber:loanNumber,counter:_searchCounter,currentUserId:applicationData.currentUser.userAccountId}).$promise.then(function(result){if(result!=null&&result.filterResults!=null){deferred.resolve(limitToFilter(result.filterResults,15));}},function(error){$log.error("Error while filtering by loan number!",error);});},300);return deferred.promise;}function onSelect($item,$model,$label,loanNumber){loanNumber.$setValidity("parse",true);return $item;}}})();(function(){angular.module("docVault").controller("docVaultClassifyController",docVaultClassifyController);function docVaultClassifyController($log,$modalInstance,documentTypes,wrappedLoan,document,enums){var vm=this;vm.documentTypes=documentTypes;vm.wrappedLoan=wrappedLoan;vm.document=document;vm.borrowerList=borrowerList();vm.borrowerJointList=borrowerJointList();vm.reoAddressList=reoAddressList();vm.documentTypeChange=documentTypeChange;vm.update=update;vm.cancel=cancel;vm.validateInput=validateInput;vm.isValid=isValid;vm.onBorrowerJointListChange=onBorrowerJointListChange;vm.selectedDocumentType=_.find(documentTypes,function(e){return e.typeId==document.documentTypeId;});vm.metadata=populateMetadata();vm.document.rejected=document.status==enums.uploadedFileStatus.rejected;function populateMetadata(){if(!vm.selectedDocumentType){return null;}var meta=[];angular.forEach(vm.selectedDocumentType.metadata,function(docTypeMetadata){angular.forEach(document.metadata,function(documentMetadata){if(docTypeMetadata.name==documentMetadata.key){if(documentMetadata.value){documentMetadata.visible=true;}documentMetadata.dependency=docTypeMetadata.dependency;meta.push(documentMetadata);}});});return meta;}function documentTypeChange(){vm.metadata=[];angular.forEach(vm.selectedDocumentType.metadata,function(docTypeMetadata){if(docTypeMetadata.name=="Co-Borrower Signed Date"){if(_.some(vm.wrappedLoan.ref.getLoanApplications(),function(loanApp){return loanApp.isSpouseOnTheLoan;})){vm.metadata.push({"key":docTypeMetadata.name,"value":"","dependency":docTypeMetadata.dependency,visible:"true"});}}else{vm.metadata.push({"key":docTypeMetadata.name,"value":"","dependency":docTypeMetadata.dependency,visible:"true"});}});}function update(){if(vm.selectedDocumentType){vm.validateForm=true;if(!vm.document.rejected&&!isValid()){return;}vm.document.classified=true;vm.document.modified=true;vm.document.category=vm.selectedDocumentType["class"];vm.document.categorySortName=vm.selectedDocumentType["class"];vm.document.documentTypeId=vm.selectedDocumentType.typeId;vm.document.description=vm.selectedDocumentType["description"];vm.document.metadata=vm.metadata;vm.document.name=vm.selectedDocumentType.description;angular.forEach(vm.selectedDocumentType.namingConvention.split(","),function(convention){angular.forEach(vm.metadata,function(meta){if(!meta.visible){meta.value="";}if(meta.value&&meta.value!=""&&convention.trim().toLowerCase()==meta.key.toLowerCase()){var value;if(angular.isDate(meta.value)){value=meta.value.format("MM-dd-yyyy");meta.value=meta.value.format("MM/dd/yyyy");}else{if(typeof(meta.value)!="number"){value=meta.value.replace(/\//g,"-").replace(" ","_");}}vm.document.name=vm.document.name+"_"+value;}});});if(vm.document.description=="Intent to Proceed"){updateITPDates();}vm.document.status=enums.uploadedFileStatus.received;vm.validateForm=false;}if(vm.document.rejected){vm.document.status=enums.uploadedFileStatus.rejected;vm.document.categorySortName="04Rejected";vm.document.rejectReasonEdit=true;}else{vm.document.categorySortName=documentSortName(document.category);vm.document.rejectReason="";}$modalInstance.close(document);}function updateITPDates(){var selectedBorrowers=_.findWhere(vm.metadata,{key:"Borrower Name(s)"}).value;angular.forEach(selectedBorrowers.split(","),function(fullName){angular.forEach(vm.wrappedLoan.ref.getLoanApplications(),function(loanApplication){var borrower=loanApplication.getBorrower();if(borrower.fullName==fullName.trim()){borrower.eApprovalConfirmation.isModified=true;borrower.eApprovalConfirmation.timeStamp=_.findWhere(vm.metadata,{key:"Borrower Signed Date"}).value;}var coBorrower=loanApplication.getCoBorrower();if(coBorrower.fullName==fullName.trim()){coBorrower.eApprovalConfirmation.isModified=true;coBorrower.eApprovalConfirmation.timeStamp=_.findWhere(vm.metadata,{key:"Co-Borrower Signed Date"}).value;}});});}function cancel(){$modalInstance.dismiss("cancel");}function borrowerList(){var borrowerList=[];angular.forEach(vm.wrappedLoan.ref.getLoanApplications(),function(loanApplication){borrowerList=borrowerList.concat(loanApplication.borrowerList());});return borrowerList;}function borrowerJointList(){var borrowerJointList=[];angular.forEach(vm.wrappedLoan.ref.getLoanApplications(),function(loanApplication){borrowerJointList=borrowerJointList.concat(loanApplication.borrowerJointList());});return borrowerJointList;}function reoAddressList(){var dropDownAddress=[];wrappedLoan.ref.active.getUniqueProperties(true).forEach(function(property){if(property){dropDownAddress.push(new cls.LookupItem(property.fullAddressString,property.propertyId));}});return dropDownAddress;}function onBorrowerJointListChange(){var selectedValue=checkBorrowerJointListSelection(_.findWhere(vm.metadata,{key:"Borrower Name(s)"}).value);switch(selectedValue){case"borrower":if(_.findWhere(vm.metadata,{key:"Borrower Signed Date",dependency:"true"})){_.findWhere(vm.metadata,{key:"Borrower Signed Date"}).visible=true;}if(_.findWhere(vm.metadata,{key:"Co-Borrower Signed Date",dependency:"true"})){_.findWhere(vm.metadata,{key:"Co-Borrower Signed Date"}).visible=false;}break;case"coborrower":if(_.findWhere(vm.metadata,{key:"Borrower Signed Date",dependency:"true"})){_.findWhere(vm.metadata,{key:"Borrower Signed Date"}).visible=false;}if(_.findWhere(vm.metadata,{key:"Co-Borrower Signed Date",dependency:"true"})){_.findWhere(vm.metadata,{key:"Co-Borrower Signed Date"}).visible=true;}break;case"borrowerAndCoborrower":if(_.findWhere(vm.metadata,{key:"Borrower Signed Date",dependency:"true"})){_.findWhere(vm.metadata,{key:"Borrower Signed Date"}).visible=true;}if(_.findWhere(vm.metadata,{key:"Co-Borrower Signed Date",dependency:"true"})){_.findWhere(vm.metadata,{key:"Co-Borrower Signed Date"}).visible=true;}break;}}function checkBorrowerJointListSelection(fullName){if(fullName){var value="borrowerAndCoborrower";angular.forEach(vm.wrappedLoan.ref.getLoanApplications(),function(loanApplication){if(loanApplication.getBorrower()){if(loanApplication.getBorrower().fullName==fullName){value="borrower";return;}}if(loanApplication.getCoBorrower()){if(loanApplication.getCoBorrower().fullName==fullName){value="coborrower";return;}}});return value;}}function validateInput(value){if(value&&value!=-1){return true;}return false;}function selectDocumentType(){return;}function documentSortName(category){switch(category.toLowerCase()){case"unclassified":return"01"+category;case"unassigned":return"02"+category;case"rejected":return"04"+category;default:return"03"+category;}}function isValid(){var valid=true;angular.forEach(vm.metadata,function(meta){if(!validateInput(meta.value)&&meta.visible){valid=false;}});return valid;}}})();(function(){angular.module("mailroom",[]);})();(function(){angular.module("mailroom").config(config);config.$inject=["$stateProvider"];function config($stateProvider){$stateProvider.state("loanCenter.workbench",{"abstract":true,url:"workbench",views:{"workbench":{templateUrl:"/angular/mailroom/_blank.html"},"contextualBar":{templateUrl:"/angular/contextualbar/contextualbar.html",controller:"ContextualBarCtrl as contextualBarCtrl"},},params:{loanId:null,parentLoanId:null},resolve:{wrappedLoan:function(mailroomResolver,docVaultResolver,docVaultSvc,loanService,$stateParams,HttpUIStatusService,BroadcastSvc,applicationData,$filter,$q){var d=$q.defer();mailroomResolver(docVaultResolver,docVaultSvc,loanService,$stateParams,HttpUIStatusService,BroadcastSvc,applicationData,$filter,$q).then(function(data){d.resolve(data);});return d.promise;}}}).state("loanCenter.workbench.mailroom",{url:"/mailroom",views:{"mailroom":{templateUrl:"/angular/mailroom/mailroom.html",controller:"mailroomController as mailroomCtrl"}},params:{loanId:null,loanPurposeType:null,disclosureDueDate:null},});}})();var mailroom;(function(mailroom){var mailroomService=(function(){function mailroomService(apiRoot,$resource,$q,$http,$window,$timeout,$sce,$filter,docVaultSvc){var _this=this;this.apiRoot=apiRoot;this.$resource=$resource;this.$q=$q;this.$http=$http;this.$window=$window;this.$timeout=$timeout;this.$sce=$sce;this.$filter=$filter;this.docVaultSvc=docVaultSvc;this.getPDFFile=function(fileItemId,userAccountId){var request=_this.$http({method:"get",headers:{"Content-type":"application/pdf"},url:_this.postApiPath,params:{fileStoreItemId:fileItemId,userAccountId:userAccountId},responseType:"arraybuffer",});return request;};this.postApiPath=this.apiRoot+"MailRoom/GetPDFFileInfo";}mailroomService.$inject=["apiRoot","$resource","$q","$http","$window","$timeout","$sce","$filter","docVaultSvc"];return mailroomService;})();mailroom.mailroomService=mailroomService;angular.module("mailroom").service("mailroomService",mailroomService);})(mailroom||(mailroom={}));var mailroom;(function(mailroom){var mailroomController=(function(){function mailroomController($log,wrappedLoan,applicationData,$state,$rootScope,enums,$controller,modalPopoverFactory,docVaultSvc,NavigationSvc,$stateParams,simpleModalWindowFactory,mailroomService,$q,$scope,$modalStack){var _this=this;this.$log=$log;this.wrappedLoan=wrappedLoan;this.applicationData=applicationData;this.$state=$state;this.$rootScope=$rootScope;this.enums=enums;this.$controller=$controller;this.modalPopoverFactory=modalPopoverFactory;this.docVaultSvc=docVaultSvc;this.NavigationSvc=NavigationSvc;this.$stateParams=$stateParams;this.simpleModalWindowFactory=simpleModalWindowFactory;this.mailroomService=mailroomService;this.$q=$q;this.$scope=$scope;this.$modalStack=$modalStack;this.enableSaveAndNext=true;this.enableSnooze=true;this.snoozedApplications=new Array();this.getSendingMethods=function(){return(angular.isDefined(_this.applicationData.lookup.sendingMethods)?_this.applicationData.lookup.sendingMethods:"Select One");};this.openLink=function(linkName,state){_this.$scope.loanItemOpen=false;_this.$scope.loanItemHover=false;_this.$modalStack.dismissAll("cancel");_this.NavigationSvc.openLink(linkName,state,_this.wrappedLoan,_this.applicationData);};this.checkDocumentId=function(value,index){return value.repositoryId&&_this.showDocumentInList(value.repositoryId,value.status,value.documentTypeId,value.classId);};this.showDocumentInList=function(repositoryItemId,status,documentTypeId,classId){var currentLoanApplication=_this.wrappedLoan.ref.active;var borrowerId=_this.wrappedLoan.ref.active.getBorrower().borrowerId;var coBorrowerId=_this.wrappedLoan.ref.active.getCoBorrower()?_this.wrappedLoan.ref.active.getCoBorrower().borrowerId:null;if(status==_this.enums.uploadedFileStatus.delivered||status==_this.enums.uploadedFileStatus.sent){for(var i=0;i<currentLoanApplication.documents.length;i++){if(currentLoanApplication.documents[i].borrowerId==borrowerId||currentLoanApplication.documents[i].borrowerId==coBorrowerId){for(var j=0;j<currentLoanApplication.documents[i].uploadedFiles.length;j++){if((classId=="19"||documentTypeId=="8005")&&currentLoanApplication.documents[i].uploadedFiles[j].repositoryItemId==repositoryItemId){if(status==_this.enums.uploadedFileStatus.delivered){_this.enableSaveAndNext=false;}if(status==_this.enums.uploadedFileStatus.sent){_this.enableSnooze=false;}_this.enableSaveAndNext=(status==_this.enums.uploadedFileStatus.sent&&_this.enableSaveAndNext);_this.enableSnooze=(status==_this.enums.uploadedFileStatus.delivered&&_this.enableSnooze);return true;}}}}}return false;};this.openDocVaultMenu=function(event,document){_this.docVaultSvc.openDocVaultMenu(event,_this.wrappedLoan,document,_this.groupedDocuments);};this.documentStatusChanged=function(document){_this.enableSaveAndNext=true;_this.enableSnooze=true;_this.docVaultSvc.documentStatusChanged(_this.wrappedLoan,_this.groupedDocuments,document,document.category);};this.downloadDocument=function(repositoryId){_this.docVaultSvc.downloadDocument(repositoryId);};this.filterStatuses=function(status){return status.text=="Sent"||status.text=="Delivered";};this.saveAndNext=function(){var loanAppId=_this.wrappedLoan.ref.active.loanApplicationId;var savingDataInProgress=true;var self=_this;_this.NavigationSvc.SaveAndUpdateWrappedLoan(_this.applicationData.currentUser.userAccountId,_this.wrappedLoan,function(wrappedLoan){savingDataInProgress=false;self.loadNewLoan(loanAppId);},function(error){self.$log.error(error);self.simpleModalWindowFactory.trigger("ERROR_SAVE_MODAL");savingDataInProgress=false;});};this.loadNewLoan=function(activeLoanAppId){var self=_this;var next1003=_this.retrieveNext1003(activeLoanAppId,_this.wrappedLoan.ref.status,_this.wrappedLoan.ref.getLoanApplications(),false);if(next1003){_this.wrappedLoan.ref.switchActiveLoanApplication(next1003);var d=self.$q.defer();var documents;var promises=[];angular.forEach(self.wrappedLoan.ref.getLoanApplications(),function(loanApplication){promises.push(self.docVaultSvc.DocumentsServices.GetDocVaultData({loanId:loanApplication.loanApplicationId,userAccountId:self.applicationData.currentUserId}).$promise);});return self.$q.all(promises).then(function(data){angular.forEach(data,function(object){self.wrappedLoan.ref.documents.docVaultDocuments=self.wrappedLoan.ref.documents.docVaultDocuments.concat(object.docVaultDocuments);});self.wrappedLoan.ref.documents.documentsLoaded=true;return d.resolve(self.wrappedLoan);});}else{_this.NavigationSvc.openFirstLoanInMailRoomQueue(_this.applicationData.currentUser.userAccountId);}};this.retrieveNext1003=function(activeLoanAppId,loanStatus,loanApplications,loanCurrentApp){var next1003=null;var isSnoozed=false;angular.forEach(loanApplications,function(loanApplication){lib.forEach(_this.snoozedApplications,function(loanApp){if(loanApplication.loanApplicationId==loanApp){isSnoozed=true;}});if(((loanApplication.loanApplicationId!=activeLoanAppId&&!loanCurrentApp)||(loanApplication.loanApplicationId==activeLoanAppId&&loanCurrentApp))&&(loanStatus==2||loanStatus==4)&&(loanApplication.disclosureStatusDetails.disclosureStatus==5)&&(loanApplication.docDelivery==0)&&!isSnoozed){next1003=loanApplication;}});return next1003;};this.snoozeLoan=function(){_this.wrappedLoan.ref.active.incrementSnoozeOrder();_this.snoozedApplications.push(_this.wrappedLoan.ref.active.loanApplicationId);_this.saveAndNext();};NavigationSvc.contextualType=enums.ContextualTypes.MailRoomWorkbench;var vm=this;vm.wrappedLoan=wrappedLoan;vm.dueDate=$stateParams.disclosureDueDate;this.groupedDocuments=_.groupBy(_.where(this.wrappedLoan.ref.documents.docVaultDocuments,{deleted:false}),"categorySortName");var next1003=this.retrieveNext1003($stateParams.loanId,this.wrappedLoan.ref.status,this.wrappedLoan.ref.getLoanApplications(),true);if(next1003){this.wrappedLoan.ref.switchActiveLoanApplication(next1003);}}mailroomController.prototype.openFirstLoanFromMailList=function(){this.NavigationSvc.openFirstLoanInMailRoomQueue(this.$rootScope.userAccountId);};mailroomController.$inject=["$log","wrappedLoan","applicationData","$state","$rootScope","enums","$controller","modalPopoverFactory","docVaultSvc","NavigationSvc","$stateParams","simpleModalWindowFactory","mailroomService","$q","$scope","$modalStack"];return mailroomController;})();mailroom.mailroomController=mailroomController;angular.module("mailroom").controller("mailroomController",mailroomController);})(mailroom||(mailroom={}));(function(){angular.module("signalrModule",["SignalR"]);})();(function(){var app=angular.module("signalrModule");app.value("signalrData",[]);app.factory("signalrFactory",signalrFactory);signalrFactory.$inject=["$timeout","Hub","signalrData"];function signalrFactory($timeout,Hub,signalrData){var factory={};factory.createListener=createListener;function createListener(hubName,signalrFunction,parameter){var hub=new Hub(hubName,{listeners:{"updateCosts":function(loanId){$timeout(function(){signalrFunction(loanId,parameter);});}},errorHandler:function(error){console.error(error);},});return hub;}return factory;}})();var mailroom;(function(mailroom){var mailroomResolver=(function(){function mailroomResolver(){var _this=this;this.$get=function(){return _this.resolver.bind(_this);};this.resolver=function(docVaultResolver,docVaultSvc,loanService,$stateParams,HttpUIStatusService,BroadcastSvc,applicationData,$filter,$q,mailroomService){var d=$q.defer();console.log("loading loan: "+$stateParams.loanId?$stateParams.loanId:"(new)");HttpUIStatusService.load("Loading Loan...",function(happyPath,unhappyPath){var loanId;if($stateParams.parentLoanId){loanId=$stateParams.parentLoanId;}else{loanId=$stateParams.loanId;}return loanService.loan().get({loanId:loanId,userAccountId:applicationData.currentUserId}).$promise.then(happyPath,unhappyPath);},function(loan){var wrappedLoan=new lib.referenceWrapper(new cls.LoanViewModel(loan,$filter,true));if(wrappedLoan.ref.documents.documentsLoaded){return wrappedLoan;}var documents;var promises=[];angular.forEach(wrappedLoan.ref.getLoanApplications(),function(loanApplication){promises.push(docVaultSvc.DocumentsServices.GetDocVaultData({loanId:loanApplication.loanApplicationId,userAccountId:applicationData.currentUserId}).$promise);});return $q.all(promises).then(function(data){angular.forEach(data,function(object){wrappedLoan.ref.documents.docVaultDocuments=wrappedLoan.ref.documents.docVaultDocuments.concat(object.docVaultDocuments);});wrappedLoan.ref.documents.documentsLoaded=true;return d.resolve(wrappedLoan);});},function(error){console.log("loan load failure: "+$stateParams.loanId+" "+error);},$stateParams.loanId!=null);return d.promise;};}return mailroomResolver;})();mailroom.mailroomResolver=mailroomResolver;angular.module("mailroom").provider("mailroomResolver",mailroomResolver);})(mailroom||(mailroom={}));(function(){angular.module("costDetails",[]);})();(function(){angular.module("loanCenter").controller("CostDetailsCtrl",costDetailsController);costDetailsController.$inject=["$q","$state","$filter","$rootScope","pricingResultsSvc","BroadcastSvc","commonService","costDetailsHelpers","costDetailsSvc","enums","NavigationSvc","wrappedLoan","simpleModalWindowFactory","applicationData","$window","modalPopoverFactory","$controller","$scope","commonintegrationsSvc","$http","blockUI","signalrFactory","loanEvent","vaCenterService","$stateParams","ImpoundCalculatorHelpersSvc"];function costDetailsController($q,$state,$filter,$rootScope,pricingResultsSvc,BroadcastSvc,commonService,costDetailsHelpers,costDetailsSvc,enums,NavigationSvc,wrappedLoan,simpleModalWindowFactory,applicationData,$window,modalPopoverFactory,$controller,$scope,commonintegrationsSvc,$http,blockUI,signalrFactory,loanEvent,vaCenterService,$stateParams,ImpoundCalculatorHelpersSvc){var vm=this;initializeController();getCostDetailsData();vm.hoverIn=hoverIn;vm.hoverOut=hoverOut;vm.hoverInSection=hoverInSection;vm.hoverOutSection=hoverOutSection;vm.rowClick=rowClick;vm.payOffItemRowClick=payOffItemRowClick;vm.addCost=addCost;vm.addPayoffItem=addPayoffItem;vm.deleteCost=deleteCost;vm.deletePayoffItem=deletePayoffItem;vm.costTypeChanged=costTypeChanged;vm.cancelChanges=cancelChanges;vm.getSectionCostTypes=getSectionCostTypes;vm.getPayOffComments=getPayOffComments;vm.getPayOffCommentText=getPayOffCommentText;vm.payoffCommentChanged=payoffCommentChanged;vm.isOptionDisabled=isOptionDisabled;vm.calculateTotals=calculateTotals;vm.calculateLoanCostsTotals=calculateLoanCostsTotals;vm.calculateOtherCostsTotals=calculateOtherCostsTotals;vm.calculatePayOffTotals=calculatePayOffTotals;vm.calculateTaxesAndRecordingsTotals=calculateTaxesAndRecordingsTotals;vm.includeInTotalChanged=includeInTotalChanged;vm.amountPerMonthChanged=amountPerMonthChanged;vm.borrowerPaidAmountChanged=borrowerPaidAmountChanged;vm.amountClosingDataChange=amountClosingDataChange;vm.payOffFilter=payOffFilter;vm.removedItemsFilter=removedItemsFilter;vm.zeroItemsFilter=zeroItemsFilter;vm.removedLenderItemsFilter=removedLenderItemsFilter;vm.lenderCreditRowClick=lenderCreditRowClick;vm.addLenderCreditItem=addLenderCreditItem;vm.lenderAmountChange=lenderAmountChange;vm.deleteLenderCreditItem=deleteLenderCreditItem;vm.getCashToCloseTotalsText=getCashToCloseTotalsText;vm.saveAll=saveAll;vm.hideRemainigRebate=hideRemainigRebate;vm.isCostFullyPaidByRebate=isCostFullyPaidByRebate;vm.isCostPartiallyPaidByRebate=isCostPartiallyPaidByRebate;vm.isLoanCostRowDisabled=isLoanCostRowDisabled;vm.disableRightSection=disableRightSection;vm.disableBorrowerPaid=disableBorrowerPaid;vm.showLoanEstimateFeePopup=showLoanEstimateFeePopup;vm.isCostImpounded=isCostImpounded;vm.isInitialEscrowPaymentSection=isInitialEscrowPaymentSection;vm.checkVaRules=checkVaRules;vm.isTaxOrInsuranceCost=isTaxOrInsuranceCost;vm.onRightSectionAmountBlur=onRightSectionAmountBlur;vm.openImpoundCalculator=openImpoundCalculator;vm.openItemizedPropertyTaxCalculator=openItemizedPropertyTaxCalculator;vm.isItemizeCalculatorVisible=isItemizeCalculatorVisible;vm.recalculateAggregateAdjustment=recalculateAggregateAdjustment;vm.calculateAggregateAdjustmentIndex=calculateAggregateAdjustmentIndex;vm.isAggregateAdjustmentIndexOdd=isAggregateAdjustmentIndexOdd;vm.refreshSmartGFE=refreshSmartGFE;vm.createSmartGFE=createSmartGFE;vm.showSmartGfeRefreshButton;vm.isAddItemToPayoffsEnabled=false;var smartGfeSignalRCostUpdate=smartGfeSignalrFunction;NavigationSvc.contextualType=enums.ContextualTypes.CostDetails;getTransactionsData();$scope.$on("CostsRecalculated",function(event,totals){getCostDetailsData(true);});function calculateTotals(){costDetailsHelpers.calculateCostTotals();}function initializeController(){vm.wrappedLoan=wrappedLoan;vm.applicationData=applicationData;vm.enums=enums;vm.closingCostsRW=applicationData.currentUser.hasPrivilege(enums.privileges.ClosingCostsRW);vm.isRefinance=(wrappedLoan.ref.loanPurposeType===enums.LoanTransactionTypes.Refinance);vm.creditPayoffItemsCount=0;vm.aggregateAdjustmentIndex=1;vm.borrowerDataK={};vm.borrowerDataL={};vm.sellerDataM={};vm.sellerDataN={};}function getCostDetailsData(costsRecalculated){if(costsRecalculated===void 0){costsRecalculated=false;}if(!costsRecalculated||!costDetailsSvc.costDetailsData||!costDetailsSvc.costDetailsData.loanCosts){costDetailsHelpers.getCostDetailsData();}vm.closingCostViewModel=costDetailsSvc.wrappedLoan.ref.closingCost;vm.costDetailsData=costDetailsSvc.costDetailsData;BroadcastSvc.broadcastCostDetailsLoaded();}function checkVaRules(){if(vm.wrappedLoan.ref.vaInformation&&vm.wrappedLoan.ref.vaInformation.isvaLoan&&!$stateParams.redirectedFromLoanDetailsVaAlertModal){vaCenterService.isVAFeeLimitExceeded(vm.wrappedLoan.ref.closingCost,vm.wrappedLoan.ref.detailsOfTransaction.totalLoanAmount).$promise.then(function(data){vaCenterService.openVaFeeExceededAlertModal(data.vaFeeLimitExceededResults);vm.wrappedLoan.ref.updateGovermentEligibility(4,!data.vaFeeLimitExceededResults.length);},function(error){console.log(error);});}}function hoverIn(loanCost,mainModel){if(loanCost.canEdit==true){loanCost.hoverEdit=true;mainModel.hoverEdit=true;}}function hoverOut(loanCost,mainModel){if(loanCost.editMode!=true){loanCost.hoverEdit=false;}mainModel.hoverEdit=false;}function hoverInSection(loanCost){loanCost.hoverEdit=true;}function hoverOutSection(loanCost){loanCost.hoverEdit=false;}function rowClick(cost,useLoanCostsList){if(!vm.closingCostsRW){return;}cost.editMode=true;cost.hoverEdit=true;if(!vm.isLoanCostRowDisabled(cost)){return;}var costTypes=getSectionCostTypes(useLoanCostsList,cost.sectionId);var alreadyAdded=false;angular.forEach(costTypes,function(costType){if(!alreadyAdded&&costType.value==cost.uniqueCostTypeId){if(cost.name&&cost.name!=costType.text){addNewCostType(cost,costType,costTypes);}alreadyAdded=true;}});if(!alreadyAdded){if(cost.uniqueCostTypeId=="0"){cost.uniqueCostTypeId=getUniqueCostTypeId(cost);}addNewCostType(cost,cost,costTypes);}}function addNewCostType(cost,costType,costTypes){var newCostType={text:cost.name,value:getUniqueCostTypeId(cost),costGroupId:costType.costGroupId,costTypeGroupCategory:costType.costTypeGroupCategory,hudLineNumber:cost.hudLineNumber,isAprCost:cost.isAprCost,mustBeUnique:true,orderNo:costType.orderNo,subHUDLineNumber:cost.subHUDLineNumber,templateId:costType.templateId,templateUrl:costType.templateUrl,toleranceLevel:costType.toleranceLevel,totalRow:costType.totalRow,vaAllowableType:costType.vaAllowableType,};if(cost.uniqueCostTypeId==newCostType.value&&cost.name!=costType.name){newCostType.value=newCostType.value+".a";}cost.uniqueCostTypeId=newCostType.value;cost.mustBeUnique=true;costTypes.push(newCostType);costDetailsSvc.costDetailsData.usedLoanCostTypes=[];costDetailsSvc.costDetailsData.usedOtherCostTypes=[];costDetailsHelpers.getAllUsedCostTypes(costDetailsSvc.costDetailsData.usedLoanCostTypes,costDetailsSvc.costDetailsData.usedOtherCostTypes,costDetailsSvc.costDetailsData.loanCosts,costDetailsSvc.costDetailsData.otherCosts);}function getUniqueCostTypeId(cost){return !cost.subHUDLineNumber?cost.hudLineNumber.toString():cost.hudLineNumber+"."+cost.subHUDLineNumber;}function payOffItemRowClick(payOffItem){if(vm.closingCostsRW){payOffItem.editMode=true;payOffItem.hoverEdit=true;}}function isLoanCostRowDisabled(loanCost){return vm.savingDataInProgress||vm.closingCostViewModel.disableFields||!loanCost.userAdded||!vm.closingCostsRW;}function disableRightSection(cost){return(cost.hudLineNumber==801&&cost.subHUDLineNumber=="e"&&cost.costId!=lib.getEmptyGuid())||(cost.borrowerPaid.atClosing<0&&cost.templateId==5);}function disableBorrowerPaid(cost){return cost.templateId==5||cost.templateId==4;}function onRightSectionAmountBlur(cost,model,rightSectionPaidType){if(cost.templateId!=5&&cost.templateId!=4&&cost.hudLineNumber!=1003){return;}if(cost.templateId==5||cost.templateId==4){var borrowerPaidAtClose=costDetailsHelpers.calculateBorrowerPTCAmount(cost,vm.wrappedLoan.ref.closingDate.dateValue);costDetailsHelpers.recalculateRightSectionAmounts(cost,model,rightSectionPaidType,borrowerPaidAtClose);}else{var borrowerPaidMax=$filter("impRound")(cost.amountPerMonth,2);var atClose=cost.upfrontPreferredPaymentPeriod==1;costDetailsHelpers.recalculateRightSectionAmounts(cost,model,rightSectionPaidType,borrowerPaidMax,atClose);}calculateTotals();}function addCost(useLoanCostsList,section){if(vm.savingDataInProgress||vm.closingCostViewModel.disableFields||!vm.closingCostsRW){return;}var originalItem=section[0];var newItem=angular.copy(originalItem);newItem.isRemoved=false;newItem.canBeLocked=true;newItem.editMode=true;newItem.hoverEdit=true;newItem.costContainer=useLoanCostsList?enums.CostContainer.LoanCosts:enums.CostContainer.OtherCosts;newItem.loanId=wrappedLoan.ref.loanId;newItem.LoanTransactionType=wrappedLoan.ref.loanPurposeType;newItem.serviceProvider=0;newItem.isLocked=true;newItem.costId=util.IdentityGenerator.nextGuid();newItem.userAdded=true;if(originalItem.costSection=="G"){newItem.impounded=true;newItem.costType=enums.CostTypeEnum.EstimatedReservesDepositedwithLender;vm.aggregateAdjustmentIndex++;}else{if(originalItem.costSection=="F"){newItem.costType=enums.CostTypeEnum.Prepaids;}else{if(originalItem.costSection=="A"){newItem.costType=enums.CostTypeEnum.EstimatedLenderCosts;}}}vm.closingCostViewModel.costs.push(newItem);costDetailsHelpers.groupCostsBySections();}function addPayoffItem(){if(vm.savingDataInProgress||vm.closingCostViewModel.disableFields){return;}var originalItem=vm.closingCostViewModel.payOffSection.payOffItems[0];var newItem=angular.copy(originalItem);newItem.isRemoved=false;newItem.editMode=true;newItem.hoverEdit=true;newItem.loanId=wrappedLoan.ref.loanId;vm.closingCostViewModel.payOffSection.payOffItems.push(newItem);}function deleteCost(cost){if(vm.savingDataInProgress||vm.closingCostViewModel.disableFields){return;}cost.isRemoved=true;if(cost.sectionId==6){vm.aggregateAdjustmentIndex--;}costDetailsHelpers.calculateCostTotals();costDetailsSvc.costDetailsData.usedLoanCostTypes=[];costDetailsSvc.costDetailsData.usedOtherCostTypes=[];costDetailsHelpers.getAllUsedCostTypes(costDetailsSvc.costDetailsData.usedLoanCostTypes,costDetailsSvc.costDetailsData.usedOtherCostTypes,costDetailsSvc.costDetailsData.loanCosts,costDetailsSvc.costDetailsData.otherCosts);}function deletePayoffItem(payoffItem){if(vm.savingDataInProgress||vm.closingCostViewModel.disableFields){return;}payoffItem.isRemoved=true;costDetailsHelpers.calculatePayOffTotals();costDetailsHelpers.setCreditPayoffItemsCount();}function calculatePayOffTotals(){costDetailsHelpers.calculatePayOffTotals();}function costTypeChanged(cost,useLoanCostsList){var costTypes=getSectionCostTypes(useLoanCostsList,cost.sectionId);angular.forEach(costTypes,function(costType){if(costType.value==cost.uniqueCostTypeId){cost.hudLineNumber=cost.originalHUDLineNumber=costType.hudLineNumber;cost.subHUDLineNumber=cost.originalSubHUDLineNumber=costType.subHUDLineNumber;cost.templateId=costType.templateId;cost.templateUrl=costType.templateUrl;cost.costTypeGroupCategory=costType.costTypeGroupCategory;cost.mustBeUnique=costType.mustBeUnique;cost.name=costType.text;cost.isAprCost=costType.isAprCost;cost.toleranceLevel=costType.toleranceLevel;cost.costTypeId=costType.costGroupId;cost.totalRow=costType.totalRow;cost.vaAllowableType=costType.vaAllowableType;cost.feeCategory=costType.feeCategory;}});costDetailsHelpers.calculateCostTotals();costDetailsSvc.costDetailsData.usedLoanCostTypes=[];costDetailsSvc.costDetailsData.usedOtherCostTypes=[];costDetailsHelpers.getAllUsedCostTypes(costDetailsSvc.costDetailsData.usedLoanCostTypes,costDetailsSvc.costDetailsData.usedOtherCostTypes,costDetailsSvc.costDetailsData.loanCosts,costDetailsSvc.costDetailsData.otherCosts);}function cancelChanges(){vm.showLoader=true;vm.showErrorContainer=false;NavigationSvc.cancelChanges(wrappedLoan.ref.loanId);getCostDetailsData();}function getSectionCostTypes(useLoanCostsList,sectionId){if(useLoanCostsList){return vm.closingCostViewModel.loanCostTypes[sectionId];}return vm.closingCostViewModel.otherCostTypes[sectionId];}function isOptionDisabled(useLoanCostsList,dropdownCostTypeValue,uniqueCostTypeId){if(dropdownCostTypeValue==uniqueCostTypeId){return false;}if(dropdownCostTypeValue==1003){return(costDetailsSvc.costDetailsData.usedLoanCostTypes.indexOf(dropdownCostTypeValue)!=-1)||(costDetailsSvc.costDetailsData.usedOtherCostTypes.indexOf(dropdownCostTypeValue)!=-1);}if(useLoanCostsList){if(costDetailsSvc.costDetailsData.usedLoanCostTypes.indexOf(dropdownCostTypeValue)!=-1){return true;}}else{if(costDetailsSvc.costDetailsData.usedOtherCostTypes.indexOf(dropdownCostTypeValue)!=-1){return true;}}return false;}function amountPerMonthChanged(cost){if(cost.hudLineNumber==1002||cost.hudLineNumber==1003||cost.hudLineNumber==1004){cost.percent=0;}costDetailsHelpers.resetRightSectionAmounts(cost);cost.borrowerPaid.atClosing=costDetailsHelpers.calculateBorrowerPTCAmount(cost,vm.wrappedLoan.ref.closingDate.dateValue);costDetailsHelpers.calculateCostTotals();}function borrowerPaidAmountChanged(useLoanCostsList,cost){if(useLoanCostsList){calculateLoanCostsTotals();}else{calculateOtherCostsTotals();}}function resetRightSectionAmounts(cost){cost.borrowerPaid.beforeClosing=0;cost.sellerPaid.atClosing=0;cost.sellerPaid.beforeClosing=0;cost.otherPaid.atClosing=0;cost.otherPaid.beforeClosing=0;}function amountClosingDataChange(cost){costDetailsHelpers.resetRightSectionAmounts(cost);cost.borrowerPaid.atClosing=costDetailsHelpers.calculateBorrowerPTCAmount(cost,vm.wrappedLoan.ref.closingDate.dateValue);costDetailsHelpers.calculateCostTotals();}function calculateLoanCostsTotals(){costDetailsHelpers.calculateLoanCostsTotals();calculateCashToCloseTotals();BroadcastSvc.broadcastCostDetailsTotals();}function calculateOtherCostsTotals(){costDetailsHelpers.calculateOtherCostsTotals();calculateCashToCloseTotals();BroadcastSvc.broadcastCostDetailsTotals();}function calculateLenderCreditsTotals(){costDetailsHelpers.calculateLenderCreditsTotals();calculateCashToCloseTotals();BroadcastSvc.broadcastCostDetailsTotals();}function calculateCashToCloseTotals(){costDetailsHelpers.calculateCashToCloseTotals();BroadcastSvc.broadcastCostDetailsTotals();}function calculateTaxesAndRecordingsTotals(){costDetailsHelpers.calculateTaxesAndRecordingsTotals();}function includeInTotalChanged(cost){if(cost.includeInTotal==1){var costTypes=getSectionCostTypes(false,cost.sectionId);angular.forEach(costTypes,function(costType){if(costType.value==cost.uniqueCostTypeId){cost.totalRow=costType.totalRow;}});}else{cost.totalRow="";}vm.calculateTaxesAndRecordingsTotals();}function getPayOffComments(payOffItem){if(payOffItem.isLiability){if(payOffItem.typeId==2){return vm.applicationData.lookup.liabilityDebtComments;}return vm.applicationData.lookup.collectionComments;}if(payOffItem.isPublicRecord){return vm.applicationData.lookup.debtComments;}return vm.applicationData.lookup.pledgetAssetComments;}function getPayOffCommentText(payOffItem){var result="Unknown";var lookups=vm.applicationData.lookup.pledgetAssetComments;if(payOffItem.isLiability){if(payOffItem.typeId==2){lookups=vm.applicationData.lookup.liabilityDebtComments;}else{lookups=vm.applicationData.lookup.collectionComments;}}if(payOffItem.isPublicRecord){lookups=vm.applicationData.lookup.debtComments;}angular.forEach(lookups,function(lookup){if(lookup.value==payOffItem.payoffCommentId){result=lookup.text;}});return result;}function payoffCommentChanged(payoffItem){costDetailsHelpers.payoffCommentChanged(payoffItem);}function payOffFilter(payoffItem){return costDetailsHelpers.payOffFilter(payoffItem);}function removedItemsFilter(item){return !item.isRemoved;}function zeroItemsFilter(item){var flagReserves=item.amountPerMonth!=0&&(item.monthsToBePaid>0||item.hudLineNumber==1003);return item.editMode==true||flagReserves||item.borrowerPaid.atClosing!=0||item.borrowerPaid.beforeClosing!=0||item.sellerPaid.atClosing!=0||item.sellerPaid.beforeClosing!=0||item.otherPaid.atClosing!=0||item.otherPaid.beforeClosing!=0||item.amountMethod==1;}function isCostImpounded(item){return(item.impounded&&item.sectionId==6)||item.sectionId!=6;}function removedLenderItemsFilter(item){if(item.hudLineNumber=="802"){item.isHidden=vm.closingCostViewModel.totals.remainigRebate<=0;}return !item.isRemoved||item.isHidden==true&&item.isRemoved==false;}function lenderCreditRowClick(lenderCredit){if(lenderCredit.canEdit&&vm.closingCostsRW){lenderCredit.editMode=true;lenderCredit.hoverEdit=true;}}function addLenderCreditItem(section){if(vm.savingDataInProgress||vm.closingCostViewModel.disableFields){return;}var originalItem=section[0];var newItem=angular.copy(originalItem);newItem.isRemoved=false;newItem.editMode=true;newItem.hoverEdit=true;newItem.costContainer=enums.CostContainer.LenderCredits;newItem.loanId=wrappedLoan.ref.loanId;newItem.isLocked=true;vm.closingCostViewModel.costs.push(newItem);costDetailsHelpers.groupCostsBySections();}function deleteLenderCreditItem(item){if(vm.savingDataInProgress||vm.closingCostViewModel.disableFields){return;}item.isRemoved=true;calculateLenderCreditsTotals();}function lenderAmountChange(){calculateLenderCreditsTotals();}function getCashToCloseTotalsText(amount){return parseFloat(amount)<0?"From":"To";}function saveAll(){vm.savingDataInProgress=true;vm.closingCostViewModel.disableFields=true;NavigationSvc.SaveAndUpdateWrappedLoan(applicationData.currentUserId,wrappedLoan,function(wrappedLoan){vm.savingDataInProgress=false;vm.closingCostViewModel.disableFields=false;getCostDetailsData();},function(error){vm.savingDataInProgress=false;vm.closingCostViewModel.disableFields=false;});}function hideRemainigRebate(lenderCredit){if(!(lenderCredit.hudLineNumber=="802"&&vm.closingCostViewModel.totals.remainigRebate<=0)){return true;}else{lenderCredit.isHidden=true;return false;}}function isCostFullyPaidByRebate(cost){if(cost.otherPaid.beforeClosing==0&&cost.otherPaid.atClosing==0&&cost.sellerPaid.beforeClosing==0&&cost.sellerPaid.atClosing==0){return false;}return cost.borrowerPaid.beforeClosing==0&&cost.borrowerPaid.atClosing==0;}function isCostPartiallyPaidByRebate(cost){if(cost.otherPaid.beforeClosing==0&&cost.otherPaid.atClosing==0&&cost.sellerPaid.beforeClosing==0&&cost.sellerPaid.atClosing==0){return false;}return cost.borrowerPaid.beforeClosing!=0||cost.borrowerPaid.atClosing!=0;}function refreshSmartGFE(){pricingResultsSvc.RefreshSmartGFE.Refresh(vm.wrappedLoan.ref).$promise.then(function(data){vm.wrappedLoan.ref.closingCost.costs=data.costs;getCostDetailsData();},function(error){console.log("Error:"+JSON.stringify(error));});}function createSmartGFE(){var deferredCreateGFE=$q.defer();var deferredGetToken=$q.defer();var createGFEResult=pricingResultsSvc.CreateSmartGFE(vm.wrappedLoan.ref).then(function(data){signalrFactory.createListener("LoanActivityHub",smartGfeSignalRCostUpdate,wrappedLoan.ref.loanId);vm.wrappedLoan.ref.closingCost.smartGFEId=data.data;deferredCreateGFE.resolve(data.data);},function(error){console.log("Error:"+JSON.stringify(error));});var getToken=commonintegrationsSvc.services.getClosingCorpSSOToken({path:"GetClosingCorpSSOToken"},{},function(){blockUI.start("Loading...");deferredGetToken.resolve(getToken);});var token;var apiKey;var postPage;$q.all([deferredGetToken.promise,deferredCreateGFE.promise]).then(function(data){token=data[0].token;apiKey=data[0].apiKey;vm.showSmartGfeRefreshButton=data[0].showSmartGfeRefreshButton;postPage=data[0].postPage;blockUI.stop();$state.go("loanCenter.loan.cost.details.redirection",{token:token,apiKey:apiKey,smartGFEId:vm.wrappedLoan.ref.closingCost.smartGFEId,postUrl:postPage});});}function getTransactionsData(){vm.borrowerDataK={dueItems:[{name:"Sale Price of Property",cost:"180000"},{name:"Sale price of Any Personal Property Included in Sale",cost:"0"},{name:"Closing Costs Paid at Closing (J)",cost:"9682.30"},],adjust:[{name:"Example Line Item",cost:"900.00"}],adjustPaid:[{name:"City/Town Taxes",startDate:"04/15/2005",endDate:"09/15/2005",cost:"300"},{name:"County Taxes",startDate:"04/15/2007",endDate:"04/15/2008",cost:"600"},{name:"Assessments",startDate:"04/15/2012",endDate:"04/30/2013",cost:"40"},{name:"HOA Dues",startDate:"04/15/2015",endDate:"04/30/2017",cost:"80.00"}]};vm.borrowerDataL={credits:[{name:"Deposit",cost:"10,000.00"},{name:"Loan Amount",cost:"162,000.00"},{name:"Existing Loan(s) Assumed or Taken Subject to",cost:""},{name:"Seller Credit",cost:"2,500.00"},],otherCredits:[{name:"",cost:""}],adjust:[{name:"",cost:""}],adjustUnPaid:[{name:"City/Town Taxes",startDate:"1/1/15",endDate:"4/14/15",cost:"365.04"},{name:"County Taxes",startDate:"",endDate:"",cost:""},{name:"Assessments",startDate:"",endDate:"",cost:""}]};vm.sellerDataM={dueItems:[{name:"Sale Price of Property",cost:"180,000"},{name:"Sale price of Any Personal Property Included in Sale",cost:""},],adjustPaid:[{name:"City/Town Taxes",startDate:"",endDate:"",cost:""},{name:"County Taxes",startDate:"",endDate:"",cost:""},{name:"Assessments",startDate:"",endDate:"",cost:""},{name:"HOA Dues",startDate:"4/15/15",endDate:"4/30/15",cost:"-80.00"}]};vm.sellerDataN={credits:[{name:"Excess Deposit",cost:""},{name:"Closing Costs Paid at Closing (J)",cost:"12,800.00"},{name:"Existing Loan(s) Assumed or Taken Subject to",cost:""},{name:"Payoff of First Mortgage Loan",cost:"100,000.00"},{name:"Payoff of Second Mortgage Loan",cost:""},{name:"Seller Credit",cost:"2,500.00"},],adjustUnpaid:[{name:"City/Town Taxes",startDate:"1/1/15",endDate:"4/14/15",cost:"365.04"},{name:"County Taxes",startDate:"",endDate:"",cost:""},{name:"Assessments",startDate:"",endDate:"",cost:""}]};}function showLoanEstimateFeePopup(model,event){var initialModel=angular.copy(model);if(!initialModel.toleranceLevel&&initialModel.toleranceLevel!=0){initialModel.toleranceLevel=100;}var ctrl={itemModalTitle:"Loan Estimate Fees",serviceProviderChanged:serviceProviderChanged,loanEstimateFeeAmountChanged:loanEstimateFeeAmountChanged,disableTolerance:disableEstimateFeeTolerance,serviceProviderTypes:vm.applicationData.lookup.serviceProviderTypes};modalPopoverFactory.openModalPopover("angular/costdetails/loanestimatefees.html",ctrl,initialModel,event).result.then(function(data){model.useLoanEstimateFee=data.useLoanEstimateFee||data.useLoanEstimateFee=="true";model.loanEstimateFeeAmount=data.loanEstimateFeeAmount;model.serviceProvider=data.serviceProvider;model.toleranceLevel=data.toleranceLevel;});}function serviceProviderChanged(model){if(model.serviceProvider==1){model.toleranceLevel=0;}else{if(model.serviceProvider==2){model.toleranceLevel=10;}}}function loanEstimateFeeAmountChanged(model){var maxValue=999999.99;if(!isNaN(model.loanEstimateFeeAmount)&&parseFloat(model.loanEstimateFeeAmount)>maxValue){model.loanEstimateFeeAmount=maxValue;}}function disableEstimateFeeTolerance(model){return model.serviceProvider==1;}function isInitialEscrowPaymentSection(costsInSection){if(!costsInSection||!costsInSection[0]||costsInSection[0].sectionId!=6){return false;}return true;}function openImpoundCalculator(event){var totalLoanAmount=vm.wrappedLoan.ref.loanAmount;var closingMonth=moment(vm.wrappedLoan.ref.closingDate.dateValue).month()+1;if(!!vm.wrappedLoan.ref.detailsOfTransaction.totalLoanAmount){totalLoanAmount=vm.wrappedLoan.ref.detailsOfTransaction.totalLoanAmount;}var subjectProperty=vm.wrappedLoan.ref.getSubjectProperty();var impoundCalculator=modalPopoverFactory.openModalPopover("angular/common/impoundcalculator/impoundcalculator.html",$controller("impoundCalculatorController",{$scope:$scope.$new()}),{isRefinance:vm.isRefinance,mortageType:vm.wrappedLoan.ref.financialInfo.mortgageType,isExtended:true,loanAmount:totalLoanAmount,applicationData:applicationData,purchasePrice:subjectProperty.purchasePrice,costs:vm.wrappedLoan.ref.closingCost.costs,HOAExpens:{preferredPayPeriod:1,amountPerMonth:vm.wrappedLoan.ref.housingExpenses.newHoa,amount:vm.wrappedLoan.ref.housingExpenses.newHoa},paymentPeriodOptions:vm.applicationData.lookup.paymentPeriodOptions,firstPaymentDate:moment(vm.wrappedLoan.ref.firstPaymentDate).format("MM/DD/YYYY"),impoundSchedule:ImpoundCalculatorHelpersSvc.findImpoundScheduleByStateAndClosingMonth(vm.applicationData.impoundSchedules,subjectProperty.stateName,closingMonth),MICalculatorRequest:ImpoundCalculatorHelpersSvc.createMiRequestModel(vm.wrappedLoan.ref)},event,{className:"tooltip-arrow-right-cost-details",verticalPopupPositionPerHeight:0,horisontalPopupPositionPerWidth:0.695});impoundCalculator.result.then(function(data){costDetailsHelpers.updateImpounds(data,vm.wrappedLoan);getCostDetailsData();calculateAggregateAdjustmentIndex(vm.wrappedLoan.ref.closingCost.costs);loanEvent.broadcastPropertyChangedEvent(28,wrappedLoan.ref.totalAggregateAdjustment);},function(){});}function openItemizedPropertyTaxCalculator(event,cost){var itemizedPropertyTaxCalculator=modalPopoverFactory.openModalPopover("angular/common/itemizedpropertytaxcalculator/itemizedpropertytaxcalculator.html",$controller("itemizedPropertyTaxCalculatorController",{paymentPeriodMonths:vm.applicationData.lookup.periodPaymentMonths}),cost,event,{});itemizedPropertyTaxCalculator.result.then(function(data){var propertyTax=_.where(wrappedLoan.ref.closingCost.costs,{hudLineNumber:1004})[0];propertyTax.itemizedPropertyTaxes=data.itemizedPropertyTaxes;propertyTax.amountForYear=data.amountForYear;propertyTax.amountPerMonth=data.amountPerMonth;loanEvent.broadcastPropertyChangedEvent(28,wrappedLoan.ref.totalAggregateAdjustment);},function(){});}function isItemizeCalculatorVisible(loanCost){return loanCost.hudLineNumber==1004&&loanCost.amountMethod==1;}function smartGfeSignalrFunction(loanId,parameter){if(loanId==parameter){refreshSmartGFE();}}function isTaxOrInsuranceCost(cost){return cost.hudLineNumber==1002||(cost.hudLineNumber==1003&&!cost.userAdded)||cost.hudLineNumber==1004||cost.hudLineNumber==1006;}function recalculateAggregateAdjustment(loanCost){if(loanCost.hudLineNumber==1002||loanCost.hudLineNumber==1003||loanCost.hudLineNumber==1004||loanCost.hudLineNumber==1006||(loanCost.isRemoved!=true&&costDetailsHelpers.isOtherInsurance(loanCost))){loanEvent.broadcastPropertyChangedEvent(28,wrappedLoan.ref.totalAggregateAdjustment);}}function calculateAggregateAdjustmentIndex(costs){vm.aggregateAdjustmentIndex=costs.filter(function(c){if(vm.removedItemsFilter(c)&&vm.zeroItemsFilter(c)&&vm.isCostImpounded(c)&&c.sectionId==6){return c;}}).length+1;}function isAggregateAdjustmentIndexOdd(){return vm.aggregateAdjustmentIndex%2==0;}}})();var loanCenter;(function(loanCenter){var CostDetailsData=(function(){function CostDetailsData(){this.loanCosts=[];this.otherCosts=[];this.lenderCreditsCosts=[];this.usedLoanCostTypes=[];this.usedOtherCostTypes=[];this.payOffSectionItems=[];}return CostDetailsData;})();loanCenter.CostDetailsData=CostDetailsData;var costDetailsSvc=(function(){function costDetailsSvc($q,$resource,apiRoot){var _this=this;this.$q=$q;this.$resource=$resource;this.apiRoot=apiRoot;this.costDetailsApiPath=this.apiRoot+"CostDetails/";this.toleranceGroupsData={};this.toleranceLineItemsData={};this.activeToleranceData={};this.selectedToleranceItems={};this.initializeItemizedPropertyTaxes=this.$resource(this.costDetailsApiPath+"InitializeItemizedPropertyTaxes",{method:"GET",isArray:true,params:{costId:"costId"}});this.getToleranceGroups=function(){var def=_this.$q.defer();var service=_this;_this.toleranceGroupsData=_this.wrappedLoan.ref.closingCost.disclosuresDetailsViewModel;angular.forEach(service.toleranceGroupsData,function(group){group.costs=service.groupCostsByTolerance(group.costs);});_this.calculateAggregates(_this.toleranceGroupsData);def.resolve(_this.toleranceGroupsData);return def.promise;};this.getToleranceLineItems=function(toleranceGroupId){var def=_this.$q.defer();var service=_this;_this.selectedToleranceGroupId=toleranceGroupId;angular.forEach(service.toleranceGroupsData,function(group){if(group.disclosureDetailsId==service.selectedToleranceGroupId){service.toleranceLineItemsData=group;}});_this.setSelectedToleranceCosts(_this.toleranceLineItemsData);def.resolve(_this.toleranceLineItemsData);return def.promise;};this.getActiveToleranceGroup=function(){var def=_this.$q.defer();var activeToleranceData={};var activeGroupExists=false;var service=_this;service.getToleranceGroups().then(function(data){service.toleranceGroupsData=data;angular.forEach(service.toleranceGroupsData,function(group){if(group.active){activeGroupExists=true;service.activeToleranceGroupId=group.disclosureDetailsId;service.activeToleranceData=activeToleranceData=group;}});if(activeGroupExists){service.setSelectedToleranceCosts(activeToleranceData);}else{service.initializeSelectedToleranceItems();service.activeToleranceData=activeToleranceData={};service.activeToleranceGroupId=-1;}def.resolve(activeToleranceData);},function(errorMsg){def.reject(errorMsg);});return def.promise;};this.updateActiveToleranceTotals=function(){var def=_this.$q.defer();if(_this.activeToleranceData==undefined||_this.activeToleranceData.costs==undefined){return def.promise;}_this.activeToleranceData.costs=_this.groupCostsByTolerance(_this.activeToleranceData.costs);_this.calculateAggregates([_this.activeToleranceData]);def.resolve(_this.activeToleranceData);return def.promise;};this.initializeSelectedToleranceItems=function(){_this.selectedToleranceItems={zeroTolerance:{costs:[],disclosedTotal:0,currentTotal:0,changeDollar:0,changePercent:0,amountToCure:0},tenPercentTolerance:{costs:[],disclosedTotal:0,currentTotal:0,changeDollar:0,changePercent:0,amountToCure:0},unlimitedTolerance:{costs:[],disclosedTotal:0,currentTotal:0,changeDollar:0,changePercent:0,amountToCure:0}};};this.groupCostsByTolerance=function(toleranceCosts){if(toleranceCosts==undefined){return;}var allCurrentCosts=_this.wrappedLoan.ref.closingCost.costs;var service=_this;angular.forEach(allCurrentCosts,function(cost){if(cost.isRemoved||cost.hudLineNumber==204||cost.hudLineNumber==8020||(cost.hudLineNumber==802&&cost.amount<0)){return true;}var costExistsInToleranceCostsList=false;var costCopy=angular.copy(cost);costCopy.totalAmountForTolerance=cost.borrowerPaid.atClosing+cost.borrowerPaid.beforeClosing+cost.otherPaid.atClosing+cost.otherPaid.beforeClosing;costCopy.disclosedTotalAmountForTolerance=0;angular.forEach(toleranceCosts,function(toleranceCost){var subHUDLineNumberEmpty=((toleranceCost.subHUDLineNumber==null&&cost.subHUDLineNumber==null)||(toleranceCost.subHUDLineNumber==""&&cost.subHUDLineNumber==""));if((toleranceCost.hudLineNumber==cost.hudLineNumber)&&(subHUDLineNumberEmpty||(toleranceCost.subHUDLineNumber==cost.subHUDLineNumber))){costExistsInToleranceCostsList=true;toleranceCost.disclosedTotalAmountForTolerance=toleranceCost.amount;toleranceCost.totalAmountForTolerance=costCopy.totalAmountForTolerance;toleranceCost.toleranceLevel=cost.toleranceLevel;}});if(!costExistsInToleranceCostsList){toleranceCosts.push(costCopy);}});var filteredList=toleranceCosts.filter(function(toleranceCost){return(!service.isCostAmountEmpty(toleranceCost)&&(toleranceCost.hudLineNumber!=204)&&(toleranceCost.hudLineNumber!=8020)&&((toleranceCost.hudLineNumber==802&&toleranceCost.amount>0)||(toleranceCost.hudLineNumber!=802)));});return filteredList;};this.isCostAmountEmpty=function(cost){return((cost.disclosedTotalAmountForTolerance==null&&cost.totalAmountForTolerance==null)||(cost.disclosedTotalAmountForTolerance==0&&cost.totalAmountForTolerance==0));};this.setSelectedToleranceCosts=function(toleranceGroup){if(toleranceGroup==undefined||toleranceGroup.costs==undefined){_this.initializeSelectedToleranceItems();return;}_this.selectedToleranceItems=toleranceGroup;if(_this.selectedToleranceItems.zeroTolerance!=undefined){_this.selectedToleranceItems.zeroTolerance.costs=_this.getToleranceLevelCosts(toleranceGroup.costs,0);}if(_this.selectedToleranceItems.tenPercentTolerance!=undefined){_this.selectedToleranceItems.tenPercentTolerance.costs=_this.getToleranceLevelCosts(toleranceGroup.costs,10);}if(_this.selectedToleranceItems.unlimitedTolerance!=undefined){_this.selectedToleranceItems.unlimitedTolerance.costs=_this.getToleranceLevelCosts(toleranceGroup.costs,null);}};this.getToleranceLevelCosts=function(costs,toleranceLevel){var filteredCosts=[];angular.forEach(costs,function(cost){if(!cost.isRemoved&&cost.toleranceLevel==toleranceLevel){filteredCosts.push(cost);}});return filteredCosts;};this.calculateAggregates=function(toleranceGroups){var service=_this;angular.forEach(toleranceGroups,function(toleranceObj){var groupedCostsByTolerance=_.groupBy(toleranceObj.costs,"toleranceLevel");toleranceObj.zeroTolerance={disclosedTotal:0,currentTotal:0,changeDollar:0,changePercent:0,amountToCure:0};toleranceObj.tenPercentTolerance={disclosedTotal:0,currentTotal:0,changeDollar:0,changePercent:0,amountToCure:0};toleranceObj.unlimitedTolerance={disclosedTotal:0,currentTotal:0,changeDollar:0,changePercent:0,amountToCure:0};angular.forEach(groupedCostsByTolerance,function(costs,toleranceLevel){angular.forEach(costs,function(cost){if(toleranceLevel=="0"){toleranceObj.zeroTolerance.disclosedTotal+=parseFloat(cost.disclosedTotalAmountForTolerance);toleranceObj.zeroTolerance.currentTotal+=parseFloat(cost.totalAmountForTolerance);}else{if(toleranceLevel=="10"){toleranceObj.tenPercentTolerance.disclosedTotal+=parseFloat(cost.disclosedTotalAmountForTolerance);toleranceObj.tenPercentTolerance.currentTotal+=parseFloat(cost.totalAmountForTolerance);}else{toleranceObj.unlimitedTolerance.disclosedTotal+=parseFloat(cost.disclosedTotalAmountForTolerance);toleranceObj.unlimitedTolerance.currentTotal+=parseFloat(cost.totalAmountForTolerance);}}});});service.calculateToleranceTotals(toleranceObj.zeroTolerance);service.calculateToleranceTotals(toleranceObj.tenPercentTolerance);toleranceObj.zeroTolerance.amountToCure=(toleranceObj.zeroTolerance.changeDollar<0)?0:toleranceObj.zeroTolerance.changeDollar;toleranceObj.tenPercentTolerance.amountToCure=(toleranceObj.tenPercentTolerance.changePercent<10||toleranceObj.tenPercentTolerance.changePercent==10||toleranceObj.tenPercentTolerance.changePercent<0)?0:toleranceObj.tenPercentTolerance.changeDollar-(toleranceObj.tenPercentTolerance.disclosedTotal*0.1);toleranceObj.unlimitedTolerance.amountToCure=toleranceObj.zeroTolerance.amountToCure+toleranceObj.tenPercentTolerance.amountToCure;});};this.calculateToleranceTotals=function(section){section.changeDollar=section.currentTotal-section.disclosedTotal;section.changePercent=(section.disclosedTotal>0)?Math.round(((section.changeDollar/section.disclosedTotal)*100)*100)/100:0;};this.getBorrowerTotal=function(){if(!_this.wrappedLoan.ref.closingCost||!_this.wrappedLoan.ref.closingCost.totals||!_this.wrappedLoan.ref.closingCost.totals.closingCosts){return 0;}return _this.wrappedLoan.ref.closingCost.totals.closingCosts.borrowerTotal;};this.totalClosingCostsWithoutG=function(){var borrowerTotal=_this.getBorrowerTotal();var sectionGTotal=lib.summate(_this.costDetailsData.groupedOtherCosts["G. INITIAL ESCOW PAYMENT AT CLOSING"],function(p){return p.borrowerPaid.atClosing!=0;},function(c){return c.borrowerPaid.atClosing;});return borrowerTotal-sectionGTotal;};this.costDetailsData=new CostDetailsData();this.initializeSelectedToleranceItems();}costDetailsSvc.className="costDetailsSvc";costDetailsSvc.$inject=["$q","$resource","apiRoot"];return costDetailsSvc;})();loanCenter.costDetailsSvc=costDetailsSvc;angular.module("loanCenter").service(costDetailsSvc.className,costDetailsSvc);})(loanCenter||(loanCenter={}));(function(){angular.module("loanCenter").factory("costDetailsHelpers",costDetailsHelpers);costDetailsHelpers.$inject=["costDetailsSvc","enums","commonService","$filter","BroadcastSvc","$state"];function costDetailsHelpers(costDetailsSvc,enums,commonService,$filter,BroadcastSvc,$state){var service={getAllUsedCostTypes:getAllUsedCostTypes,calculateTotals:calculateTotals,calculateLoanCostsTotals:calculateLoanCostsTotals,calculateOtherCostsTotals:calculateOtherCostsTotals,calculateClosingCostsTotals:calculateClosingCostsTotals,calculateLenderCreditsTotals:calculateLenderCreditsTotals,calculateCashToCloseTotals:calculateCashToCloseTotals,initializeCostService:initializeCostService,resetLoanOtherCostsTotals:resetLoanOtherCostsTotals,resetTaxesAndRecordingsTotals:resetTaxesAndRecordingsTotals,resetAllTotals:resetAllTotals,calculatePayOffTotals:calculatePayOffTotals,calculateTaxesAndRecordingsTotals:calculateTaxesAndRecordingsTotals,recalculateRightSectionAmounts:recalculateRightSectionAmounts,calculateBorrowerPTCAmount:calculateBorrowerPTCAmount,sumOfRightSection:sumOfRightSection,calculateCostsOnCloseDateChanged:calculateCostsOnCloseDateChanged,resetRightSectionAmounts:resetRightSectionAmounts,groupCostsBySections:groupCostsBySections,initializeTotals:initializeTotals,calculateLoanOrOtherCostsTotals:calculateLoanOrOtherCostsTotals,updateImpounds:updateImpounds,isOtherInsurance:isOtherInsurance,calculateCostTotals:calculateCostTotals,payOffFilter:payOffFilter,getCostDetailsData:getCostDetailsData,calculateSectionTotal:calculateSectionTotal,calculateAllowableBorrowerPaidClosingCost:calculateAllowableBorrowerPaidClosingCost,payoffCommentChanged:payoffCommentChanged,getCostsTotalByHUDLineNumber:getCostsTotalByHUDLineNumber};return service;function initializeCostService(wrappedLoan,applicationData){costDetailsSvc.wrappedLoan=wrappedLoan;if(!!applicationData){costDetailsSvc.applicationData=applicationData;}initializeTotals();}function getCostDetailsData(){var closingCostViewModel=costDetailsSvc.wrappedLoan.ref.closingCost;closingCostViewModel.activeTab=($state.current.name=="loanCenter.loan.cost.transactional")?"transactional-summary":"closing-costs";initializeTotals();groupCostsBySections();initializePayOffSectionItems();populatePledgedAssetComments(costDetailsSvc.applicationData.lookup.pledgetAssetComments);closingCostViewModel.totals.totalLenderRebate=closingCostViewModel.totalLenderRebate;getAllUsedCostTypes(costDetailsSvc.costDetailsData.usedLoanCostTypes,costDetailsSvc.costDetailsData.usedOtherCostTypes,costDetailsSvc.costDetailsData.loanCosts,costDetailsSvc.costDetailsData.otherCosts);calculateCostTotals();calculatePayOffTotals();roundAndRecalculatePTCAmountOnInit();closingCostViewModel.disableFields=!costDetailsSvc.applicationData.currentUser.hasPrivilege(enums.privileges.ClosingCostsRW);costDetailsSvc.getActiveToleranceGroup();}function initializePayOffSectionItems(){costDetailsSvc.costDetailsData.payOffSectionItems=[];angular.forEach(costDetailsSvc.wrappedLoan.ref.getLoanApplications(),function(loanApplication){if(loanApplication.getBorrower()){angular.forEach(loanApplication.getBorrower().getLiabilities(),function(liability){initializePayOffSectionItem(liability);});angular.forEach(loanApplication.getBorrower().publicRecords,function(publicRecord){initializePayOffSectionItem(publicRecord);});}if(loanApplication.getCoBorrower()&&loanApplication.isSpouseOnTheLoan){angular.forEach(loanApplication.getCoBorrower().getLiabilities(),function(liability){initializePayOffSectionItem(liability);});angular.forEach(loanApplication.getCoBorrower().publicRecords,function(publicRecord){initializePayOffSectionItem(publicRecord);});}});setCreditPayoffItemsCount();}function initializePayOffSectionItem(item){if(item.isRemoved){return;}item.hidden=false;payoffCommentChanged(item);costDetailsSvc.costDetailsData.payOffSectionItems.push(item);}function setCreditPayoffItemsCount(){costDetailsSvc.costDetailsData.creditPayoffItemsCount=0;angular.forEach(costDetailsSvc.costDetailsData.payOffSectionItems,function(payoffItem){if(payOffFilter(payoffItem)){costDetailsSvc.costDetailsData.creditPayoffItemsCount+=1;}});}function payoffCommentChanged(payoffItem){var isLiabilityPayOff=payoffItem.isLiability&&payoffItem.payoffCommentId!=enums.LiabilitiesDebtComment.PayoffAtClose;var isPublicRecordPayOff=payoffItem.isPublicRecord&&payoffItem.payoffCommentId!=enums.DebtComment.PayoffAtClose;var isPledgedAssetPayOff=payoffItem.isPledged&&(payoffItem.payoffCommentId!=enums.PledgedAssetComment.PayoffAtClose&&payoffItem.payoffCommentId!=enums.PledgedAssetComment.PayoffAtClosingAndDontCloseAccount&&payoffItem.payoffCommentId!=enums.PledgedAssetComment.PayoffAtClosingAndCloseAccount);if(isLiabilityPayOff||isPublicRecordPayOff||isPledgedAssetPayOff){payoffItem.hidden=true;calculatePayOffTotals();costDetailsSvc.costDetailsData.creditPayoffItemsCount-=1;}}function payOffFilter(payoffItem){return !payoffItem.isRemoved&&!payoffItem.hidden&&(payoffItem.balance>0||payoffItem.isPayoffItem);}function calculateCostTotals(){calculateTotals();BroadcastSvc.broadcastCostDetailsTotals(costDetailsSvc.wrappedLoan.ref.closingCost.totals);}function populatePledgedAssetComments(pledgetAssetComments){if(!pledgetAssetComments||pledgetAssetComments.length===0){return;}var notMyLoanEnumText="Not My Loan / Exclude From Debt Ratio";var commentNotMyLoan=_.find(pledgetAssetComments,function(comment){return comment.value===enums.PledgedAssetComment.NotMyLoan.toString();});if(commentNotMyLoan){commentNotMyLoan.text=notMyLoanEnumText;}}function roundAndRecalculatePTCAmountOnInit(){var allCosts=costDetailsSvc.wrappedLoan.ref.closingCost.costs;for(var key in allCosts){if((allCosts[key].templateId==4||allCosts[key].templateId==5)&&!allCosts[key].isRemoved){var expectedBorrowerPtcAmount=calculateBorrowerPTCAmount(allCosts[key],costDetailsSvc.wrappedLoan.ref.closingDate.dateValue);if(expectedBorrowerPtcAmount!=sumOfRightSection(allCosts[key])){resetRightSectionAmounts(allCosts[key]);allCosts[key].borrowerPaid.atClosing=expectedBorrowerPtcAmount;}}}calculateCostTotals();}function getAllUsedCostTypes(usedLoanCostTypes,usedOtherCostTypes,loanCosts,otherCosts){angular.forEach(loanCosts,function(cost){if(!cost.isRemoved&&cost.mustBeUnique){usedLoanCostTypes.push(cost.uniqueCostTypeId);}});angular.forEach(otherCosts,function(cost){if(!cost.isRemoved&&cost.mustBeUnique){usedOtherCostTypes.push(cost.uniqueCostTypeId);}});}function resetLoanOtherCostsTotals(totals){totals.borrowerPaidAtClosingTotal=0;totals.borrowerPaidBeforeClosingTotal=0;totals.sellerPaidAtClosingTotal=0;totals.sellerPaidBeforeClosingTotal=0;totals.otherPaidAtClosingTotal=0;totals.otherPaidBeforeClosingTotal=0;totals.totalLenderPaidFees=0;totals.borrowerTotal=0;totals.sellerTotal=0;totals.otherTotal=0;totals.total=0;}function resetClosingCostsTotals(totals){totals.borrowerPaidAtClosingTotal=0;totals.borrowerPaidBeforeClosingTotal=0;totals.sellerPaidAtClosingTotal=0;totals.sellerPaidBeforeClosingTotal=0;totals.otherPaidAtClosingTotal=0;totals.otherPaidBeforeClosingTotal=0;totals.paidBeforeClosingTotal=0;totals.total=0;totals.borrowerTotal=0;totals.totalLenderPaidFees=0;}function resetCashToCloseTotals(totals){totals.loanEstimateTotal=0;totals.finalTotal=0;}function resetTaxesAndRecordingsTotals(totals){totals.recordingFeesTotal=0;totals.taxesTotal=0;}function resetAllTotals(totals){resetLoanOtherCostsTotals(totals.loanCosts);resetLoanOtherCostsTotals(totals.otherCosts);resetClosingCostsTotals(totals.closingCosts);resetCashToCloseTotals(totals.calculatedCashToClose);resetTaxesAndRecordingsTotals(totals);}function calculateTotals(){resetAllTotals(costDetailsSvc.wrappedLoan.ref.closingCost.totals);calculateLoanCostsTotals(true);calculateOtherCostsTotals(true);calculateLenderCreditsTotals(true);calculateClosingCostsTotals();calculateCashToCloseTotals();calculateTaxesAndRecordingsTotals();}function calculateLoanCostsTotals(skipClosingCostTotalsCalculation){calculateLoanOrOtherCostsTotals(costDetailsSvc.wrappedLoan.ref.closingCost.totals,costDetailsSvc.costDetailsData.loanCosts,costDetailsSvc.costDetailsData.lenderCreditsCosts,skipClosingCostTotalsCalculation,false);}function calculateOtherCostsTotals(skipClosingCostTotalsCalculation){calculateLoanOrOtherCostsTotals(costDetailsSvc.wrappedLoan.ref.closingCost.totals,costDetailsSvc.costDetailsData.otherCosts,costDetailsSvc.costDetailsData.lenderCreditsCosts,skipClosingCostTotalsCalculation,true);}function calculateLoanOrOtherCostsTotals(allTotals,costs,lenderCreditsCosts,skipClosingCostTotalsCalculation,isOtherSection){var totals=isOtherSection?allTotals.otherCosts:allTotals.loanCosts;resetLoanOtherCostsTotals(totals);angular.forEach(costs,function(cost){if(cost.isRemoved||(isOtherSection&&!cost.impounded&&cost.sectionId==6)){return true;}if(isAmountValid(cost.borrowerPaid.atClosing)){totals.borrowerPaidAtClosingTotal+=parseFloat(cost.borrowerPaid.atClosing);}if(isAmountValid(cost.borrowerPaid.beforeClosing)){totals.borrowerPaidBeforeClosingTotal+=parseFloat(cost.borrowerPaid.beforeClosing);}if(isAmountValid(cost.sellerPaid.atClosing)){totals.sellerPaidAtClosingTotal+=parseFloat(cost.sellerPaid.atClosing);}if(isAmountValid(cost.sellerPaid.beforeClosing)){totals.sellerPaidBeforeClosingTotal+=parseFloat(cost.sellerPaid.beforeClosing);}if(isAmountValid(cost.otherPaid.atClosing)){totals.otherPaidAtClosingTotal+=parseFloat(cost.otherPaid.atClosing);if(cost.otherPaid.paidBy==enums.PaidBy.LenderRebate){totals.totalLenderPaidFees+=parseFloat(cost.otherPaid.atClosing);}}if(isAmountValid(cost.otherPaid.beforeClosing)){totals.otherPaidBeforeClosingTotal+=parseFloat(cost.otherPaid.beforeClosing);}});totals.borrowerTotal=totals.borrowerPaidAtClosingTotal+totals.borrowerPaidBeforeClosingTotal;totals.sellerTotal=totals.sellerPaidAtClosingTotal+totals.sellerPaidBeforeClosingTotal;totals.otherTotal=totals.otherPaidAtClosingTotal+totals.otherPaidBeforeClosingTotal;totals.total=totals.borrowerTotal+totals.sellerTotal+totals.otherTotal;if(skipClosingCostTotalsCalculation!=true){calculateLenderCreditsTotals(true);calculateClosingCostsTotals();if(isOtherSection){calculateTaxesAndRecordingsTotals();}}}function calculateClosingCostsTotals(){var totals=costDetailsSvc.wrappedLoan.ref.closingCost.totals;resetClosingCostsTotals(totals.closingCosts);totals.closingCosts.borrowerPaidAtClosingTotal=totals.loanCosts.borrowerPaidAtClosingTotal+totals.otherCosts.borrowerPaidAtClosingTotal;totals.closingCosts.borrowerPaidBeforeClosingTotal=totals.loanCosts.borrowerPaidBeforeClosingTotal+totals.otherCosts.borrowerPaidBeforeClosingTotal;totals.closingCosts.sellerPaidAtClosingTotal=totals.loanCosts.sellerPaidAtClosingTotal+totals.otherCosts.sellerPaidAtClosingTotal;totals.closingCosts.sellerPaidBeforeClosingTotal=totals.loanCosts.sellerPaidBeforeClosingTotal+totals.otherCosts.sellerPaidBeforeClosingTotal;totals.closingCosts.otherPaidAtClosingTotal=totals.loanCosts.otherPaidAtClosingTotal+totals.otherCosts.otherPaidAtClosingTotal;totals.closingCosts.otherPaidBeforeClosingTotal=totals.loanCosts.otherPaidBeforeClosingTotal+totals.otherCosts.otherPaidBeforeClosingTotal;totals.closingCosts.paidBeforeClosingTotal=totals.closingCosts.borrowerPaidBeforeClosingTotal+totals.closingCosts.sellerPaidBeforeClosingTotal+totals.closingCosts.otherPaidBeforeClosingTotal;totals.closingCosts.total=totals.loanCosts.total+totals.otherCosts.total+totals.lenderCredits;totals.closingCosts.borrowerTotal=totals.closingCosts.borrowerPaidAtClosingTotal+totals.closingCosts.borrowerPaidBeforeClosingTotal+totals.lenderCredits;totals.totalLenderPaidFees=totals.loanCosts.totalLenderPaidFees+totals.otherCosts.totalLenderPaidFees;totals.remainigRebate=calculateRemainingRebate(totals.totalLenderRebate,totals.totalLenderPaidFees);}function calculateLenderCreditsTotals(skipClosingCostTotalsCalculation){var totals=costDetailsSvc.wrappedLoan.ref.closingCost.totals;var lenderCreditsCosts=costDetailsSvc.costDetailsData.lenderCreditsCosts;totals.lenderCredits=0;totals.totalLenderPaidFees=totals.loanCosts.totalLenderPaidFees+totals.otherCosts.totalLenderPaidFees;totals.remainigRebate=calculateRemainingRebate(totals.totalLenderRebate,totals.totalLenderPaidFees);var remain=totals.totalLenderPaidFees+totals.totalLenderRebate;for(var i=0;i<lenderCreditsCosts.length;i++){var cost=lenderCreditsCosts[i];if(cost.isRemoved||(remain>=0&&cost.hudLineNumber==802)){continue;}if(isAmountValid(cost.otherPaid.atClosing)){if(cost.hudLineNumber==802&&isAmountValid(totals.remainigRebate)&&totals.remainigRebate>0){totals.lenderCredits-=totals.remainigRebate;}else{if(cost.editMode==true&&cost.otherPaid.atClosing>0){totals.lenderCredits-=parseFloat(cost.otherPaid.atClosing);}else{totals.lenderCredits+=parseFloat(cost.otherPaid.atClosing);}}}}if(skipClosingCostTotalsCalculation!=true){calculateClosingCostsTotals();}}function calculateRemainingRebate(totalLenderRebate,totalLenderPaidFees){var remainingRebate=roundToTwoDecimalPlaces(totalLenderRebate*-1)-roundToTwoDecimalPlaces(totalLenderPaidFees);return remainingRebate;}function roundToTwoDecimalPlaces(value){return Math.round(value*100)/100;}function calculatePayOffTotals(){var totalAmount=AddPayoffItems(costDetailsSvc.wrappedLoan.ref.closingCost.payOffSection.payOffItems);totalAmount+=AddPayoffItems(costDetailsSvc.costDetailsData.payOffSectionItems);costDetailsSvc.wrappedLoan.ref.closingCost.totals.payOffSectionTotal=totalAmount;calculateCostTotals();}function AddPayoffItems(payoffs){var totalAmount=0;for(var i=0;i<payoffs.length;i++){var item=payoffs[i];if(item.isRemoved||item.hidden){continue;}totalAmount+=item.balance;}return totalAmount;}function calculateLoanEstimateTotal(loanEstimates){return loanEstimates.loanAmount-loanEstimates.totalClosingCosts+loanEstimates.closingCostsPaidBeforeClosing-(Math.abs(loanEstimates.totalPayoffsAndPayments));}function calculateCashToCloseFinalTotal(totals,loanAmountFinal){var payOffTotal=getFloatValue(totals.payOffSectionTotal);var totalClosingCosts=getFloatValue(totals.closingCosts.borrowerTotal);return loanAmountFinal-totalClosingCosts+totals.closingCosts.borrowerPaidBeforeClosingTotal-(Math.abs(payOffTotal));}function calculateFinancedClosingCosts(totals,loanAmountFinal){var closingCostsFinanced=loanAmountFinal+(-Math.abs(getFloatValue(totals.payOffSectionTotal)));var totalClosingCosts=getFloatValue(totals.closingCosts.borrowerTotal);var returnValue;if(closingCostsFinanced>0&&totalClosingCosts>0){if(closingCostsFinanced>totalClosingCosts){returnValue=totalClosingCosts;}else{returnValue=closingCostsFinanced;}}else{returnValue=0;}return returnValue;}function calculateCashToCloseTotals(){var totals=costDetailsSvc.wrappedLoan.ref.closingCost.totals;var calculatedCashToCloseLoanEstimates=costDetailsSvc.wrappedLoan.ref.closingCost.calculatedCashToClose.loanEstimates;var loanAmount=costDetailsSvc.wrappedLoan.ref.detailsOfTransaction.totalLoanAmount;totals.calculatedCashToClose.loanEstimateTotal=calculateLoanEstimateTotal(calculatedCashToCloseLoanEstimates);totals.calculatedCashToClose.finalTotal=calculateCashToCloseFinalTotal(totals,loanAmount);totals.calculatedCashToClose.financedClosingCosts=calculateFinancedClosingCosts(totals,loanAmount);}function calculateTaxesAndRecordingsTotals(){var totals=costDetailsSvc.wrappedLoan.ref.closingCost.totals;var costs=costDetailsSvc.costDetailsData.otherCosts;resetTaxesAndRecordingsTotals(totals);for(var i=0;i<costs.length;i++){var cost=costs[i];if(cost.isRemoved){continue;}if(cost.costTypeGroupCategory=="Recordings"){if(cost.includeInTotal==1){totals.recordingFeesTotal+=getCostTotalAmount(cost);}}else{if(cost.costTypeGroupCategory=="Taxes"){totals.taxesTotal+=getCostTotalAmount(cost);}}}}function calculateSectionTotal(section){var sectionTotal=0;angular.forEach(costDetailsSvc.wrappedLoan.ref.closingCost.costs,function(cost){if(!cost.isRemoved&&cost.sectionId==section){sectionTotal+=cost.borrowerPaid.atClosing+cost.borrowerPaid.beforeClosing;}});return sectionTotal;}function getCostsTotalByHUDLineNumber(hudLineNumber,subHudLineNuumber){var total=0;lib.forEach(costDetailsSvc.wrappedLoan.ref.closingCost.costs,function(cost){if(!cost.isRemoved&&(cost.hudLineNumber==hudLineNumber||cost.originalHUDLineNumber==hudLineNumber)){if(subHudLineNuumber&&(cost.subHUDLineNumber==subHudLineNuumber||cost.originalSubHUDLineNumber==subHudLineNuumber)){total+=cost.borrowerPaid.atClosing+cost.borrowerPaid.beforeClosing;return;}total+=cost.borrowerPaid.atClosing+cost.borrowerPaid.beforeClosing;}});return total;}function getCostTotalAmount(cost){return cost.borrowerPaid.atClosing+cost.borrowerPaid.beforeClosing+cost.sellerPaid.atClosing+cost.sellerPaid.beforeClosing+cost.otherPaid.atClosing+cost.otherPaid.beforeClosing;}function isAmountValid(amount){return amount!=null&&!isNaN(parseFloat(amount));}function getFloatValue(amount){return isAmountValid(amount)?parseFloat(amount):0;}function calculateCostsOnCloseDateChanged(costs,closingDate,impoundSchedules,stateName){for(var i=0;i<costs.length;i++){if(costs[i].hudLineNumber==901||costs[i].originalHUDLineNumber==901){var days=this.commonService.compareDatesCustom(closingDate,costs[i].closingDateEnd,enums.timeInterval.days);var amount=costs[i].interestRate*days;costs[i].amount=amount;costs[i].borrowerPaid.atClosing=amount;resetRightSectionAmounts(costs[i]);}if(costs[i].hudLineNumber==1002||costs[i].originalHUDLineNumber==1002){var numberOfMonthsHoi=getEscrowNumberOfMonths(impoundSchedules,closingDate,costs[i].hudLineNumber,null);var amount=calculateCostImpounds(costs[i].preferredPaymentPeriod,numberOfMonthsHoi,costs[i].amountPerMonth*12);costs[i].amount=amount;costs[i].amountPerMonth=costs[i].amount/numberOfMonthsHoi;costs[i].monthsToBePaid=costs[i].originalMonthsToBePaid=numberOfMonthsHoi;costs[i].borrowerPaid.atClosing=amount;resetRightSectionAmounts(costs[i]);}if(costs[i].hudLineNumber==1004||costs[i].originalHUDLineNumber==1004){var numberOfMonths=getEscrowNumberOfMonths(impoundSchedules,closingDate,costs[i].hudLineNumber,stateName);var amount=calculateCostImpounds(costs[i].preferredPaymentPeriod,numberOfMonths,costs[i].amountPerMonth*12);costs[i].amount=amount;costs[i].amountPerMonth=costs[i].amount/numberOfMonths;costs[i].monthsToBePaid=costs[i].originalMonthsToBePaid=numberOfMonths;costs[i].borrowerPaid.atClosing=amount;resetRightSectionAmounts(costs[i]);}}}function calculateCostImpounds(preferredPaymentPeriod,numberOfMonths,userEnteredAmount){var amount=0;if(preferredPaymentPeriod==1){amount=(Math.round(userEnteredAmount*10000)/10000)*numberOfMonths;}else{amount=(Math.round(userEnteredAmount/12*10000)/10000)*numberOfMonths;}return amount;}function getEscrowNumberOfMonths(impoundSchedules,closingDate,hudlineNumber,stateName){var numberOfMonths=0;var closingDateMonth=new Date(closingDate).getMonth()+1;if(hudlineNumber==1004){numberOfMonths=impoundSchedules.filter(function(e){return e.hudLine==1004&&e.month==closingDateMonth&&e.state==stateName;})[0].impoundsOpen;}else{if(hudlineNumber==1002){numberOfMonths=impoundSchedules.filter(function(e){return e.hudLine==1002;})[0].impoundsOpen;}}return numberOfMonths;}function resetRightSectionAmounts(cost){cost.borrowerPaid.beforeClosing=0;cost.sellerPaid.atClosing=0;cost.sellerPaid.beforeClosing=0;cost.otherPaid.atClosing=0;cost.otherPaid.beforeClosing=0;}function recalculateRightSectionAmounts(cost,model,rightSectionPaidType,borrowerPaidMax,atClose){if(atClose===void 0){atClose=true;}var diffBetweenSumAndMax=diferenceBetweenSumAndMax(cost,borrowerPaidMax,atClose);var diffBetweenMaxAndSumOfAllCostsInRightSection=borrowerPaidMax-sumOfRightSection(cost);var borrowerPaidAmount=!atClose?cost.borrowerPaid.beforeClosing:cost.borrowerPaid.atClosing;if(diffBetweenMaxAndSumOfAllCostsInRightSection>0){setBorrowerPaidAmount(cost.borrowerPaid,borrowerPaidAmount+diffBetweenMaxAndSumOfAllCostsInRightSection,atClose);}else{if(diffBetweenSumAndMax>0){setBorrowerPaidAmount(cost.borrowerPaid,diffBetweenSumAndMax,atClose);}else{model[rightSectionPaidType]=borrowerPaidAmount+(borrowerPaidMax-sumAllExcept(cost,model,rightSectionPaidType));setBorrowerPaidAmount(cost.borrowerPaid,0,atClose);}}}function setBorrowerPaidAmount(borrowerPaid,amount,atClose){if(!atClose){borrowerPaid.beforeClosing=amount;}else{borrowerPaid.atClosing=amount;}}function sumAllExcept(cost,model,costPaidWhenTypes){var sum=0;for(var key in enums.costPaymentTypes){if(cost[key]==model){sum+=costPaidWhenTypes!=enums.costPaidWhenTypes.atClosing?cost[key].atClosing:cost[key].beforeClosing;}else{sum+=cost[key].atClosing+cost[key].beforeClosing;}}return sum;}function sumOfRightSection(cost){return cost.borrowerPaid.atClosing+cost.borrowerPaid.beforeClosing+cost.sellerPaid.atClosing+cost.sellerPaid.beforeClosing+cost.otherPaid.atClosing+cost.otherPaid.beforeClosing;}function diferenceBetweenSumAndMax(cost,borrowerPaidMax,atClose){return borrowerPaidMax-sumAllExcept(cost,cost.borrowerPaid,atClose?enums.costPaidWhenTypes.atClosing:enums.costPaidWhenTypes.beforeClosing);}function calculateBorrowerPTCAmount(cost,closingDate){return cost.templateId==4?cost.monthsToBePaid*$filter("impRound")(cost.amountPerMonth,2):commonService.compareDatesCustom(closingDate,cost.closingDateEnd,enums.timeInterval.days)*$filter("impRound")(cost.interestRate,2);}function updateImpounds(data,wrappedLoan){if(!data||!data.costs||!wrappedLoan){return;}for(var i=0;i<data.costs.length;i++){var newCost=data.costs[i];if(!newCost.amountPerMonth){newCost.amountPerMonth=0;}var matchingCosts=[];if(newCost.hudLineNumber==1002||newCost.hudLineNumber==1003||newCost.hudLineNumber==1004||newCost.hudLineNumber==1006){matchingCosts=_.where(wrappedLoan.ref.closingCost.costs,{hudLineNumber:newCost.hudLineNumber});}else{matchingCosts=_.where(wrappedLoan.ref.closingCost.costs,{costId:newCost.costId});}if(!matchingCosts.length){wrappedLoan.ref.closingCost.costs.push(matchingCosts[0]);}else{var oldCost=matchingCosts[0];oldCost.amountPerMonth=newCost.amountPerMonth;oldCost.monthsToBePaid=newCost.monthsToBePaid;if(!oldCost.originalMonthsToBePaid||oldCost.originalMonthsToBePaid<0){oldCost.originalMonthsToBePaid=newCost.monthsToBePaid;}oldCost.preferredPaymentPeriod=newCost.preferredPaymentPeriod;oldCost.amount=newCost.amountPerMonth*newCost.monthsToBePaid;if(newCost.hudLineNumber!=1003||newCost.amountMethod==3){oldCost.borrowerPaid.atClosing=newCost.amountPerMonth*newCost.monthsToBePaid;}oldCost.amountMethod=newCost.amountMethod;oldCost.percent=newCost.percent;oldCost.impounded=newCost.impounded;oldCost.itemizedPropertyTaxes=newCost.itemizedPropertyTaxes;oldCost.periodPaymentMonths=newCost.periodPaymentMonths;oldCost.upfrontPreferredPaymentPeriod=newCost.upfrontPreferredPaymentPeriod;oldCost.editMode=newCost.editMode;oldCost.isLocked=newCost.isLocked;switch(oldCost.hudLineNumber){case 1004:wrappedLoan.ref.housingExpenses.newTaxes=oldCost.amountPerMonth;break;case 1002:wrappedLoan.ref.housingExpenses.newHazardInsurance=oldCost.amountPerMonth;break;case 1006:wrappedLoan.ref.housingExpenses.newFloodInsurance=oldCost.amountPerMonth;break;case 1003:if(newCost.amountMethod==3){wrappedLoan.ref.housingExpenses.newMtgInsurance=oldCost.amountPerMonth;}break;}if(newCost.hudLineNumber!=1003||newCost.amountMethod==3){resetRightSectionAmounts(oldCost);oldCost.borrowerPaid.atClosing=calculateBorrowerPTCAmount(oldCost,wrappedLoan.ref.closingDate.dateValue);}}}wrappedLoan.ref.housingExpenses.newHoa=data.HOAExpens.amountPerMonth;}function groupCostsBySections(){costDetailsSvc.costDetailsData.loanCosts=[];costDetailsSvc.costDetailsData.otherCosts=[];costDetailsSvc.costDetailsData.lenderCreditsCosts=[];angular.forEach(costDetailsSvc.wrappedLoan.ref.closingCost.costs,function(cost){if(cost.costContainer==enums.CostContainer.LoanCosts){costDetailsSvc.costDetailsData.loanCosts.push(cost);}else{if(cost.costContainer==enums.CostContainer.OtherCosts){costDetailsSvc.costDetailsData.otherCosts.push(cost);}else{if(cost.costContainer==enums.CostContainer.LenderCredits){costDetailsSvc.costDetailsData.lenderCreditsCosts.push(cost);}}}});costDetailsSvc.costDetailsData.groupedLoanCosts=_.groupBy(costDetailsSvc.costDetailsData.loanCosts,"sectionName");costDetailsSvc.costDetailsData.groupedOtherCosts=_.groupBy(costDetailsSvc.costDetailsData.otherCosts,"sectionName");}function initializeTotals(){costDetailsSvc.wrappedLoan.ref.closingCost.totals={};costDetailsSvc.wrappedLoan.ref.closingCost.totals.loanCosts={};costDetailsSvc.wrappedLoan.ref.closingCost.totals.otherCosts={};costDetailsSvc.wrappedLoan.ref.closingCost.totals.closingCosts={};resetClosingCostsTotals(costDetailsSvc.wrappedLoan.ref.closingCost.totals.closingCosts);costDetailsSvc.wrappedLoan.ref.closingCost.totals.payOffSection={};costDetailsSvc.wrappedLoan.ref.closingCost.totals.lenderCredits=0;costDetailsSvc.wrappedLoan.ref.closingCost.totals.totalLenderRebate=0;costDetailsSvc.wrappedLoan.ref.closingCost.totals.totalLenderPaidFees=0;costDetailsSvc.wrappedLoan.ref.closingCost.totals.calculatedCashToClose={};costDetailsSvc.wrappedLoan.ref.closingCost.totals.recordingFeesTotal=0;costDetailsSvc.wrappedLoan.ref.closingCost.totals.taxesTotal=0;}function isOtherInsurance(cost){return(cost.hudLineNumber==1010||cost.hudLineNumber==1007||cost.hudLineNumber==1012||cost.originalHUDLineNumber==1010||cost.originalHUDLineNumber==1007||cost.originalHUDLineNumber==1012);}function calculateAllowableBorrowerPaidClosingCost(){return costDetailsSvc.wrappedLoan.ref.closingCost.totals.loanCosts.borrowerTotal+(costDetailsSvc.wrappedLoan.ref.closingCost.totals.otherCosts.borrowerTotal-calculateSectionTotal(5));}}})();(function(){angular.module("loanCenter").directive("cashToCloseValueChanged",function(){return{restrict:"AE",scope:{loanEstimate:"=",finalValue:"=",isDisclosureAvailable:"="},controller:controller,controllerAs:"ctrl",bindToController:true,template:'<div class="{{ctrl.getTextClass()}}"><span>{{ctrl.getText()}}</span></div>',replace:true};function controller(){var vm=this;vm.getText=getText;vm.getTextClass=getTextClass;function isChanged(){return parseFloat(vm.loanEstimate)!==parseFloat(vm.finalValue)&&vm.isDisclosureAvailable;}function getText(){return isChanged()?"Yes":"No";}function getTextClass(){return isChanged()?"col-a":"col-a values-changed";}}});})();angular.module("common").directive("impClosingCostRedirection",function($state,$timeout){return{restrict:"E",replace:true,scope:{},bindToController:true,link:function(scope,el,attrs,controller){var frm=el[0];$timeout(function(){frm.action=controller.postUrl;frm.submit();$state.go("loanCenter.loan.cost.details");});},controller:function($scope,$element,$stateParams,$state){this.apiKey=$stateParams.apiKey;this.token=$stateParams.token;this.smartGFEId=$stateParams.smartGFEId;this.postUrl=$stateParams.postUrl;this.customData=$stateParams.customData;},controllerAs:"vm",templateUrl:"angular/common/integrations/closingcost/closingcostredirection.html"};});(function(){angular.module("iMP.Filters").filter("formatCashToCloseTotalClosingCosts",formatCashToCloseTotalClosingCosts).filter("formatCashToClosePOC",formatCashToClosePOC).filter("formatCashToClosePayments",formatCashToClosePayments);function formatCashToCloseTotalClosingCosts($filter){return function(input){var value=parseFloat(input);if(value<0){value=Math.abs(value);}else{if(value>0){value=value*(-1);}}return $filter("impCurrency")(value,"");};}function formatCashToClosePOC($filter){return function(input){var value=parseFloat(input);var formattedValue=$filter("impCurrency")(value,"");if(value==0){return formattedValue;}return"("+formattedValue+")";};}function formatCashToClosePayments($filter){return function(input){var value=parseFloat(input);var formattedValue=$filter("impCurrency")(value,"");if(value==0){return formattedValue;}return"-"+formattedValue;};}})();(function(){angular.module("loanScenario",["CalculatorModule","common","ui.bootstrap"]);})();(function(){angular.module("loanScenario").factory("loanScenarioSvc",loanScenarioSvc);loanScenarioSvc.$inject=["$resource","apiRoot","commonCalculatorSvc"];function loanScenarioSvc($resource,apiRoot,commonCalculatorSvc){var pricingResultsApiPath=apiRoot+"PricingResults/";var loanScenario=$resource(pricingResultsApiPath+"GetPricingResults",{},{shopForRates:{method:"POST",url:pricingResultsApiPath+"GetPricingResults",params:{currentUserId:"currentUserId"}}});var loanScenarioService={loanScenario:loanScenario,ruleEngine:{runCashoutRules:runCashoutRules,runDownPaymentRules:runDownPaymentRules},currentLoanOnSubjectPropertyChange:currentLoanOnSubjectPropertyChange,isVaUsedInPastChange:isVaUsedInPastChange};function runCashoutRules(wrappedLoan){}function currentLoanOnSubjectPropertyChange(vaInformation){vaInformation.isVaUsedInPast=Boolean(vaInformation.isCurrentLoanVA);vaInformation.vaLoanPaidOff=false;}function isVaUsedInPastChange(vaInformation){if(!vaInformation.isVaUsedInPast){vaInformation.vaLoanPaidOff=false;}vaInformation.includeVAFee=!vaInformation.disabilityBenefits;}function runDownPaymentRules(wrappedLoan,downPaymentPercent,contextIdentifier){var purchasePrice=Number.isNaN(parseFloat(wrappedLoan.ref.getSubjectProperty().purchasePrice))?0:parseFloat(wrappedLoan.ref.getSubjectProperty().purchasePrice);var loanAmount=Number.isNaN(parseFloat(wrappedLoan.ref.loanAmount))?0:parseFloat(wrappedLoan.ref.loanAmount);var concurrent2ndMortgage=Number.isNaN(parseFloat(wrappedLoan.ref.subordinateFinancingDetails.loanAmount))?0:parseFloat(wrappedLoan.ref.subordinateFinancingDetails.loanAmount);var downPayment=Number.isNaN(parseFloat(wrappedLoan.ref.downPayment))?0:parseFloat(wrappedLoan.ref.downPayment);var downPaymentPercentage=Number.isNaN(parseFloat(downPaymentPercent))?0:parseFloat(downPaymentPercent);var result=commonCalculatorSvc.recalculateDownPayment(purchasePrice,loanAmount,downPayment,downPaymentPercentage,concurrent2ndMortgage,contextIdentifier);wrappedLoan.ref.getSubjectProperty().purchasePrice=result.purchasePrice;wrappedLoan.ref.loanAmount=result.loanAmount;wrappedLoan.ref.downPayment=result.downPayment;return result.downPaymentPercentage;}return loanScenarioService;}})();(function(){angular.module("loanScenario").provider("loanScenarioResolver",loanScenarioResolver);function loanScenarioResolver(){this.$get=function(){return resolver;};function resolver(loanService,wrappedLoan,applicationData,$stateParams){var service={payOff2ndMortgageList:null,isWholesale:false,minCompensation:0,maxCompensation:0,brokerCompensationAmount:0,brokerCompensationPercent:0,repricing:false,pricingFicoScore:0,firstMortgage:false,secondMortgage:false,forceDisableFirst:false,forceDisableSecond:false};service.repricing=$stateParams["repricing"]?true:false;service.pricingFicoScore=(function(primary){if(!primary.isSpouseOnTheLoan){return primary.getBorrower().ficoScore.decisionScore;}else{return Math.min(primary.getBorrower().ficoScore.decisionScore,primary.getCoBorrower().ficoScore.decisionScore);}})(wrappedLoan.ref.primary);if(service.repricing){var result=runCreditMappingRulesForRepricing(wrappedLoan);service.firstMortgage=result.firstMortgage;service.secondMortgage=result.secondMortgage;service.forceDisableFirst=result.forceDisableFirst;service.forceDisableSecond=result.forceDisableSecond;}if(service.repricing&&service.secondMortgage){service.payOff2ndMortgageList=applicationData.lookup.secondMortgageInsurancePayOffTypes;}else{service.payOff2ndMortgageList=transformList(wrappedLoan,applicationData);}var channelId=Boolean(wrappedLoan.ref.channelId)?wrappedLoan.ref.channelId:applicationData.currentUser.channelId;var divisionId=Boolean(wrappedLoan.ref.divisionId)?wrappedLoan.ref.divisionId:applicationData.currentUser.divisionId;var branchId=Boolean(wrappedLoan.ref.branchId)?wrappedLoan.ref.branchId:applicationData.currentUser.branchId;try{var channel=firstOrDefault(_.where(applicationData.companyProfile.channels,{channelId:channelId}),{isWholesale:false});service.isWholesale=Boolean(channel.isWholesale);if(service.isWholesale){var division=firstOrDefault(_.where(channel.divisions,{divisionId:divisionId}),null);if(Boolean(division)){var branch=firstOrDefault(_.where(division.branches,{branchId:branchId}),{minCompensation:0,maxCompensation:0,defaultBrokerCompensationAmount:0,defaultBrokerCompensationPercent:0});service.minCompensation=branch.minCompensation;service.maxCompensation=branch.maxCompensation;service.brokerCompensationAmount=branch.defaultBrokerCompensationAmount;service.brokerCompensationPercent=branch.defaultBrokerCompensationPercent;}else{service.minCompensation=0;service.maxCompensation=0;service.brokerCompensationAmount=0;service.brokerCompensationPercent=0;}}}catch(ex){}return service;}function firstOrDefault(coll,dflt){if(coll&&coll.length>0){return coll[0];}else{return dflt;}}function transformList(wrappedLoan,applicationData){var secondMortgageType=wrappedLoan.ref.otherInterviewData.existingSecondMortgage;var payOff2ndMortgageList=applicationData.lookup.secondMortgageInsurancePayOffTypes.slice();if(secondMortgageType=="0"||secondMortgageType=="1"){angular.forEach(payOff2ndMortgageList,function(val,key){if(val.value=="3"){payOff2ndMortgageList.splice(key,2);}});}else{if(secondMortgageType=="2"){payOff2ndMortgageList=applicationData.lookup.secondMortgageInsurancePayOffTypes.slice();angular.forEach(payOff2ndMortgageList,function(val,key){if(val.value=="2"){payOff2ndMortgageList.splice(key,1);}});}}if(wrappedLoan.ref.loanAmount==0){wrappedLoan.ref.otherInterviewData.secondMortgageRefinanceComment="1";}return payOff2ndMortgageList;}function runCreditMappingRulesForRepricing(wrappedLoan){if(wrappedLoan.ref.primary.credit.creditDataAvailable){wrappedLoan.ref.otherInterviewData.selectedDecisionScoreRange=-1;}var borrowerLiabilities=wrappedLoan.ref.primary.getBorrower().getLiabilities();var coBorrowerLiabilities=wrappedLoan.ref.primary.isSpouseOnTheLoan?wrappedLoan.ref.primary.getCoBorrower().getLiabilities():[];var liabilities=[].concat(borrowerLiabilities?borrowerLiabilities:[]).concat(coBorrowerLiabilities?coBorrowerLiabilities:[]);var firstMortgage=liabilities.filter(function(l){return l.property&&l.property.isSubjectProperty&&l.isPledged&&l.lienPosition==1;})[0];var secondMortgage=liabilities.filter(function(l){return l.property&&l.property.isSubjectProperty&&l.isPledged&&l.lienPosition==2;})[0];var disableFirst=false;var disableSecond=false;if(firstMortgage){if(firstMortgage.borrowerDebtCommentId==6||firstMortgage.borrowerDebtCommentId==8){firstMortgage=null;}else{if(firstMortgage.borrowerDebtCommentId==1||firstMortgage.borrowerDebtCommentId==5||firstMortgage.borrowerDebtCommentId==7){disableFirst=true;}wrappedLoan.ref.otherInterviewData.firstMortgage=firstMortgage.unpaidBalance;wrappedLoan.ref.otherInterviewData.firstPayment=firstMortgage.minPayment;}}if(secondMortgage){if(secondMortgage.borrowerDebtCommentId==6||secondMortgage.borrowerDebtCommentId==8){secondMortgage=null;}else{if(secondMortgage.borrowerDebtCommentId==1||secondMortgage.borrowerDebtCommentId==5||secondMortgage.borrowerDebtCommentId==7){disableSecond=true;secondMortgage=null;wrappedLoan.ref.otherInterviewData.existingSecondMortgage=0;}else{wrappedLoan.ref.otherInterviewData.existingSecondMortgage=secondMortgage.pledgedAssetLoanType;wrappedLoan.ref.otherInterviewData.outstandingBalance=secondMortgage.unpaidBalance;wrappedLoan.ref.otherInterviewData.secondPayment=secondMortgage.minPayment;if(secondMortgage.pledgedAssetLoanType==2){wrappedLoan.ref.otherInterviewData.maximumCreditLine=secondMortgage.maximumCreditLine;}if(secondMortgage.borrowerDebtCommentId==0){wrappedLoan.ref.otherInterviewData.secondMortgageRefinanceComment="1";}else{if(secondMortgage.borrowerDebtCommentId==2){wrappedLoan.ref.otherInterviewData.secondMortgageRefinanceComment="2";}else{if(secondMortgage.borrowerDebtCommentId==3){wrappedLoan.ref.otherInterviewData.secondMortgageRefinanceComment="3";}else{if(secondMortgage.borrowerDebtCommentId==4){wrappedLoan.ref.otherInterviewData.secondMortgageRefinanceComment="4";}else{wrappedLoan.ref.otherInterviewData.secondMortgageRefinanceComment="1";}}}}}}}var result={firstMortgage:Boolean(firstMortgage),secondMortgage:Boolean(secondMortgage),forceDisableFirst:disableFirst,forceDisableSecond:disableSecond};return result;}}})();(function(){angular.module("loanScenario").controller("loanScenarioController",loanScenarioController);loanScenarioController.$inject=["$log","$state","loanScenarioSvc","commonCalculatorSvc","wrappedLoan","loanEvent","NavigationSvc","enums","controllerData","applicationData","commonModalWindowFactory","modalWindowType","anchorSmoothScroll","$stateParams","propertySvc","commonService","costDetailsHelpers"];function loanScenarioController($log,$state,loanScenarioSvc,commonCalculatorSvc,wrappedLoan,loanEvent,NavigationSvc,enums,controllerData,applicationData,commonModalWindowFactory,modalWindowType,anchorSmoothScroll,$stateParams,propertySvc,commonService,costDetailsHelpers){var vm=this;vm.wrappedLoan=wrappedLoan;vm.applicationData=applicationData;if($stateParams.contextualBarTitle){NavigationSvc.contextualType=enums.ContextualTypes.ShopForRates;}else{NavigationSvc.contextualType=enums.ContextualTypes.LoanScenario;}vm.isLoanInformationSectionShown=true;vm.isSearchCriteriaSectionShown=true;vm.disableDecisionScoreDDL=false;vm.downPaymentPercent=null;vm.manualCashout=Boolean(controllerData.repricing);vm.dti=40;vm.licencedStates=vm.wrappedLoan.ref.getLicencedStates(vm.applicationData);vm.concurrent2ndMortgageEnable=false;vm.creditLineCapEnable=false;vm.repricing=controllerData.repricing;vm.payOff2ndMortgageList=controllerData.payOff2ndMortgageList;vm.isTPO=controllerData.isWholesale;vm.pricingFicoScore=getLowestMiddleFicoScore();vm.firstMortgage=controllerData.firstMortgage;vm.secondMortgage=controllerData.secondMortgage;vm.forceDisableFirst=controllerData.forceDisableFirst;vm.forceDisableSecond=controllerData.forceDisableSecond;vm.otherInterviewData=angular.copy(wrappedLoan.ref.otherInterviewData);vm.brokerCompensationMaxAmount=controllerData.maxCompensation;vm.brokerCompensationMinAmount=controllerData.minCompensation;vm.defaultBrokerCompPercent=controllerData.brokerCompensationPercent;vm.defaultBrokerCompAmount=controllerData.brokerCompensationAmount;vm.showBrokerCompensationError=false;vm.validateBrokerCompensation=function(){vm.showBrokerCompensationError=vm.brokerCompensationError();};vm.brokerCompensationTotalAmount=function(){if(isNaN(parseFloat(vm.wrappedLoan.ref.otherInterviewData.brokerCompPercent))){vm.wrappedLoan.ref.otherInterviewData.brokerCompPercent=0;}if(isNaN(parseFloat(vm.wrappedLoan.ref.otherInterviewData.brokerCompAmount))){vm.wrappedLoan.ref.otherInterviewData.brokerCompAmount=0;}return(vm.wrappedLoan.ref.otherInterviewData.brokerCompPercent/100)*(isNaN(parseFloat(vm.wrappedLoan.ref.loanAmount))?0:vm.wrappedLoan.ref.loanAmount)+parseFloat(vm.wrappedLoan.ref.otherInterviewData.brokerCompAmount);};vm.brokerCompensationError=function(){return(vm.brokerCompensationTotalAmount()>vm.brokerCompensationMaxAmount||vm.brokerCompensationTotalAmount()<vm.brokerCompensationMinAmount);};vm.onCompensationOptionChange=function(){if(vm.wrappedLoan.ref.otherInterviewData.selectedCompensationOption==1){vm.wrappedLoan.ref.otherInterviewData.brokerCompPercent=vm.defaultBrokerCompPercent;vm.wrappedLoan.ref.otherInterviewData.brokerCompAmount=vm.defaultBrokerCompAmount;}};vm.validateForm=false;vm.purchasePriceBlur=false;vm.currentEstimatedValueBlur=false;vm.loanAmountBlur=false;vm.cashOutBlur=false;vm.downPaymentBlur=false;vm.dtiBlur=false;vm.exactDecisionScoreBlur=false;vm.secondBalanceBlur=false;vm.creditLineCapBlur=false;vm.firstBalanceBlur=false;vm.negativeDti=false;vm.highlightNegativeDti=false;vm.calculateDti=calculateDti;vm.isDTINegative=isDTINegative;vm.openDTIAlert=openDTIAlert;vm.runCashoutRules=runCashoutRules;vm.collapseExpand=collapseExpand;vm.loanTypeSwitch=loanTypeSwitch;vm.onDownPaymentChange=onDownPaymentChange;vm.onDownPaymentPercentageChange=onDownPaymentPercentageChange;vm.onPurchasePriceChange=onPurchasePriceChange;vm.onLoanAmountChange=onLoanAmountChange;vm.onHomeBuyingTypeChange=onHomeBuyingTypeChange;vm.onFHAinformationChange=onFHAinformationChange;vm.onUSDAinformationChange=onUSDAinformationChange;vm.overrideDecisionScoreDDL=overrideDecisionScoreDDL;vm.onEstimatedValueChange=onEstimatedValueChange;vm.onSecondMortgageTypeChange=onSecondMortgageTypeChange;vm.onSecondBalanceChange=onSecondBalanceChange;vm.onCreditLineCapChange=onCreditLineCapChange;vm.onSecondMortgagePayoffTypeChange=onSecondMortgagePayoffTypeChange;vm.BindPayOff2ndMortgageDropDown=BindPayOff2ndMortgageDropDown;vm.onCurrentLoanOnSubjectPropertyChange=onCurrentLoanOnSubjectPropertyChange;vm.onIsVaUsedInPastChange=onIsVaUsedInPastChange;vm.onVAinformationChange=onVAinformationChange;vm.onCashOutChange=onCashOutChange;vm.onCashoutOptionChange=onCashoutOptionChange;vm.onReceivingVADisabilityBenefitsChange=onReceivingVADisabilityBenefitsChange;vm.searchCriteriaSelectDeselectAll=searchCriteriaSelectDeselectAll;vm.checkForSelectedSearchCriteria=checkForSelectedSearchCriteria;vm.onFirstBalanceBlur=onFirstBalanceBlur;vm.calculateETPCosts=calculateETPCosts;vm.onConcurrent2ndMortgageChange=onConcurrent2ndMortgageChange;vm.onDTIBlur=onDTIBlur;vm.shopForRates=shopForRates;vm.cancel=cancel;vm.saveLoan=saveLoan;vm.enableSave=enableSave;vm.anchorSmoothScroll=anchorSmoothScroll;vm.scrollToElement=scrollToElement;vm.validateLoanScenario=validateLoanScenario;vm.onOccupancyTypeChanged=onOccupancyTypeChanged;calculateETPCosts();initalizeFHAsection();initalizeVAsection();initalizeUSDAsection();refreshConcurrent2ndMortgageSection();function onOccupancyTypeChanged(){vm.wrappedLoan.ref.getSubjectProperty().getNetRentalIncome();loanEvent.broadcastPropertyChangedEvent(events.LoanFieldIdentifier.PropertyOccupancyTypeChanged,vm.wrappedLoan.ref.getSubjectProperty());}(function(){if(!vm.wrappedLoan.ref.otherInterviewData.brokerCompAmount&&!vm.wrappedLoan.ref.otherInterviewData.brokerCompPercent){vm.wrappedLoan.ref.otherInterviewData.brokerCompPercent=vm.defaultBrokerCompPercent;vm.wrappedLoan.ref.otherInterviewData.brokerCompAmount=vm.defaultBrokerCompAmount;}if(wrappedLoan.ref.loanAmount!=0){onLoanAmountChange();if(wrappedLoan.ref.financialInfo.qualifyingDtiDu&&wrappedLoan.ref.loanId){vm.dti=wrappedLoan.ref.financialInfo.qualifyingDtiDu;}else{vm.dti=wrappedLoan.ref.financialInfo.dti;}vm.negativeDti=vm.isDTINegative(vm.dti);}})();function cancel(){if(vm.repricing){wrappedLoan.ref.otherInterviewData=vm.otherInterviewData;$state.go("loanCenter.loan.loanDetails.sections");}}function saveLoan($event){if(vm.enableSave()){wrappedLoan.ref.financialInfo.dti=vm.dti;NavigationSvc.SaveAndUpdateWrappedLoan(applicationData.currentUserId,wrappedLoan,function(wrappedLoan){vm.onLoanAmountChange();vm.loanAmountBlur=false;wrappedLoan.ref.financialInfo.cashOut=(!wrappedLoan.ref.financialInfo.cashOutAmount||wrappedLoan.ref.financialInfo.cashOutAmount=="0")?"0":"1";});}else{$event.stopPropagation();}}function scrollToElement(selector){var fieldToScroll=document.querySelector(selector);if(fieldToScroll&&vm.anchorSmoothScroll){vm.anchorSmoothScroll(selector,200);}}function enableSave(){if((vm.wrappedLoan.canSave()&&vm.wrappedLoan.ref.active.getBorrower().firstName&&vm.wrappedLoan.ref.active.getBorrower().lastName)||vm.wrappedLoan.ref.active.getBorrower().userAccount.username){return true;}return false;}function validateLoanScenario(){vm.validateForm=false;if((wrappedLoan.ref.otherInterviewData.selectedDecisionScoreRange==-1&&!wrappedLoan.ref.financialInfo.ficoScore)||!wrappedLoan.ref.getSubjectProperty().zipCode||!wrappedLoan.ref.loanAmount||wrappedLoan.ref.loanAmount=="0"){vm.validateForm=true;}else{if(wrappedLoan.ref.loanPurposeType==2){if((!wrappedLoan.ref.getSubjectProperty().currentEstimatedValue||wrappedLoan.ref.getSubjectProperty().currentEstimatedValue=="0")||(wrappedLoan.ref.financialInfo.cashOut=="1"&&(!wrappedLoan.ref.financialInfo.cashOutAmount||wrappedLoan.ref.financialInfo.cashOutAmount=="0"))||(wrappedLoan.ref.otherInterviewData.existingSecondMortgage!="0"&&!wrappedLoan.ref.otherInterviewData.outstandingBalance)||(wrappedLoan.ref.otherInterviewData.existingSecondMortgage=="2"&&!wrappedLoan.ref.otherInterviewData.maximumCreditLine)||(!wrappedLoan.ref.otherInterviewData.firstMortgage&&wrappedLoan.ref.otherInterviewData.firstMortgage!=0)){vm.validateForm=true;}}else{if(vm.wrappedLoan.ref.loanPurposeType==1){if((!vm.wrappedLoan.ref.getSubjectProperty().purchasePrice||vm.wrappedLoan.ref.getSubjectProperty().purchasePrice=="0")||(vm.wrappedLoan.ref.otherInterviewData.selectedDTIOption=="1"&&(vm.dti=="0%"||vm.dti=="0"||!vm.dti))){vm.validateForm=true;}}else{if(vm.isTPO){if(wrappedLoan.ref.otherInterviewData.selectedBuyoutOption==0&&wrappedLoan.ref.otherInterviewData.selectedCompensationOption==0){vm.validateBrokerCompensation();if(vm.brokerCompensationError()){vm.validateForm=true;}}}}}}if(!vm.validateForm){if(wrappedLoan.ref.vaInformation.isvaLoan){if(!wrappedLoan.ref.vaInformation.militaryService||wrappedLoan.ref.vaInformation.militaryService=="0"||!wrappedLoan.ref.vaInformation.militaryBranch||wrappedLoan.ref.vaInformation.militaryBranch=="0"||!wrappedLoan.ref.vaInformation.serviceStatus||wrappedLoan.ref.vaInformation.serviceStatus=="0"){vm.validateForm=true;}}if(vm.creditLineCapEnable&&(!wrappedLoan.ref.subordinateFinancingDetails.creditLineCap||wrappedLoan.ref.subordinateFinancingDetails.creditLineCap==0)){vm.validateForm=true;}}return vm.validateForm;}function shopForRates(){if(vm.negativeDti){openDTIAlert();vm.highlightNegativeDti=true;return;}if(vm.validateLoanScenario&&vm.validateLoanScenario()){if(vm.wrappedLoan.ref.loanPurposeType==1){vm.scrollToElement&&vm.scrollToElement(".imp-psection-purchasePrice");}else{if(!vm.wrappedLoan.ref.otherInterviewData.firstMortgage&&vm.wrappedLoan.ref.otherInterviewData.firstMortgage!=0){vm.scrollToElement&&vm.scrollToElement(".imp-psection-firstMortgage");}}return;}if(wrappedLoan.ref.getSubjectProperty().purchaseDate&&angular.isDate(wrappedLoan.ref.getSubjectProperty().purchaseDate)){wrappedLoan.ref.getSubjectProperty().purchaseDate=moment(wrappedLoan.ref.getSubjectProperty().purchaseDate).format("MM/YYYY");}if(wrappedLoan.ref.getSubjectProperty().stateName==""){try{wrappedLoan.ref.getSubjectProperty().stateName=applicationData.lookup.states.filter(function(e){return e.value==wrappedLoan.ref.getSubjectProperty().stateId.toString();})[0].text;}catch(e){return;}}wrappedLoan.ref.getSubjectProperty().occupancyType=wrappedLoan.ref.primary.occupancyType;if(wrappedLoan.ref.active.getBorrower()){wrappedLoan.ref.active.getBorrower().userAccount.currentUserAccountId=applicationData.currentUserId;}wrappedLoan.ref.financialInfo.dti=vm.dti;wrappedLoan.ref.otherInterviewData.enableTPO=vm.isTPO;onFHAinformationChange(wrappedLoan.ref.otherInterviewData.fhaInformation.isfhaLoan);onUSDAinformationChange(wrappedLoan.ref.otherInterviewData.usdaInformation.isusdaLoan);commonModalWindowFactory.open({type:modalWindowType.loader,message:"Calculating Rates, Price and Fees..."});wrappedLoan.ref.prepareSave();loanScenarioSvc.loanScenario.shopForRates({currentUserId:applicationData.currentUserId,sixPieces:wrappedLoan.ref.areSixPiecesAcquiredForAllLoanApplications()||(wrappedLoan.ref.closingCost&&wrappedLoan.ref.closingCost.smartGFEId?true:false)},wrappedLoan.ref).$promise.then(function(data){wrappedLoan.ref.pricingResults=data.pricingResults;wrappedLoan.ref.closingCost=data.closingCost;costDetailsHelpers.getCostDetailsData();for(var i=0;i<vm.wrappedLoan.ref.getLoanApplications().length;i++){if(vm.wrappedLoan.ref.active.loanId==vm.wrappedLoan.ref.getLoanApplications()[i]){vm.wrappedLoan.ref.active.getBorrower().userAccount=new cls.UserAccountViewModel(data.transactionInfo.borrowers[0].userAccount);vm.wrappedLoan.ref.active.getCoBorrower().userAccount=new cls.UserAccountViewModel(data.transactionInfo.borrowers[1].userAccount);}else{vm.wrappedLoan.ref.getLoanApplications()[i].getBorrower().userAccount=new cls.UserAccountViewModel(data.transactionInfo.borrowers[2*i].userAccount);vm.wrappedLoan.ref.getLoanApplications()[i].getCoBorrower().userAccount=new cls.UserAccountViewModel(data.transactionInfo.borrowers[2*i+1].userAccount);}}commonModalWindowFactory.close("close");var anyCosts=false;if(data.pricingResults.productListViewModel.eligibleProducts[0]){var firstProductNumberOfCosts=data.pricingResults.productListViewModel.eligibleProducts[0].costDetails.lenderCost.length+data.pricingResults.productListViewModel.eligibleProducts[0].costDetails.prepaidCosts.length+data.pricingResults.productListViewModel.eligibleProducts[0].costDetails.reservesCosts.length+data.pricingResults.productListViewModel.eligibleProducts[0].costDetails.thirdPartyCosts.length;anyCosts=firstProductNumberOfCosts!==0;}if(data.pricingResults.productListViewModel.eligibleProducts[0]&&!anyCosts){commonModalWindowFactory.open({type:modalWindowType.error,message:"We are unable to calculate your closing costs because we were unable to obtain current fees."});}$state.go("loanCenter.loan.pricing",{"repricing":vm.repricing},{reload:false});},function(){commonModalWindowFactory.close("close");});}function onCreditLineCapChange(){loanEvent.broadcastPropertyChangedEvent(events.LoanFieldIdentifier.LoanAmount,wrappedLoan.ref.loanAmount);if(!vm.manualCashout){runCashoutRules();}vm.creditLineCapBlur=true;}function onSecondBalanceChange(){loanEvent.broadcastPropertyChangedEvent(events.LoanFieldIdentifier.LoanAmount,wrappedLoan.ref.loanAmount);if(!vm.manualCashout){runCashoutRules();}vm.secondBalanceBlur=true;}function onSecondMortgagePayoffTypeChange(){loanEvent.broadcastPropertyChangedEvent(events.LoanFieldIdentifier.LoanAmount,wrappedLoan.ref.loanAmount);if(!vm.manualCashout){runCashoutRules();}configureConcurrent2ndMortgageSection();}function onCurrentLoanOnSubjectPropertyChange(){loanScenarioSvc.currentLoanOnSubjectPropertyChange(wrappedLoan.ref.vaInformation);}function onIsVaUsedInPastChange(){loanScenarioSvc.isVaUsedInPastChange(wrappedLoan.ref.vaInformation);}function onVAinformationChange(){if(!wrappedLoan.ref.vaInformation.isvaLoan){wrappedLoan.ref.vaInformation.isCurrentLoanVA=false;wrappedLoan.ref.vaInformation.isVaUsedInPast=false;wrappedLoan.ref.vaInformation.vaLoanPaidOff=false;wrappedLoan.ref.vaInformation.disabilityBenefits=false;}else{wrappedLoan.ref.vaInformation.includeVAFee=true;}}function onReceivingVADisabilityBenefitsChange(){wrappedLoan.ref.vaInformation.includeVAFee=!wrappedLoan.ref.vaInformation.disabilityBenefits;}function collapseExpand(sectionName){switch(sectionName){case"LoanInformationSection":vm.isLoanInformationSectionShown=!vm.isLoanInformationSectionShown;break;case"SearchCriteriaSection":vm.isSearchCriteriaSectionShown=!vm.isSearchCriteriaSectionShown;break;}}function loanTypeSwitch(loantype){switch(loantype){case"Purchase":wrappedLoan.ref.loanPurposeType=1;wrappedLoan.ref.homeBuyingType=srv.HomeBuyingType.GetPreApproved;vm.wrappedLoan.ref.getSubjectProperty().streetName="TBD";break;case"Refinance":if(wrappedLoan.ref.homeBuyingType==srv.HomeBuyingType.GetPreApproved){vm.wrappedLoan.ref.getSubjectProperty().streetName=null;}wrappedLoan.ref.loanPurposeType=2;vm.wrappedLoan.ref.getSubjectProperty().streetName="";break;}refreshConcurrent2ndMortgageSection();}function onPurchasePriceChange(){if(wrappedLoan.ref.loanPurposeType==1){vm.downPaymentPercent=loanScenarioSvc.ruleEngine.runDownPaymentRules(wrappedLoan,vm.downPaymentPercent,"PurchasePrice");}else{if(wrappedLoan.ref.loanPurposeType==2){if(!vm.manualCashout){runCashoutRules();}}}loanEvent.broadcastPropertyChangedEvent(events.LoanFieldIdentifier.PurchasePrice,wrappedLoan.ref.getSubjectProperty().purchasePrice);vm.purchasePriceBlur=true;}function onLoanAmountChange(){if(wrappedLoan.ref.loanPurposeType==1){vm.downPaymentPercent=loanScenarioSvc.ruleEngine.runDownPaymentRules(wrappedLoan,vm.downPaymentPercent,"LoanAmount");calculateETPCosts();}else{if(wrappedLoan.ref.loanPurposeType==2){if(!vm.manualCashout){runCashoutRules();}calculateETPCosts();}}loanEvent.broadcastPropertyChangedEvent(events.LoanFieldIdentifier.LoanAmount,wrappedLoan.ref.loanAmount);vm.loanAmountBlur=true;}function onDownPaymentChange(){vm.downPaymentPercent=loanScenarioSvc.ruleEngine.runDownPaymentRules(wrappedLoan,vm.downPaymentPercent,"DownPayment");loanEvent.broadcastPropertyChangedEvent(events.LoanFieldIdentifier.LoanAmount,wrappedLoan.ref.loanAmount);}function onDownPaymentPercentageChange(){vm.downPaymentPercent=loanScenarioSvc.ruleEngine.runDownPaymentRules(wrappedLoan,vm.downPaymentPercent,"DownPaymentPercentage");loanEvent.broadcastPropertyChangedEvent(events.LoanFieldIdentifier.LoanAmount,wrappedLoan.ref.loanAmount);}function onDTIBlur(dti){vm.negativeDti=vm.isDTINegative(dti);vm.dtiBlur=true;}function onEstimatedValueChange(){loanEvent.broadcastPropertyChangedEvent(events.LoanFieldIdentifier.EstimatedValue,wrappedLoan.ref.getSubjectProperty().currentEstimatedValue);vm.currentEstimatedValueBlur=true;}function onCashoutOptionChange(){vm.manualCashout=true;if(!vm.manualCashout){if(wrappedLoan.ref.financialInfo.cashOut=="0"){wrappedLoan.ref.financialInfo.cashOutAmount=0;}runCashoutChange();}}function onCashOutChange(){vm.manualCashout=true;wrappedLoan.ref.financialInfo.cashOut=wrappedLoan.ref.financialInfo.cashOutAmount>0?"1":"0";vm.cashOutBlur=true;if(!vm.manualCashout){runCashoutChange();}}function onSecondMortgageTypeChange(secondMortgageType){BindPayOff2ndMortgageDropDown(secondMortgageType);loanEvent.broadcastPropertyChangedEvent(events.LoanFieldIdentifier.LoanAmount,wrappedLoan.ref.loanAmount);if(!vm.manualCashout){runCashoutRules();}configureConcurrent2ndMortgageSection();}function onHomeBuyingTypeChange(item){vm.wrappedLoan.ref.getSubjectProperty().streetName=(item=="3"?"TBD":"");}function onFirstBalanceBlur(){vm.firstBalanceBlur=true;if(!vm.manualCashout){vm.runCashoutRules();}}function onFHAinformationChange(fhaValue){angular.forEach(vm.wrappedLoan.ref.otherInterviewData.searchCriteria.loanTypeList,function(item){if(item.name=="FHA"){item.value=fhaValue;}});}function onUSDAinformationChange(usdaValue){angular.forEach(vm.wrappedLoan.ref.otherInterviewData.searchCriteria.loanTypeList,function(item){if(item.name=="USDA"){item.value=usdaValue;}});}function deSelectAll(list,value,isARMFixedTerms){if(list==null||list.length==0){return;}angular.forEach(list,function(item){if(item.name!="FHA"){item.value=value;}});if(value==false&&!isARMFixedTerms){list[0].value=!value;}}function searchCriteriaSelectDeselectAll(value){deSelectAll(wrappedLoan.ref.otherInterviewData.searchCriteria.loanTypeList,value);deSelectAll(wrappedLoan.ref.otherInterviewData.searchCriteria.amortizationTypeList,value);deSelectAll(wrappedLoan.ref.otherInterviewData.searchCriteria.loanTermsList,value);deSelectAll(wrappedLoan.ref.otherInterviewData.searchCriteria.armTermsList,value,true);}function calculateDti(){if(wrappedLoan.ref.otherInterviewData.selectedDTIOption=="1"){return;}var coBorrowerIncomeAmount=0;if(vm.isSpouseOnTheLoanSelected===true){coBorrowerIncomeAmount=wrappedLoan.ref.otherInterviewData.coBorrowerIncome;}var DTI=commonCalculatorSvc.calculateDti(wrappedLoan.ref.otherInterviewData.monthlyDebt,wrappedLoan.ref.otherInterviewData.borrowerIncome,wrappedLoan.ref.otherInterviewData.selectedBorrowerIncomeType,coBorrowerIncomeAmount,wrappedLoan.ref.otherInterviewData.selectedCoBorrowerIncomeType);wrappedLoan.ref.financialInfo.dti=DTI.dti;vm.dti=DTI.dti;vm.negativeDti=vm.isDTINegative(vm.dti);}function BindPayOff2ndMortgageDropDown(secondMortgageType){vm.payOff2ndMortgageList=applicationData.lookup.secondMortgageInsurancePayOffTypes.slice();if(secondMortgageType=="0"||secondMortgageType=="1"){angular.forEach(vm.payOff2ndMortgageList,function(val,key){if(val.value=="3"){vm.payOff2ndMortgageList.splice(key,2);}});}else{if(secondMortgageType=="2"){vm.payOff2ndMortgageList=applicationData.lookup.secondMortgageInsurancePayOffTypes.slice();angular.forEach(vm.payOff2ndMortgageList,function(val,key){if(val.value=="2"){vm.payOff2ndMortgageList.splice(key,1);}});}}wrappedLoan.ref.otherInterviewData.secondMortgageRefinanceComment="1";}function runCashoutRules(){wrappedLoan.ref.fhaCountyLoanLimit=commonService.getFHAOrVALoanLimit(applicationData.fhaLoanLimits,wrappedLoan.ref.getSubjectProperty().stateName,wrappedLoan.ref.getSubjectProperty().countyName,wrappedLoan.ref.getSubjectProperty().numberOfUnits);}function runCashoutChange(){}function overrideDecisionScoreDDL(item){if(item>0){wrappedLoan.ref.otherInterviewData.selectedDecisionScoreRange=-1;vm.disableDecisionScoreDDL=true;}else{vm.disableDecisionScoreDDL=false;vm.exactDecisionScoreBlur=true;}}function checkForSelectedSearchCriteria(event,item,list,isARMFixedTerms){if(!item.value&&!isARMFixedTerms){var isAnyItemSelected=_.find(list,function(itemInList){return itemInList.value;});if(!isAnyItemSelected){event.preventDefault();}else{if(item.name=="ARM"){deSelectAll(vm.wrappedLoan.ref.otherInterviewData.searchCriteria.armTermsList,item.value,true);}}}else{if(item.name.indexOf("HARP")>-1){disableHARP(item.name);}}}function disableHARP(clickedItem){for(var item in vm.wrappedLoan.ref.otherInterviewData.searchCriteria.loanTypeList){if(vm.wrappedLoan.ref.otherInterviewData.searchCriteria.loanTypeList[item].name!=clickedItem&&vm.wrappedLoan.ref.otherInterviewData.searchCriteria.loanTypeList[item].name.indexOf("HARP")>-1){vm.wrappedLoan.ref.otherInterviewData.searchCriteria.loanTypeList[item].value=false;}}}function calculateETPCosts(){var ddlOption=vm.wrappedLoan.ref.otherInterviewData.selectedETPCOption;var loanAmount=parseFloat(vm.wrappedLoan.ref.loanAmount);var etpcPercent=vm.wrappedLoan.ref.otherInterviewData.percentETPCValue;var etpcValue=(etpcPercent/100)*loanAmount;switch(ddlOption){case"0":vm.wrappedLoan.ref.otherInterviewData.disclaimerETPCValue=etpcValue;break;case"1":break;case"2":break;}}function getLowestMiddleFicoScore(){var midFicoScore=commonCalculatorSvc.GetLowestMiddleFicoScore(vm.wrappedLoan,vm.applicationData);return midFicoScore;}function initalizeFHAsection(){wrappedLoan.ref.otherInterviewData.fhaInformation.isFinanceUfmip=setFlagIncludeInLoanAmount(902,wrappedLoan.ref.otherInterviewData.fhaInformation.isFinanceUfmip);}function initalizeVAsection(){wrappedLoan.ref.vaInformation.includeVAFee=setFlagIncludeInLoanAmount(905,wrappedLoan.ref.vaInformation.includeVAFee);}function initalizeUSDAsection(){wrappedLoan.ref.otherInterviewData.usdaInformation.addUSDAGFeeToLoanAmount=setFlagIncludeInLoanAmount(819,wrappedLoan.ref.otherInterviewData.usdaInformation.addUSDAGFeeToLoanAmount);}function setFlagIncludeInLoanAmount(hudLineNumber,flag){var cost=getCost(hudLineNumber);if(cost&&cost.financedAmount>0){flag=true;}else{if(cost&&cost.financedAmount==0){flag=false;}}return flag;}function getCost(hudLineNumber){var cost=null;if(wrappedLoan.ref&&wrappedLoan.ref.closingCost&&wrappedLoan.ref.closingCost.costs){lib.forEach(wrappedLoan.ref.closingCost.costs,function(costItem){if((!costItem.originalHUDLineNumber||costItem.originalHUDLineNumber==0)&&costItem.hudLineNumber==hudLineNumber){cost=costItem;}});}return cost;}function onConcurrent2ndMortgageChange(option){switch(parseInt(option)){case srv.Concurrent2ndMortgageEnum.No:vm.concurrent2ndMortgageEnable=false;vm.creditLineCapEnable=false;vm.wrappedLoan.ref.subordinateFinancingDetails.loanAmount=null;vm.wrappedLoan.ref.subordinateFinancingDetails.creditLineCap=null;break;case srv.Concurrent2ndMortgageEnum.Fixed:vm.concurrent2ndMortgageEnable=true;vm.creditLineCapEnable=false;vm.wrappedLoan.ref.subordinateFinancingDetails.creditLineCap=null;break;case srv.Concurrent2ndMortgageEnum.HELOC:vm.concurrent2ndMortgageEnable=true;vm.creditLineCapEnable=true;break;}}function configureConcurrent2ndMortgageSection(){switch(vm.wrappedLoan.ref.loanPurposeType){case enums.LoanTransactionTypes.Refinance:vm.wrappedLoan.ref.subordinateFinancingDetails.secondMortgageType=srv.Concurrent2ndMortgageEnum.No;refreshConcurrent2ndMortgageSection();break;case enums.LoanTransactionTypes.Purchase:refreshConcurrent2ndMortgageSection();break;}}function refreshConcurrent2ndMortgageSection(){onConcurrent2ndMortgageChange(vm.wrappedLoan.ref.subordinateFinancingDetails.secondMortgageType);}function isDTINegative(dti){return dti<0?true:false;}function openDTIAlert(){commonModalWindowFactory.open({type:modalWindowType.success,message:"This loan cannot be priced with a negative DTI.",messageDetails:"Please correct your search criteria and try again.",messageClass:"loan-scenario-negative-dti-modal"});}}})();(function(){angular.module("aus",[]);})();(function(){angular.module("aus").service("ausSvc",ausSvc);ausSvc.$inject=["apiRoot","$resource"];function ausSvc(apiRoot,$resource){var ausApiPath=apiRoot+"Aus/";var services=$resource(ausApiPath+":path",{path:"@path"},{get:{method:"GET",params:{loanId:"loanId"}},post:{method:"POST",params:{caseId:"caseId",identifier:"identifier",ausType:"ausType",userAccountId:"userAccountId"}},});var ausService={services:services};return ausService;}})();(function(){angular.module("aus").provider("ausResolver",ausResolver);function ausResolver(){this.$get=function(){return resolver;};function resolver($stateParams,$state,ausSvc,wrappedLoan,enums){var ausObject=ausSvc.services.get({loanId:wrappedLoan.ref.loanId}).$promise.then(function(aus){wrappedLoan.ref.aus=aus;if($stateParams.tab!=undefined&&$stateParams.tab!=null){aus.selectedTab=$stateParams.tab;}aus.duEnabled=_.some(wrappedLoan.ref.product.loanAusTypes,function(ausType){return ausType==enums.AusType.DU.toString();});aus.lpEnabled=_.some(wrappedLoan.ref.product.loanAusTypes,function(ausType){return ausType==enums.AusType.LP.toString();});return aus;});return ausObject;}}})();(function(){angular.module("aus").controller("ausController",ausController);ausController.$inject=["$log","$state","wrappedLoan","applicationData","enums","NavigationSvc"];function ausController($log,$state,wrappedLoan,applicationData,enums,NavigationSvc){var vm=this;vm.wrappedLoan=wrappedLoan;vm.applicationData=applicationData;vm.init=init;vm.supportsAusType=supportsAusType;vm.selectTab=selectTab;NavigationSvc.contextualType=enums.ContextualTypes.Aus;vm.ausTypes=[];for(var i=0;i<wrappedLoan.ref.product.loanAusTypes.length;i++){_.each(enums.AusType,function(val,key){if(val==wrappedLoan.ref.product.loanAusTypes[i]){vm.ausTypes.push(key);}});}if(wrappedLoan.ref.loanExternalReferences.length){vm.defaultAus=_.find(wrappedLoan.ref.loanExternalReferences,function(obj){return obj.name=="DEFAULT_AUS";});}if(!vm.defaultAus){if(supportsAusType("DU")){vm.defaultAus={value:"DU"};}else{if(supportsAusType("LP")){vm.defaultAus={value:"LP"};}}}vm.ausTabs={du:{isSelected:false,isDisabled:!supportsAusType("DU")},lp:{isSelected:false,isDisabled:!supportsAusType("LP")},gus:{isSelected:false,isDisabled:true},manual:{isSelected:false,isDisabled:true}};init();function init(){if(wrappedLoan.ref.aus.selectedTab==undefined){if(vm.defaultAus==undefined){wrappedLoan.ref.aus.selectedTab="du";}else{wrappedLoan.ref.aus.selectedTab=vm.defaultAus.value;}}selectTab(wrappedLoan.ref.aus.selectedTab);}function supportsAusType(ausType){if(vm.ausTypes.indexOf(ausType)!=-1){return true;}return false;}function selectTab(defaultTab){switch(defaultTab.toLowerCase()){case"du":vm.ausTabs.du.isSelected=true;$state.go("loanCenter.loan.aus.du");break;case"lp":vm.ausTabs.lp.isSelected=true;$state.go("loanCenter.loan.aus.lp");break;}}}})();(function(){angular.module("aus").provider("duResolver",duResolver);function duResolver(){this.$get=function(){return resolver;};function resolver(ausObj){var duObj={results:{},caseIds:[],selectedCaseId:null,enabled:ausObj.duEnabled};sortAndGroupServiceTrackings(ausObj,duObj);return duObj;}function sortAndGroupServiceTrackings(ausObj,duObj){var mainGroups=[];var groupedResults=_.groupBy(_.where(ausObj.serviceTrackings,{item:"DU Findings"}),"caseId");for(var caseId in groupedResults){duObj.results[caseId]=sortBy(groupedResults[caseId],["date"],false);mainGroups.push(duObj.results[caseId][0]);}sortBy(mainGroups,["date"],false);for(var group=0;group<mainGroups.length;group++){duObj.caseIds.push(mainGroups[group].caseId);}duObj.selectedCaseId=duObj.caseIds[0];}function sortBy(sequence,keys,ascOrder){sequence.sort(function(x,y){var comparison=0;for(var i=0;i<keys.length;++i){comparison=compareBy(x,y,keys[i],ascOrder);if(comparison!==0){return comparison;}}return comparison;});return sequence;}function compareBy(x,y,key,ascOrder){if(x[key]==y[key]){return 0;}if(ascOrder){return x[key]>y[key]?1:-1;}return x[key]<y[key]?1:-1;}}})();(function(){angular.module("aus").controller("duController",duController);duController.$inject=["$log","$scope","$state","$controller","ausSvc","wrappedLoan","du","enums","applicationData","NavigationSvc","$filter","simpleModalWindowFactory","blockUI","commonintegrationsSvc","$interval","commonModalWindowFactory","modalWindowType"];function duController($log,$scope,$state,$controller,ausSvc,wrappedLoan,du,enums,applicationData,NavigationSvc,$filter,simpleModalWindowFactory,blockUI,commonintegrationsSvc,$interval,commonModalWindowFactory,modalWindowType){var vm=this;vm.wrappedLoan=wrappedLoan;vm.du=du;vm.applicationData=applicationData;angular.extend(this,$controller("DocumentCtrl",{$scope:vm}));vm.validate=validate;vm.cancel=cancel;vm.caseIdChange=caseIdChange;vm.submit=submit;vm.refresh=refresh;vm.statusColor=statusColor;vm.armIdentifier=-1;vm.guidEmpty="00000000-0000-0000-0000-000000000000";vm.du.selectedArmIdentifier=wrappedLoan.ref.product.armIdentifier;function caseIdChange(){if(vm.du.selectedCaseId==null){vm.caseIdManualEntry=true;}}function validate(){}function showErrorMessage(message){commonModalWindowFactory.open({type:modalWindowType.error,message:message});}function submit(){vm.showErrorContainer=false;vm.processing=true;var selectedCaseId="";if(vm.du.selectedCaseId){selectedCaseId=vm.du.selectedCaseId;}var selectedArmIdentifier="";if(vm.du.selectedArmIdentifier){selectedArmIdentifier=vm.du.selectedArmIdentifier;}commonModalWindowFactory.open({type:modalWindowType.loader,message:"Submitting to DU"});NavigationSvc.SaveAndUpdateWrappedLoan(applicationData.currentUserId,wrappedLoan,function(wrappedLoan){ausSvc.services.post({caseId:selectedCaseId,identifier:selectedArmIdentifier,ausType:enums.AusType.DU,userAccountId:$scope.userAccountId},wrappedLoan.ref).$promise.then(function(result){if(result.loanServiceId){var timer=$interval(function(){commonintegrationsSvc.services.getLoanServiceStatus({loanServiceId:result.loanServiceId}).$promise.then(function(result){refresh();commonModalWindowFactory.close("close");var status=result.status;if(status=="400 - Error"||status=="140 - Order Not Accepted By Provider"||status=="270 - Service Completed"){$interval.cancel(timer);}},function(error){$interval.cancel(timer);commonModalWindowFactory.close("close");showErrorMessage("Error while submitting to DU!");$log.error("Failure while getting loan service status",error);});},10000);}},function(error){commonModalWindowFactory.close("close");$log.error("Failure submitting Fannie Mae DU data",error);showErrorMessage("Error while submitting to DU!");vm.processing=false;});},function(error){commonModalWindowFactory.close("close");showErrorMessage("Error while submitting to DU!");$log.error(error);vm.processing=false;},null,false);}function cancel(){vm.caseIdManualEntry=false;vm.du.selectedCaseId=vm.du.caseIds[0];}function isProcessing(){vm.processing=false;vm.processing=_.some(vm.du.results,function(tracking){return tracking.status=="Pending";});}function refresh(){if($state.current.name=="loanCenter.loan.aus.du"&&!NavigationSvc.stateChangeStarted.value){blockUI.stop();$state.go("loanCenter.loan.refresh",{page:"loanCenter.loan.aus",tab:"du"});}}function statusColor(status){switch(status){case"Pending":return"";case"Approve/Eligible":case"Accept/Eligible":case"Accept/A-Offering":return"#1FB25A";default:return"#FD3701";}}}})();(function(){angular.module("aus").provider("lpResolver",lpResolver);function lpResolver(){this.$get=function(){return resolver;};function resolver(ausObj){var lpObj={results:{},caseIds:[],selectedCaseId:null,enabled:ausObj.lpEnabled};sortAndGroupServiceTrackings(ausObj,lpObj);return lpObj;}function sortAndGroupServiceTrackings(ausObj,lpObj){var mainGroups=[];var groupedResults=_.groupBy(_.where(ausObj.serviceTrackings,{item:"LP Findings"}),"caseId");for(var caseId in groupedResults){lpObj.results[caseId]=sortBy(groupedResults[caseId],["date"],false);mainGroups.push(lpObj.results[caseId][0]);}sortBy(mainGroups,["date"],false);for(var group=0;group<mainGroups.length;group++){lpObj.caseIds.push(mainGroups[group].caseId);}lpObj.selectedCaseId=lpObj.caseIds[0];}function sortBy(sequence,keys,ascOrder){sequence.sort(function(x,y){var comparison=0;for(var i=0;i<keys.length;++i){comparison=compareBy(x,y,keys[i],ascOrder);if(comparison!==0){return comparison;}}return comparison;});return sequence;}function compareBy(x,y,key,ascOrder){if(x[key]==y[key]){return 0;}if(ascOrder){return x[key]>y[key]?1:-1;}return x[key]<y[key]?1:-1;}}})();(function(){angular.module("aus").controller("lpController",lpController);lpController.$inject=["$log","$scope","$state","$controller","ausSvc","wrappedLoan","lp","enums","applicationData","NavigationSvc","$filter","simpleModalWindowFactory","blockUI","commonintegrationsSvc","$interval","commonModalWindowFactory","modalWindowType"];function lpController($log,$scope,$state,$controller,ausSvc,wrappedLoan,lp,enums,applicationData,NavigationSvc,$filter,simpleModalWindowFactory,blockUI,commonintegrationsSvc,$interval,commonModalWindowFactory,modalWindowType){var vm=this;vm.wrappedLoan=wrappedLoan;vm.lp=lp;vm.applicationData=applicationData;angular.extend(this,$controller("DocumentCtrl",{$scope:vm}));vm.validate=validate;vm.submit=submit;vm.cancel=cancel;vm.caseIdChange=caseIdChange;vm.getVendorLoanId=getVendorLoanId;vm.isProcessing=isProcessing;vm.statusColor=statusColor;vm.refresh=refresh;vm.offeringIdentifier=-1;vm.guidEmpty="00000000-0000-0000-0000-000000000000";vm.vendorLoanId="";vm.processing=false;getVendorLoanId();function caseIdChange(){vm.vendorLoanId="";vm.caseIdManualEntry=false;if(vm.lp.selectedCaseId==null){vm.caseIdManualEntry=true;}else{getVendorLoanId();}}function getImageClass(cse){if(cse.CaseResults.length==0){return"";}else{if(cse.IsExpanded){return"imp-collapsed down";}else{return"imp-collapsed right";}}}function caseClicked(cse){cse.IsExpanded=!cse.IsExpanded;}function validate(){}function showErrorMessage(message){commonModalWindowFactory.open({type:modalWindowType.error,message:message});}function submit(){vm.showErrorContainer=false;vm.processing=true;var selectedCaseId="";if(vm.lp.selectedCaseId!=null){selectedCaseId=vm.lp.selectedCaseId;}var selectedOfferingIdentifier="";if(vm.lp.offeringIdentifier){selectedOfferingIdentifier=vm.lp.offeringIdentifier;}commonModalWindowFactory.open({type:modalWindowType.loader,message:"Submitting to LP"});NavigationSvc.SaveAndUpdateWrappedLoan(applicationData.currentUserId,wrappedLoan,function(wrappedLoan){ausSvc.services.post({caseId:selectedCaseId,identifier:selectedOfferingIdentifier,ausType:enums.AusType.LP,userAccountId:$scope.userAccountId},wrappedLoan.ref).$promise.then(function(result){if(result.loanServiceId){var timer=$interval(function(){commonintegrationsSvc.services.getLoanServiceStatus({loanServiceId:result.loanServiceId}).$promise.then(function(result){refresh();commonModalWindowFactory.close("close");var status=result.status;if(status=="400 - Error"||status=="140 - Order Not Accepted By Provider"||status=="270 - Service Completed"){$interval.cancel(timer);}},function(error){commonModalWindowFactory.close("close");showErrorMessage("Error while submitting to LP!");$interval.cancel(timer);$log.error("Failure while getting loan service status",error);});},10000);}},function(error){commonModalWindowFactory.close("close");showErrorMessage("Error while submitting to LP!");$log.error("Failure submitting Freddie Mac Lp data",error);vm.processing=false;});},function(error){commonModalWindowFactory.close("close");showErrorMessage("Error while submitting to DU!");$log.error(error);vm.processing=false;},null,false);}function cancel(){vm.caseIdManualEntry=false;vm.lp.selectedCaseId=vm.caseIds[0];getVendorLoanId();}function getVendorLoanId(){vm.vendorLoanId="";if(vm.lp.selectedCaseId){vm.vendorLoanId=_.find(vm.lp.results[vm.lp.selectedCaseId],function(e){return e.vendorLoanId!="";}).vendorLoanId;}}function isProcessing(){vm.processing=false;vm.processing=_.some(vm.lp.results,function(tracking){return tracking.status=="Pending";});}function refresh(){if($state.current.name=="loanCenter.loan.aus.lp"&&!NavigationSvc.stateChangeStarted.value){blockUI.stop();$state.go("loanCenter.loan.refresh",{page:"loanCenter.loan.aus",tab:"lp"});}}function statusColor(status){switch(status){case"Pending":return"";case"Approve/Eligible":case"Accept/Eligible":case"Accept/A-Offering":return"#1FB25A";default:return"#FD3701";}}}})();var complianceEase;(function(complianceEase){angular.module("complianceEase",[]);})(complianceEase||(complianceEase={}));(function(){angular.module("complianceEase").config(config);config.$inject=["$stateProvider"];function config($stateProvider){$stateProvider.state("loanCenter.loan.complianceEase",{url:"/complianceEase",views:{"complianceEase":{templateUrl:"/angular/complianceease/complianceease.html",controller:"complianceEaseController as complianceEaseCtrl"},"contextualBar@":{templateUrl:"/angular/contextualbar/contextualbar.html",controller:"ContextualBarCtrl as contextualBarCtrl"}},resolve:{complianceData:function(complianceEaseService,wrappedLoan,applicationData,$log){return complianceEaseService.getComplianceData(wrappedLoan.ref.loanId,applicationData.currentUser.userAccountId).$promise.then(function(success){return success.response;},function(error){$log.error("Error occurred while getting Complience Ease data!",error);});}},onExit:function(complianceEaseService,$interval){$interval.cancel(complianceEaseService.interval);}});}})();var complianceEase;(function(complianceEase){var service;(function(service){var ComplianceEaseService=(function(){function ComplianceEaseService(apiRoot,$resource,$q,$log,$interval){var _this=this;this.apiRoot=apiRoot;this.$resource=$resource;this.$q=$q;this.$log=$log;this.$interval=$interval;this.submit=function(request){return _this.$resource(_this.apiPath).save(request);};this.getComplianceData=function(loanId,userAccountId){return _this.$resource(_this.apiPath,{loanId:loanId,userAccountId:userAccountId}).get();};this.refreshComplianceData=function(loanId,userAccountId,callback){_this.interval=_this.$interval(function(){_this.getComplianceData(loanId,userAccountId).$promise.then(function(success){callback(success.response);},function(error){_this.$log.error("Error occurred while refreshing ComplianceEase Data!",error);});},10000);};this.formatDate=function(value,format){if(!!value){format=format?format:"MM/DD/YYYY";return moment(value).format(format);}else{return"";}};this.apiPath=apiRoot+"ComplianceResultService/";}ComplianceEaseService.className="complianceEaseService";ComplianceEaseService.$inject=["apiRoot","$resource","$q","$log","$interval"];return ComplianceEaseService;})();service.ComplianceEaseService=ComplianceEaseService;angular.module("complianceEase").service("complianceEaseService",ComplianceEaseService);})(service=complianceEase.service||(complianceEase.service={}));})(complianceEase||(complianceEase={}));var complianceEase;(function(complianceEase){var controller;(function(controller){var complianceEaseController=(function(){function complianceEaseController(wrappedLoan,applicationData,navigationService,complianceEaseService,complianceData,$log,$state,commonModalWindowFactory,modalWindowType,documentsService,enums,modalPopoverFactory){var _this=this;this.wrappedLoan=wrappedLoan;this.applicationData=applicationData;this.navigationService=navigationService;this.complianceEaseService=complianceEaseService;this.complianceData=complianceData;this.$log=$log;this.$state=$state;this.commonModalWindowFactory=commonModalWindowFactory;this.modalWindowType=modalWindowType;this.documentsService=documentsService;this.enums=enums;this.modalPopoverFactory=modalPopoverFactory;this.counter=0;this.submitting=false;this.saveLoanAndSubmit=function(){_this.navigationService.SaveAndUpdateWrappedLoan(_this.applicationData.currentUserId,_this.wrappedLoan,function(wrappedLoan){var request=new srv.cls.ComplianceEaseRequestViewModel();request.loanId=_this.wrappedLoan.ref.loanId;request.branchId=_this.wrappedLoan.ref.branchId;request.channelId=_this.wrappedLoan.ref.channelId;request.companyId=_this.wrappedLoan.ref.companyId;request.divisionId=_this.wrappedLoan.ref.divisionId;request.userAccountId=_this.applicationData.currentUserId;request.submitedBy=_this.applicationData.currentUser.fullName;_this.submit(request);},function(error){console.log(error);},"Saving Loan and Submitting to CE...");};this.formatDate=function(value,format){return _this.complianceEaseService.formatDate(value,format);};this.colorText=function(value){if(value){switch(value.toUpperCase()){case"PASS":return"#46cc7c";case"FAIL":return"#ef1126";case"WARNING":return"#FFEEC5";}}return"#000";};this.refreshComplianceEaseData=function(){_this.complianceEaseService.getComplianceData(_this.wrappedLoan.ref.loanId,_this.applicationData.currentUserId).$promise.then(function(success){_this.complianceData=success.response;},function(error){_this.$log.error("Error occurred while getting ComplianceEase Data!",error);});};this.openPDF=function(documentId){_this.documentsService.openDocument(documentId,false,true);};this.submit=function(request){_this.complianceEaseService.submit(request).$promise.then(function(success){if(success.response){_this.commonModalWindowFactory.open({type:_this.modalWindowType.success,message:"Request to ComplianceEase Successfully Submitted"});}else{_this.commonModalWindowFactory.open({type:_this.modalWindowType.success,message:"Request to ComplianceEase Failed. Please try again."});}},function(error){_this.$log.error("Error occurred while submitting ComplianceEase request!",error);_this.commonModalWindowFactory.open({type:_this.modalWindowType.success,message:"Request to ComplianceEase Failed. Please try again."});});};this.showComplianceResultDetails=function(event,details){_this.modalPopoverFactory.openModalPopover("angular/complianceease/complianceresultdetails.html",{},details,event,{horisontalPopupPositionPerWidth:0.1,className:"tooltip-arrow-left"});};this.complianceEaseService.refreshComplianceData(this.wrappedLoan.ref.loanId,this.applicationData.currentUserId,function(data){_this.complianceData=data;});this.navigationService.contextualType=this.enums.ContextualTypes.ComplianceEase;}complianceEaseController.$inject=["wrappedLoan","applicationData","NavigationSvc","complianceEaseService","complianceData","$log","$state","commonModalWindowFactory","modalWindowType","DocumentsService","enums","modalPopoverFactory"];complianceEaseController.className="complianceEaseController";return complianceEaseController;})();controller.complianceEaseController=complianceEaseController;angular.module("complianceEase").controller("complianceEaseController",complianceEaseController);})(controller=complianceEase.controller||(complianceEase.controller={}));})(complianceEase||(complianceEase={}));(function(){angular.module("messagecenter",["loanCenter.core"]);})();(function(){angular.module("messagecenter").factory("messagecenterSvc",messagecenterSvc);messagecenterSvc.$inject=["$resource","apiRoot"];function messagecenterSvc($resource,ApiRoot){var messagecenterApiPath=ApiRoot+"MessageCenter/";var MessageCenterServices=$resource(messagecenterApiPath+":path",{path:"@path"},{GetData:{method:"GET",params:{loanId:"loanId",userAccountId:"userAccountId"}},SubmitData:{method:"POST",params:{loanId:"loanId",userAccountId:"userAccountId"}}});var messagecenterService={MessageCenterServices:MessageCenterServices};return messagecenterService;}})();(function(){angular.module("messagecenter").controller("messagecenterController",messagecenterController);function messagecenterController($log,$modal,messagecenterSvc,enums,NavigationSvc){var vm=this;vm.init=init;vm.Submit=Submit;vm.PostMessage=PostMessage;vm.EmailMessage="";vm.processing=false;vm.showLoader=false;vm.showErrorContainer=false;NavigationSvc.contextualType=enums.ContextualTypes.MessageCenter;init();function init(){vm.showLoader=false;vm.showErrorContainer=false;}function Submit(){}function PostMessage(){alert(vm.EmailMessage);}}});(function(){angular.module("lockingandpricingadj",[]);})();(function(){angular.module("lockingandpricingadj").config(config);config.$inject=["$stateProvider"];function config($stateProvider){$stateProvider.state("loanCenter.loan.lockingandpricingadj",{url:"/lockingandpricingadj",views:{"lockingandpricingadj":{templateUrl:"/angular/lockingandpricingadj/lockingandpricingadj.html",controller:"lockingandpricingController as lockingpricingCtrl"}},});}})();var loanCenter;(function(loanCenter){var lockingPricingService=(function(){function lockingPricingService(ApiRoot,$resource,$q){var _this=this;this.ApiRoot=ApiRoot;this.$resource=$resource;this.$q=$q;this.lockLoan=function(){return _this.$resource(_this.lockExpireDateUrl,{loanid:"loanid",useraccountid:"useraccountid"});};var vm=this;vm.apiPath=ApiRoot+"LockingPricing/";vm.lockExpireDateUrl=vm.apiPath+"LockExpireDate";}lockingPricingService.className="LockingPricingService";lockingPricingService.$inject=["apiRoot","$resource","$q",];return lockingPricingService;})();loanCenter.lockingPricingService=lockingPricingService;angular.module("lockingandpricingadj").service("lockingPricingService",lockingPricingService);})(loanCenter||(loanCenter={}));var lockingandpricingadj;(function(lockingandpricingadj){var lockingandpricingController=(function(){function lockingandpricingController(wrappedLoan,enums,modalPopoverFactory,NavigationSvc,pricingResultsSvc,$filter,$state,simpleModalWindowFactory,lockingPricingService,applicationData,loanEvent,lockingActions){var _this=this;this.wrappedLoan=wrappedLoan;this.enums=enums;this.modalPopoverFactory=modalPopoverFactory;this.NavigationSvc=NavigationSvc;this.pricingResultsSvc=pricingResultsSvc;this.$filter=$filter;this.$state=$state;this.simpleModalWindowFactory=simpleModalWindowFactory;this.lockingPricingService=lockingPricingService;this.applicationData=applicationData;this.loanEvent=loanEvent;this.lockingActions=lockingActions;this.rateAndPriceEditDisabled=true;this.userHasConcessionPrivileges=false;this.getTotalSumOfApprovedRates=function(){var sum=0;_this.pricingLockingModel.adjustments.forEach(function(adjustment){if(adjustment.adjustmentSectionType==2&&!adjustment.isDeleted&&adjustment.description=="Approved"){return sum+=adjustment.rate;}});return sum;};this.getMaxAllowedNumberOfPrivileges=function(){var maxNumberOfConcessions=0;_this.applicationData.lockingConfigurations.some(function(lockingConfig){if(lockingConfig.lockingConfigurationKey==5){maxNumberOfConcessions=parseInt(lockingConfig.value);}});return maxNumberOfConcessions;};this.getTotalNumberOfLoApprovedConcessions=function(){var numberOfLoConcessions=0;_this.pricingLockingModel.adjustments.forEach(function(adjustment){if(adjustment.adjustmentTypeId==2&&!adjustment.isDeleted&&adjustment.description=="Approved"){numberOfLoConcessions++;}});return numberOfLoConcessions;};this.modifyArmAdjustmentPeriod=function(armAdjustmentPeriod){if(!armAdjustmentPeriod){return 12;}else{return armAdjustmentPeriod;}};this.lockStatusDisplay=function(){var vm=_this;var lockStatus;for(var i=0;i<vm.applicationData.lookup.lockStatus.length;i++){if(vm.applicationData.lookup.lockStatus[i].value==vm.wrappedLoan.ref.lockingInformation.lockStatus){lockStatus=vm.applicationData.lookup.lockStatus[i].text;}}return lockStatus;};this.setVisibilityByRoles=function(){var vm=_this;if(vm.applicationData.currentUser&&vm.applicationData.currentUser.roles){angular.forEach(vm.applicationData.currentUser.roles,function(role){if(role.roleName==vm.enums.userRoles.loanOfficer||role.roleName==vm.enums.userRoles.administrator){vm.displayEnterpriseSection=true;vm.isLO=true;vm.currentUserRole=vm.enums.userRoles.loanOfficer;}if(role.roleName==vm.enums.userRoles.secondary||role.roleName==vm.enums.userRoles.administrator){vm.displayEnterpriseSection=true;vm.displayLOSection=true;vm.currentUserRole=vm.enums.userRoles.secondary;}if(role.roleName==vm.enums.userRoles.lockDesk||role.roleName==vm.enums.userRoles.administrator){vm.displaySellSide=true;vm.displayPricingInfoEditButton=true;vm.displayInvestorPurchasePrice=true;vm.displayEnterpriseSection=true;vm.displayLOSection=true;vm.currentUserRole=vm.enums.userRoles.lockDesk;}});}};this.setClassesAndPermissionsByPrivilege=function(){var vm=_this;var maxValue=0;var concessionPrivileges=[];if(vm.applicationData.currentUser&&vm.applicationData.currentUser.privileges){angular.forEach(vm.applicationData.currentUser.privileges,function(privilege){if(privilege.name==vm.enums.privileges.AcceptLock){vm.contextualMenuClass+=" accept-lock";}if(privilege.name==vm.enums.privileges.SubmitLock){vm.contextualMenuClass+=" submit-lock";}if(privilege.name==vm.enums.privileges.ConcessionLevel1){concessionPrivileges.push(7);}else{if(privilege.name==vm.enums.privileges.ConcessionLevel2){concessionPrivileges.push(8);}else{if(privilege.name==vm.enums.privileges.ConcessionLevel3){concessionPrivileges.push(9);}else{if(privilege.name==vm.enums.privileges.ConcessionLevel4){concessionPrivileges.push(10);}else{if(privilege.name==vm.enums.privileges.ConcessionLevel5){concessionPrivileges.push(11);}}}}}});}if(concessionPrivileges.length>0){vm.userHasConcessionPrivileges=true;if(vm.applicationData.lockingConfigurations){angular.forEach(concessionPrivileges,function(concessionPrivilege){vm.applicationData.lockingConfigurations.forEach(function(lockingConfig){var tempvalue=parseFloat(lockingConfig.value);if(concessionPrivilege==lockingConfig.lockingConfigurationKey&&tempvalue>maxValue){maxValue=tempvalue;}});});}}_this.maxConcessionApproveRate=maxValue;};this.getTotalLoanOfficerAmount=function(adjustments){var total=0;for(var i=0;i<adjustments.length;i++){if(adjustments[i].adjustmentSectionType==_this.enums.pricingAdjustmentSectionType.lOPrice&&adjustments[i].isDeleted!=true){total+=parseFloat(adjustments[i].value);}}return total;};this.filterPricingAdjustments=function(wrappedLoan,enumType){var vm=_this;var pricing=new cls.PricingAdjustmentsViewModel(wrappedLoan.ref.pricingAdjustments);pricing.adjustments=_.filter(wrappedLoan.ref.pricingAdjustments.adjustments,function(adjustment){adjustment.totalLoanAmount=vm.totalAmountValue;return adjustment.adjustmentSectionType===enumType;});pricing.defaultAdjustmentTypeId=1;pricing.isDisabled=true;return pricing;};this.getInclude=function(){if(_this.isLO&&!_this.displayLOSection){return"angular/lockingandpricingadj/loprice.html";}else{if(_this.displayEnterpriseSection){return"angular/lockingandpricingadj/investorprice.html";}else{return null;}}};this.loFilter=function(item){return item.isEditable;};this.setSellSideInvestorPurchasePrice=function(){_this.pricingLockingModel.sellSideInformation.sellSideInvestorPurchasePrice=_this.pricingLockingModel.investorPurchasePrice;};this.enableSellSide=function(){if(_this.pricingLockingModel.sellSideInformation.isDisabledSellSide){_this.pricingLockingModel.sellSideInformation.isDisabledSellSide=false;}};this.enableRateAndPriceEdit=function(){if(_this.rateAndPriceEditDisabled){_this.rateAndPriceEditDisabled=false;}};this.enableInvestor=function(item){item.isDisabled=!item.isDisabled;item.isEditClicked=!item.isEditClicked;if(item.isDisabled==false){item.hoverEdit=true;}};this.hoverInTitle=function(item){item.hoverEdit=true;};this.hoverOutTitle=function(item){if(item.isDisabled==false){item.hoverEdit=true;}else{item.hoverEdit=false;}};this.isDescriptionTextExpired=function(number){if(number>0){return false;}else{return true;}};this.adjustedPointsChange=function(){_this.wrappedLoan.ref.financialInfo.adjustedPoints=100-_this.pricingLockingModel.finalLoanOfficerPrice;_this.loanEvent.broadcastPropertyChangedEvent(23,_this.wrappedLoan.ref.financialInfo.adjustedPoints);};this.addRow=function(pricingViewModel,secType){var vm=_this;var newItem=new cls.AdjustmentsViewModel();newItem.editMode=true;newItem.hoverClick=true;newItem.hoverEdit=true;newItem.loanId=vm.wrappedLoan.ref.loanId;newItem.isDeleted=false;newItem.adjustmentSectionType=secType;newItem.adjustmentTypeId=pricingViewModel.defaultAdjustmentTypeId;newItem.newAdjustment=true;newItem.lastModifiedBy=vm.applicationData.currentUser.firstName+" "+vm.applicationData.currentUser.lastName;newItem.sortingNotRequired=true;pricingViewModel.adjustments.push(newItem);};this.removeRow=function(item,adjustmentsModel){if(adjustmentsModel[adjustmentsModel.indexOf(item)].isEmpty){adjustmentsModel.splice(adjustmentsModel.indexOf(item),1);}else{adjustmentsModel[adjustmentsModel.indexOf(item)].isDeleted=true;_this.wrappedLoan.ref.financialInfo.adjustedPoints+=parseFloat(adjustmentsModel[adjustmentsModel.indexOf(item)].value);}};this.getAdjustmentDescription=function(lookupAdjustmentTypes,adjustment){var lookupItem=_.find(lookupAdjustmentTypes,function(item){return item.value===String(adjustment.adjustmentTypeId);});return lookupItem?lookupItem.text:"";};this.getPaidBy=function(loPricePaidBys,adjustment){var lookupItem=_.find(loPricePaidBys,function(item){return item.value===String(adjustment.paidBy);});return lookupItem?lookupItem.description:"";};this.editAdjustment=function(adjustment){if(adjustment&&adjustment.isEditable&&!_this.isDisabled()&&(adjustment.description!="Approved"&&adjustment.description!="Denied")){adjustment.editMode=true;adjustment.hoverClick=true;adjustment.hoverEdit=true;}};this.saveAll=function(){var vm=_this;vm.pricingLockingModel.sellSideInformation.isDisabledSellSide=true;vm.rateAndPriceEditDisabled=true;vm.savingDataInProgress=true;vm.pricingLockingModel.disableFields=true;_this.navigationSvc.SaveAndUpdateWrappedLoan(vm.applicationData.currentUserId,vm.wrappedLoan,function(wrappedLoan){vm.lockingPricingSvc.lockLoan().get({loanid:vm.wrappedLoan.ref.loanId,useraccountid:vm.applicationData.currentUserId}).$promise.then(function(data){vm.state.reload();vm.savingDataInProgress=false;vm.pricingLockingModel.disableFields=true;},function(error){vm.savingDataInProgress=false;vm.pricingLockingModel.disableFields=false;});},function(error){vm.savingDataInProgress=false;vm.pricingLockingModel.disableFields=false;});};this.saveOnly=function(){var vm=_this;vm.savingDataInProgress=true;_this.navigationSvc.SaveAndUpdateWrappedLoan(vm.applicationData.currentUserId,vm.wrappedLoan,function(wrappedLoan){vm.savingDataInProgress=false;},function(error){vm.savingDataInProgress=false;});};this.cancelChanges=function(){var vm=_this;vm.savingDataInProgress=false;vm.pricingLockingModel.disableFields=false;_this.navigationSvc.cancelChanges(vm.wrappedLoan.ref.loanId);};this.callSaveLockAction=function(){var vm=_this;if(vm.lockingAction){switch(vm.lockingAction.value){case 1:_this.saveOnly();break;}}};this.filterOptionsByRoles=function(item){var vm=_this;var hasPrivilege=false;if(vm.applicationData.currentUser&&!item.saveAction){hasPrivilege=vm.applicationData.currentUser.hasPrivilege(item.userPrivilege);}return(hasPrivilege||item.saveAction);};this.showSaveLockAction=function(item,$event){var vm=_this;if(item){vm.lockingAction=item;}};this.isDisabled=function(){return(_this.pricingLockingModel.disableFields||_this.wrappedLoan.ref.lockingInformation.isLocked||_this.savingDataInProgress);};this.adjustmentTypeFilter=function(adjustment){var adjustmentTypes=[];if(adjustment&&adjustment.adjustmentSectionType==2){var existingLoanOfficerAdjustments=_this.tableAdjustmentList(2);if(existingLoanOfficerAdjustments&&existingLoanOfficerAdjustments.length>0){var isConcessionRequested=existingLoanOfficerAdjustments.some(function(adjustment){return _this.isConessionRequested(adjustment,2);});var currentNumberOfLoConcessions=_this.getTotalNumberOfLoApprovedConcessions();var concessionRequested=isConcessionRequested||(_this.maxAllowedNumberOfConcession&&_this.maxAllowedNumberOfConcession>0&&currentNumberOfLoConcessions>=_this.maxAllowedNumberOfConcession);if((adjustment.newAdjustment&&!concessionRequested)||(adjustment.adjustmentTypeId==undefined)||(adjustment.adjustmentTypeId==2&&(!adjustment.newAdjustment||(adjustment.newAdjustment&&concessionRequested)))){adjustmentTypes=_this.getLoanOfficerAdjustmentTypes(false);}else{adjustmentTypes=_this.getLoanOfficerAdjustmentTypes(true);}}else{adjustmentTypes=_this.getLoanOfficerAdjustmentTypes(false);}}return adjustmentTypes;};this.disableLoAddButton=function(){var disableLoAddButton=false;var loanOfficerAdjustments=_this.tableAdjustmentList(2);if(loanOfficerAdjustments&&loanOfficerAdjustments.length>0){var isConcessionRequested=loanOfficerAdjustments.some(function(adjustment){return _this.isConessionRequested(adjustment,2);});var adjustmentTypes=[];if(!_this.maxAllowedNumberOfConcession&&_this.maxAllowedNumberOfConcession<1){adjustmentTypes=(isConcessionRequested)?_this.getLoanOfficerAdjustmentTypes(true):_this.getLoanOfficerAdjustmentTypes(false);}else{var totalNumberOfLoConcession=_this.getTotalNumberOfLoApprovedConcessions();adjustmentTypes=(isConcessionRequested||(totalNumberOfLoConcession>=_this.maxAllowedNumberOfConcession))?_this.getLoanOfficerAdjustmentTypes(true):_this.getLoanOfficerAdjustmentTypes(false);}disableLoAddButton=!adjustmentTypes||adjustmentTypes.length<1;}return disableLoAddButton;};this.isConessionRequested=function(adjustment,tableOfAdjustments){var isConcessionRequested=false;if(tableOfAdjustments&&adjustment){if(tableOfAdjustments==2&&tableOfAdjustments==adjustment.adjustmentSectionType){isConcessionRequested=adjustment.adjustmentTypeId==2&&!adjustment.isDeleted&&adjustment.description=="Requested";}}return isConcessionRequested;};this.adjustmentsSubTypeFilter=function(adjustment){var adjustmentSubTypes=Array();if(adjustment&&!adjustment.isDeleted){adjustmentSubTypes=_this.filterAdjustmentDescriptions(adjustment,1);if(adjustment.adjustmentTypeId==2){var filteredAdjustmentSubTypes=[];var roles=_this.applicationData.currentUser.roles;if(_this.currentUserRole==_this.enums.userRoles.lockDesk||_this.currentUserRole==_this.enums.userRoles.loanOfficer||_this.currentUserRole==_this.enums.userRoles.secondary||_this.currentUserRole==_this.enums.userRoles.administrator){filteredAdjustmentSubTypes=_this.getFilteredConcessionSubTypes(adjustment,adjustmentSubTypes);}adjustment.hasSubType=filteredAdjustmentSubTypes.length>0;return filteredAdjustmentSubTypes;}adjustment.hasSubType=adjustmentSubTypes.length>0;}return adjustmentSubTypes;};this.getFilteredConcessionSubTypes=function(adjustment,adjustmentSubTypes){var filteredAdjustmentSubTypes=Array();if(!adjustment.description){adjustment.firstLoad=false;filteredAdjustmentSubTypes=adjustmentSubTypes.filter(function(adjustmentSubType){return adjustmentSubType.text=="Requested";});if(filteredAdjustmentSubTypes.length>0){adjustment.description="Requested";}}else{if(adjustment.description=="Requested"){if(adjustment.firstLoad==true&&_this.currentUserRole!=_this.enums.userRoles.loanOfficer&&_this.userHasConcessionPrivileges){var adjustmentRate=adjustment.rate;filteredAdjustmentSubTypes=((adjustmentRate+_this.totalApprovedConcessionRates)>_this.maxConcessionApproveRate)?_this.getAdjustmnetSubTypeByText(adjustmentSubTypes,["Requested"]):_this.getAdjustmnetSubTypeByText(adjustmentSubTypes,["Requested","Approved","Denied"]);}else{filteredAdjustmentSubTypes=_this.getAdjustmnetSubTypeByText(adjustmentSubTypes,["Requested"]);}}else{if(adjustment.description=="Approved"||adjustment.description=="Denied"){filteredAdjustmentSubTypes=_this.getAdjustmnetSubTypeByText(adjustmentSubTypes,["Requested","Approved","Denied"]);}}}return filteredAdjustmentSubTypes;};this.getAdjustmnetSubTypeByText=function(adjustmentSubTypes,filter){var filteringResults=[];if(!adjustmentSubTypes||!filter){return filteringResults;}var param1=filter[0];if(filter.length==1){filteringResults=adjustmentSubTypes.filter(function(adjustmentSubType){return adjustmentSubType.text==param1;});}else{var param2=filter[1];if(filter.length==2){filteringResults=adjustmentSubTypes.filter(function(adjustmentSubType){return adjustmentSubType.text==param1||adjustmentSubType.text==param2;});}else{var param3=filter[2];if(filter.length==3){filteringResults=adjustmentSubTypes.filter(function(adjustmentSubType){return adjustmentSubType.text==param1||adjustmentSubType.text==param2||adjustmentSubType.text==param3;});}}}return filteringResults;};this.paidByTypeFilter=function(adjustment){var vm=_this;var filteredLookup=[];var filtederdPaidOff=_this.filterAdjustmentDescriptions(adjustment,2);for(var i=0;i<vm.applicationData.lookup.loPricePaidBy.length;i++){for(var j=0;j<filtederdPaidOff.length;j++){if(vm.applicationData.lookup.loPricePaidBy[i].text==filtederdPaidOff[j].text){filteredLookup.push(vm.applicationData.lookup.loPricePaidBy[i]);}}}if(filteredLookup.length>0){adjustment.hasPaidByType=true;}else{adjustment.hasPaidByType=false;}return filteredLookup;};this.filterAdjustmentDescriptions=function(adjustment,section){var adjustmentSubTypes=_this.applicationData.adjustmentTypeDescLookupViewModel.adjustmentTypesDescriptions;if(!adjustmentSubTypes||!adjustment){return[];}return adjustmentSubTypes.filter(function(ajdustmentSubType){return ajdustmentSubType.type==section&&ajdustmentSubType.value==adjustment.adjustmentTypeId;});};this.changeSelection=function(adjustment,dropdownType){if(adjustment){var vm=_this;adjustment.lastModifiedBy=vm.applicationData.currentUser.firstName+" "+vm.applicationData.currentUser.lastName;if(dropdownType==0){adjustment.description="";adjustment.paidBy=-1;}else{if(dropdownType==1){if(adjustment.adjustmentTypeId==2&&(adjustment.description=="Approved"||adjustment.description=="Requested")){var totalApprovedConcessions=_this.getTotalNumberOfLoApprovedConcessions();if(totalApprovedConcessions>=_this.maxAllowedNumberOfConcession||adjustment.description=="Requested"){var rowsForRemove=[];for(var i=0;i<_this.pricingLockingModel.adjustments.length;i++){var helperAdjustment=_this.pricingLockingModel.adjustments[i];if(helperAdjustment.adjustmentTypeId==2&&helperAdjustment.description=="Requested"&&!helperAdjustment.isDeleted&&helperAdjustment!=adjustment){rowsForRemove.push(i);}}if(rowsForRemove.length>0){rowsForRemove.forEach(function(row){return _this.removeRow(_this.pricingLockingModel.adjustments[row],_this.pricingLockingModel.adjustments);});}}}}}}};this.adjustNoteMessage=function(adjustment){var message="";if(adjustment&&adjustment.description){message=adjustment.description;}if(adjustment.adjustmentTypeId==2&&adjustment.lastModifiedBy&&adjustment.lastModifiedBy!="OptimalBlue"){if(!message){message="{"+adjustment.lastModifiedBy+"}";}else{message=message+", {"+adjustment.lastModifiedBy+"}";}}if(adjustment.note){if(!message){message=adjustment.note;}else{message=message+" "+adjustment.note;}}return message;};this.tableAdjustmentList=function(filter){var adjustments=_this.pricingLockingModel.adjustments;var filteredList=[];var extensionCounter=0;var concessionCounter=0;for(var i=0;i<adjustments.length;i++){if(adjustments[i].adjustmentSectionType==filter){var adjustment=adjustments[i];!adjustment.adjustmentCounter?"":adjustment.adjustmentCounter;if(!adjustment.newAdjustment){if(!adjustment.sortingNotRequired){if(adjustment.adjustmentSectionType==1){if(adjustment.adjustmentTypeId==7){adjustment.orderBy=1;}else{if(adjustment.adjustmentTypeId==8){adjustment.orderBy=2;}else{if(adjustment.adjustmentTypeId==17){adjustment.orderBy=3;}else{if(adjustment.adjustmentTypeId==18){adjustment.orderBy=4;}else{if(adjustment.adjustmentTypeId==19){adjustment.orderBy=5;}else{adjustment.orderBy=adjustments.length+i;}}}}}}else{if(adjustment.adjustmentSectionType==2){if(adjustment.adjustmentTypeId==1){adjustment.orderBy=1;}else{if(adjustment.adjustmentTypeId==20){adjustment.orderBy=2;}else{if(adjustment.adjustmentTypeId==21){adjustment.orderBy=3;}else{if(adjustment.adjustmentTypeId==2){adjustment.orderBy=4;extensionCounter=extensionCounter+1;adjustment.adjustmentCounter=extensionCounter.toString();}else{if(adjustment.adjustmentTypeId==4){adjustment.orderBy=5;concessionCounter=concessionCounter+1;adjustment.adjustmentCounter=concessionCounter.toString();}else{adjustment.orderBy=adjustments.length+i;}}}}}}}adjustment.sortingNotRequired=true;}}else{adjustment.orderBy=adjustments.length+i;}filteredList.push(adjustment);}}var sortedAdjustment=filteredList.sort(function(obj1,obj2){return obj1.orderBy-obj2.orderBy;});return sortedAdjustment;};this.getIntegrationItem=function(itemId,logType){var vm=_this;var result=vm.pricingResultsSvc.GetIntegrationLogItem(vm.wrappedLoan.ref.active.getBorrower().userAccount.userAccountId,itemId,logType);};this.openIntegrationXmlMenu=function(event,logListItem,logType){var vm=_this;var detailedClosingCostPopup=_this.modalPopoverFactory.openModalPopover("angular/pricingresults/sections/integrationsxmloptions.html",{getIntegrationItem:vm.getIntegrationItem},{logListItem:logListItem,logType:logType},event,{className:"tooltip-arrow-integration-logs",calculateVerticalPositionFromTopBorder:true,verticalPopupPositionPerHeight:1,horisontalPopupPositionPerWidth:0.5});detailedClosingCostPopup.result.then(function(data){},function(){});};var vm=this;if(wrappedLoan){vm.wrappedLoan=wrappedLoan;vm.enums=enums;vm.totalAmountValue=vm.wrappedLoan.ref.detailsOfTransaction.totalLoanAmount;wrappedLoan.ref.pricingAdjustments=new cls.PricingAdjustmentsViewModel(wrappedLoan.ref.pricingAdjustments);vm.pricingLockingModel=wrappedLoan.ref.pricingAdjustments;vm.loanLockStatus=vm.lockStatusDisplay();vm.investorPricingModel=this.filterPricingAdjustments(vm.wrappedLoan,enums.pricingAdjustmentSectionType.investor);vm.loanOfficerModel=this.filterPricingAdjustments(vm.wrappedLoan,enums.pricingAdjustmentSectionType.loanOfficer);vm.investorBasePurchaseModel=this.filterPricingAdjustments(vm.wrappedLoan,enums.pricingAdjustmentSectionType.investorBasePurchase);vm.pricingLockingModel.totalLoanPrice=vm.getTotalLoanOfficerAmount(vm.pricingLockingModel.adjustments);vm.pricingLockingModel.sellSideInformation.isDisabledSellSide=true;vm.pricingLockingModel.sellSideInformation.sellSideInvestorPurchasePrice=this.pricingLockingModel.investorPurchasePrice;vm.pricingLockingModel.investorPrice=100-vm.wrappedLoan.ref.financialInfo.adjustedPoints-vm.pricingLockingModel.totalLoanPrice;vm.getIntegrationItem=vm.getIntegrationItem;vm.currentUserRole;vm.contextualMenuClass="dropdown-menu";}if(applicationData){vm.lookups=applicationData.lockingPricingLookup;vm.applicationData=applicationData;vm.displaySellSide=false;vm.displayPricingInfoEditButton=false;vm.displayInvestorPurchasePrice=false;vm.displayEnterpriseSection=false;vm.displayLOSection=false;vm.displayOptimalBlueXML=false;vm.setVisibilityByRoles();}vm.wrappedLoan.ref.loanLock.armAdjustmentPeriod=this.modifyArmAdjustmentPeriod(vm.wrappedLoan.ref.loanLock.armAdjustmentPeriod);vm.lockingPricingSvc=lockingPricingService;vm.navigationSvc=NavigationSvc;vm.state=$state;vm.simpleModalWindowFactory=simpleModalWindowFactory;vm.lockingActions=lockingActions;vm.lockingAction=lockingActions[0];vm.maxAllowedNumberOfConcession=this.getMaxAllowedNumberOfPrivileges();vm.setClassesAndPermissionsByPrivilege();vm.totalApprovedConcessionRates=this.getTotalSumOfApprovedRates();vm.displayOptimalBlueXML=vm.applicationData.currentUser.hasPrivilege(vm.enums.privileges.ViewOptimalBlueXML);NavigationSvc.contextualType=enums.ContextualTypes.LockingPricing;}lockingandpricingController.prototype.getLoanOfficerAdjustmentTypes=function(containsRequestedConcession){var _this=this;if(containsRequestedConcession==true){return this.lookups.loAdjustmentTypes.filter(function(adjustmentType){return adjustmentType.text!="Concession"&&_this.loFilter(adjustmentType);});}else{return this.lookups.loAdjustmentTypes.filter(function(adjustmentType){return _this.loFilter(adjustmentType);});}};lockingandpricingController.className="lockingandpricingController";lockingandpricingController.$inject=["wrappedLoan","enums","modalPopoverFactory","NavigationSvc","pricingResultsSvc","$filter","$state","simpleModalWindowFactory","lockingPricingService","applicationData","loanEvent","lockingActions"];return lockingandpricingController;})();lockingandpricingadj.lockingandpricingController=lockingandpricingController;angular.module("lockingandpricingadj").controller("lockingandpricingController",lockingandpricingController);})(lockingandpricingadj||(lockingandpricingadj={}));(function(){angular.module("preapprovalletters",[]);})();(function(){angular.module("preapprovalletters").config(config);config.$inject=["$stateProvider"];function config($stateProvider){$stateProvider.state("loanCenter.loan.preapprovalletters",{url:"/preapprovalletters",views:{"preapprovalletters":{templateUrl:"/angular/preapprovalletters/preapprovalletters.html",controller:"preapprovallettersController as preapprovallettersCtrl"}},});}})();var preapprovalletters;(function(preapprovalletters){var preapprovallettersService=(function(){function preapprovallettersService(apiRoot,$resource,$q,$http){var _this=this;this.apiRoot=apiRoot;this.$resource=$resource;this.$q=$q;this.$http=$http;this.send=function(viewModel){var config={params:{viewModel:viewModel}};return _this.$http.post(_this.postApiPath,viewModel,{params:{}});};this.postApiPath=this.apiRoot+"PreApprovalLetters/Post";var postAction={method:"POST",isArray:false};this.preapprovalSend=this.$resource(this.postApiPath,{viewModel:"@viewModel"},{create:postAction});}preapprovallettersService.$inject=["apiRoot","$resource","$q","$http"];return preapprovallettersService;})();preapprovalletters.preapprovallettersService=preapprovallettersService;angular.module("preapprovalletters").service("preapprovallettersService",preapprovallettersService);})(preapprovalletters||(preapprovalletters={}));var preapprovalletters;(function(preapprovalletters){var preapprovallettersController=(function(){function preapprovallettersController(wrappedLoan,enums,NavigationSvc,$filter,$state,$controller,$modal,modalPopoverFactory,applicationData){var _this=this;this.wrappedLoan=wrappedLoan;this.enums=enums;this.NavigationSvc=NavigationSvc;this.$filter=$filter;this.$state=$state;this.$controller=$controller;this.$modal=$modal;this.modalPopoverFactory=modalPopoverFactory;this.applicationData=applicationData;this.selectedNames="Select One or More";this.sendToUsers={borrowers:[],buyersAgent:null,sellersAgent:null};this.letterExpirationDate=new Date();this.letterExpirationDateValidated=true;this.showExpirationDateDisclaimer=false;this.purchasePriceValidated=true;this.showPurchasePriceDisclaimer=false;this.loanAmountlValidated=true;this.showLoanAmountDisclaimer=false;this.expirationDateValidated=true;this.ruleFunctionExpirationDate=function(expirationDateEntered){return false;};this.getCurrentDate=function(){return _this.$filter("date")(new Date(),"MM/dd/yy");};this.showSendToSection=function(event,model){var ctrl={getSendToNames:_this.getSendToNames,selectedNames:_this.selectedNames};var sendToSection=_this.modalPopoverFactory.openModalPopover("angular/preapprovalletters/sendtosection.html",ctrl,_this.sendToUsers,event,{verticalPopupPositionPerHeight:0.03,horisontalPopupPositionPerWidth:0.5,refExtModelAndCtrl:true,className:"tooltip-arrow-display-non"});};this.getSendToNames=function(){_this.selectedNames="";for(var i=0;i<_this.sendToUsers.borrowers.length;i++){if(_this.sendToUsers.borrowers[i].isSelected){_this.selectedNames=_this.selectedNames.concat(_this.sendToUsers.borrowers[i].fullname,", ");}}if(_this.sendToUsers.buyersAgent.isSelected){_this.selectedNames=_this.selectedNames.concat(_this.sendToUsers.buyersAgent.fullname,", ");}if(_this.sendToUsers.sellersAgent.isSelected){_this.selectedNames=_this.selectedNames.concat(_this.sendToUsers.sellersAgent.fullname,", ");}_this.selectedNames=_this.selectedNames.slice(0,-1);_this.selectedNames=_this.selectedNames.substring(0,_this.selectedNames.length-1);if(_this.selectedNames==""){_this.selectedNames="Select One or More";}};this.getBorrowers=function(){var borrowers=[];if(_this.wrappedLoan.ref.getLoanApplications()){for(var i=0;i<_this.wrappedLoan.ref.getLoanApplications().length;i++){borrowers.push({fullname:_this.wrappedLoan.ref.getLoanApplications()[i].getBorrower().getFullName(),email:_this.wrappedLoan.ref.getLoanApplications()[i].getBorrower().userAccount.username,id:_this.wrappedLoan.ref.getLoanApplications()[i].loanApplicationId,isSelected:false});}}return borrowers;};this.getBuyersAgent=function(){if(_this.wrappedLoan.ref.buyersAgentContact){var firstname=_this.wrappedLoan.ref.buyersAgentContact.firstname?_this.wrappedLoan.ref.buyersAgentContact.firstname+" ":"";var lastname=_this.wrappedLoan.ref.buyersAgentContact.lastname?_this.wrappedLoan.ref.buyersAgentContact.lastname:"";var email=_this.wrappedLoan.ref.buyersAgentContact.email?_this.wrappedLoan.ref.buyersAgentContact.email:"";return{fullname:firstname+lastname,email:email,isSelected:false};}};this.getSellersAgent=function(){if(_this.wrappedLoan.ref.sellersAgentContact){var firstname=_this.wrappedLoan.ref.sellersAgentContact.firstname?_this.wrappedLoan.ref.sellersAgentContact.firstname+" ":"";var lastname=_this.wrappedLoan.ref.sellersAgentContact.lastname?_this.wrappedLoan.ref.sellersAgentContact.lastname:"";var email=_this.wrappedLoan.ref.sellersAgentContact.email?_this.wrappedLoan.ref.sellersAgentContact.email:"";return{fullname:firstname+lastname,email:email,isSelected:false};}};this.getSentToUsersHistory=function(preApprovalLetterHistory){var sentToUserNames="";if(preApprovalLetterHistory.distributeToBorrower){var splittedLoanIds=preApprovalLetterHistory.borrowersForDistribution.split("|");for(var i=0;i<_this.wrappedLoan.ref.getLoanApplications().length;i++){if(splittedLoanIds.indexOf(_this.wrappedLoan.ref.getLoanApplications()[i].loanApplicationId)>-1){sentToUserNames=sentToUserNames.concat(_this.wrappedLoan.ref.getLoanApplications()[i].getBorrower().getFullName(),", ");}}}if(preApprovalLetterHistory.distributeToBuyersAgent){sentToUserNames=sentToUserNames.concat(_this.getBuyersAgent().fullname,", ");}if(preApprovalLetterHistory.distributeToSellersAgent){sentToUserNames=sentToUserNames.concat(_this.getSellersAgent().fullname,", ");}sentToUserNames=sentToUserNames.slice(0,-1);sentToUserNames=sentToUserNames.substring(0,sentToUserNames.length-1);return sentToUserNames;};this.getTemplateById=function(id){var template=_.find(_this.applicationData.preApprovalLetterTemplates,function(template){return template.id==id;});if(template){return template;}};this.isLetterExpired=function(expirationDate){var today=new Date();var expirationdate=new Date(expirationDate);if(today>expirationdate){return true;}else{return false;}};this.setDefaultExpirationDate=function(){if(!_.some(_this.wrappedLoan.ref.getLoanApplications(),function(loanApp){return(!loanApp.credit.creditReportDate||loanApp.credit.creditReportDate.toString()=="0001-01-01T00:00:00");})){_this.creditReportDate=new Date(_this.wrappedLoan.ref.active.credit.creditReportDate.toString());_this.letterExpirationDate=new Date(_this.creditReportDate.toDateString());_this.letterExpirationDate.setDate(_this.creditReportDate.getDate()+89);if(_this.validateCreditReportDate()){_this.letterExpirationDateEntered=_this.$filter("date")(_this.letterExpirationDate,"MM/dd/yy");_this.letterExpirationDateMessage="Date cannot exceed "+_this.letterExpirationDateEntered;}}};this.validateCreditReportDate=function(){var allowedMinCreditReportDate=new Date();allowedMinCreditReportDate.setDate(allowedMinCreditReportDate.getDate()-75);if(!(_this.creditReportDate instanceof Date)||_this.creditReportDate<allowedMinCreditReportDate){return false;}else{return true;}};this.validateData=function(){return(_this.templateId&&_this.purchasePriceValidated&&_this.loanAmountlValidated&&_this.validateCreditReportDate()&&_this.selectedNames!="Select One or More");};this.validateExpirationDate=function(model){if(new Date(model.preapprovallettersCtrl.letterExpirationDateEntered)>model.preapprovallettersCtrl.letterExpirationDate){model.preapprovallettersCtrl.expirationDateValidated=false;}else{model.preapprovallettersCtrl.expirationDateValidated=true;}};this.onPurchasePriceBlur=function(){_this.purchasePriceValidated=true;_this.showPurchasePriceDisclaimer=false;if(_this.letterPurchasePrice>_this.wrappedLoan.ref.getSubjectProperty().purchasePrice){_this.purchasePriceValidated=false;}};this.onPurchasePriceFocus=function(){if(_this.letterPurchasePrice>_this.wrappedLoan.ref.getSubjectProperty().purchasePrice){_this.showPurchasePriceDisclaimer=true;}};this.onLoanAmountBlur=function(){_this.loanAmountlValidated=true;_this.showLoanAmountDisclaimer=false;if(_this.letterLoanAmount>_this.wrappedLoan.ref.loanAmount){_this.loanAmountlValidated=false;}};this.onLoanAmountFocus=function(){if(_this.letterLoanAmount>_this.wrappedLoan.ref.loanAmount){_this.showLoanAmountDisclaimer=true;}};this.openPreview=function(wrappedLoan,sendToUsers,applicationData,letterLoanAmount,letterPurchasePrice,letterExpirationDate,templateId){_this.$modal.open({templateUrl:"angular/preapprovalletters/preapprovalletters.preview.modal.html",controller:"preapprovallettersPreviewModalController",controllerAs:"palCtrl",backdrop:"static",resolve:{sendToUsers:function(){return sendToUsers;},wrappedLoan:function(){return wrappedLoan;},applicationData:function(){return applicationData;},preapprovalLoanTerms:function(){return[letterLoanAmount,letterPurchasePrice,letterExpirationDate];},templateId:function(){return templateId;}}});};angular.extend(this,$controller("DocumentCtrl",{$scope:this}));this.sendToUsers.borrowers=this.getBorrowers();this.sendToUsers.buyersAgent=this.getBuyersAgent();this.sendToUsers.sellersAgent=this.getSellersAgent();this.setDefaultExpirationDate();this.templateId=0;this.letterPurchasePrice=0;this.letterLoanAmount=0;this.issueDate=this.getCurrentDate();this.subjectPropertyAddress=this.wrappedLoan.ref.getSubjectProperty().fullAddressString;this.letterLoanAmount=this.wrappedLoan.ref.loanAmount;this.letterPurchasePrice=this.wrappedLoan.ref.getSubjectProperty().purchasePrice;NavigationSvc.contextualType=enums.ContextualTypes.PreApprovalLetters;}preapprovallettersController.className="preapprovallettersController";preapprovallettersController.$inject=["wrappedLoan","enums","NavigationSvc","$filter","$state","$controller","$modal","modalPopoverFactory","applicationData"];return preapprovallettersController;})();preapprovalletters.preapprovallettersController=preapprovallettersController;angular.module("preapprovalletters").controller("preapprovallettersController",preapprovallettersController);})(preapprovalletters||(preapprovalletters={}));var preapprovalletters;(function(preapprovalletters){var preapprovallettersPreviewModalController=(function(){function preapprovallettersPreviewModalController(enums,NavigationSvc,$filter,$state,simpleModalWindowFactory,$modal,wrappedLoan,sendToUsers,applicationData,personalUtilities,preapprovalLoanTerms,$modalInstance,preapprovallettersService,templateId,commonModalWindowFactory,modalWindowType){var _this=this;this.enums=enums;this.NavigationSvc=NavigationSvc;this.$filter=$filter;this.$state=$state;this.simpleModalWindowFactory=simpleModalWindowFactory;this.$modal=$modal;this.wrappedLoan=wrappedLoan;this.$modalInstance=$modalInstance;this.preapprovallettersService=preapprovallettersService;this.commonModalWindowFactory=commonModalWindowFactory;this.modalWindowType=modalWindowType;this.getDateTime=function(){return new Date();};this.close=function(){_this.$modalInstance.dismiss("cancel");};this.send=function(){var palViewModel=new srv.cls.SentPreApprovalLetterHistoryViewModel();palViewModel.loanId=_this.wrappedLoan.ref.loanId;palViewModel.distributeToBorrower=_.some(_this.sendToUsers.borrowers,function(borrower){return borrower.isSelected==true;});palViewModel.distributeToBuyersAgent=_this.sendToUsers.buyersAgent.isSelected;palViewModel.distributeToSellersAgent=_this.sendToUsers.sellersAgent.isSelected;palViewModel.letterLoanAmount=_this.preapprovalLoanTerms[0];palViewModel.letterPurchasePrice=_this.preapprovalLoanTerms[1];palViewModel.expirationDate=_this.preapprovalLoanTerms[2];palViewModel.propertyId=_this.wrappedLoan.ref.getSubjectProperty().propertyId;palViewModel.letterTemplateId=_this.templateId;palViewModel.brandThemeName=_this.applicationData.companyProfile.companyTheme;palViewModel.brandDisplayName=_this.applicationData.companyProfile.companyName;var listSelectedBorrowersForDistribution=_.where(_this.sendToUsers.borrowers,function(x){return x.isSelected==true;});palViewModel.selectedBorrowersForDistribution=_.map(listSelectedBorrowersForDistribution,function(x){return x.id;});palViewModel.userAccountId=_this.applicationData.currentUserId;_this.$modalInstance.dismiss("close");_this.commonModalWindowFactory.open({type:_this.modalWindowType.loader,message:"Sending preapproval letter"});_this.NavigationSvc.SaveAndUpdateWrappedLoan(_this.applicationData.currentUser.userAccountId,_this.wrappedLoan,function(wrappedLoan){_this.preapprovallettersService.send(palViewModel).then(function(response){_this.commonModalWindowFactory.close("close");_this.wrappedLoan.ref.sentPreApprovalLetterHistories.push(response.data);_this.wrappedLoan.ref.currentMilestone=4;},function(error){_this.commonModalWindowFactory.close("close");_this.commonModalWindowFactory.open({type:_this.modalWindowType.error,message:"Error while sending preapproval letter"});});},function(error){_this.commonModalWindowFactory.close("close");},null,false);};this.sendToUsers=sendToUsers;this.applicationData=applicationData;this.preapprovalLoanTerms=preapprovalLoanTerms;this.borrowerCoBorrowerName=personalUtilities.getBorrowerAndCoBorrowerNames(this.wrappedLoan.ref.active.getBorrower(),this.wrappedLoan.ref.active.getCoBorrower(),this.wrappedLoan.ref.active.isSpouseOnTheLoan,this.wrappedLoan.ref.active.isSpouseOnTheTitle,this.wrappedLoan.ref.active.titleInfo.nameOfPartner);this.cityStateZip=this.wrappedLoan.ref.active.getBorrower().getMailingAddress().cityName+" "+this.wrappedLoan.ref.active.getBorrower().getMailingAddress().stateName,this.wrappedLoan.ref.active.getBorrower().getMailingAddress().zipCode;this.occupancyType=_.findWhere(this.wrappedLoan.ref.lookup.occupancyTypeList,{value:this.wrappedLoan.ref.active.occupancyType.toString()});this.propertyType=_.findWhere(this.wrappedLoan.ref.lookup.subjectPropertyTypes,{value:this.wrappedLoan.ref.getSubjectProperty().propertyType});this.templateId=templateId;this.concierge=_.find(this.applicationData.companyEmployees.userAccounts,function(employee){return _this.wrappedLoan.ref.conciergeId==employee.userAccountId;});if(this.concierge!=null&&this.concierge.phones!=null&&this.concierge.phones.length>0){var conciergePhoneWork=_.find(this.concierge.phones,function(p){return p.type=="2";});if(conciergePhoneWork!=null){this.conciergePhone=conciergePhoneWork.number;}else{var conciergePhoneCell=_.find(this.concierge.phones,function(p){return p.type=="1";});if(conciergePhoneCell!=null){this.conciergePhone=conciergePhoneCell.number;}}}}preapprovallettersPreviewModalController.$inject=["enums","NavigationSvc","$filter","$state","simpleModalWindowFactory","$modal","wrappedLoan","sendToUsers","applicationData","personalUtilities","preapprovalLoanTerms","$modalInstance","preapprovallettersService","templateId","commonModalWindowFactory","modalWindowType"];return preapprovallettersPreviewModalController;})();preapprovalletters.preapprovallettersPreviewModalController=preapprovallettersPreviewModalController;angular.module("preapprovalletters").controller("preapprovallettersPreviewModalController",preapprovallettersPreviewModalController);})(preapprovalletters||(preapprovalletters={}));(function(){angular.module("compliancecenter",[]);})();(function(){angular.module("compliancecenter").config(config);config.$inject=["$stateProvider"];function config($stateProvider){$stateProvider.state("loanCenter.loan.compliancecenter",{url:"/compliancecenter",views:{"compliancecenter":{templateUrl:"/angular/compliancecenter/compliancecenter.html",controller:"compliancecenterController as compliancecenterCtrl"}},params:{autoActivateChild:"loanCenter.loan.compliancecenter.auditlog"}});}})();var compliancecenter;(function(compliancecenter){var compliancecenterController=(function(){function compliancecenterController($state,$rootScope,NavigationSvc,enums,wrappedLoan){this.$state=$state;this.$rootScope=$rootScope;this.NavigationSvc=NavigationSvc;this.enums=enums;this.wrappedLoan=wrappedLoan;NavigationSvc.contextualType=enums.ContextualTypes.ComplianceCenter;var vm=this;vm.wrappedLoan=wrappedLoan;$state.go("loanCenter.loan.compliancecenter.auditlog");$rootScope.$on("$stateChangeSuccess",function(event,toState,toParams,fromState,fromParams){if(toState&&toState.params&&toState.params.autoActivateChild){$state.go(toState.params.autoActivateChild);}});}compliancecenterController.$inject=["$state","$rootScope","NavigationSvc","enums","wrappedLoan"];return compliancecenterController;})();compliancecenter.compliancecenterController=compliancecenterController;angular.module("compliancecenter").controller("compliancecenterController",compliancecenterController);})(compliancecenter||(compliancecenter={}));(function(){angular.module("compliancecenter").config(config);config.$inject=["$stateProvider"];function config($stateProvider){$stateProvider.state("loanCenter.loan.compliancecenter.auditlog",{url:"/auditlog",views:{"compliancecenter":{templateUrl:"/angular/compliancecenter/auditlog/auditlog.html",controller:"auditlogController as auditlogCtrl"}},resolve:{auditLogViewModel:resolveAuditLogViewModel},});resolveAuditLogViewModel.$inject=["$rootScope","auditLogSvc"];function resolveAuditLogViewModel($rootScope,auditLogSvc){var userAccountId=$rootScope.SelectedLoan.UserAccountId;var loanId=$rootScope.SelectedLoan.LoanId;return auditLogSvc.getData(loanId,userAccountId);}}})();var compliancecenter;(function(compliancecenter){var auditlogController=(function(){function auditlogController(auditLogViewModel){this.logs=auditLogViewModel;}auditlogController.$inject=["auditLogViewModel",];return auditlogController;})();compliancecenter.auditlogController=auditlogController;angular.module("compliancecenter").controller("auditlogController",auditlogController);})(compliancecenter||(compliancecenter={}));var compliancecenter;(function(compliancecenter){var AuditLogService=(function(){function AuditLogService($http,ApiRoot){this.$http=$http;this.ApiRoot=ApiRoot;}AuditLogService.prototype.getData=function(loanId,userAccountId){var getDataApiUrl=this.ApiRoot+"AuditLog/Get";var parameters={loanId:loanId,userAccountId:userAccountId};var config={params:parameters};return this.$http.get(getDataApiUrl,config).then(function(response){return response.data;});};return AuditLogService;})();factory.$inject=["$http","apiRoot"];function factory($http,apiEndpoint){return new AuditLogService($http,apiEndpoint);}angular.module("compliancecenter").factory("auditLogSvc",factory);})(compliancecenter||(compliancecenter={}));(function(){angular.module("PricingResults",[]);})();(function(){angular.module("PricingResults").factory("pricingResultsSvc",pricingResultsSvc);pricingResultsSvc.$inject=["$resource","apiRoot","$http","$q","$window"];function pricingResultsSvc($resource,apiRoot,$http,$q,$window){var productPath=apiRoot+"ProductCalculator/";var loanPath=apiRoot+"loan/";var pricingResultsApiPath=apiRoot+"PricingResults/";var integrationLogItemApiPath=apiRoot+"PricingResults/GetIntegrationLogItemResponse";var GetIntegrationLogItem=GetIntegrationLogItem;function GetIntegrationLogItem(userAccountId,itemId,type){var request=$http({method:"get",headers:{"Content-type":"text/xml"},url:integrationLogItemApiPath,params:{userAccountId:userAccountId,itemId:itemId,type:type},responseType:"arraybuffer",});return(request.then(handleSuccess,handleError));}function handleError(response){if(!angular.isObject(response.data)||!response.data.message){return($q.reject("Error occurred."));}return($q.reject(response.data.message));}function handleSuccess(response){var file=new Blob([response.data],{type:"text/xml"});var fileURL=URL.createObjectURL(file);$window.open(fileURL);return(response.data);}var PerformProductCalculations=$resource(productPath,{},{PerformProductCalculations:{method:"POST"}});var ApplyLoan=$resource(loanPath+":productId",{productId:"@productId",currentUserId:"@currentUserId",repricing:"@repricing"},{Create:{method:"PUT",url:loanPath+":productId"}});function sortByMultiple(sequence,keys,ascOrder){sequence.sort(function(x,y){var comparison=0;for(var i=0;i<keys.length;++i){comparison=compareBy(x,y,keys[i],ascOrder);if(comparison!==0){return comparison;}}return comparison;});return sequence;}function compareBy(x,y,key,ascOrder){if(x[key]==y[key]){return 0;}if(ascOrder){return x[key]>y[key]?1:-1;}return x[key]<y[key]?1:-1;}var RefreshSmartGFE=$resource(pricingResultsApiPath+"RefreshSmartGFE",{},{Refresh:{method:"POST",url:pricingResultsApiPath+"RefreshSmartGFE"}});var CreateSmartGFE=function(loan){return $http.post(pricingResultsApiPath+"CreateSmartGFE",loan);};var SaveAndSendUserSelectedProductCategories=function(vm){return $http.post(pricingResultsApiPath+"SaveAndSendUserSelectedProductCategories",vm);};var pricingResultsService={PerformProductCalculations:PerformProductCalculations,ApplyLoan:ApplyLoan,sortByMultiple:sortByMultiple,GetIntegrationLogItem:GetIntegrationLogItem,RefreshSmartGFE:RefreshSmartGFE,CreateSmartGFE:CreateSmartGFE,SaveAndSendUserSelectedProductCategories:SaveAndSendUserSelectedProductCategories};return pricingResultsService;}})();(function(){angular.module("PricingResults").controller("pricingResultsController",pricingResultsController);pricingResultsController.$inject=["$window","$scope","$rootScope","$state","$controller","pricingResultsSvc","BroadcastSvc","modalPopoverFactory","wrappedLoan","controllerData","applicationData","enums","NavigationSvc","personalUtilities","$filter","commonModalWindowFactory","modalWindowType","loanEvent","costDetailsHelpers"];function pricingResultsController($window,$scope,$rootScope,$state,$controller,pricingResultsSvc,BroadcastSvc,modalPopoverFactory,wrappedLoan,controllerData,applicationData,enums,NavigationSvc,personalUtilities,$filter,commonModalWindowFactory,modalWindowType,loanEvent,costDetailsHelpers){var vm=this;vm.wrappedLoan=wrappedLoan;vm.applicationData=applicationData;vm.repricing=controllerData.repricing;vm.sortedProductGoupsArray=controllerData.sortedProductGoupsArray,vm.sortedProductsArray=controllerData.sortedProductsArray,vm.sortedProductPricingArray=controllerData.sortedProductPricingArray,vm.shoppingCartIds=controllerData.shoppingCartIds,vm.allProductsGrouped=controllerData.allProductsGrouped;vm.impoundCalculatorResults=null;vm.productListViewModel=wrappedLoan.ref.pricingResults.productListViewModel;vm.dti=wrappedLoan.ref.financialInfo.dti;$scope.$on("BroadcastRepopulatePricingResults",function(event,args){wrappedLoan.ref.pricingResults.productListViewModel=vm.productListViewModel;wrappedLoan.ref.financialInfo.dti=vm.dti;});vm.pricingResultsViewModel={};vm.test="controller"+Date.now();vm.init=init();$rootScope.navigation="ProductAndPricing";vm.collapseExpand=collapseExpand;vm.selectedRow=null;vm.selectedEligibleRow=null;vm.selectRow=selectRow;vm.selectEligibleRow=selectEligibleRow;vm.costType="1";vm.savingsDropdownOption="1";vm.sortingProductGoup={predicate:"rate",reverse:false};vm.groupedProducts={};vm.lockDaysNext=lockDaysNext;vm.lockDaysPrevious=lockDaysPrevious;vm.shoppingCartKeys=[];vm.utilities={keys:Object.keys};vm.viewDetailedClosingCost=viewDetailedClosingCost;vm.openClosingCostMenu=openClosingCostMenu;vm.openLifeOfLoanMenu=openLifeOfLoanMenu;vm.openIntegrationXmlMenu=openIntegrationXmlMenu;vm.openPricePercentageOrPoints=openPricePercentageOrPoints;vm.priceDisplayType="points";vm.applyProduct=applyProduct;var productRowExpanded=false;NavigationSvc.contextualType=enums.ContextualTypes.PricingResults;vm.openSavingsCalculationsModal=openSavingsCalculationsModal;function applyProduct(product){if(wrappedLoan.ref.active.getBorrower()){wrappedLoan.ref.active.getBorrower().userAccount.currentUserAccountId=applicationData.currentUserId;}commonModalWindowFactory.open({type:modalWindowType.loader,message:"Adding Loan Product..."});pricingResultsSvc.ApplyLoan.Create({productId:product.productId,currentUserId:vm.applicationData.currentUserId,repricing:vm.repricing},wrappedLoan.ref).$promise.then(function(data){if(vm.repricing){vm.wrappedLoan.ref=new cls.LoanViewModel(data,$filter);costDetailsHelpers.initializeCostService(wrappedLoan);costDetailsHelpers.getCostDetailsData();if(angular.element(document.getElementById("divMainNavBar")).scope()!=undefined){angular.element(document.getElementById("divMainNavBar")).scope().updateValuesOnRowChangeNEW(vm.wrappedLoan.ref.loanId);}loanEvent.broadcastPropertyChangedEvent(events.LoanFieldIdentifier.todo,{});$state.go("loanCenter.loan.loanDetails.sections",{"repricing":true},{reload:false});}else{if(angular.element(document.getElementById("divMainNavBar")).scope()!=undefined){angular.element(document.getElementById("divMainNavBar")).scope().updateValuesOnRowChangeNEW(data.loanId);}$rootScope.SelectedLoan.LoanId=data.loanId;NavigationSvc.setPersonalAsActiveAndRedirect(true,data.loanId);}});NavigationSvc.lastRepricing.timestamp=new Date().getTime();}$scope.$on("$viewContentLoaded",function(event){$window.scrollTo(0,0);});vm.registerProduct=registerProduct;vm.lockDaysLimit={min:0,max:2};function init(){if(vm.sortedProductPricingArray&&Object.keys(vm.sortedProductPricingArray).length>0){var group=vm.sortedProductPricingArray[Object.keys(vm.sortedProductPricingArray)[0]];var product=group[Object.keys(group)[0]];var pricing=product[0];if(wrappedLoan.ref.pricingResults.productListViewModel.feeProvider==1&&wrappedLoan.ref.otherInterviewData.selectedETPCOption!="0"&&wrappedLoan.ref.otherInterviewData.selectedETPCOption!="1"){var filteredThirdPartyCosts=pricing.costDetails.thirdPartyCosts.filter(function(c){return c.hudLineNumber!=804;});if(filteredThirdPartyCosts&&filteredThirdPartyCosts.length==0){commonModalWindowFactory.open({type:modalWindowType.error,message:"We are unable to calculate your closing costs because we were unable to obtain current fees."});}}BroadcastSvc.broadcastSelectedProduct(pricing);}}function registerProduct(product){var array=vm.sortedProductPricingArray[product.productType][product.productName];if(product.register){if(!array.map(function(e){return e.productId==product.productId;})[0]){if(!product.costDetails){product.originalPricingQuery=wrappedLoan.ref.pricingResults.productListViewModel.originalPricingQuery;product.adjustments=vm.sortedProductPricingArray[product.productType][product.productName][0].adjustments;pricingResultsSvc.PerformProductCalculations.PerformProductCalculations({},{product:product,otherInterviewData:wrappedLoan.ref.otherInterviewData}).$promise.then(function(data){product.costDetails=data.costDetails;product.paymentBreakdownModalVM=data.paymentBreakdownModalVM;product.originalPricingQuery=null;product.closingCosts=data.closingCosts;updateCostsFromImpoundCalculator(product,vm.impoundCalculatorResults);array.push(product);});}else{array.push(product);}}}else{if(array.length>1){array=array.splice(array.map(function(p){return p.productId;}).indexOf(product.productId),1);}}}function collapseExpand(product){product.productRowExpanded=!product.productRowExpanded;}function selectEligibleRow(index,event,product){if(event!=undefined&&event.target.attributes["class"].value.indexOf("imp-sa-grid-row-collaps")>-1){return;}vm.selectedEligibleRow=index;BroadcastSvc.broadcastSelectedProduct(product);}function selectRow(index,event){if(event!=undefined&&event.target.attributes["class"].value.indexOf("imp-sa-grid-row-collaps")>-1){return;}vm.selectedRow=index;}$scope.$on("ImpoundsChanged",function(event,args){vm.impoundCalculatorResults=args;vm.wrappedLoan.ref.housingExpenses.newHoa=args.HOAExpens.amountPerMonth;if(!vm.repricing){vm.wrappedLoan.ref.closingCost.costs=args.costs;var j;for(j=0;j<vm.wrappedLoan.ref.closingCost.costs.length;j++){vm.wrappedLoan.ref.closingCost.costs[j].amount=vm.wrappedLoan.ref.closingCost.costs[j].monthsToBePaid*vm.wrappedLoan.ref.closingCost.costs[j].amountPerMonth;}}else{var k;for(k=0;k<args.costs.length;k++){var taxExists=_.where(vm.wrappedLoan.ref.closingCost.costs,{hudLineNumber:args.costs[k].hudLineNumber}).length>0;if(!taxExists){vm.wrappedLoan.ref.closingCost.costs.push(_.where(args.costs,{hudLineNumber:args.costs[k].hudLineNumber})[0]);}else{var oldCost=_.where(vm.wrappedLoan.ref.closingCost.costs,{hudLineNumber:args.costs[k].hudLineNumber})[0];oldCost.amountPerMonth=args.costs[k].amountPerMonth;oldCost.monthsToBePaid=args.costs[k].monthsToBePaid;oldCost.amount=args.costs[k].amountPerMonth*args.costs[k].monthsToBePaid;oldCost.percent=args.costs[k].percent;oldCost.impounded=args.costs[k].impounded;resetCosts(oldCost);}}}for(var group in vm.sortedProductPricingArray){if(vm.sortedProductPricingArray.hasOwnProperty(group)){for(var product in vm.sortedProductPricingArray[group]){if(vm.sortedProductPricingArray[group].hasOwnProperty(product)){for(var pricing in vm.sortedProductPricingArray[group][product]){if(vm.sortedProductPricingArray[group][product].hasOwnProperty(pricing)){if(vm.sortedProductPricingArray[group][product][pricing].productId){updateCostsFromImpoundCalculator(vm.sortedProductPricingArray[group][product][pricing],args);}}}}}}}});function resetCosts(cost){costDetailsHelpers.resetRightSectionAmounts(cost);cost.borrowerPaid.atClosing=costDetailsHelpers.calculateBorrowerPTCAmount(cost,vm.wrappedLoan.ref.closingDate.dateValue);}function updateCostsFromImpoundCalculator(product,args){if(!args){return;}var costDetails=product.costDetails;var paymentBreakdown=product.paymentBreakdownModalVM;var sum=0;var i;for(i=0;i<costDetails.reservesCosts.length;i++){var old=costDetails.reservesCosts[i];var calc=_.where(args.costs,{hudLineNumber:old.hudLineNumber})[0];old.amountPerMonth=calc.amountPerMonth;old.amount=calc.impounded?calc.amountPerMonth*calc.monthsToBePaid:0;old.percent=calc.percent;old.impounded=calc.impounded;old.upfrontPreferredPaymentPeriod=calc.upfrontPreferredPaymentPeriod;old.amountMethod=calc.amountMethod;resetCosts(old);if(old.hudLineNumber==1004){paymentBreakdown.taxesMonthlyAmount=old.amountPerMonth;paymentBreakdown.taxesMonthlyAmountPercent=old.percent;}if(old.hudLineNumber==1002){paymentBreakdown.insuranceMonthlyAmount=old.amountPerMonth;paymentBreakdown.insuranceMonthlyAmountPercent=old.percent;var annualHoi=_.where(costDetails.prepaidCosts,{hudLineNumber:903})[0];if(annualHoi){annualHoi.amount=old.amountPerMonth*12;annualHoi.percent=old.percent;}}if(old.hudLineNumber==1003){paymentBreakdown.mip=old.amountPerMonth;paymentBreakdown.mipPercent=old.percent;}sum=sum+old.amount;}paymentBreakdown.totalMonthlyPayment=paymentBreakdown.principalAndInterest+paymentBreakdown.taxesMonthlyAmount+paymentBreakdown.insuranceMonthlyAmount+paymentBreakdown.mip;costDetails.totalReserves=sum;costDetails.reservesAndPrepaids=costDetails.totalPrepaids+costDetails.totalReserves;costDetails.thirdPartyPrepaidsAndReserves=(costDetails.totalEstimatedClosingCosts+costDetails.totalPrepaids+costDetails.totalReserves);}function lockDaysNext(length){if(vm.lockDaysLimit.max<length-1){vm.lockDaysLimit.min=vm.lockDaysLimit.min+1;vm.lockDaysLimit.max=vm.lockDaysLimit.max+1;}}function lockDaysPrevious(){if(vm.lockDaysLimit.min>0){vm.lockDaysLimit.min=vm.lockDaysLimit.min-1;vm.lockDaysLimit.max=vm.lockDaysLimit.max-1;}}function openClosingCostMenu(event,product){var menuPopup=modalPopoverFactory.openModalPopover("angular/pricingresults/sections/closingcostoptions.html",{},{},event,{className:"tooltip-arrow-display-non",horisontalPopupPositionPerWidth:0.2});menuPopup.result.then(function(data){vm.costType=data.model;});}function openLifeOfLoanMenu(event,product){var menuPopup=modalPopoverFactory.openModalPopover("angular/pricingresults/sections/lifeofloanoptions.html",{},this,event,{className:"tooltip-arrow-display-non",horisontalPopupPositionPerWidth:0.5});menuPopup.result.then(function(data){vm.savingsDropdownOption=data.model;});}function openPricePercentageOrPoints(event,product){var menuPopup=modalPopoverFactory.openModalPopover("angular/pricingresults/sections/pricepercentagespoints.html",{},{},event,{className:"tooltip-arrow-display-non",horisontalPopupPositionPerWidth:0.2});menuPopup.result.then(function(data){vm.priceDisplayType=data.model;});}function openIntegrationXmlMenu(event,product){var menuPopup=modalPopoverFactory.openModalPopover("angular/pricingresults/sections/integrationsxmloptions.html",{},{},event,{className:"tooltip-arrow-display-non",horisontalPopupPositionPerWidth:0.2});menuPopup.result.then(function(data){});}function viewDetailedClosingCost(event,costDetails){vm.currentCell=event.currentTarget;vm.currentCell.className+=" cost-cell-on-popup-open";costDetails.showPrepaidDescriptions=false;costDetails.showReservesDescriptions=false;var detailedClosingCostPopup=modalPopoverFactory.openModalPopover("angular/pricingresults/sections/detailedclosingcosts.html",{},costDetails,event,{className:"tooltip-arrow-right-cost-details",verticalPopupPositionPerHeight:0,horisontalPopupPositionPerWidth:0.695});detailedClosingCostPopup.result.then(function(data){console.log(vm.currentCell);},function(){vm.currentCell.className=vm.currentCell.className.replace(" cost-cell-on-popup-open","");});}vm.openIntegrationXmlMenu=openIntegrationXmlMenu;function openIntegrationXmlMenu(event,logListItem,logType){var detailedClosingCostPopup=modalPopoverFactory.openModalPopover("angular/pricingresults/sections/integrationsxmloptions.html",{getIntegrationItem:vm.getIntegrationItem},{logListItem:logListItem,logType:logType},event,{className:"tooltip-arrow-integration-logs",calculateVerticalPositionFromTopBorder:true,verticalPopupPositionPerHeight:1,horisontalPopupPositionPerWidth:0.5});detailedClosingCostPopup.result.then(function(data){},function(){});}vm.getIntegrationItem=getIntegrationItem;function getIntegrationItem(itemId,logType){var result=pricingResultsSvc.GetIntegrationLogItem(vm.wrappedLoan.ref.active.getBorrower().userAccount.userAccountId,itemId,logType);}function openSavingsCalculationsModal(){modalPopoverFactory.openModalPopover("angular/pricingresults/other/savingscalculationsmodal.html",{},{},event,{className:"tooltip-arrow-right-savings-calculations",verticalPopupPositionPerHeight:-0.04,horisontalPopupPositionPerWidth:0.542});}}})();(function(){angular.module("PricingResults").provider("pricingResultsResolver",pricingResultsResolver);function pricingResultsResolver(){this.$get=function(){return resolver;};function resolver(wrappedLoan,pricingResultsSvc,$stateParams){var sortedProductGoupsArray=[];var sortedProductsArray={};var sortedProductPricingArray={};var mainGroupArray=[];var byFirst=_.groupBy(wrappedLoan.ref.pricingResults.productListViewModel.eligibleProducts,"productType");for(var prop in byFirst){var productSubRows=[];var bySecond=_.groupBy(byFirst[prop],"productName");for(var propSec in bySecond){var productPricingArray=bySecond[propSec];pricingResultsSvc.sortByMultiple(productPricingArray,["rate","priceAmount"],true);if(sortedProductPricingArray[prop]==undefined){sortedProductPricingArray[prop]={};}sortedProductPricingArray[prop][propSec]=productPricingArray;productSubRows.push(productPricingArray[0]);}pricingResultsSvc.sortByMultiple(productSubRows,["rate","priceAmount"],true);sortedProductsArray[prop]=productSubRows;mainGroupArray.push(productSubRows[0]);}pricingResultsSvc.sortByMultiple(mainGroupArray,["loanAmortizationFixedTerm","rate","priceAmount"],false);sortedProductGoupsArray=mainGroupArray;var sortDirectionAndProperty={};sortDirectionAndProperty.propertyName="DefaultSorting";sortDirectionAndProperty.asc=false;var shoppingCartIds=wrappedLoan.ref.pricingResults.productListViewModel.eligibleProducts.map(function(p){return p.productId;});_.each(wrappedLoan.ref.pricingResults.productListViewModel.allProducts,function(p){if(_.contains(shoppingCartIds,p.productId)){p.register=true;var prod=_.find(wrappedLoan.ref.pricingResults.productListViewModel.eligibleProducts,function(r){return p.productId==r.productId;});p.costDetails=prod.costDetails;}});var allProductsGrouped=_.groupByMulti(wrappedLoan.ref.pricingResults.productListViewModel.allProducts,["productIndex","rate","days"]);var service={sortedProductGoupsArray:sortedProductGoupsArray,sortedProductsArray:sortedProductsArray,sortedProductPricingArray:sortedProductPricingArray,sortDirectionAndProperty:sortDirectionAndProperty,shoppingCartIds:shoppingCartIds,allProductsGrouped:allProductsGrouped,repricing:($stateParams["repricing"]==true)};return service;}}})();(function(){angular.module("uploadFiles",[]);})();(function(){angular.module("uploadFiles").controller("uploadFilesController",uploadFilesController);uploadFilesController.$inject=["$log","$modal","enums","uploadFilesSvc","blockUI"];function uploadFilesController($log,$modal,enums,uploadFilesSvc,blockUI){var vm=this;vm.files=[];vm.deleteFile=deleteFile;vm.uploadFiles=uploadFiles;function deleteFile(index){vm.files.splice(index,1);if(vm.uploadDocumentsError){validateFilesSizeAndExtension();}}function uploadFiles(modalpopoverCtrl){vm.uploadDocumentsError=false;validateFilesSizeAndExtension();if(!vm.uploadDocumentsError){vm.savingDataInProgress=true;blockUI.start("Uploading files..");uploadFilesSvc.uploadFiles(modalpopoverCtrl.ctrl.loanId,modalpopoverCtrl.ctrl.userAccountId,modalpopoverCtrl.ctrl.borrowerId,modalpopoverCtrl.ctrl.documentCategoryId,vm.files).then(function(data){vm.savingDataInProgress=false;blockUI.stop();modalpopoverCtrl.done();},function(error){$log.error("Failure uploading files",error);vm.savingDataInProgress=false;blockUI.stop();});}}function validateFilesSizeAndExtension(){var supportedExtensions=_.values(enums.DocumentContentType);for(var i=0;i<vm.files.length;i++){if(vm.files[i].size>48*1024*1024||!_.contains(supportedExtensions,getFileExtension(vm.files[i].name.toLowerCase()))){vm.files[i].invalid=true;}}if(_.some(vm.files,function(file){return file.invalid==true;})){vm.uploadDocumentsError=true;}else{vm.uploadDocumentsError=false;}}function getFileExtension(filename){return filename.split(".").pop();}}})();(function(){angular.module("uploadFiles").factory("uploadFilesSvc",uploadFilesSvc);uploadFilesSvc.$inject=["$http","apiRoot"];function uploadFilesSvc($http,ApiRoot){var uploadFilesApiPath=ApiRoot+"Document/";function uploadFiles(loanId,userAccountId,borrowerId,documentCategoryId,files){var fd=new FormData();if(loanId){fd.append("loanId",loanId);}if(userAccountId){fd.append("userAccountId",userAccountId);}if(borrowerId){fd.append("borrowerId",borrowerId);}if(documentCategoryId){fd.append("documentCategoryId",documentCategoryId);}for(var i in files){fd.append("file",files[i]);}return $http.post(uploadFilesApiPath,fd,{transformRequest:angular.identity,headers:{"Content-Type":undefined}}).success(function(data){}).error(function(){});}var uploadFilesService={uploadFiles:uploadFiles};return uploadFilesService;}})();(function(){angular.module("uploadFiles").controller("importFnmController",importFnmController);importFnmController.$inject=["$log","$scope","$modal","$state","applicationData","enums","importFnmSvc","uploadFilesSvc","blockUI","importFnmParams","$modalInstance"];function importFnmController($log,$scope,$modal,$state,applicationData,enums,importFnmSvc,uploadFilesSvc,blockUI,importFnmParams,$modalInstance){var vm=this;vm.files=[];vm.deleteFile=deleteFile;vm.selectPrimaryFNM=selectPrimaryFNM;vm.getFileExtension=getFileExtension;vm.markFirstAsPrimaryFNM=markFirstAsPrimaryFNM;vm.close=close;vm.importFnmParams=importFnmParams;vm.fnmUploadAndReview=fnmUploadAndReview;function deleteFile(index){vm.files.splice(index,1);markFirstAsPrimaryFNM();if(vm.uploadDocumentsError){validateFilesSizeAndExtension();}}function fnmUploadAndReview(){vm.uploadDocumentsError=false;vm.fnmPrimary=_.findWhere(vm.files,function(item){return(getFileExtension(item.name.toLowerCase())==="fnm"&&item.isPrimary);});vm.fnmNonPrimary=_.filter(vm.files,function(item){return(getFileExtension(item.name.toLowerCase())==="fnm"&&!item.isPrimary);});vm.documents=_.filter(vm.files,function(item){return getFileExtension(item.name.toLowerCase())!="fnm";});if(!vm.uploadDocumentsError){$modalInstance.close();if(vm.fnmPrimary){vm.importingLoanInProgress=true;blockUI.start("Importing loan...");importFnmSvc.uploadFnm(null,applicationData.companyProfile.companyProfileId,applicationData.currentUser.userAccountId,vm.fnmPrimary).then(function(result){if(vm.documents.length>0){vm.savingDataInProgress=true;uploadFilesSvc.uploadFiles(result.data,applicationData.currentUser.userAccountId,vm.documents).then(function(docResults){vm.savingDataInProgress=false;blockUI.stop();$state.go("loanCenter.loan.loanApplication.personal",{"loanId":result.data,"loanPurposeType":null},{reload:true});},function(error){$log.error("Failure Uploading files",error);vm.savingDataInProgress=false;blockUI.stop();});vm.importingLoanInProgress=false;}else{blockUI.stop();$state.go("loanCenter.loan.loanApplication.personal",{"loanId":result.data,"loanPurposeType":null},{reload:true});}},function(error){$log.error("Failure Importing Primary FNM",error);vm.importingLoanInProgress=false;blockUI.stop();});}else{if(vm.documents.length>0){vm.savingDataInProgress=true;blockUI.start("Uploading files...");uploadFilesSvc.uploadFiles($scope.selectedLoanId,$scope.userAccountId,vm.documents).then(function(result){vm.savingDataInProgress=false;blockUI.stop();$state.go($state.current,{"loanId":$scope.selectedLoanId,"loanPurposeType":null},{reload:true});},function(error){$log.error("Failure Uploading files",error);vm.savingDataInProgress=false;blockUI.stop();});}}}}function uploadDocuments(loanId,userAccountId,files){vm.savingDataInProgress=true;blockUI.start("Uploading files...");uploadFilesSvc.uploadFiles(loanId,userAccountId,files).then(function(result){},function(error){$log.error("Failure Uploading files",error);vm.savingDataInProgress=false;blockUI.stop();});}function getFileExtension(filename){return filename.split(".").pop();}function selectPrimaryFNM(index){for(var i=0;i<vm.files.length;i++){if(vm.files[i]!=vm.files[index]){vm.files[i].isPrimary=false;}}vm.files[index].isPrimary=true;}function markFirstAsPrimaryFNM(){for(var i=0;i<vm.files.length;i++){if(vm.files[i].isPrimary){return;}}for(var i=0;i<vm.files.length;i++){if(getFileExtension(vm.files[i].name.toLowerCase())=="fnm"){vm.files[i].isPrimary=true;break;}}}function close(){$modalInstance.dismiss("cancel");}}})();(function(){angular.module("uploadFiles").factory("importFnmSvc",importFnmSvc);importFnmSvc.$inject=["$http","apiRoot","$state","$modal"];function importFnmSvc($http,ApiRoot,$state,$modal){var importFnmApiPath=ApiRoot+"FNMImport/";function uploadFnm(loanId,companyProfileId,userAccountId,files){var fd=new FormData();if(loanId){fd.append("loanId",loanId);}if(companyProfileId){fd.append("companyProfileId",companyProfileId);}if(userAccountId){fd.append("userAccountId",userAccountId);}if(files.length){for(var i in files){fd.append("file",files[i]);}}else{fd.append("file",files);}return $http.post(importFnmApiPath,fd,{transformRequest:angular.identity,headers:{"Content-Type":undefined}}).success(function(data){}).error(function(){});}function openImportLoanModal(applicationData,loanExists,emptyLoanOnCancel,loanPurposeType){var importFnmParams;if(loanExists){importFnmParams={title:"Add FNM 3.2 Files to Loan",preSelectPrimaryFnm:false};}else{importFnmParams={title:"Create New Loan",preSelectPrimaryFnm:true};}var importLoanModal=$modal.open({templateUrl:"angular/common/uploadfiles/importfnmfiles.html",backdrop:"static",windowClass:"imp-reference-modal upload-files-modal",controller:"importFnmController",controllerAs:"importFnmCtrl",resolve:{importFnmParams:function(){return importFnmParams;},applicationData:function(){return applicationData;},}});importLoanModal.result.then(function(){},function(){if(emptyLoanOnCancel){$state.go("loanCenter.loan.loanApplication.personal",{loanId:null,loanPurposeType:loanPurposeType},{reload:true});}});}var importFnmService={uploadFnm:uploadFnm,openImportLoanModal:openImportLoanModal};return importFnmService;}})();(function(){angular.module("queue",["angularGrid"]);})();(function(){angular.module("queue").factory("queueSvc",queueSvc);queueSvc.$inject=["$resource","apiRoot"];function queueSvc($resource,apiRoot){var queueApiPath=apiRoot+"queue/";var dates=["dateModified","dateCreated","creditExpirationDate","loanApplicationDate","lockExpireDate","closingDate","disclosureDate","eConsentDate","itpDate","appraisalRequestedDate","appraisalInspectionDate","appraisalExpectedDeliveryDate","appraisalOrderStatusDate","appraisalOrderedDate","appraisalDeliveredDate","disclosureDueDate","adverseReasonDate"];function queue(){return $resource(queueApiPath,{},{"get":{method:"GET",transformResponse:transformResponse}});}function transformResponse(data){var result=JSON.parse(data,transformDate);return result;}function transformDate(key,value){if(dates.indexOf(key)>-1&&value){return new moment(value);}else{return value;}}var queueService={queue:queue};return queueService;}})();(function(){angular.module("queue").provider("queueResolver",queueResolver);function queueResolver(){this.$get=function(){return resolver;};function resolver(queueSvc,$stateParams,blockUI,userAccount,enums){blockUI.start("Loading list...");var result={};if(userAccount.hasPrivilege(enums.privileges.ViewStandardList)&&!$stateParams.queue){setStateParams(enums.myListQueue.openLoans,"My Pipeline");}else{if(userAccount.hasPrivilege(enums.privileges.ViewAppraisalLists)&&!$stateParams.queue){setStateParams(enums.myListQueue.orderRequested,"Order Requested");}}result=queueSvc.queue().get({currentUserId:userAccount.userAccountId,queue:$stateParams.queue}).$promise.then(function(data){var i;for(i=0;i<data.list.length;i++){data.list[i].number=i+1;}blockUI.stop();return data;},function(error){blockUI.stop();return{list:[],error:true};});function setStateParams(queue,name){$stateParams.queue=queue;$stateParams.queueTitle=name;}return result;}}})();(function(){angular.module("queue").controller("queueController",queueController);queueController.$inject=["$window","$log","$scope","$rootScope","$state","$stateParams","queueSvc","NavigationSvc","modalPopoverFactory","BroadcastSvc","enums","controllerData","applicationData","commonModalWindowFactory","modalWindowType","$timeout","blockUI"];function queueController($window,$log,$scope,$rootScope,$state,$stateParams,queueSvc,NavigationSvc,modalPopoverFactory,BroadcastSvc,enums,controllerData,applicationData,commonModalWindowFactory,modalWindowType,$timeout,blockUI){$rootScope.navigation="Queue";var vm=this;vm.recordItems=[{name:"250 Records",value:250},{name:"500 Records",value:500},{name:"1000 Records",value:1000},{name:"All Records",value:100000}];vm.displaySizeItem=1;vm.filterNumberOfRecordsInTheGrid=filterNumberOfRecordsInTheGrid;vm.onGridSizeChange=onGridSizeChange;vm.applicationData=applicationData;vm.queueItems=controllerData.list;vm.openMultiBorrowerModal=openMultiBorrowerModal;var _searchCounter=0;var _searchCounterLastReceived=0;var _filterTextTimeout;var _tempfilterValue={};var _filterValue={};vm.showGridLoader=false;NavigationSvc.contextualType=enums.ContextualTypes.Queue;vm.gridData=[];filterNumberOfRecordsInTheGrid(vm.recordItems[0],false);(function(){BroadcastSvc.broadcastQueueSizeChanged(vm.queueItems.length);if(vm.queueItems.length==0&&controllerData.error){commonModalWindowFactory.open({type:modalWindowType.error,message:"We are unable to retrieve loans for this queue at the moment. Please try again later."});}else{if(vm.queueItems.length==0&&!controllerData.error){commonModalWindowFactory.open({type:modalWindowType.error,message:"There are no any loans in this queue at the moment."});}}})();var queueColumnDefs=createColumnDefs($stateParams.queue);$scope.gridOptions={columnDefs:queueColumnDefs,rowSelection:"single",enableSorting:true,rowData:vm.gridData,rowSelected:rowSelected,enableFilter:true,enableColResize:true,dontUseScrolls:false,angularCompileFilters:true,angularCompileRows:true,icons:{menu:'<i class="ag-filter-icon"/>',sortAscending:"<i/>",sortDescending:"<i/>",filter:"<i/>"}};angular.element($window).bind("resize",function(){$scope.$digest();});$scope.$on("BroadcastRefreshGridColumns",function(event){$scope.gridOptions.columnDefs=createColumnDefs($stateParams.queue,applicationData);$scope.gridOptions.api.onNewCols();});$scope.$on("BroadcastClearAllFilter",function(event){vm.loanNumberFilter="";vm.borrowerNameFilter="";$state.go("loanCenter.queue",{"queue":$stateParams.queue,"queueTitle":$stateParams.queueTitle},{reload:true});});$scope.$on("BroadcastRefreshQueue",function(event){getFilteredData();});function getFilteredData(){if(_filterTextTimeout){$timeout.cancel(_filterTextTimeout);}_tempfilterValue.loanNumberFilter=vm.loanNumberFilter?vm.loanNumberFilter:"";_tempfilterValue.borrowerNameFilter=vm.borrowerNameFilter?vm.borrowerNameFilter:"";_tempfilterValue.counter=_searchCounter;_filterTextTimeout=$timeout(function(){_searchCounter=_searchCounter+1;_filterValue=_tempfilterValue;console.log(" SENT _filterValue ",_filterValue);vm.showGridLoader=true;queueSvc.queue().get({currentUserId:applicationData.currentUserId,queue:$stateParams.queue,loanNumberFilter:_filterValue.loanNumberFilter,borrowerNameFilter:_filterValue.borrowerNameFilter,counter:_filterValue.counter}).$promise.then(function(data){if(data.searchCounter>=_searchCounterLastReceived){_searchCounterLastReceived=data.searchCounter;var i;for(i=0;i<data.list.length;i++){data.list[i].number=i+1;}createNewDatasource(data.list);BroadcastSvc.broadcastQueueSizeChanged(data.list.length);console.log("REC data.SearchCounter "+data.searchCounter+" - Applied");}else{console.log("REC data.SearchCounter "+data.searchCounter+" - Ignored");}vm.showGridLoader=false;},function(error){console.log("Error: Unable to retrieve filtered data!");vm.showGridLoader=false;});},300);}function createNewDatasource(filteredData){var dataSource={getRows:function(params){params.successCallback(filteredData,filteredData.length);}};$scope.gridOptions.api.setDatasource(dataSource);}function BorrowerNameFilter(){}BorrowerNameFilter.prototype.init=function(params){this.$scope=params.$scope;this.$scope.onFilterChanged=function(borrowerNameFilter){vm.borrowerNameFilter=borrowerNameFilter;getFilteredData();params.filterChangedCallback();};this.valueGetter=params.valueGetter;};BorrowerNameFilter.prototype.getGui=function(){return'<div style="width: 170px;">'+'<div style="font-weight: bold; padding: 4px;">Borrower Name Search</div>'+'<div style="font-weight: bold; border-top: 1px solid #9D9D9D; width:100%; height:1px;">&nbsp</div>'+'<div><input style="margin: 4px 0px 4px 4px; width: 151px" type="text" ng-model="borrowerNameFilter" ng-change="onFilterChanged(borrowerNameFilter)" placeholder="Search..."/></div>'+"</div>";};BorrowerNameFilter.prototype.doesFilterPass=function(params){return true;};BorrowerNameFilter.prototype.isFilterActive=function(){var value=this.$scope.borrowerNameFilter;return value!==null&&value!==undefined&&value!=="";};function LoanFilter(){}LoanFilter.prototype.init=function(params){this.$scope=params.$scope;this.$scope.onFilterChanged=function(loanNumberFilter){vm.loanNumberFilter=loanNumberFilter;getFilteredData();params.filterChangedCallback();};this.valueGetter=params.valueGetter;};LoanFilter.prototype.getGui=function(){return'<div style="width: 170px;">'+'<div style="font-weight: bold; padding: 4px;">Loan Number Search</div>'+'<div style="font-weight: bold; border-top: 1px solid #9D9D9D; width:100%; height:1px;">&nbsp</div>'+'<div><input style="margin: 4px 0px 4px 4px; width: 151px;" type="text" ng-model="loanNumberFilter" ng-change="onFilterChanged(loanNumberFilter)" placeholder="Search..."/></div>'+"</div>";};LoanFilter.prototype.doesFilterPass=function(params){return true;};LoanFilter.prototype.isFilterActive=function(){var value=this.$scope.loanNumberFilter;return value!==null&&value!==undefined&&value!=="";};function rowSelected(row){if(angular.element(document.getElementById("divMainNavBar")).scope()!=undefined){angular.element(document.getElementById("divMainNavBar")).scope().prepareLoanOnRowSelect(row.loanId);}}function displayNameCellRenderer(params){if(!params.data.borrowerFirstName&&!params.data.borrowerLastName){return null;}else{if(!params.data.borrowerFirstName&&params.data.borrowerLastName){return params.data.borrowerLastName;}else{if(params.data.borrowerFirstName&&!params.data.borrowerLastName){return null;}else{params.api.rowRenderer.$scope.openMultiBorrowerModal=vm.openMultiBorrowerModal;var retVal='<div class="borrower-names" style="text-overflow: ellipsis; overflow: hidden;">'+'<span ng-click="openMultiBorrowerModal(data.borrowerNames, $event)" ng-show="'+params.data.isMultiBorrowerLoan+'" class="imp-multiborrower-icon"></span>'+'<span style="text-align: left;" >';if($stateParams.queue==4&&(params.data.conciergeFullName==""||params.data.conciergeFullName==null||params.data.conciergeFullName=="Pending")){retVal+="<b>"+params.data.borrowerLastName+"</b>";}else{retVal+=params.data.borrowerLastName;}return retVal+='<span style="color: #9d9d9d">, '+params.data.borrowerFirstName+"</span></span></div>";}}}}function loanStatusCellRenderer(params){if(params.data.isMilestoneStatusManual){return'<div style="font-style:italic">'+params.data.milestoneStatus+"</div>";}return params.data.milestoneStatus;}function openMultiBorrowerModal(borrowerNames,event){modalPopoverFactory.openModalPopover("angular/queue/other/multiBorrowerModal.html",{},borrowerNames,event);}function onGridSizeChange(item){vm.displaySizeItem=item;var grid=document.getElementById("angularGrid");if(vm.displaySizeItem.value==1){if(grid){grid.style.width="1300px";}}else{if(grid){grid.style.width="1500px";}}}function cellClickedHandler(row){var loanId=row.data.loanId;if(row.data.parentLoanId){loanId=row.data.parentLoanId;}if(angular.element(document.getElementById("divMainNavBar")).scope()!=undefined){angular.element(document.getElementById("divMainNavBar")).scope().updateValuesOnRowChangeNEW(loanId);}if(!(isNaN(parseFloat(row.data.loanNumber)))){if(applicationData.currentUser.hasPrivilege(enums.privileges.ViewStandardList)){$state.go("loanCenter.loan.loanDetails.sections",{"loanId":loanId},{reload:true});}else{if(applicationData.currentUser.hasPrivilege(enums.privileges.ViewAppraisalLists)){$state.go("loanCenter.loan.appraisal",{"loanId":loanId},{reload:true});}else{}}}else{$state.go("loanCenter.loan.loanApplication.personal",{"loanId":loanId},{reload:true});}}function dueDateClickedHandler(row){if(angular.element(document.getElementById("divMainNavBar")).scope()!=undefined){angular.element(document.getElementById("divMainNavBar")).scope().updateValuesOnRowChangeNEW(row.data.parentLoanId);}if($state.params.queue==enums.myListQueue.mailRoom){$state.go("loanCenter.workbench.mailroom",{"loanId":row.data.loanId,"parentLoanId":row.data.parentLoanId,"disclosureDueDate":row.data.disclosureDueDate._i},{reload:true});}else{$state.go("loanCenter.loan.documents.docvault",{"loanId":row.data.loanId},{reload:true});}}function dateComparator(date1,date2){return(date1==date2?0:(date1>date2?1:-1));}function dateRenderer(params){return params.data[params.colDef.field]?params.data[params.colDef.field].format("MM/DD/YY"):null;}function dateTimeRenderer(params){return params.data[params.colDef.field]?params.data[params.colDef.field].format("MM/DD/YY hh:mm a"):null;}function currencyRenderer(params){return params.data[params.colDef.field]?params.data[params.colDef.field].toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,"):null;}function threeDecimalRenderer(params){return params.data[params.colDef.field]?params.data[params.colDef.field].toFixed(3):null;}function filterNumberOfRecordsInTheGrid(item,refreshGrid){vm.displayRecordItem=item;var numberOfRecordsToDisplay=vm.queueItems.length;if(vm.displayRecordItem.value<numberOfRecordsToDisplay){numberOfRecordsToDisplay=vm.displayRecordItem.value;}vm.gridData.splice(0,vm.gridData.length);var i;for(i=0;i<numberOfRecordsToDisplay;i++){vm.gridData.push(vm.queueItems[i]);}if(refreshGrid&&$scope.gridOptions!=undefined){$scope.gridOptions.api.onNewRows();}}function createColumnDefs(queue){addColumnsToApplicationDataIfNotExists(queue);var colDefs=bindQueueColumnDefs(queue);return colDefs;}function addColumnsToApplicationDataIfNotExists(queue){if(!applicationData.allQueueColumns){applicationData.allQueueColumns=getAllQueueColumns();}if(!applicationData.queueColumns){applicationData.queueColumns=[];}var inApplicationData;angular.forEach(applicationData.queueColumns,function(columns){if(columns.queue==queue){inApplicationData=true;}});if(!inApplicationData){applicationData.queueColumns.push(getColumnsForQueue(queue));}}function bindQueueColumnDefs(queue){var columnDefs=[];columnDefs.push({headerName:"",field:"number",width:40,icons:{menu:"<i/>"},headerClass:"ag-header-cell-without-style",suppressSorting:true});angular.forEach(applicationData.queueColumns,function(queueColumn){if(queueColumn.queue==queue){angular.forEach(queueColumn.columns,function(column){columnDefs.push(getColumnDefs(column));});}});return columnDefs;}function getAllQueueColumns(){var allAvailableQueuesColumns=["Adverse Reason","Adverse Reason Date","Appraisal Age","Appraisal Condition","Appraisal Delivered Date","Appraisal Expected Delivery Date","Appraisal Inspection Date","Appraisal Ordered Date","Appraisal Order ID","Appraisal Order Status Date","Appraisal Requested Date","Appraisal Rush","Appraisal Status","Appraised Value","Borrower Activity","Borrower Mailing Address","Borrower Name","Branch","Channel","Company","Conforming/Non-Conforming","Created Date","Credit Expiration Date","Decision Score","Disclosure Date","Disclosure Due Date","Disclosure Status","Doc Delivery","Docs","Division","E-Consent Date","Email","Employment Status","Est Closing Date","Est Value","Intent to Proceed Date","Lead Status","Loan #","Loan Amt","Loan Application Date","Loan Officer","Loan Program","Purpose","Loan Status","Loan Type","Lock Expiration Date","Modified By","Modified Date","Occupancy","PreApproval Letter","Preferred Phone","Property Type","Purchase Amt","Rate","Seller Name","Subject Address - State","Subject Address - Street","Term & Amort"];return allAvailableQueuesColumns;}function getColumnsForQueue(queue){var columns;switch(queue){case enums.myListQueue.openLoans:columns=["Borrower Name","Loan #","Created Date","Doc Delivery","Purpose","Loan Program","Occupancy","Loan Amt","Rate","Subject Address - Street","Subject Address - State","Loan Application Date","Disclosure Date","E-Consent Date","Intent to Proceed Date","Lock Expiration Date","Est Closing Date","Loan Status","Appraisal Status","Borrower Activity","Modified Date","Loan Officer"];break;case enums.myListQueue.closedLoans:columns=["Borrower Name","Loan #","Subject Address - Street","Subject Address - State","Loan Type","Occupancy","Property Type","Est Value","Loan Amt","Term & Amort","Rate","Loan Officer","Created Date","Modified Date","Credit Expiration Date","Loan Program","Appraised Value","Decision Score","Preferred Phone","Email","Employment Status","Company","Channel","Division","Branch"];break;case enums.myListQueue.cancelledLoans:columns=["Borrower Name","Loan #","Subject Address - Street","Subject Address - State","Loan Type","Occupancy","Property Type","Est Value","Loan Amt","Term & Amort","Rate","Loan Officer","Created Date","Modified Date","Credit Expiration Date","Loan Program","Appraised Value","Decision Score","Preferred Phone","Email","Employment Status","Company","Channel","Division","Branch"];break;case enums.myListQueue.prospects:columns=["Borrower Name","Loan #","Created Date","Purpose","Occupancy","Loan Amt","Subject Address - Street","Subject Address - State","Doc Delivery","Loan Officer","Loan Program","Lead Status","PreApproval Letter","Modified Date","Modified By","Loan Type"];break;case enums.myListQueue.unsubmitted:columns=["Borrower Name","Loan #","Created Date"];break;case enums.myListQueue.registered:columns=["Borrower Name","Loan #","Created Date"];break;case enums.myListQueue.submitted:columns=["Borrower Name","Loan #","Created Date"];break;case enums.myListQueue.opening:columns=["Borrower Name","Loan #","Created Date"];break;case enums.myListQueue.preApproval:columns=["Borrower Name","Loan #","Created Date","Doc Delivery","Purpose","Loan Type","Occupancy","Loan Amt","Subject Address - Street","Subject Address - State","Loan Program","PreApproval Letter","Modified Date","Loan Officer"];break;case enums.myListQueue.approved:columns=["Borrower Name","Loan #","Created Date"];break;case enums.myListQueue.docsOut:columns=["Borrower Name","Loan #","Created Date"];break;case enums.myListQueue.funding:columns=["Borrower Name","Loan #","Created Date"];break;case enums.myListQueue.mailRoom:columns=["Borrower Name","Loan #","Borrower Mailing Address","Disclosure Status","Disclosure Due Date","Loan Officer"];break;case enums.myListQueue.pendingEConsent:columns=["Borrower Name","Loan #","Email","Loan Application Date","Loan Status","Disclosure Due Date","Doc Delivery","Disclosure Status","Loan Program","Loan Officer","E-Consent Date"];break;case enums.myListQueue.pendingDisclosures:columns=["Borrower Name","Loan #","Loan Application Date","E-Consent Date","Disclosure Due Date","Disclosure Status","Doc Delivery","Loan Program","Subject Address - Street","Subject Address - State","Loan Status","Loan Officer"];break;case enums.myListQueue.orderRequested:columns=["Appraisal Order ID","Borrower Name","Loan #","Loan Type","Loan Amt","Purchase Amt","Est Value","Seller Name","Appraisal Rush","Loan Officer","Appraisal Requested Date","Appraisal Age"];break;case enums.myListQueue.orderProcessed:columns=["Appraisal Order ID","Borrower Name","Loan #","Purpose","Loan Amt","Purchase Amt","Est Value","Seller Name","Conforming/Non-Conforming","Appraisal Rush","Loan Officer","Appraisal Requested Date","Appraisal Ordered Date","Appraisal Inspection Date","Appraisal Expected Delivery Date","Appraisal Status","Appraisal Order Status Date","Appraisal Age"];break;case enums.myListQueue.delivered:columns=["Appraisal Order ID","Borrower Name","Loan #","Loan Type","Loan Amt","Purchase Amt","Est Value","Appraised Value","Loan Officer","Appraisal Ordered Date","Appraisal Inspection Date","Appraisal Delivered Date","Appraisal Age","Appraisal Rush"];break;case enums.myListQueue.exceptions:columns=["Appraisal Order ID","Borrower Name","Loan #","Loan Type","Loan Amt","Purchase Amt","Est Value","Appraised Value","Appraisal Condition","Loan Officer","Appraisal Status","Appraisal Order Status Date","Appraisal Age","Appraisal Rush"];break;case enums.myListQueue.incomplete:columns=["Borrower Name","Loan #","Doc Delivery","Loan Application Date","Disclosure Due Date","E-Consent Date","Intent to Proceed Date","Lock Expiration Date","Appraisal Status","Loan Officer"];break;case enums.myListQueue.adverse:columns=["Borrower Name","Loan #","Loan Officer","Loan Application Date","E-Consent Date","Adverse Reason","Adverse Reason Date","PreApproval Letter","Appraisal Status","Purpose","Subject Address - Street","Subject Address - State"];break;case enums.myListQueue.processing:columns=["Borrower Name","Loan #","Doc Delivery","Loan Application Date","E-Consent Date","Intent to Proceed Date","Lock Expiration Date","Est Closing Date","Loan Type","Purpose","Loan Program","Loan Officer","Borrower Activity","Docs"];break;default:columns=["Borrower Name","Loan #","Created Date"];console.log("ERROR: Unsupported myListQueue item!");}return{queue:queue,columns:columns};}function getColumnDefs(column){var colDefs;switch(column){case"Adverse Reason":colDefs={headerName:"Adverse Reason",field:"adverseReason",width:130,filterParams:{newRowsAction:"keep"}};break;case"Adverse Reason Date":colDefs={headerName:"Adverse Reason Date",field:"adverseReasonDate",width:180,cellRenderer:dateRenderer,valueGetter:dateRenderer,comparator:dateComparator,filter:"set",filterParams:{newRowsAction:"keep"}};break;case"Appraisal Age":colDefs={headerName:"Age",field:"appraisalAge",width:80,filterParams:{newRowsAction:"keep"}};break;case"Appraisal Condition":colDefs={headerName:"Appraisal Condition",field:"appraisalCondition",width:140,filterParams:{newRowsAction:"keep"}};break;case"Appraisal Delivered Date":colDefs={headerName:"Delivered Appraisal",field:"appraisalDeliveredDate",width:170,cellRenderer:dateRenderer,valueGetter:dateRenderer,comparator:dateComparator,filter:"set",filterParams:{newRowsAction:"keep"}};break;case"Appraisal Expected Delivery Date":colDefs={headerName:"Expected Delivery",field:"appraisalExpectedDeliveryDate",width:130,cellRenderer:dateRenderer,valueGetter:dateRenderer,comparator:dateComparator,filter:"set",filterParams:{newRowsAction:"keep"}};break;case"Appraisal Inspection Date":colDefs={headerName:"Inspection",field:"appraisalInspectionDate",width:90,cellRenderer:dateRenderer,valueGetter:dateRenderer,comparator:dateComparator,filter:"set",filterParams:{newRowsAction:"keep"}};break;case"Appraisal Order ID":colDefs={headerName:"Order ID",field:"appraisalOrderId",width:100,filterParams:{newRowsAction:"keep"}};break;case"Appraisal Ordered Date":colDefs={headerName:"Ordered Appraisal",field:"appraisalOrderedDate",width:170,cellRenderer:dateRenderer,valueGetter:dateRenderer,comparator:dateComparator,filter:"set",filterParams:{newRowsAction:"keep"}};break;case"Appraisal Order Status Date":colDefs={headerName:"Order Status Date",field:"appraisalOrderStatusDate",width:130,cellRenderer:dateRenderer,valueGetter:dateRenderer,comparator:dateComparator,filter:"set",filterParams:{newRowsAction:"keep"}};break;case"Appraisal Requested Date":colDefs={headerName:"Requested Appraisal",field:"appraisalRequestedDate",width:150,cellRenderer:dateRenderer,valueGetter:dateRenderer,comparator:dateComparator,filter:"set",filterParams:{newRowsAction:"keep"}};break;case"Appraisal Rush":colDefs={headerName:"Rush",field:"appraisalRush",width:130,filterParams:{newRowsAction:"keep"}};break;case"Appraisal Status":colDefs={headerName:"Order Status",field:"appraisalStatus",width:130,filterParams:{newRowsAction:"keep"}};break;case"Appraised Value":colDefs={headerName:"Appraised Value",field:"appraisedValue",width:90,cellRenderer:currencyRenderer,valueGetter:currencyRenderer,filterParams:{newRowsAction:"keep"}};break;case"Branch":colDefs={headerName:"Branch",field:"branch",width:130,filterParams:{newRowsAction:"keep"}};break;case"Borrower Activity":colDefs={headerName:"Borrower Activity",field:"borrowerActivity",width:130,filterParams:{newRowsAction:"keep"}};break;case"Borrower Mailing Address":colDefs={headerName:"Mailing Address",field:"borrowerMailingAddress",width:210,filterParams:{newRowsAction:"keep"}};break;case"Borrower Name":colDefs={headerName:"Borrower Name",width:150,cellRenderer:displayNameCellRenderer,valueGetter:displayNameCellRenderer,filter:BorrowerNameFilter,filterParams:{newRowsAction:"keep"}};break;case"Channel":colDefs={headerName:"Channel",field:"channel",width:130,filterParams:{newRowsAction:"keep"}};break;case"Company":colDefs={headerName:"Company",field:"company",width:130,filterParams:{newRowsAction:"keep"}};break;case"Conforming/Non-Conforming":colDefs={headerName:"Conf/Non-Conf",field:"conformingNonConforming",width:130,filterParams:{newRowsAction:"keep"}};break;case"Created Date":colDefs={headerName:"Created",field:"dateCreated",width:110,cellRenderer:dateTimeRenderer,valueGetter:dateTimeRenderer,comparator:dateComparator,filter:"set",filterParams:{newRowsAction:"keep"}};break;case"Credit Expiration Date":colDefs={headerName:"Credit Exp",field:"creditExpirationDate",width:130,cellRenderer:dateRenderer,valueGetter:dateRenderer,comparator:dateComparator,filter:"set",filterParams:{newRowsAction:"keep"}};break;case"Decision Score":colDefs={headerName:"FICO",field:"decisionScore",width:130,filterParams:{newRowsAction:"keep"}};break;case"Disclosure Date":colDefs={headerName:"Disclosure Date",field:"disclosureDate",width:130,cellRenderer:dateRenderer,valueGetter:dateRenderer,comparator:dateComparator,filter:"set",filterParams:{newRowsAction:"keep"}};break;case"Disclosure Due Date":colDefs={headerName:"Due Date",field:"disclosureDueDate",width:110,cellRenderer:dateRenderer,valueGetter:dateRenderer,comparator:dateComparator,cellClass:"ag-loan-number",cellClicked:applicationData.currentUser.hasPrivilege(enums.privileges.MailroomWorkbench)?dueDateClickedHandler:"",filter:"set",filterParams:{newRowsAction:"keep"}};break;case"Disclosure Status":colDefs={headerName:"Disclosure Status",field:"disclosureStatus",width:160,filterParams:{newRowsAction:"keep"}};break;case"Division":colDefs={headerName:"Division",field:"division",width:130,filterParams:{newRowsAction:"keep"}};break;case"Doc Delivery":colDefs={headerName:"Doc Delivery",field:"docDelivery",width:110,filterParams:{newRowsAction:"keep"}};break;case"Docs":colDefs={headerName:"Docs",field:"docs",width:110,filterParams:{newRowsAction:"keep"}};break;case"E-Consent Date":colDefs={headerName:"E-Consent",field:"eConsentDate",width:130,cellRenderer:dateTimeRenderer,valueGetter:dateTimeRenderer,comparator:dateComparator,filter:"set",filterParams:{newRowsAction:"keep"}};break;case"Email":colDefs={headerName:"Email",field:"email",width:200,filterParams:{newRowsAction:"keep"}};break;case"Employment Status":colDefs={headerName:"Employment Status",field:"employmentStatus",width:150,filterParams:{newRowsAction:"keep"}};break;case"Est Closing Date":colDefs={headerName:"Est Closing Date",field:"closingDate",width:130,cellRenderer:dateRenderer,valueGetter:dateRenderer,comparator:dateComparator,filter:"set",filterParams:{newRowsAction:"keep"}};break;case"Est Value":colDefs={headerName:"Est Value",field:"estimatedValue",width:90,cellRenderer:currencyRenderer,valueGetter:currencyRenderer,filterParams:{newRowsAction:"keep"}};break;case"Intent to Proceed Date":colDefs={headerName:"ITP",field:"itpDate",width:130,cellRenderer:dateRenderer,valueGetter:dateRenderer,comparator:dateComparator,filter:"set",filterParams:{newRowsAction:"keep"}};break;case"Lead Status":colDefs={headerName:"Lead Status",field:"leadStatus",width:130,filterParams:{newRowsAction:"keep"}};break;case"Loan #":colDefs={headerName:"Loan #",field:"loanNumber",width:80,cellClass:"ag-loan-number",cellClicked:cellClickedHandler,filter:LoanFilter,filterParams:{newRowsAction:"keep"}};break;case"Loan Amt":colDefs={headerName:"Loan Amt",field:"loanAmount",width:90,cellRenderer:currencyRenderer,valueGetter:currencyRenderer,filterParams:{newRowsAction:"keep"}};break;case"Loan Application Date":colDefs={headerName:"App Date",field:"loanApplicationDate",width:110,cellRenderer:dateRenderer,valueGetter:dateRenderer,comparator:dateComparator,filter:"set",filterParams:{newRowsAction:"keep"}};break;case"Loan Officer":colDefs={headerName:"Loan Officer",field:"conciergeFullName",width:130,filterParams:{newRowsAction:"keep"}};break;case"Loan Program":colDefs={headerName:"Loan Program",field:"loanProgram",width:160,filterParams:{newRowsAction:"keep"}};break;case"Purpose":colDefs={headerName:"Purpose",field:"loanPurpose",width:110,filterParams:{newRowsAction:"keep"}};break;case"Loan Status":colDefs={headerName:"Loan Status",field:"milestoneStatus",cellRenderer:loanStatusCellRenderer,valueGetter:loanStatusCellRenderer,width:110,filterParams:{newRowsAction:"keep"}};break;case"Loan Type":colDefs={headerName:"Loan Type",field:"loanType",width:95,filterParams:{newRowsAction:"keep"}};break;case"Lock Expiration Date":colDefs={headerName:"Lock Exp",field:"lockExpireDate",width:110,cellRenderer:dateRenderer,valueGetter:dateRenderer,comparator:dateComparator,filter:"set",filterParams:{newRowsAction:"keep"}};break;case"Modified By":colDefs={headerName:"Modified By",field:"modifiedBy",width:130,filterParams:{newRowsAction:"keep"}};break;case"Modified Date":colDefs={headerName:"Modified Date",field:"dateModified",width:130,cellRenderer:dateTimeRenderer,valueGetter:dateTimeRenderer,comparator:dateComparator,filter:"set",filterParams:{newRowsAction:"keep"}};break;case"Occupancy":colDefs={headerName:"Occupancy",field:"occupancyType",width:95,filterParams:{newRowsAction:"keep"}};break;case"PreApproval Letter":colDefs={headerName:"PreApproval Letter",field:"preApprovalLetter",width:160,filterParams:{newRowsAction:"keep"}};break;case"Preferred Phone":colDefs={headerName:"Preferred Phone",field:"prefferedPhone",width:130,filterParams:{newRowsAction:"keep"}};break;case"Property Type":colDefs={headerName:"Property Type",field:"propertyType",width:130,filterParams:{newRowsAction:"keep"}};break;case"Purchase Amt":colDefs={headerName:"Purchase Amt",field:"purchaseAmt",width:130,cellRenderer:currencyRenderer,valueGetter:currencyRenderer,filterParams:{newRowsAction:"keep"}};break;case"Rate":colDefs={headerName:"Rate",field:"rate",width:60,cellRenderer:threeDecimalRenderer,valueGetter:threeDecimalRenderer,filterParams:{newRowsAction:"keep"}};break;case"Seller Name":colDefs={headerName:"Seller Name",field:"sellerName",width:130,filterParams:{newRowsAction:"keep"}};break;case"Subject Address - Street":colDefs={headerName:"Street",field:"streetAddress",width:170,filterParams:{newRowsAction:"keep"}};break;case"Subject Address - State":colDefs={headerName:"State",field:"state",width:65,filterParams:{newRowsAction:"keep"}};break;case"Term & Amort":colDefs={headerName:"Term & Amort",field:"termAmort",width:105,filterParams:{newRowsAction:"keep"}};break;default:console.log("ERROR: Column definitions for column: "+column+" is not define!");}return colDefs;}}})();(function(){angular.module("queue").provider("queueColumnDefs",queueColumnDefs);function queueColumnDefs(){this.$get=function(){return columnDefs;};var navigationSvc;var state;var enumTypes;var _stateParams;var _applicationData;function columnDefs(enums,$stateParams,applicationData,NavigationSvc,$state){var result={};navigationSvc=NavigationSvc;state=$state;enumTypes=enums;_stateParams=$stateParams;_applicationData=applicationData;return result;}}})();var fileUploadDirective=angular.module("iMP.Directives");fileUploadDirective.directive("fileSelect",["$q",function($q){return{restrict:"A",scope:{fileTypes:"=?",preSelectFnm:"=?"},link:function(scope,$elem,attrs){var openFileInput=function(){var id="__global_file_input",html='<input type="file" id="'+id+'" style="display:none" multiple'+(scope.fileTypes?' accept="'+scope.fileTypes+'"':"")+" />",input=$("#"+id),deferred=$q.defer();if(input.length==0){input=$(html);$("#upload-files").append(input);}input[0].value=null;var onInputChange=function(event){var files=event.target.files;if(files!=null&&files.length>0){deferred.resolve(files);}else{deferred.reject();}};input.unbind("change");input.bind("change",function(event){scope.$apply(function(){onInputChange(event);});});input.trigger("click");return deferred.promise;};$elem.bind("click",function(event){var updateScope=function(files){for(var i=0;i<files.length;i++){if(scope.$parent.importFnmCtrl){scope.$parent.importFnmCtrl.files.push(files[i]);}if(scope.$parent.uploadFiles){scope.$parent.uploadFiles.files.push(files[i]);}if(scope.preSelectFnm){scope.$parent.importFnmCtrl.markFirstAsPrimaryFNM();}}};openFileInput().then(updateScope);});}};}]);var loan;(function(loan){var LoanParticipantsModal=(function(){function LoanParticipantsModal(wrappedLoan,applicationData,$modalInstance,manageAccountService,NavigationSvc,$rootScope){var _this=this;this.wrappedLoan=wrappedLoan;this.applicationData=applicationData;this.$modalInstance=$modalInstance;this.manageAccountService=manageAccountService;this.NavigationSvc=NavigationSvc;this.$rootScope=$rootScope;this.primaryApplicationModel=[];this.clonedParticipants={};this.log=function(variable){console.log(variable);};this.close=function(){_this.clonedParticipants={};_this.$modalInstance.dismiss("cancel");};this.save=function(){_this.$rootScope.$broadcast("ModalDoneLoanParticipants");_this.wrappedLoan.ref.loanParticipants=_this.clonedParticipants;_this.close();};this.saveAndClose=function(){_this.save();_this.close();};this.accountStatus=function(application){if(application.isSpouseOnTheLoan){application.coBorrower.userAccount.isCoBorrower=true;}application.borrowerAccountStatus=_this.manageAccountService.accountStatus(application.borrower.userAccount,application.coBorrower.userAccount,application.isSpouseOnTheLoan);if(application.isSpouseOnTheLoan){application.coBorrowerAccountStatus=_this.manageAccountService.accountStatus(application.coBorrower.userAccount,application.borrower.userAccount,application.isSpouseOnTheLoan);}};this.manageAccountsModal=function(model,application,isCoBorrower,event){if(model.username==null||model.username==undefined||model.username.trim()===""){return;}if(isCoBorrower&&application.getBorrower().userAccount.username&&!(model.userAccountId>0)){model=angular.copy(_this.wrappedLoan.ref.active.getBorrower().userAccount);model.userAccountId=0;}else{if(application.getBorrower().userAccount.username==application.getCoBorrower().userAccount.originalUsername&&!(model.userAccountId>0)){var username=model.username;model=new cls.UserAccountViewModel();model.username=username;model.originalUsername=username;model.isOnlineUser=false;model.userAccountId=0;}}var accountStatus=function(){_this.accountStatus(application);};model.isCoBorrower=isCoBorrower;var manageUserAccount=new cls.ManageUserAccountsViewModel();manageUserAccount.userAccount=model;var confirmationPopup=_this.manageAccountService.openManageAccount(_this.wrappedLoan,manageUserAccount,event,accountStatus,_this.applicationData);confirmationPopup.result.then(function(){});};angular.forEach(this.wrappedLoan.ref.getLoanApplications(),function(v,k){_this.primaryApplicationModel[k]=v.isPrimary;});angular.copy(this.wrappedLoan.ref.loanParticipants,this.clonedParticipants);}LoanParticipantsModal.$inject=["wrappedLoan","applicationData","$modalInstance","manageAccountService","NavigationSvc","$rootScope"];return LoanParticipantsModal;})();angular.module("loanCenter").controller("LoanParticipantsModal",LoanParticipantsModal);})(loan||(loan={}));var loancenter;(function(loancenter){var participantsTable=(function(){function participantsTable(){this.restrict="E";this.templateUrl="angular/loanparticipants/participants.table.html";this.scope={"viewModel":"="};this.controller=function($scope){$scope.showAdd=false;$scope.log=function(variable){console.log(variable);};};}participantsTable.Factory=function(){var directive=function(){return new participantsTable();};directive["$inject"]=[];return directive;};return participantsTable;})();loancenter.participantsTable=participantsTable;angular.module("loanCenter").directive("participantsTable",participantsTable.Factory());})(loancenter||(loancenter={}));var loancenter;(function(loancenter){function attachParticipantsViewModel(wrappedLoan){wrappedLoan.ref.loanParticipants={participantInformation:[]};var numberOfParticipants=randomNumber(4,12);for(var i=0;i<numberOfParticipants;i++){var person=createPerson();wrappedLoan.ref.loanParticipants.participantInformation.push(person);}}loancenter.attachParticipantsViewModel=attachParticipantsViewModel;function randomNumber(min,max){return Math.floor(Math.random()*(max-min+1))+min;}function getCompanyTypes(){var companyTypes=["CPA","Doc Signing","Employer","Escrow","Flood Insurance","Hazard Insurance","Property Management","Home Warranty","Survey","Termite","Mortgage Insurance","Realtor","Title Insurance","Appraiser"];return companyTypes;}function getCompanyTypeLookups(){var companyTypeLookups=[];var companyTypes=getCompanyTypes();for(var i=0;i<companyTypes.length;i++){companyTypeLookups.push({legalEntityTypeKey:i+1,legalEntityTypeString:companyTypes[i]});}return companyTypeLookups;}loancenter.getCompanyTypeLookups=getCompanyTypeLookups;function getCompanyType(){var companyTypes=getCompanyTypes();return companyTypes[randomNumber(0,12)];}function getAreaCode(){return getPreFix();}function getPreFix(){return getRandomNumber(3);}function getSuffix(){return getRandomNumber(4);}function getLicenseNumber(){return getRandomNumber(12);}function getRandomNumber(length){var number=[];for(var i=0;i<length;i++){number[i]=(randomNumber(0,9)).toString();}return number.join("");}function getFirstName(){var name=["Marilyn","Deborah","Timothy","Kathleen","Arthur","Deborah","Barbara","Annette","Flora","Ann","Nancy","Porfirio","Jonathan","Leslie","Barbara","Mark","Kathy","Christopher","Jeffrey","Kimbra"];return name[randomNumber(0,name.length-1)];}function getMiddleIntial(){var name=["J","J","F","M","C","C","R","D","E","D","G","P","J","J","M","M","S","K","R","R",];return name[randomNumber(0,name.length-1)];}function getLastName(){var name=["Bledsoe","Loiselle","Dostie","Allen","Young","Chavez","Crawford","Aldrich","Hudson","Karr","Ashton","White","McAdams","Hanson","Koontz","Winters","Betts","Sweet","Pennypacker","Lafon"];return name[randomNumber(0,name.length-1)];}function getPhoneNumber(typeOfNumber){if(typeOfNumber===void 0){typeOfNumber=null;}var types=["Other","Home","Mobile","Office","Fax"];typeOfNumber=(typeOfNumber!==null)?typeOfNumber:randomNumber(0,types.length-1);var p=getPreFix(),s=getSuffix(),a=getAreaCode();return{areaCode:a,preFix:p,suffix:s,phoneNumber:"("+a+") "+p+" - "+s,phoneNumberType:types[typeOfNumber]};}function createEmptyPerson(){return{companyName:"",companyPhoneNumber:"",companyType:"",emailAddressList:[{emailAddress:"",emailType:"Office"}],companyLicenseNumber:"",personalLicenseNumber:"",firstName:"",middleName:"",lastName:"",name:"",addressList:[{city:"",county:"",state:"",streetAddress:"",streetAddress1:"",streetAddress2:"",zipCode:""}],phoneList:[{areaCode:"",preFix:"",suffix:"",phoneNumber:"",phoneNumberType:"Office"},{areaCode:"",preFix:"",suffix:"",phoneNumber:"",phoneNumberType:"Mobile"},{areaCode:"",preFix:"",suffix:"",phoneNumber:"",phoneNumberType:"Fax"},],isRemoved:false};}loancenter.createEmptyPerson=createEmptyPerson;function createPerson(){var firstName=getFirstName(),middle=getMiddleIntial(),last=getLastName(),phoneNumbers=[];phoneNumbers.push(getPhoneNumber(3));phoneNumbers.push(getPhoneNumber(2));phoneNumbers.push(getPhoneNumber(4));return{companyName:"Some Company",companyPhoneNumber:getPhoneNumber(),companyType:getCompanyType(),emailAddressList:[{emailAddress:firstName.toLowerCase()+"."+last.toLowerCase()+"@somecompany.com",emailType:"Office"}],companyLicenseNumber:getLicenseNumber(),personalLicenseNumber:getLicenseNumber(),firstName:firstName,middleName:middle,lastName:last,name:firstName+" "+middle+" "+last,addressList:[{city:"Reston",county:"Fairfax",state:"VA",streetAddress:"10304 Chamberlain Dr",streetAddress1:"Apt 3",streetAddress2:"",zipCode:"22192"}],phoneList:phoneNumbers,isRemoved:false};}})(loancenter||(loancenter={}));var loancenter;(function(loancenter){var participantRow=(function(){function participantRow(loanParticipantsService){var _this=this;this.loanParticipantsService=loanParticipantsService;this.restrict="E";this.templateUrl="/angular/loanparticipants/participant.row.default.html";this.scope={"mode":"@","companyTypes":"=","item":"=?","viewModel":"=?","showAdd":"=?"};this.controller=function($scope){_this.setTemplate($scope);if($scope.mode!="add"){_this.setTemplatePhoneVars($scope);}$scope.changeTemplate=function(newMode){$scope.mode=newMode;_this.setTemplate($scope);};$scope.removeItem=function(){_this.removeItem($scope);};$scope.addItem=function(){_this.addItem($scope);};$scope.splitName=function(name){_this.splitName(name,$scope.item);};$scope.log=function(variable){console.log(variable);};$scope.getCompanyTypeFromInt=function(integer){return _this.getCompanyTypeFromInt(integer,$scope);};$scope.$on("ModalDoneLoanParticipants",function(){if($scope.mode=="add"&&$scope.showAdd==true){$scope.addItem();}});};}participantRow.prototype.setTemplate=function($scope){var _this=this;if($scope.mode=="view"){$scope.template="angular/loanparticipants/participant.row.view.html";}else{if($scope.mode=="edit"){this.setFullName($scope);$scope.template="angular/loanparticipants/participant.row.edit.html";}else{if($scope.mode=="add"){this.initEmptyItem($scope,function(){_this.setTemplatePhoneVars($scope);});$scope.template="angular/loanparticipants/participant.row.edit.html";}}}};participantRow.prototype.removeItem=function($scope){$scope.item.isDeleted=true;};participantRow.prototype.addItem=function($scope){$scope.item.valid=true;var copiedItem=JSON.parse(JSON.stringify($scope.item));$scope.viewModel.push(copiedItem);$scope.showAdd=false;};participantRow.prototype.initEmptyItem=function($scope,callback){var _this=this;var $promise=this.loanParticipantsService.getEmptyContact();$promise.then(function(sr){$scope.item=sr.response;_this.setFullName($scope);if(typeof callback=="function"){callback();}console.log(sr);},function(error){console.log(error);});};participantRow.prototype.setTemplatePhoneVars=function($scope){if(typeof $scope.item.companyPhoneNumber.value=="object"){$scope.item.companyPhoneNumber.value.phoneNumberType=3;$scope.item.companyPhoneNumber.value.typeStr="Office";}$scope.item.personPhone={"Mobile":this.findPhoneNumber(2,$scope.item.phoneList.list),"Office":$scope.item.companyPhoneNumber.value};$scope.item.companyPhone={"Fax":this.findPhoneNumber(4,$scope.item.phoneList.list)};};participantRow.prototype.findPhoneNumber=function(phoneType,phoneList){if(typeof phoneList!=="object"){return;}var types=this.phoneTypes();if(phoneType<types.length){for(var i=0;i<phoneList.length;i++){if(phoneList[i].value.phoneNumberType==phoneType){phoneList[i].value.typeStr=types[phoneType];return phoneList[i].value;}}}return this.emptyPhoneObject(phoneType,phoneList);};participantRow.prototype.phoneTypes=function(){return["Other","Home","Mobile","Office","Fax"];};participantRow.prototype.emptyPhoneObject=function(phoneType,phoneList){var phoneObject=null,phoneParentObject=null,types=this.phoneTypes(),phoneTypeValid=(arguments.length>0&&!isNaN(parseFloat(phoneType))&&isFinite(phoneType)&&phoneType!=0)?true:false,phoneTypeInt=(phoneTypeValid)?phoneType:0,phoneTypeStr=(phoneTypeValid)?types[phoneType]:null;if(typeof phoneList==="object"){for(var i=0;i<phoneList.length;i++){if(phoneList[i].value.phoneNumberType=="0"&&phoneList[i].value.phoneNumber==""){phoneList[i].value.phoneNumberType=phoneTypeInt;phoneList[i].value.typeStr=phoneTypeStr;phoneObject=phoneList[i].value;}}}if(phoneObject===null&&typeof phoneList==="object"){phoneObject={phoneNumber:"",phoneNumberType:phoneTypeInt,typeStr:phoneTypeStr};phoneParentObject={isDeleted:false,isPreferred:false,parentId:"00000000-0000-0000-0000-000000000000",recordId:"00000000-0000-0000-0000-000000000000",value:phoneObject};phoneList.push(phoneParentObject);}else{if(phoneObject===null){phoneObject={phoneNumber:"",phoneNumberType:phoneTypeInt,typeStr:phoneTypeStr};}}return phoneObject;};participantRow.prototype.splitName=function(name,item){var fullName=name.trim().split(" ");if(fullName.length==2){item.firstName=item.name.firstName=fullName[0];item.lastName=item.name.lastName=fullName[1];}else{if(fullName.length==3){item.firstName=item.name.firstName=fullName[0];item.middleName=item.name.middleName=fullName[1];item.lastName=item.name.lastname=fullName[2];}}};participantRow.prototype.setFullName=function($scope){var nameArray=[],name=$scope.item.name;if(name.firstName&&name.lastName&&name.middleName){nameArray.push(name.firstName);nameArray.push(name.middleName);nameArray.push(name.lastName);}else{if(name.firstName&&name.lastName){nameArray.push(name.firstName);nameArray.push(name.lastName);}}$scope.fullName=(nameArray.length>0)?nameArray.join(" "):"";};participantRow.prototype.getCompanyTypeFromInt=function(integer,$scope){for(var k in $scope.companyTypes){if(typeof $scope.companyTypes[k]==="object"&&$scope.companyTypes[k].legalEntityTypeKey==integer){return $scope.companyTypes[k].legalEntityTypeString;}}return" ";};participantRow.Factory=function(){var directive=function(loanParticipantsService){return new participantRow(loanParticipantsService);};directive["$inject"]=["loanParticipantsService"];return directive;};return participantRow;})();loancenter.participantRow=participantRow;angular.module("loanCenter").directive("participantRow",participantRow.Factory());})(loancenter||(loancenter={}));var loancenter;(function(loancenter){var loanParticipantsService=(function(){function loanParticipantsService($resource,apiRoot){this.$resource=$resource;this.apiRoot=apiRoot;this.$inject=["$resource","api"];}loanParticipantsService.prototype.getEmptyContact=function(){this.proxy=this.$resource(this.apiRoot+"LoanParticipantsService/GetEmptyCompanyContact",{},{GetEmptyContact:{method:"GET"}});return this.proxy.GetEmptyContact().$promise;};loanParticipantsService.Factory=function(){var service=function($resource,api){return new loanParticipantsService($resource,api);};service["$inject"]=["$resource","api"];return service;};return loanParticipantsService;})();loancenter.loanParticipantsService=loanParticipantsService;angular.module("loanCenter").service("loanParticipantsService",loancenter.loanParticipantsService);})(loancenter||(loancenter={}));(function(){angular.module("assignments",[]);})();var loan;(function(loan){var AssignmentsController=(function(){function AssignmentsController(wrappedLoan,enums,NavigationSvc,$state,$modalInstance,applicationData){var _this=this;this.wrappedLoan=wrappedLoan;this.enums=enums;this.NavigationSvc=NavigationSvc;this.$state=$state;this.$modalInstance=$modalInstance;this.applicationData=applicationData;this.isCurrentUserAdmin=false;this.isCurrentUserLoOrConcierge=false;this.init=function(){_this.isCurrentUserAdmin=_.some(_this.applicationData.currentUser.roles,function(role){return(role.roleName=="Administrator");});_this.enableDigitalDocsCall=_this.wrappedLoan.ref.enableDigitalDocsCall;_this.loanNumber=_this.wrappedLoan.ref.loanNumber;_this.losFolderId=_this.wrappedLoan.ref.losFolderId;_this.channelId=_this.wrappedLoan.ref.channelId;_this.divisionId=_this.wrappedLoan.ref.divisionId;_this.branchId=_this.wrappedLoan.ref.branchId;_this.conciergeId=_this.wrappedLoan.ref.conciergeId;_this.conciergeFullName=_this.wrappedLoan.ref.conciergeFullName;_this.salesManagerId=_this.wrappedLoan.ref.salesManagerId;_this.teamLeaderId=_this.wrappedLoan.ref.teamLeaderId;_this.LOAId=_this.wrappedLoan.ref.loaId;_this.LOAFullName=_this.wrappedLoan.ref.loaFullName;_this.loanProcessorId=_this.wrappedLoan.ref.callCenterId;_this.channels=_this.applicationData.companyProfile.channels;_this.getDivisionsByChannelId(_this.channelId);_this.getBranchesByDivisionId(_this.divisionId);_this.getChannelManager();_this.getDivisionManager();_this.getBranchManager();_this.getConcierges();_this.getSalesManagers();_this.getTeamLeaders();_this.getLOAs();_this.getLoanProcessors();};this.assignValuesFromUserAccount=function(selectedConcierge){if(angular.isDefined(_this.wrappedLoan.ref.loaId)&&angular.isDefined(selectedConcierge.loaId)){if(!_this.wrappedLoan.ref.loaId||_this.wrappedLoan.ref.loaId==-1){_this.wrappedLoan.ref.loaId=selectedConcierge.loaId;_this.LOAId=selectedConcierge.loaId;}}if(angular.isDefined(_this.wrappedLoan.ref.callCenterId)&&angular.isDefined(selectedConcierge.loanProcessorId)){if(!_this.wrappedLoan.ref.callCenterId||_this.wrappedLoan.ref.callCenterId==-1){_this.wrappedLoan.ref.callCenterId=selectedConcierge.loanProcessorId;_this.loanProcessorId=selectedConcierge.loanProcessorId;}}if(angular.isDefined(_this.wrappedLoan.ref.salesManagerId)&&angular.isDefined(selectedConcierge.salesManagerId)){if(!_this.wrappedLoan.ref.salesManagerId||_this.wrappedLoan.ref.salesManagerId==-1){_this.wrappedLoan.ref.salesManagerId=selectedConcierge.salesManagerId;_this.salesManagerId=selectedConcierge.salesManagerId;}}if(angular.isDefined(_this.wrappedLoan.ref.teamLeaderId)&&angular.isDefined(selectedConcierge.teamLeaderId)){if(!_this.wrappedLoan.ref.teamLeaderId||_this.wrappedLoan.ref.teamLeaderId==-1){_this.wrappedLoan.ref.teamLeaderId=selectedConcierge.teamLeaderId;_this.teamLeaderId=selectedConcierge.teamLeaderId;}}};this.getDivisionsByChannelId=function(channelId){var divisions;if(channelId&&channelId!=-1){var channel=_.findWhere(_this.applicationData.companyProfile.channels,{channelId:channelId});divisions=channel.divisions;}_this.divisions=divisions;};this.getBranchesByDivisionId=function(divisionId){var branches;if(divisionId&&divisionId!=-1){var division=_.findWhere(_this.divisions,{divisionId:divisionId});branches=division.branches;}_this.branches=branches;};this.getChannelManager=function(){var channel=_this.getSection(_this.channels,function(channel){return channel.channelId==_this.channelId;});if(channel){return _this.getManager(function(m){return m.userAccountId==channel.channelManagerId;});}};this.getDivisionManager=function(){var division=_this.getSection(_this.divisions,function(division){return division.divisionId==_this.divisionId;});if(division){return _this.getManager(function(m){return m.userAccountId==division.divisionManagerId;});}};this.getBranchManager=function(){var branch=_this.getSection(_this.branches,function(branch){return branch.branchId==_this.branchId;});if(branch){return _this.getManager(function(m){return m.userAccountId==branch.branchManager;});}};this.getSection=function(coll,predicate){return _.find(coll,predicate);};this.getManager=function(predicate){var managerRetrieved=_.find(_this.loanAssignmentUserAccounts,predicate);if(managerRetrieved){return managerRetrieved.firstName+" "+managerRetrieved.lastName;}return"";};this.onChannelChange=function(){_this.divisionId=0;_this.branchId=0;_this.conciergeId=0;_this.conciergeFullName="";_this.LOAId=0;_this.LOAFullName="";_this.nmlsNumber=undefined;_this.getDivisionsByChannelId(_this.channelId);_this.getBranchesByDivisionId(_this.divisionId);_this.getConcierges();_this.getLOAs();_this.getChannelManager();_this.getDivisionManager();_this.getBranchManager();};this.onDivisionChange=function(){_this.branchId=0;_this.conciergeId=0;_this.conciergeFullName="";_this.LOAId=0;_this.LOAFullName="";_this.nmlsNumber=undefined;_this.getBranchesByDivisionId(_this.divisionId);_this.getConcierges();_this.getLOAs();_this.getDivisionManager();_this.getBranchManager();};this.onBranchChange=function(){_this.conciergeId=0;_this.conciergeFullName="";_this.LOAId=0;_this.LOAFullName="";_this.nmlsNumber=undefined;_this.getConcierges();_this.getLOAs();_this.getBranchManager();};this.onLOAChange=function(){if(_this.LOAId){var selectedLOA=_this.getUserByAccountId(_this.LOAs,_this.LOAId);if(selectedLOA){_this.LOAFullName=selectedLOA.firstName+" "+(selectedLOA.middleName!=""?(selectedLOA.middleName+" "):"")+selectedLOA.lastName;_this.wrappedLoan.ref.loaId=_this.LOAId;}}};this.onLoanProcessorChange=function(){if(_this.loanProcessorId){var selectedLoanProcessor=_this.getUserByAccountId(_this.loanProcessors,_this.loanProcessorId);if(selectedLoanProcessor){_this.wrappedLoan.ref.callCenterId=_this.loanProcessorId;}}};this.onConciergeChange=function(){if(_this.conciergeId){var selectedConcierge=_this.getUserByAccountId(_this.concierges,_this.conciergeId);if(selectedConcierge){_this.conciergeFullName=selectedConcierge.firstName+" "+(selectedConcierge.middleName!=""?(selectedConcierge.middleName+" "):"")+selectedConcierge.lastName;_this.nmlsNumber=selectedConcierge.nmlsNumber;_this.assignValuesFromUserAccount(selectedConcierge);}}};this.getUserByAccountId=function(listOfUsers,userAccountId){if(userAccountId){return _.find(listOfUsers,function(user){return user.userAccountId==userAccountId;});}};this.getBranchIdByAccountId=function(listOfUsers,userAccountId){if(userAccountId){var userAccount=_this.getUserByAccountId(listOfUsers,userAccountId);if(userAccount){return userAccount.branchId;}}};this.getUserByBranchId=function(listOfUsers,branchId){if(branchId){return _.find(listOfUsers,function(user){return user.branchId==branchId;});}};this.getConcierges=function(){var concierges;concierges=_.filter(_this.loanAssignmentUserAccounts,function(user){return user.isActivated==true&&user.nmlsNumber!=null&&user.nmlsNumber!=""&&user.nmlsNumber!="Pending"&&_this.isUserStateLicensedForLoan(user)&&_.some(user.roles,function(role){return(role.roleName=="Concierge"||role.roleName=="Loan Officer");});});if(concierges){if(_this.branchId&&_this.branchId!=="00000000-0000-0000-0000-000000000000"){concierges=_.filter(concierges,function(user){return user.branchId==_this.branchId;});}else{if(_this.divisionId&&_this.divisionId!=-1){concierges=_.filter(concierges,function(user){return user.divisionId==_this.divisionId;});}else{if(_this.channelId&&_this.channelId!=-1){concierges=_.filter(concierges,function(user){return user.channelId==_this.channelId;});}}}_this.concierges=concierges;_this.onConciergeChange();}};this.getSalesManagers=function(){_this.salesManagers=_this.retrieveRolesByRoleName(function(user){return user.isActivated==true&&_.some(user.roles,function(role){return(role.roleName=="Sales Manager");});});};this.getTeamLeaders=function(){_this.teamLeaders=_this.retrieveRolesByRoleName(function(user){return user.isActivated==true&&_.some(user.roles,function(role){return(role.roleName=="Team Leader");});});};this.getLoanProcessors=function(){_this.loanProcessors=_this.retrieveRolesByRoleName(function(user){return user.isActivated==true&&_.some(user.roles,function(role){return(role.roleName=="Loan Processor");});});};this.retrieveRolesByRoleName=function(predicate){var retrievedRoles=_.filter(_this.loanAssignmentUserAccounts,predicate);return retrievedRoles.length!=0?retrievedRoles:[];};this.getLOAs=function(){_this.LOAs=_this.retrieveRolesByRoleName(function(user){return user.isActivated==true&&_.some(user.roles,function(role){return(role.roleName=="Loan Officer Assistant");});});};this.isUserStateLicensedForLoan=function(userAccount){var stateId;if(_this.wrappedLoan.ref.getSubjectProperty().stateId){stateId=_this.wrappedLoan.ref.getSubjectProperty().stateId;}else{stateId=4;}var userLicensed=_.some(userAccount.licenses,function(license){return(license.stateId==stateId&&(!license.expireDate||new Date(license.expireDate)>new Date()));});var branchLicensed;if(userAccount.branchId){var userChannel;var userDivision;var userBranch;userChannel=_.find(_this.applicationData.companyProfile.channels,function(channel){return channel.channelId==userAccount.channelId;});if(userChannel){userDivision=_.find(userChannel.divisions,function(division){return division.divisionId==userAccount.divisionId;});}if(userDivision){userBranch=_.find(userDivision.branches,function(branch){return branch.branchId==userAccount.branchId;});}if(userBranch){if(_.some(userBranch.licenses,function(license){return license.stateId==stateId&&license.branchId==userAccount.branchId;})){branchLicensed=true;}}}return userLicensed&&branchLicensed;};this.close=function(){_this.$modalInstance.dismiss("cancel");};this.applyChanges=function(){var branchIdTemp;if(_this.loanNumber&&_this.loanNumber!=""){_this.wrappedLoan.ref.loanNumber=_this.loanNumber;}_this.wrappedLoan.ref.conciergeId=_this.conciergeId;_this.wrappedLoan.ref.conciergeFullName=_this.conciergeFullName;_this.wrappedLoan.ref.salesManagerId=_this.salesManagerId;_this.wrappedLoan.ref.teamLeaderId=_this.teamLeaderId;_this.wrappedLoan.ref.loaId=_this.LOAId;_this.wrappedLoan.ref.loaFullName=_this.LOAFullName;_this.wrappedLoan.ref.enableDigitalDocsCall=_this.enableDigitalDocsCall;_this.wrappedLoan.ref.losFolderId=_this.losFolderId;if(_this.loanProcessorId){_this.wrappedLoan.ref.callCenterId=_this.loanProcessorId;}if(_this.conciergeId){branchIdTemp=_this.getBranchIdByAccountId(_this.loanAssignmentUserAccounts,_this.conciergeId);if(_this.wrappedLoan.ref.branchId=="00000000-0000-0000-0000-000000000000"){_this.wrappedLoan.ref.branchId=branchIdTemp;}}else{if(_this.LOAId){branchIdTemp=_this.getBranchIdByAccountId(_this.loanAssignmentUserAccounts,_this.LOAId);if(_this.wrappedLoan.ref.branchId=="00000000-0000-0000-0000-000000000000"){_this.wrappedLoan.ref.branchId=branchIdTemp;}}}if(_this.channelId&&_this.channelId!=-1&&_this.divisionId&&_this.divisionId!=-1&&_this.branchId&&_this.branchId!=="00000000-0000-0000-0000-000000000000"){_this.wrappedLoan.ref.channelId=_this.channelId;_this.wrappedLoan.ref.divisionId=_this.divisionId;_this.wrappedLoan.ref.branchId=_this.branchId;}else{if(branchIdTemp){var userTemp;if(_this.conciergeId){userTemp=_this.getUserByBranchId(_this.concierges,branchIdTemp);}else{if(_this.LOAId){userTemp=_this.getUserByBranchId(_this.LOAs,branchIdTemp);}}_this.wrappedLoan.ref.channelId=userTemp.channelId;_this.wrappedLoan.ref.divisionId=userTemp.divisionId;}}_this.applicationData.lookup.currentLoanLicensedStatesForLO=_this.wrappedLoan.ref.getLicencedStates(_this.applicationData);_this.saveAll();_this.close();};this.save=function(){};this.saveAndClose=function(){_this.save();_this.close();};this.saveAll=function(){_this.navigationSvc.SaveAndUpdateWrappedLoan(_this.applicationData.currentUserId,_this.wrappedLoan);};this.isEditable=function(){return _this.applicationData.currentUser.hasPrivilege(_this.enums.privileges.EditLoanAssignments);};this.navigationSvc=NavigationSvc;this.loanAssignmentUserAccounts=applicationData.companyEmployees.userAccounts;this.init();}AssignmentsController.className="AssignmentsController";AssignmentsController.$inject=["wrappedLoan","enums","NavigationSvc","$state","$modalInstance","applicationData"];return AssignmentsController;})();loan.AssignmentsController=AssignmentsController;angular.module("assignments").controller("AssignmentsController",AssignmentsController);})(loan||(loan={}));var srv;(function(srv){(function(AccountNameEnum){AccountNameEnum[AccountNameEnum["Default"]=0]="Default";AccountNameEnum[AccountNameEnum["Buyer"]=1]="Buyer";AccountNameEnum[AccountNameEnum["Seller"]=2]="Seller";AccountNameEnum[AccountNameEnum["Ghost"]=3]="Ghost";})(srv.AccountNameEnum||(srv.AccountNameEnum={}));var AccountNameEnum=srv.AccountNameEnum;(function(AccountOwnershipTypeEnum){AccountOwnershipTypeEnum[AccountOwnershipTypeEnum["AuthorizedUser"]=0]="AuthorizedUser";AccountOwnershipTypeEnum[AccountOwnershipTypeEnum["Comaker"]=1]="Comaker";AccountOwnershipTypeEnum[AccountOwnershipTypeEnum["Individual"]=2]="Individual";AccountOwnershipTypeEnum[AccountOwnershipTypeEnum["JointContractualLiability"]=3]="JointContractualLiability";AccountOwnershipTypeEnum[AccountOwnershipTypeEnum["JointParticipating"]=4]="JointParticipating";AccountOwnershipTypeEnum[AccountOwnershipTypeEnum["Maker"]=5]="Maker";AccountOwnershipTypeEnum[AccountOwnershipTypeEnum["OnBehalfOf"]=6]="OnBehalfOf";AccountOwnershipTypeEnum[AccountOwnershipTypeEnum["Terminated"]=7]="Terminated";AccountOwnershipTypeEnum[AccountOwnershipTypeEnum["Undesignated"]=8]="Undesignated";AccountOwnershipTypeEnum[AccountOwnershipTypeEnum["Deceased"]=9]="Deceased";AccountOwnershipTypeEnum[AccountOwnershipTypeEnum["None"]=-1]="None";})(srv.AccountOwnershipTypeEnum||(srv.AccountOwnershipTypeEnum={}));var AccountOwnershipTypeEnum=srv.AccountOwnershipTypeEnum;(function(AccountTypeEnum){AccountTypeEnum[AccountTypeEnum["Default"]=0]="Default";AccountTypeEnum[AccountTypeEnum["Asset"]=1]="Asset";AccountTypeEnum[AccountTypeEnum["Liability"]=2]="Liability";AccountTypeEnum[AccountTypeEnum["Income"]=3]="Income";AccountTypeEnum[AccountTypeEnum["Expense"]=4]="Expense";AccountTypeEnum[AccountTypeEnum["Capital"]=5]="Capital";})(srv.AccountTypeEnum||(srv.AccountTypeEnum={}));var AccountTypeEnum=srv.AccountTypeEnum;(function(AddressTypeEnum){AddressTypeEnum[AddressTypeEnum["Default"]=0]="Default";AddressTypeEnum[AddressTypeEnum["Present"]=1]="Present";AddressTypeEnum[AddressTypeEnum["Former"]=2]="Former";AddressTypeEnum[AddressTypeEnum["Mailing"]=3]="Mailing";AddressTypeEnum[AddressTypeEnum["Billing"]=4]="Billing";AddressTypeEnum[AddressTypeEnum["GovernmentMonitoring"]=5]="GovernmentMonitoring";AddressTypeEnum[AddressTypeEnum["RealEstate"]=6]="RealEstate";})(srv.AddressTypeEnum||(srv.AddressTypeEnum={}));var AddressTypeEnum=srv.AddressTypeEnum;(function(AmortizationTypeEnum){AmortizationTypeEnum[AmortizationTypeEnum["None"]=0]="None";AmortizationTypeEnum[AmortizationTypeEnum["Fixed"]=1]="Fixed";AmortizationTypeEnum[AmortizationTypeEnum["ARM"]=2]="ARM";AmortizationTypeEnum[AmortizationTypeEnum["GPM"]=3]="GPM";AmortizationTypeEnum[AmortizationTypeEnum["Other"]=4]="Other";})(srv.AmortizationTypeEnum||(srv.AmortizationTypeEnum={}));var AmortizationTypeEnum=srv.AmortizationTypeEnum;(function(AmountMethodEnum){AmountMethodEnum[AmountMethodEnum["Manual"]=0]="Manual";AmountMethodEnum[AmountMethodEnum["Itemized"]=1]="Itemized";AmountMethodEnum[AmountMethodEnum["Calculated"]=2]="Calculated";AmountMethodEnum[AmountMethodEnum["MonthlyMI"]=3]="MonthlyMI";AmountMethodEnum[AmountMethodEnum["SinglePremiumNonRefundable"]=4]="SinglePremiumNonRefundable";AmountMethodEnum[AmountMethodEnum["SinglePremiumRefundable"]=5]="SinglePremiumRefundable";})(srv.AmountMethodEnum||(srv.AmountMethodEnum={}));var AmountMethodEnum=srv.AmountMethodEnum;(function(AssetTypeEnum){AssetTypeEnum[AssetTypeEnum["Checking"]=0]="Checking";AssetTypeEnum[AssetTypeEnum["Savings"]=1]="Savings";AssetTypeEnum[AssetTypeEnum["CD"]=2]="CD";AssetTypeEnum[AssetTypeEnum["MutualFunds"]=3]="MutualFunds";AssetTypeEnum[AssetTypeEnum["Bonds"]=4]="Bonds";AssetTypeEnum[AssetTypeEnum["Stocks"]=5]="Stocks";AssetTypeEnum[AssetTypeEnum["MoneyMarket"]=6]="MoneyMarket";AssetTypeEnum[AssetTypeEnum["RetirementFund"]=7]="RetirementFund";AssetTypeEnum[AssetTypeEnum["IRA"]=8]="IRA";AssetTypeEnum[AssetTypeEnum["GiftFunds"]=9]="GiftFunds";AssetTypeEnum[AssetTypeEnum["EscrowDeposit"]=10]="EscrowDeposit";AssetTypeEnum[AssetTypeEnum["ProceedsfromaPropertySale"]=11]="ProceedsfromaPropertySale";AssetTypeEnum[AssetTypeEnum["TrustFunds"]=12]="TrustFunds";AssetTypeEnum[AssetTypeEnum["LifeInsuranceCashValue"]=13]="LifeInsuranceCashValue";AssetTypeEnum[AssetTypeEnum["Other"]=14]="Other";AssetTypeEnum[AssetTypeEnum["Automobile"]=15]="Automobile";AssetTypeEnum[AssetTypeEnum["SecuredBorrowerFundsNotDeposited"]=16]="SecuredBorrowerFundsNotDeposited";AssetTypeEnum[AssetTypeEnum["NotRequired"]=99]="NotRequired";AssetTypeEnum[AssetTypeEnum["None"]=-1]="None";})(srv.AssetTypeEnum||(srv.AssetTypeEnum={}));var AssetTypeEnum=srv.AssetTypeEnum;(function(AuditLogCategoryEnum){AuditLogCategoryEnum[AuditLogCategoryEnum["UserAccount"]=0]="UserAccount";AuditLogCategoryEnum[AuditLogCategoryEnum["LoanRelated"]=1]="LoanRelated";AuditLogCategoryEnum[AuditLogCategoryEnum["AppraisalRelated"]=2]="AppraisalRelated";})(srv.AuditLogCategoryEnum||(srv.AuditLogCategoryEnum={}));var AuditLogCategoryEnum=srv.AuditLogCategoryEnum;(function(AuditLogTypeEnum){AuditLogTypeEnum[AuditLogTypeEnum["AgreedToTerms"]=0]="AgreedToTerms";AuditLogTypeEnum[AuditLogTypeEnum["ActivatedAccount"]=1]="ActivatedAccount";AuditLogTypeEnum[AuditLogTypeEnum["AcceptedESign"]=2]="AcceptedESign";AuditLogTypeEnum[AuditLogTypeEnum["AcceptedCreditAuthorization"]=3]="AcceptedCreditAuthorization";AuditLogTypeEnum[AuditLogTypeEnum["CreditReportRetrieved"]=4]="CreditReportRetrieved";AuditLogTypeEnum[AuditLogTypeEnum["UploadedDocuments"]=5]="UploadedDocuments";AuditLogTypeEnum[AuditLogTypeEnum["LockedRate"]=6]="LockedRate";AuditLogTypeEnum[AuditLogTypeEnum["DisclosuresDelivered"]=7]="DisclosuresDelivered";AuditLogTypeEnum[AuditLogTypeEnum["AuthorizationFormsDelivered"]=8]="AuthorizationFormsDelivered";AuditLogTypeEnum[AuditLogTypeEnum["ReviewedDisclosures"]=9]="ReviewedDisclosures";AuditLogTypeEnum[AuditLogTypeEnum["FaxedAuthorizations"]=10]="FaxedAuthorizations";AuditLogTypeEnum[AuditLogTypeEnum["CreatedLoan"]=11]="CreatedLoan";AuditLogTypeEnum[AuditLogTypeEnum["CompletedActivity"]=12]="CompletedActivity";AuditLogTypeEnum[AuditLogTypeEnum["ChangedProfile"]=13]="ChangedProfile";AuditLogTypeEnum[AuditLogTypeEnum["LockRateRequested"]=14]="LockRateRequested";AuditLogTypeEnum[AuditLogTypeEnum["FNMImported"]=15]="FNMImported";AuditLogTypeEnum[AuditLogTypeEnum["eSignConsent"]=16]="eSignConsent";AuditLogTypeEnum[AuditLogTypeEnum["LoanStatusChanged"]=17]="LoanStatusChanged";AuditLogTypeEnum[AuditLogTypeEnum["AppraisalOrderRequested"]=18]="AppraisalOrderRequested";AuditLogTypeEnum[AuditLogTypeEnum["AppraisalOrderOrdered"]=19]="AppraisalOrderOrdered";AuditLogTypeEnum[AuditLogTypeEnum["AppraisalOrderDelivered"]=20]="AppraisalOrderDelivered";AuditLogTypeEnum[AuditLogTypeEnum["AppraisalOrderAcknowledged"]=21]="AppraisalOrderAcknowledged";AuditLogTypeEnum[AuditLogTypeEnum["ApplicationDateSet"]=22]="ApplicationDateSet";AuditLogTypeEnum[AuditLogTypeEnum["LoanApplicationCompleted"]=23]="LoanApplicationCompleted";AuditLogTypeEnum[AuditLogTypeEnum["InitialDisclosuresSent"]=24]="InitialDisclosuresSent";})(srv.AuditLogTypeEnum||(srv.AuditLogTypeEnum={}));var AuditLogTypeEnum=srv.AuditLogTypeEnum;(function(BorrowerContextTypeEnum){BorrowerContextTypeEnum[BorrowerContextTypeEnum["Borrower"]=0]="Borrower";BorrowerContextTypeEnum[BorrowerContextTypeEnum["CoBorrower"]=1]="CoBorrower";BorrowerContextTypeEnum[BorrowerContextTypeEnum["Both"]=2]="Both";})(srv.BorrowerContextTypeEnum||(srv.BorrowerContextTypeEnum={}));var BorrowerContextTypeEnum=srv.BorrowerContextTypeEnum;(function(BorrowerTypeEnum){BorrowerTypeEnum[BorrowerTypeEnum["Borrower"]=1]="Borrower";BorrowerTypeEnum[BorrowerTypeEnum["CoBorrower"]=2]="CoBorrower";})(srv.BorrowerTypeEnum||(srv.BorrowerTypeEnum={}));var BorrowerTypeEnum=srv.BorrowerTypeEnum;(function(BusinessContactCategoryTypeEnum){BusinessContactCategoryTypeEnum[BusinessContactCategoryTypeEnum["None"]=0]="None";BusinessContactCategoryTypeEnum[BusinessContactCategoryTypeEnum["Title"]=2]="Title";BusinessContactCategoryTypeEnum[BusinessContactCategoryTypeEnum["Escrow"]=3]="Escrow";BusinessContactCategoryTypeEnum[BusinessContactCategoryTypeEnum["SellerAgent"]=4]="SellerAgent";BusinessContactCategoryTypeEnum[BusinessContactCategoryTypeEnum["BuyerAgent"]=5]="BuyerAgent";BusinessContactCategoryTypeEnum[BusinessContactCategoryTypeEnum["PropertyManager"]=6]="PropertyManager";BusinessContactCategoryTypeEnum[BusinessContactCategoryTypeEnum["Others"]=7]="Others";BusinessContactCategoryTypeEnum[BusinessContactCategoryTypeEnum["Seller"]=10]="Seller";})(srv.BusinessContactCategoryTypeEnum||(srv.BusinessContactCategoryTypeEnum={}));var BusinessContactCategoryTypeEnum=srv.BusinessContactCategoryTypeEnum;(function(BusinessContactCategoryTypeMask){BusinessContactCategoryTypeMask[BusinessContactCategoryTypeMask["None"]=0]="None";BusinessContactCategoryTypeMask[BusinessContactCategoryTypeMask["Title"]=32]="Title";BusinessContactCategoryTypeMask[BusinessContactCategoryTypeMask["Escrow"]=64]="Escrow";BusinessContactCategoryTypeMask[BusinessContactCategoryTypeMask["SellerAgent"]=128]="SellerAgent";BusinessContactCategoryTypeMask[BusinessContactCategoryTypeMask["BuyerAgent"]=256]="BuyerAgent";BusinessContactCategoryTypeMask[BusinessContactCategoryTypeMask["PropertyManager"]=512]="PropertyManager";BusinessContactCategoryTypeMask[BusinessContactCategoryTypeMask["Others"]=1024]="Others";BusinessContactCategoryTypeMask[BusinessContactCategoryTypeMask["Seller"]=8192]="Seller";})(srv.BusinessContactCategoryTypeMask||(srv.BusinessContactCategoryTypeMask={}));var BusinessContactCategoryTypeMask=srv.BusinessContactCategoryTypeMask;(function(BusinessContactPhoneTypeEnum){BusinessContactPhoneTypeEnum[BusinessContactPhoneTypeEnum["Home"]=0]="Home";BusinessContactPhoneTypeEnum[BusinessContactPhoneTypeEnum["Cell"]=1]="Cell";BusinessContactPhoneTypeEnum[BusinessContactPhoneTypeEnum["Work"]=2]="Work";BusinessContactPhoneTypeEnum[BusinessContactPhoneTypeEnum["Other"]=3]="Other";BusinessContactPhoneTypeEnum[BusinessContactPhoneTypeEnum["None"]=-1]="None";})(srv.BusinessContactPhoneTypeEnum||(srv.BusinessContactPhoneTypeEnum={}));var BusinessContactPhoneTypeEnum=srv.BusinessContactPhoneTypeEnum;(function(CalculatedValueTypeEnum){CalculatedValueTypeEnum[CalculatedValueTypeEnum["Unknown"]=0]="Unknown";CalculatedValueTypeEnum[CalculatedValueTypeEnum["LTV"]=1]="LTV";CalculatedValueTypeEnum[CalculatedValueTypeEnum["DTIAndHousingRatio"]=2]="DTIAndHousingRatio";CalculatedValueTypeEnum[CalculatedValueTypeEnum["CLTV"]=3]="CLTV";CalculatedValueTypeEnum[CalculatedValueTypeEnum["HCLTV"]=4]="HCLTV";CalculatedValueTypeEnum[CalculatedValueTypeEnum["Apr"]=6]="Apr";CalculatedValueTypeEnum[CalculatedValueTypeEnum["NetRentalIncome"]=7]="NetRentalIncome";CalculatedValueTypeEnum[CalculatedValueTypeEnum["MonthlyPayment"]=8]="MonthlyPayment";CalculatedValueTypeEnum[CalculatedValueTypeEnum["Hud801And802"]=9]="Hud801And802";CalculatedValueTypeEnum[CalculatedValueTypeEnum["HousingExpenses"]=10]="HousingExpenses";CalculatedValueTypeEnum[CalculatedValueTypeEnum["InterestAmountPerDiem"]=11]="InterestAmountPerDiem";CalculatedValueTypeEnum[CalculatedValueTypeEnum["DetailsOfTransaction"]=12]="DetailsOfTransaction";CalculatedValueTypeEnum[CalculatedValueTypeEnum["RecalculatedCosts"]=13]="RecalculatedCosts";CalculatedValueTypeEnum[CalculatedValueTypeEnum["SubordinateFee"]=14]="SubordinateFee";CalculatedValueTypeEnum[CalculatedValueTypeEnum["FirstPaymentDate"]=15]="FirstPaymentDate";CalculatedValueTypeEnum[CalculatedValueTypeEnum["AgregateAdjustment"]=16]="AgregateAdjustment";CalculatedValueTypeEnum[CalculatedValueTypeEnum["VaFeeLimitsExceeded"]=17]="VaFeeLimitsExceeded";CalculatedValueTypeEnum[CalculatedValueTypeEnum["NewMonthlyPayment"]=18]="NewMonthlyPayment";CalculatedValueTypeEnum[CalculatedValueTypeEnum["NetTangibleBenefit"]=19]="NetTangibleBenefit";CalculatedValueTypeEnum[CalculatedValueTypeEnum["QMCertification"]=20]="QMCertification";CalculatedValueTypeEnum[CalculatedValueTypeEnum["LoanDecisionScore"]=21]="LoanDecisionScore";CalculatedValueTypeEnum[CalculatedValueTypeEnum["FullyIndexedRate"]=22]="FullyIndexedRate";CalculatedValueTypeEnum[CalculatedValueTypeEnum["IsImpoundMandatory"]=23]="IsImpoundMandatory";CalculatedValueTypeEnum[CalculatedValueTypeEnum["RecoupmentPeriod"]=24]="RecoupmentPeriod";CalculatedValueTypeEnum[CalculatedValueTypeEnum["FHACalculator"]=25]="FHACalculator";})(srv.CalculatedValueTypeEnum||(srv.CalculatedValueTypeEnum={}));var CalculatedValueTypeEnum=srv.CalculatedValueTypeEnum;(function(CalculationTypeEnum){CalculationTypeEnum[CalculationTypeEnum["None"]=0]="None";CalculationTypeEnum[CalculationTypeEnum["Tax"]=1]="Tax";CalculationTypeEnum[CalculationTypeEnum["HOI"]=2]="HOI";})(srv.CalculationTypeEnum||(srv.CalculationTypeEnum={}));var CalculationTypeEnum=srv.CalculationTypeEnum;(function(CertificationIdEnum){CertificationIdEnum[CertificationIdEnum["SelectOne"]=0]="SelectOne";CertificationIdEnum[CertificationIdEnum["ValidStateDriverLicense"]=1]="ValidStateDriverLicense";CertificationIdEnum[CertificationIdEnum["ValidStateIdentificationCard"]=2]="ValidStateIdentificationCard";CertificationIdEnum[CertificationIdEnum["MilitaryIdentificationCard"]=3]="MilitaryIdentificationCard";CertificationIdEnum[CertificationIdEnum["MilitaryDependentsPhotoID"]=4]="MilitaryDependentsPhotoID";CertificationIdEnum[CertificationIdEnum["USPassport"]=5]="USPassport";CertificationIdEnum[CertificationIdEnum["NonUSPassport"]=6]="NonUSPassport";CertificationIdEnum[CertificationIdEnum["ResidentAlienCard"]=7]="ResidentAlienCard";CertificationIdEnum[CertificationIdEnum["DepartmentOfPublicWelfarePhotoID"]=8]="DepartmentOfPublicWelfarePhotoID";CertificationIdEnum[CertificationIdEnum["StudentPhotoID"]=9]="StudentPhotoID";CertificationIdEnum[CertificationIdEnum["WorkIDWithPhoto"]=10]="WorkIDWithPhoto";CertificationIdEnum[CertificationIdEnum["MedicareCard"]=11]="MedicareCard";CertificationIdEnum[CertificationIdEnum["CustomerIDValidationCheck"]=12]="CustomerIDValidationCheck";CertificationIdEnum[CertificationIdEnum["ClosingCertification"]=13]="ClosingCertification";CertificationIdEnum[CertificationIdEnum["Other"]=14]="Other";})(srv.CertificationIdEnum||(srv.CertificationIdEnum={}));var CertificationIdEnum=srv.CertificationIdEnum;(function(ComplianceCheckStatusEnum){ComplianceCheckStatusEnum[ComplianceCheckStatusEnum["NotRun"]=0]="NotRun";ComplianceCheckStatusEnum[ComplianceCheckStatusEnum["Passed"]=1]="Passed";ComplianceCheckStatusEnum[ComplianceCheckStatusEnum["Failed"]=2]="Failed";ComplianceCheckStatusEnum[ComplianceCheckStatusEnum["InProgress"]=3]="InProgress";})(srv.ComplianceCheckStatusEnum||(srv.ComplianceCheckStatusEnum={}));var ComplianceCheckStatusEnum=srv.ComplianceCheckStatusEnum;(function(ComplianceResultDetailTypeEnum){ComplianceResultDetailTypeEnum[ComplianceResultDetailTypeEnum["ReportedDataError"]=1]="ReportedDataError";ComplianceResultDetailTypeEnum[ComplianceResultDetailTypeEnum["ReportedSystemError"]=2]="ReportedSystemError";})(srv.ComplianceResultDetailTypeEnum||(srv.ComplianceResultDetailTypeEnum={}));var ComplianceResultDetailTypeEnum=srv.ComplianceResultDetailTypeEnum;(function(Concurrent2ndMortgageEnum){Concurrent2ndMortgageEnum[Concurrent2ndMortgageEnum["No"]=0]="No";Concurrent2ndMortgageEnum[Concurrent2ndMortgageEnum["Fixed"]=1]="Fixed";Concurrent2ndMortgageEnum[Concurrent2ndMortgageEnum["HELOC"]=2]="HELOC";})(srv.Concurrent2ndMortgageEnum||(srv.Concurrent2ndMortgageEnum={}));var Concurrent2ndMortgageEnum=srv.Concurrent2ndMortgageEnum;(function(ConsentStatusEnum){ConsentStatusEnum[ConsentStatusEnum["None"]=0]="None";ConsentStatusEnum[ConsentStatusEnum["Accept"]=1]="Accept";ConsentStatusEnum[ConsentStatusEnum["Decline"]=2]="Decline";})(srv.ConsentStatusEnum||(srv.ConsentStatusEnum={}));var ConsentStatusEnum=srv.ConsentStatusEnum;(function(CostContainer){CostContainer[CostContainer["LoanCosts"]=1]="LoanCosts";CostContainer[CostContainer["OtherCosts"]=2]="OtherCosts";CostContainer[CostContainer["LenderCredits"]=3]="LenderCredits";CostContainer[CostContainer["CreditCosts"]=4]="CreditCosts";})(srv.CostContainer||(srv.CostContainer={}));var CostContainer=srv.CostContainer;(function(CostPaidByTypeEnum){CostPaidByTypeEnum[CostPaidByTypeEnum["Borrower"]=0]="Borrower";CostPaidByTypeEnum[CostPaidByTypeEnum["Broker"]=1]="Broker";CostPaidByTypeEnum[CostPaidByTypeEnum["Lender"]=2]="Lender";CostPaidByTypeEnum[CostPaidByTypeEnum["Other"]=3]="Other";CostPaidByTypeEnum[CostPaidByTypeEnum["EscrowCompany"]=4]="EscrowCompany";CostPaidByTypeEnum[CostPaidByTypeEnum["LenderRebate"]=5]="LenderRebate";CostPaidByTypeEnum[CostPaidByTypeEnum["LenderBranch"]=6]="LenderBranch";CostPaidByTypeEnum[CostPaidByTypeEnum["LenderCorporate"]=7]="LenderCorporate";CostPaidByTypeEnum[CostPaidByTypeEnum["LenderDivision"]=8]="LenderDivision";CostPaidByTypeEnum[CostPaidByTypeEnum["LenderLoanOfficer"]=9]="LenderLoanOfficer";CostPaidByTypeEnum[CostPaidByTypeEnum["Seller"]=10]="Seller";})(srv.CostPaidByTypeEnum||(srv.CostPaidByTypeEnum={}));var CostPaidByTypeEnum=srv.CostPaidByTypeEnum;(function(CostPaidToTypeEnum){CostPaidToTypeEnum[CostPaidToTypeEnum["Borrower"]=1]="Borrower";CostPaidToTypeEnum[CostPaidToTypeEnum["Seller"]=2]="Seller";CostPaidToTypeEnum[CostPaidToTypeEnum["Lender"]=3]="Lender";CostPaidToTypeEnum[CostPaidToTypeEnum["Other"]=10]="Other";})(srv.CostPaidToTypeEnum||(srv.CostPaidToTypeEnum={}));var CostPaidToTypeEnum=srv.CostPaidToTypeEnum;(function(CostSectionTypeEnum){CostSectionTypeEnum[CostSectionTypeEnum["OriginationCharges"]=1]="OriginationCharges";CostSectionTypeEnum[CostSectionTypeEnum["ServicesBorrowerDidNotShopFor"]=2]="ServicesBorrowerDidNotShopFor";CostSectionTypeEnum[CostSectionTypeEnum["ServicesBorrowerDidShopFor"]=3]="ServicesBorrowerDidShopFor";CostSectionTypeEnum[CostSectionTypeEnum["TaxesAndOtherGovermentFees"]=4]="TaxesAndOtherGovermentFees";CostSectionTypeEnum[CostSectionTypeEnum["Prepaids"]=5]="Prepaids";CostSectionTypeEnum[CostSectionTypeEnum["InitialEscowPaymentAtClosing"]=6]="InitialEscowPaymentAtClosing";CostSectionTypeEnum[CostSectionTypeEnum["Other"]=7]="Other";CostSectionTypeEnum[CostSectionTypeEnum["LenderCredits"]=8]="LenderCredits";})(srv.CostSectionTypeEnum||(srv.CostSectionTypeEnum={}));var CostSectionTypeEnum=srv.CostSectionTypeEnum;(function(CostTypeEnum){CostTypeEnum[CostTypeEnum["EstimatedLenderCosts"]=0]="EstimatedLenderCosts";CostTypeEnum[CostTypeEnum["EstimatedThirdPartyCosts"]=1]="EstimatedThirdPartyCosts";CostTypeEnum[CostTypeEnum["Prepaids"]=2]="Prepaids";CostTypeEnum[CostTypeEnum["EstimatedReservesDepositedwithLender"]=3]="EstimatedReservesDepositedwithLender";})(srv.CostTypeEnum||(srv.CostTypeEnum={}));var CostTypeEnum=srv.CostTypeEnum;(function(DebtCommentTypeEnum){DebtCommentTypeEnum[DebtCommentTypeEnum["Agree"]=0]="Agree";DebtCommentTypeEnum[DebtCommentTypeEnum["Disagree"]=1]="Disagree";DebtCommentTypeEnum[DebtCommentTypeEnum["PaidOff"]=3]="PaidOff";DebtCommentTypeEnum[DebtCommentTypeEnum["PayoffAtClose"]=4]="PayoffAtClose";DebtCommentTypeEnum[DebtCommentTypeEnum["AccountNotMine"]=5]="AccountNotMine";DebtCommentTypeEnum[DebtCommentTypeEnum["Duplicate"]=6]="Duplicate";DebtCommentTypeEnum[DebtCommentTypeEnum["NotMyLoan"]=7]="NotMyLoan";DebtCommentTypeEnum[DebtCommentTypeEnum["SomeoneElsePays"]=8]="SomeoneElsePays";DebtCommentTypeEnum[DebtCommentTypeEnum["NonBorrowingSpouse"]=9]="NonBorrowingSpouse";})(srv.DebtCommentTypeEnum||(srv.DebtCommentTypeEnum={}));var DebtCommentTypeEnum=srv.DebtCommentTypeEnum;(function(DebtsAccountOwnershipTypeEnum){DebtsAccountOwnershipTypeEnum[DebtsAccountOwnershipTypeEnum["Borrower"]=0]="Borrower";DebtsAccountOwnershipTypeEnum[DebtsAccountOwnershipTypeEnum["CoBorrower"]=1]="CoBorrower";DebtsAccountOwnershipTypeEnum[DebtsAccountOwnershipTypeEnum["Joint"]=2]="Joint";DebtsAccountOwnershipTypeEnum[DebtsAccountOwnershipTypeEnum["BorrowerWithOther"]=3]="BorrowerWithOther";DebtsAccountOwnershipTypeEnum[DebtsAccountOwnershipTypeEnum["CoBorrowerWithOther"]=4]="CoBorrowerWithOther";})(srv.DebtsAccountOwnershipTypeEnum||(srv.DebtsAccountOwnershipTypeEnum={}));var DebtsAccountOwnershipTypeEnum=srv.DebtsAccountOwnershipTypeEnum;(function(DisclosureStatusEnum){DisclosureStatusEnum[DisclosureStatusEnum["NotNeeded"]=1]="NotNeeded";DisclosureStatusEnum[DisclosureStatusEnum["InitialDisclosureRequired"]=2]="InitialDisclosureRequired";DisclosureStatusEnum[DisclosureStatusEnum["ReDisclosureRequired"]=3]="ReDisclosureRequired";DisclosureStatusEnum[DisclosureStatusEnum["RequestInProgress"]=4]="RequestInProgress";DisclosureStatusEnum[DisclosureStatusEnum["DisclosuresCreated"]=5]="DisclosuresCreated";})(srv.DisclosureStatusEnum||(srv.DisclosureStatusEnum={}));var DisclosureStatusEnum=srv.DisclosureStatusEnum;(function(DocDeliveryTypeEnum){DocDeliveryTypeEnum[DocDeliveryTypeEnum["Mail"]=0]="Mail";DocDeliveryTypeEnum[DocDeliveryTypeEnum["Electronic"]=1]="Electronic";})(srv.DocDeliveryTypeEnum||(srv.DocDeliveryTypeEnum={}));var DocDeliveryTypeEnum=srv.DocDeliveryTypeEnum;(function(DocumentClassEnum){DocumentClassEnum[DocumentClassEnum["None"]=0]="None";DocumentClassEnum[DocumentClassEnum["IncomeVerification"]=1]="IncomeVerification";DocumentClassEnum[DocumentClassEnum["LoanDisclosuresPackage"]=2]="LoanDisclosuresPackage";DocumentClassEnum[DocumentClassEnum["AppraisalReport"]=3]="AppraisalReport";DocumentClassEnum[DocumentClassEnum["CreditReport"]=4]="CreditReport";DocumentClassEnum[DocumentClassEnum["Authorization"]=5]="Authorization";DocumentClassEnum[DocumentClassEnum["AuthorizationsPackage"]=6]="AuthorizationsPackage";DocumentClassEnum[DocumentClassEnum["OtherDocuments"]=7]="OtherDocuments";DocumentClassEnum[DocumentClassEnum["LoanReDisclosuresPackage"]=8]="LoanReDisclosuresPackage";DocumentClassEnum[DocumentClassEnum["MiscellaneousDocuments"]=9]="MiscellaneousDocuments";DocumentClassEnum[DocumentClassEnum["SmartGFEComplianceCertificate"]=10]="SmartGFEComplianceCertificate";DocumentClassEnum[DocumentClassEnum["PreApprovalLetter"]=11]="PreApprovalLetter";DocumentClassEnum[DocumentClassEnum["Collateral"]=12]="Collateral";DocumentClassEnum[DocumentClassEnum["VariousDocuments"]=13]="VariousDocuments";DocumentClassEnum[DocumentClassEnum["AppraisalDocuments"]=14]="AppraisalDocuments";DocumentClassEnum[DocumentClassEnum["CounterOfferApprovalLetter"]=15]="CounterOfferApprovalLetter";DocumentClassEnum[DocumentClassEnum["CounterOfferApprovalLetterInitialDisclousure"]=16]="CounterOfferApprovalLetterInitialDisclousure";DocumentClassEnum[DocumentClassEnum["InitialDisclosuresMailingCoverLetter"]=17]="InitialDisclosuresMailingCoverLetter";DocumentClassEnum[DocumentClassEnum["ReDisclosuresMailingCoverLetter"]=18]="ReDisclosuresMailingCoverLetter";DocumentClassEnum[DocumentClassEnum["HudBooklet"]=19]="HudBooklet";DocumentClassEnum[DocumentClassEnum["LoanDisclosuresDocuments"]=20]="LoanDisclosuresDocuments";DocumentClassEnum[DocumentClassEnum["BorrowersNeedsListToBeCompleted"]=21]="BorrowersNeedsListToBeCompleted";DocumentClassEnum[DocumentClassEnum["Other"]=99]="Other";})(srv.DocumentClassEnum||(srv.DocumentClassEnum={}));var DocumentClassEnum=srv.DocumentClassEnum;(function(ElectronicAddressTypeEnum){ElectronicAddressTypeEnum[ElectronicAddressTypeEnum["HomePhone"]=0]="HomePhone";ElectronicAddressTypeEnum[ElectronicAddressTypeEnum["CellPhone"]=1]="CellPhone";ElectronicAddressTypeEnum[ElectronicAddressTypeEnum["WorkPhone"]=2]="WorkPhone";ElectronicAddressTypeEnum[ElectronicAddressTypeEnum["OtherPhone"]=3]="OtherPhone";ElectronicAddressTypeEnum[ElectronicAddressTypeEnum["Email"]=4]="Email";ElectronicAddressTypeEnum[ElectronicAddressTypeEnum["WorkEmail"]=5]="WorkEmail";ElectronicAddressTypeEnum[ElectronicAddressTypeEnum["Fax"]=6]="Fax";ElectronicAddressTypeEnum[ElectronicAddressTypeEnum["Unspecified"]=-1]="Unspecified";})(srv.ElectronicAddressTypeEnum||(srv.ElectronicAddressTypeEnum={}));var ElectronicAddressTypeEnum=srv.ElectronicAddressTypeEnum;(function(EmploymentStatusEnum){EmploymentStatusEnum[EmploymentStatusEnum["Current"]=1]="Current";EmploymentStatusEnum[EmploymentStatusEnum["Previous"]=2]="Previous";})(srv.EmploymentStatusEnum||(srv.EmploymentStatusEnum={}));var EmploymentStatusEnum=srv.EmploymentStatusEnum;(function(EmploymentTypeEnum){EmploymentTypeEnum[EmploymentTypeEnum["ActiveMilitaryDuty"]=0]="ActiveMilitaryDuty";EmploymentTypeEnum[EmploymentTypeEnum["SalariedEmployee"]=1]="SalariedEmployee";EmploymentTypeEnum[EmploymentTypeEnum["SelfEmployed"]=2]="SelfEmployed";EmploymentTypeEnum[EmploymentTypeEnum["Retired"]=3]="Retired";EmploymentTypeEnum[EmploymentTypeEnum["OtherOrUnemployed"]=4]="OtherOrUnemployed";EmploymentTypeEnum[EmploymentTypeEnum["None"]=-1]="None";})(srv.EmploymentTypeEnum||(srv.EmploymentTypeEnum={}));var EmploymentTypeEnum=srv.EmploymentTypeEnum;(function(EncompassRecordFieldNameEnum){EncompassRecordFieldNameEnum[EncompassRecordFieldNameEnum["Status"]=1]="Status";EncompassRecordFieldNameEnum[EncompassRecordFieldNameEnum["StatusDate"]=2]="StatusDate";EncompassRecordFieldNameEnum[EncompassRecordFieldNameEnum["IPAddress"]=3]="IPAddress";EncompassRecordFieldNameEnum[EncompassRecordFieldNameEnum["Source"]=4]="Source";EncompassRecordFieldNameEnum[EncompassRecordFieldNameEnum["CoBorrowerStatus"]=5]="CoBorrowerStatus";EncompassRecordFieldNameEnum[EncompassRecordFieldNameEnum["CoBorrowerStatusDate"]=6]="CoBorrowerStatusDate";EncompassRecordFieldNameEnum[EncompassRecordFieldNameEnum["CoBorrowerIPAddress"]=7]="CoBorrowerIPAddress";EncompassRecordFieldNameEnum[EncompassRecordFieldNameEnum["CoBorrowerSource"]=8]="CoBorrowerSource";})(srv.EncompassRecordFieldNameEnum||(srv.EncompassRecordFieldNameEnum={}));var EncompassRecordFieldNameEnum=srv.EncompassRecordFieldNameEnum;(function(EncompassRecordNameEnum){EncompassRecordNameEnum[EncompassRecordNameEnum["eConsentRecord"]=1]="eConsentRecord";EncompassRecordNameEnum[EncompassRecordNameEnum["IntentToProceed"]=2]="IntentToProceed";})(srv.EncompassRecordNameEnum||(srv.EncompassRecordNameEnum={}));var EncompassRecordNameEnum=srv.EncompassRecordNameEnum;(function(ExistingSecondMortgageTypeEnum){ExistingSecondMortgageTypeEnum[ExistingSecondMortgageTypeEnum["NoExistingMortgage"]=0]="NoExistingMortgage";ExistingSecondMortgageTypeEnum[ExistingSecondMortgageTypeEnum["Fixed"]=1]="Fixed";ExistingSecondMortgageTypeEnum[ExistingSecondMortgageTypeEnum["HELOC"]=2]="HELOC";})(srv.ExistingSecondMortgageTypeEnum||(srv.ExistingSecondMortgageTypeEnum={}));var ExistingSecondMortgageTypeEnum=srv.ExistingSecondMortgageTypeEnum;(function(FeeCategoryEnum){FeeCategoryEnum[FeeCategoryEnum["None"]=0]="None";FeeCategoryEnum[FeeCategoryEnum["Escrow"]=1]="Escrow";FeeCategoryEnum[FeeCategoryEnum["Title"]=2]="Title";FeeCategoryEnum[FeeCategoryEnum["PestInspection"]=3]="PestInspection";})(srv.FeeCategoryEnum||(srv.FeeCategoryEnum={}));var FeeCategoryEnum=srv.FeeCategoryEnum;(function(FHAProductsEnum){FHAProductsEnum[FHAProductsEnum["None"]=0]="None";FHAProductsEnum[FHAProductsEnum["StreamlineRefinance"]=1]="StreamlineRefinance";FHAProductsEnum[FHAProductsEnum["RateAndTermRefinance"]=2]="RateAndTermRefinance";FHAProductsEnum[FHAProductsEnum["SimpleRefinance"]=3]="SimpleRefinance";FHAProductsEnum[FHAProductsEnum["CashOutRefinance"]=4]="CashOutRefinance";FHAProductsEnum[FHAProductsEnum["Purchase"]=5]="Purchase";FHAProductsEnum[FHAProductsEnum["PurchaseDown"]=6]="PurchaseDown";})(srv.FHAProductsEnum||(srv.FHAProductsEnum={}));var FHAProductsEnum=srv.FHAProductsEnum;(function(FHAPropertyOccupiedForEnum){FHAPropertyOccupiedForEnum[FHAPropertyOccupiedForEnum["LessThanOneYear"]=1]="LessThanOneYear";FHAPropertyOccupiedForEnum[FHAPropertyOccupiedForEnum["MoreThanOneYear"]=2]="MoreThanOneYear";})(srv.FHAPropertyOccupiedForEnum||(srv.FHAPropertyOccupiedForEnum={}));var FHAPropertyOccupiedForEnum=srv.FHAPropertyOccupiedForEnum;(function(FormNameEnum){FormNameEnum[FormNameEnum["Default"]=0]="Default";FormNameEnum[FormNameEnum["TransactionSummaryViewModel"]=1]="TransactionSummaryViewModel";})(srv.FormNameEnum||(srv.FormNameEnum={}));var FormNameEnum=srv.FormNameEnum;(function(GFETypeEnum){GFETypeEnum[GFETypeEnum["WhatIf"]=0]="WhatIf";GFETypeEnum[GFETypeEnum["SmartGFE"]=1]="SmartGFE";})(srv.GFETypeEnum||(srv.GFETypeEnum={}));var GFETypeEnum=srv.GFETypeEnum;(function(GovermentEligibilityEnum){GovermentEligibilityEnum[GovermentEligibilityEnum["None"]=0]="None";GovermentEligibilityEnum[GovermentEligibilityEnum["FHAEligible"]=1]="FHAEligible";GovermentEligibilityEnum[GovermentEligibilityEnum["FHANotEligible"]=2]="FHANotEligible";GovermentEligibilityEnum[GovermentEligibilityEnum["VAEligible"]=3]="VAEligible";GovermentEligibilityEnum[GovermentEligibilityEnum["VANotEligible"]=4]="VANotEligible";GovermentEligibilityEnum[GovermentEligibilityEnum["USDAEligible"]=5]="USDAEligible";GovermentEligibilityEnum[GovermentEligibilityEnum["USDANotEligible"]=6]="USDANotEligible";})(srv.GovermentEligibilityEnum||(srv.GovermentEligibilityEnum={}));var GovermentEligibilityEnum=srv.GovermentEligibilityEnum;(function(HomeBuyingTypeEnum){HomeBuyingTypeEnum[HomeBuyingTypeEnum["None"]=0]="None";HomeBuyingTypeEnum[HomeBuyingTypeEnum["OfferAccepted"]=1]="OfferAccepted";HomeBuyingTypeEnum[HomeBuyingTypeEnum["OfferPendingFoundAHouse"]=2]="OfferPendingFoundAHouse";HomeBuyingTypeEnum[HomeBuyingTypeEnum["GetPreApproved"]=3]="GetPreApproved";HomeBuyingTypeEnum[HomeBuyingTypeEnum["WhatCanIAfford"]=4]="WhatCanIAfford";})(srv.HomeBuyingTypeEnum||(srv.HomeBuyingTypeEnum={}));var HomeBuyingTypeEnum=srv.HomeBuyingTypeEnum;(function(IncomeTypeEnum){IncomeTypeEnum[IncomeTypeEnum["BaseEmployment"]=0]="BaseEmployment";IncomeTypeEnum[IncomeTypeEnum["Overtime"]=1]="Overtime";IncomeTypeEnum[IncomeTypeEnum["Bonuses"]=2]="Bonuses";IncomeTypeEnum[IncomeTypeEnum["Commissions"]=3]="Commissions";IncomeTypeEnum[IncomeTypeEnum["DividendsInterest"]=4]="DividendsInterest";IncomeTypeEnum[IncomeTypeEnum["NetRental"]=5]="NetRental";IncomeTypeEnum[IncomeTypeEnum["Other"]=6]="Other";IncomeTypeEnum[IncomeTypeEnum["TrustIncome"]=7]="TrustIncome";IncomeTypeEnum[IncomeTypeEnum["AlimonyChildSupport"]=8]="AlimonyChildSupport";IncomeTypeEnum[IncomeTypeEnum["AutomobileExpenseAccount"]=9]="AutomobileExpenseAccount";IncomeTypeEnum[IncomeTypeEnum["FosterCare"]=10]="FosterCare";IncomeTypeEnum[IncomeTypeEnum["MilitaryBasePay"]=11]="MilitaryBasePay";IncomeTypeEnum[IncomeTypeEnum["NotesReceivableInstallment"]=12]="NotesReceivableInstallment";IncomeTypeEnum[IncomeTypeEnum["PartTime"]=13]="PartTime";IncomeTypeEnum[IncomeTypeEnum["SocialSecurity"]=14]="SocialSecurity";IncomeTypeEnum[IncomeTypeEnum["DisabilityIncome"]=15]="DisabilityIncome";IncomeTypeEnum[IncomeTypeEnum["SelfEmployedIncome"]=16]="SelfEmployedIncome";IncomeTypeEnum[IncomeTypeEnum["RetirementPensionIncome"]=17]="RetirementPensionIncome";IncomeTypeEnum[IncomeTypeEnum["MilitaryClothesAllows"]=18]="MilitaryClothesAllows";IncomeTypeEnum[IncomeTypeEnum["MilitaryCombatPay"]=19]="MilitaryCombatPay";IncomeTypeEnum[IncomeTypeEnum["MilitaryFlightPay"]=20]="MilitaryFlightPay";IncomeTypeEnum[IncomeTypeEnum["MilitaryHazardPay"]=21]="MilitaryHazardPay";IncomeTypeEnum[IncomeTypeEnum["MilitaryOverseasPay"]=22]="MilitaryOverseasPay";IncomeTypeEnum[IncomeTypeEnum["MilitaryPropPay"]=23]="MilitaryPropPay";IncomeTypeEnum[IncomeTypeEnum["MilitaryQuartersAllowance"]=24]="MilitaryQuartersAllowance";IncomeTypeEnum[IncomeTypeEnum["MilitaryRationsAllowance"]=25]="MilitaryRationsAllowance";IncomeTypeEnum[IncomeTypeEnum["MilitaryVariableHousingAllowance"]=26]="MilitaryVariableHousingAllowance";IncomeTypeEnum[IncomeTypeEnum["Unemployment"]=27]="Unemployment";IncomeTypeEnum[IncomeTypeEnum["VABenefitsNonEducational"]=28]="VABenefitsNonEducational";})(srv.IncomeTypeEnum||(srv.IncomeTypeEnum={}));var IncomeTypeEnum=srv.IncomeTypeEnum;(function(IncomeTypeNetRentalEnum){IncomeTypeNetRentalEnum[IncomeTypeNetRentalEnum["AdjustedNetRentalIncome"]=1]="AdjustedNetRentalIncome";IncomeTypeNetRentalEnum[IncomeTypeNetRentalEnum["NetRentalIncome"]=2]="NetRentalIncome";IncomeTypeNetRentalEnum[IncomeTypeNetRentalEnum["AnticipatedNetRentalIncome"]=3]="AnticipatedNetRentalIncome";IncomeTypeNetRentalEnum[IncomeTypeNetRentalEnum["AdjustedAnticipatedNetRentalIncome"]=4]="AdjustedAnticipatedNetRentalIncome";})(srv.IncomeTypeNetRentalEnum||(srv.IncomeTypeNetRentalEnum={}));var IncomeTypeNetRentalEnum=srv.IncomeTypeNetRentalEnum;(function(IntegrationLookupSystemEnum){IntegrationLookupSystemEnum[IntegrationLookupSystemEnum["Encompass"]=1]="Encompass";})(srv.IntegrationLookupSystemEnum||(srv.IntegrationLookupSystemEnum={}));var IntegrationLookupSystemEnum=srv.IntegrationLookupSystemEnum;(function(IntegrationStatusDetailTypeEnum){IntegrationStatusDetailTypeEnum[IntegrationStatusDetailTypeEnum["IntegrationRequest"]=1]="IntegrationRequest";IntegrationStatusDetailTypeEnum[IntegrationStatusDetailTypeEnum["iMPSourceData"]=2]="iMPSourceData";IntegrationStatusDetailTypeEnum[IntegrationStatusDetailTypeEnum["VendorRequest"]=3]="VendorRequest";IntegrationStatusDetailTypeEnum[IntegrationStatusDetailTypeEnum["VendorResponse"]=4]="VendorResponse";IntegrationStatusDetailTypeEnum[IntegrationStatusDetailTypeEnum["SystemError"]=5]="SystemError";})(srv.IntegrationStatusDetailTypeEnum||(srv.IntegrationStatusDetailTypeEnum={}));var IntegrationStatusDetailTypeEnum=srv.IntegrationStatusDetailTypeEnum;(function(IntegrationStatusTypeEnum){IntegrationStatusTypeEnum[IntegrationStatusTypeEnum["New"]=1]="New";IntegrationStatusTypeEnum[IntegrationStatusTypeEnum["Processing"]=2]="Processing";IntegrationStatusTypeEnum[IntegrationStatusTypeEnum["Completed"]=3]="Completed";IntegrationStatusTypeEnum[IntegrationStatusTypeEnum["Errored"]=4]="Errored";})(srv.IntegrationStatusTypeEnum||(srv.IntegrationStatusTypeEnum={}));var IntegrationStatusTypeEnum=srv.IntegrationStatusTypeEnum;(function(ItemizationDescriptionTypesEnum){ItemizationDescriptionTypesEnum[ItemizationDescriptionTypesEnum["Installment1"]=1]="Installment1";ItemizationDescriptionTypesEnum[ItemizationDescriptionTypesEnum["Installment2"]=2]="Installment2";ItemizationDescriptionTypesEnum[ItemizationDescriptionTypesEnum["Installment3"]=3]="Installment3";ItemizationDescriptionTypesEnum[ItemizationDescriptionTypesEnum["Installment4"]=4]="Installment4";ItemizationDescriptionTypesEnum[ItemizationDescriptionTypesEnum["MelloRoos"]=5]="MelloRoos";ItemizationDescriptionTypesEnum[ItemizationDescriptionTypesEnum["Supplemental1"]=6]="Supplemental1";ItemizationDescriptionTypesEnum[ItemizationDescriptionTypesEnum["Supplemental2"]=7]="Supplemental2";ItemizationDescriptionTypesEnum[ItemizationDescriptionTypesEnum["Supplemental3"]=8]="Supplemental3";})(srv.ItemizationDescriptionTypesEnum||(srv.ItemizationDescriptionTypesEnum={}));var ItemizationDescriptionTypesEnum=srv.ItemizationDescriptionTypesEnum;(function(ItemSourceTypeEnum){ItemSourceTypeEnum[ItemSourceTypeEnum["User"]=0]="User";ItemSourceTypeEnum[ItemSourceTypeEnum["Credit"]=1]="Credit";})(srv.ItemSourceTypeEnum||(srv.ItemSourceTypeEnum={}));var ItemSourceTypeEnum=srv.ItemSourceTypeEnum;(function(LedgerEntryNameEnum){LedgerEntryNameEnum[LedgerEntryNameEnum["Empty"]=0]="Empty";LedgerEntryNameEnum[LedgerEntryNameEnum["BorrowerClosingCosts"]=1]="BorrowerClosingCosts";LedgerEntryNameEnum[LedgerEntryNameEnum["BorrowerDeposit"]=2]="BorrowerDeposit";LedgerEntryNameEnum[LedgerEntryNameEnum["ExistingLoansTaken"]=3]="ExistingLoansTaken";LedgerEntryNameEnum[LedgerEntryNameEnum["LoanAmount"]=4]="LoanAmount";LedgerEntryNameEnum[LedgerEntryNameEnum["SalePriceOfPersonalProperty"]=5]="SalePriceOfPersonalProperty";LedgerEntryNameEnum[LedgerEntryNameEnum["SalePriceOfProperty"]=6]="SalePriceOfProperty";LedgerEntryNameEnum[LedgerEntryNameEnum["SellerClosingCosts"]=7]="SellerClosingCosts";LedgerEntryNameEnum[LedgerEntryNameEnum["SellerCredit"]=8]="SellerCredit";LedgerEntryNameEnum[LedgerEntryNameEnum["SellerExcessDeposit"]=9]="SellerExcessDeposit";LedgerEntryNameEnum[LedgerEntryNameEnum["CityTownTaxes"]=10]="CityTownTaxes";LedgerEntryNameEnum[LedgerEntryNameEnum["CountyTaxes"]=11]="CountyTaxes";LedgerEntryNameEnum[LedgerEntryNameEnum["Assessments"]=12]="Assessments";LedgerEntryNameEnum[LedgerEntryNameEnum["HOADues"]=13]="HOADues";LedgerEntryNameEnum[LedgerEntryNameEnum["PayoffFirstMortgage"]=14]="PayoffFirstMortgage";LedgerEntryNameEnum[LedgerEntryNameEnum["PayoffSecondMortgage"]=15]="PayoffSecondMortgage";LedgerEntryNameEnum[LedgerEntryNameEnum["PayoffThirdMortgage"]=16]="PayoffThirdMortgage";LedgerEntryNameEnum[LedgerEntryNameEnum["PayoffOtherMortgage"]=17]="PayoffOtherMortgage";LedgerEntryNameEnum[LedgerEntryNameEnum["Other"]=18]="Other";LedgerEntryNameEnum[LedgerEntryNameEnum["BorrowerPaidFees"]=19]="BorrowerPaidFees";LedgerEntryNameEnum[LedgerEntryNameEnum["EmployerAsstHousing"]=20]="EmployerAsstHousing";LedgerEntryNameEnum[LedgerEntryNameEnum["LeasePurchaseFund"]=21]="LeasePurchaseFund";LedgerEntryNameEnum[LedgerEntryNameEnum["LenderCredit"]=22]="LenderCredit";LedgerEntryNameEnum[LedgerEntryNameEnum["RelocationFund"]=23]="RelocationFund";LedgerEntryNameEnum[LedgerEntryNameEnum["OtherDoubleEntry"]=24]="OtherDoubleEntry";})(srv.LedgerEntryNameEnum||(srv.LedgerEntryNameEnum={}));var LedgerEntryNameEnum=srv.LedgerEntryNameEnum;(function(LedgerEntryTypeEnum){LedgerEntryTypeEnum[LedgerEntryTypeEnum["NotSpecified"]=0]="NotSpecified";LedgerEntryTypeEnum[LedgerEntryTypeEnum["Credit"]=1]="Credit";LedgerEntryTypeEnum[LedgerEntryTypeEnum["Debit"]=2]="Debit";})(srv.LedgerEntryTypeEnum||(srv.LedgerEntryTypeEnum={}));var LedgerEntryTypeEnum=srv.LedgerEntryTypeEnum;(function(LegalEntityTypeEnum){LegalEntityTypeEnum[LegalEntityTypeEnum["NotSpecified"]=0]="NotSpecified";LegalEntityTypeEnum[LegalEntityTypeEnum["CPA"]=1]="CPA";LegalEntityTypeEnum[LegalEntityTypeEnum["DocSigning"]=2]="DocSigning";LegalEntityTypeEnum[LegalEntityTypeEnum["Escrow"]=3]="Escrow";LegalEntityTypeEnum[LegalEntityTypeEnum["FloodInsurance"]=4]="FloodInsurance";LegalEntityTypeEnum[LegalEntityTypeEnum["HazardInsurance"]=5]="HazardInsurance";LegalEntityTypeEnum[LegalEntityTypeEnum["PropertyManagement"]=6]="PropertyManagement";LegalEntityTypeEnum[LegalEntityTypeEnum["HomeWarranty"]=7]="HomeWarranty";LegalEntityTypeEnum[LegalEntityTypeEnum["Survey"]=8]="Survey";LegalEntityTypeEnum[LegalEntityTypeEnum["PestInspection"]=9]="PestInspection";LegalEntityTypeEnum[LegalEntityTypeEnum["MortgageInsurance"]=10]="MortgageInsurance";LegalEntityTypeEnum[LegalEntityTypeEnum["Realtor"]=11]="Realtor";LegalEntityTypeEnum[LegalEntityTypeEnum["TitleInsurance"]=12]="TitleInsurance";LegalEntityTypeEnum[LegalEntityTypeEnum["Appraiser"]=13]="Appraiser";LegalEntityTypeEnum[LegalEntityTypeEnum["ReservedForFutureUse_3"]=22]="ReservedForFutureUse_3";LegalEntityTypeEnum[LegalEntityTypeEnum["ReservedForFutureUse_2"]=23]="ReservedForFutureUse_2";LegalEntityTypeEnum[LegalEntityTypeEnum["ReservedForFutureUse_1"]=24]="ReservedForFutureUse_1";LegalEntityTypeEnum[LegalEntityTypeEnum["PreferredSettlementServiceProvider"]=25]="PreferredSettlementServiceProvider";LegalEntityTypeEnum[LegalEntityTypeEnum["Affiliate"]=26]="Affiliate";LegalEntityTypeEnum[LegalEntityTypeEnum["FutureUse"]=31]="FutureUse";})(srv.LegalEntityTypeEnum||(srv.LegalEntityTypeEnum={}));var LegalEntityTypeEnum=srv.LegalEntityTypeEnum;(function(LegalEntityTypeMask){LegalEntityTypeMask[LegalEntityTypeMask["NotSpecified"]=0]="NotSpecified";LegalEntityTypeMask[LegalEntityTypeMask["CPA"]=16]="CPA";LegalEntityTypeMask[LegalEntityTypeMask["DocSigning"]=32]="DocSigning";LegalEntityTypeMask[LegalEntityTypeMask["Escrow"]=64]="Escrow";LegalEntityTypeMask[LegalEntityTypeMask["FloodInsurance"]=128]="FloodInsurance";LegalEntityTypeMask[LegalEntityTypeMask["HazardInsurance"]=256]="HazardInsurance";LegalEntityTypeMask[LegalEntityTypeMask["PropertyManagement"]=512]="PropertyManagement";LegalEntityTypeMask[LegalEntityTypeMask["HomeWarranty"]=1024]="HomeWarranty";LegalEntityTypeMask[LegalEntityTypeMask["Survey"]=2048]="Survey";LegalEntityTypeMask[LegalEntityTypeMask["PestInspection"]=4096]="PestInspection";LegalEntityTypeMask[LegalEntityTypeMask["MortgageInsurance"]=8192]="MortgageInsurance";LegalEntityTypeMask[LegalEntityTypeMask["Realtor"]=16384]="Realtor";LegalEntityTypeMask[LegalEntityTypeMask["TitleInsurance"]=32768]="TitleInsurance";LegalEntityTypeMask[LegalEntityTypeMask["Appraiser"]=65536]="Appraiser";LegalEntityTypeMask[LegalEntityTypeMask["PreferredSettlementServiceProvider"]=268435456]="PreferredSettlementServiceProvider";LegalEntityTypeMask[LegalEntityTypeMask["Affiliate"]=536870912]="Affiliate";LegalEntityTypeMask[LegalEntityTypeMask["AllLegalEntities"]=1073741824]="AllLegalEntities";})(srv.LegalEntityTypeMask||(srv.LegalEntityTypeMask={}));var LegalEntityTypeMask=srv.LegalEntityTypeMask;(function(LiabilityTypeEnum){LiabilityTypeEnum[LiabilityTypeEnum["Other"]=0]="Other";LiabilityTypeEnum[LiabilityTypeEnum["Revolving"]=1]="Revolving";LiabilityTypeEnum[LiabilityTypeEnum["Installment"]=2]="Installment";LiabilityTypeEnum[LiabilityTypeEnum["Public"]=3]="Public";LiabilityTypeEnum[LiabilityTypeEnum["MovedFromReo"]=4]="MovedFromReo";LiabilityTypeEnum[LiabilityTypeEnum["Alimony"]=5]="Alimony";LiabilityTypeEnum[LiabilityTypeEnum["ChildCare"]=6]="ChildCare";LiabilityTypeEnum[LiabilityTypeEnum["ChildSupport"]=7]="ChildSupport";LiabilityTypeEnum[LiabilityTypeEnum["CollectionsJudgmentAndLiens"]=8]="CollectionsJudgmentAndLiens";LiabilityTypeEnum[LiabilityTypeEnum["JobRelatedExpenses"]=9]="JobRelatedExpenses";LiabilityTypeEnum[LiabilityTypeEnum["LeasePayments"]=10]="LeasePayments";LiabilityTypeEnum[LiabilityTypeEnum["Open30DayChargeAccount"]=11]="Open30DayChargeAccount";LiabilityTypeEnum[LiabilityTypeEnum["OtherLiability"]=12]="OtherLiability";LiabilityTypeEnum[LiabilityTypeEnum["SeparateMaintenanceExpense"]=13]="SeparateMaintenanceExpense";})(srv.LiabilityTypeEnum||(srv.LiabilityTypeEnum={}));var LiabilityTypeEnum=srv.LiabilityTypeEnum;(function(LoanApplicationTypeEnum){LoanApplicationTypeEnum[LoanApplicationTypeEnum["MainApplication"]=1]="MainApplication";LoanApplicationTypeEnum[LoanApplicationTypeEnum["AdditionalApplication"]=2]="AdditionalApplication";})(srv.LoanApplicationTypeEnum||(srv.LoanApplicationTypeEnum={}));var LoanApplicationTypeEnum=srv.LoanApplicationTypeEnum;(function(LoanDateTypeEnum){LoanDateTypeEnum[LoanDateTypeEnum["AppraisalContingencyDate"]=1]="AppraisalContingencyDate";LoanDateTypeEnum[LoanDateTypeEnum["ApprovalContingencyDate"]=2]="ApprovalContingencyDate";LoanDateTypeEnum[LoanDateTypeEnum["ClosingDate"]=3]="ClosingDate";})(srv.LoanDateTypeEnum||(srv.LoanDateTypeEnum={}));var LoanDateTypeEnum=srv.LoanDateTypeEnum;(function(LoanInfoRequestEnum){LoanInfoRequestEnum[LoanInfoRequestEnum["NullRequest"]=0]="NullRequest";LoanInfoRequestEnum[LoanInfoRequestEnum["LoanAmount"]=1]="LoanAmount";LoanInfoRequestEnum[LoanInfoRequestEnum["SalePriceOfProperty"]=2]="SalePriceOfProperty";LoanInfoRequestEnum[LoanInfoRequestEnum["BorrowerDeposit"]=3]="BorrowerDeposit";LoanInfoRequestEnum[LoanInfoRequestEnum["BorrowerClosingCostsFromSectionJ"]=4]="BorrowerClosingCostsFromSectionJ";LoanInfoRequestEnum[LoanInfoRequestEnum["SellerClosingCostsFromSectionJ"]=5]="SellerClosingCostsFromSectionJ";})(srv.LoanInfoRequestEnum||(srv.LoanInfoRequestEnum={}));var LoanInfoRequestEnum=srv.LoanInfoRequestEnum;(function(LoanLockControlStatusType){LoanLockControlStatusType[LoanLockControlStatusType["Acquired"]=1]="Acquired";LoanLockControlStatusType[LoanLockControlStatusType["Released"]=2]="Released";LoanLockControlStatusType[LoanLockControlStatusType["TimedOut"]=3]="TimedOut";})(srv.LoanLockControlStatusType||(srv.LoanLockControlStatusType={}));var LoanLockControlStatusType=srv.LoanLockControlStatusType;(function(LoanOriginationInterviewTypeEnum){LoanOriginationInterviewTypeEnum[LoanOriginationInterviewTypeEnum["FaceToFace"]=0]="FaceToFace";LoanOriginationInterviewTypeEnum[LoanOriginationInterviewTypeEnum["Telephone"]=1]="Telephone";LoanOriginationInterviewTypeEnum[LoanOriginationInterviewTypeEnum["FaxOrMail"]=2]="FaxOrMail";LoanOriginationInterviewTypeEnum[LoanOriginationInterviewTypeEnum["EmailOrInternet"]=3]="EmailOrInternet";})(srv.LoanOriginationInterviewTypeEnum||(srv.LoanOriginationInterviewTypeEnum={}));var LoanOriginationInterviewTypeEnum=srv.LoanOriginationInterviewTypeEnum;(function(LoanPricingAdjustmentDropDownTypeEnum){LoanPricingAdjustmentDropDownTypeEnum[LoanPricingAdjustmentDropDownTypeEnum["Adjustment"]=0]="Adjustment";LoanPricingAdjustmentDropDownTypeEnum[LoanPricingAdjustmentDropDownTypeEnum["SubType"]=1]="SubType";LoanPricingAdjustmentDropDownTypeEnum[LoanPricingAdjustmentDropDownTypeEnum["PaidBy"]=2]="PaidBy";})(srv.LoanPricingAdjustmentDropDownTypeEnum||(srv.LoanPricingAdjustmentDropDownTypeEnum={}));var LoanPricingAdjustmentDropDownTypeEnum=srv.LoanPricingAdjustmentDropDownTypeEnum;(function(LoanPricingAdjustmentPaidByTypeEnum){LoanPricingAdjustmentPaidByTypeEnum[LoanPricingAdjustmentPaidByTypeEnum["Unkonwn"]=0]="Unkonwn";LoanPricingAdjustmentPaidByTypeEnum[LoanPricingAdjustmentPaidByTypeEnum["LoanOfficer"]=1]="LoanOfficer";LoanPricingAdjustmentPaidByTypeEnum[LoanPricingAdjustmentPaidByTypeEnum["Division"]=2]="Division";LoanPricingAdjustmentPaidByTypeEnum[LoanPricingAdjustmentPaidByTypeEnum["Company"]=3]="Company";LoanPricingAdjustmentPaidByTypeEnum[LoanPricingAdjustmentPaidByTypeEnum["Borrower"]=4]="Borrower";})(srv.LoanPricingAdjustmentPaidByTypeEnum||(srv.LoanPricingAdjustmentPaidByTypeEnum={}));var LoanPricingAdjustmentPaidByTypeEnum=srv.LoanPricingAdjustmentPaidByTypeEnum;(function(LoanPricingAdjustmentTypeEnum){LoanPricingAdjustmentTypeEnum[LoanPricingAdjustmentTypeEnum["Sec2Llpa"]=1]="Sec2Llpa";LoanPricingAdjustmentTypeEnum[LoanPricingAdjustmentTypeEnum["Sec2Concession"]=2]="Sec2Concession";LoanPricingAdjustmentTypeEnum[LoanPricingAdjustmentTypeEnum["Sec2ExcessPricing"]=3]="Sec2ExcessPricing";LoanPricingAdjustmentTypeEnum[LoanPricingAdjustmentTypeEnum["Sec2Extension"]=4]="Sec2Extension";LoanPricingAdjustmentTypeEnum[LoanPricingAdjustmentTypeEnum["Sec2Renegotation"]=5]="Sec2Renegotation";LoanPricingAdjustmentTypeEnum[LoanPricingAdjustmentTypeEnum["Sec2WorstCasePricing"]=6]="Sec2WorstCasePricing";LoanPricingAdjustmentTypeEnum[LoanPricingAdjustmentTypeEnum["Sec1CorporateMargin"]=7]="Sec1CorporateMargin";LoanPricingAdjustmentTypeEnum[LoanPricingAdjustmentTypeEnum["Sec1DivisionMargin"]=8]="Sec1DivisionMargin";LoanPricingAdjustmentTypeEnum[LoanPricingAdjustmentTypeEnum["Sec1LoanOfficerCompensation"]=9]="Sec1LoanOfficerCompensation";LoanPricingAdjustmentTypeEnum[LoanPricingAdjustmentTypeEnum["Sec1ExcessPricing"]=10]="Sec1ExcessPricing";LoanPricingAdjustmentTypeEnum[LoanPricingAdjustmentTypeEnum["Sec1Extension"]=11]="Sec1Extension";LoanPricingAdjustmentTypeEnum[LoanPricingAdjustmentTypeEnum["Sec3ExcessPricing"]=12]="Sec3ExcessPricing";LoanPricingAdjustmentTypeEnum[LoanPricingAdjustmentTypeEnum["Sec3Extension"]=13]="Sec3Extension";LoanPricingAdjustmentTypeEnum[LoanPricingAdjustmentTypeEnum["Sec3Renegotation"]=14]="Sec3Renegotation";LoanPricingAdjustmentTypeEnum[LoanPricingAdjustmentTypeEnum["Sec3WorstCasePricing"]=15]="Sec3WorstCasePricing";LoanPricingAdjustmentTypeEnum[LoanPricingAdjustmentTypeEnum["Sec1CompanyMargin"]=16]="Sec1CompanyMargin";LoanPricingAdjustmentTypeEnum[LoanPricingAdjustmentTypeEnum["Sec1Compensation"]=17]="Sec1Compensation";LoanPricingAdjustmentTypeEnum[LoanPricingAdjustmentTypeEnum["Sec1Ipa"]=18]="Sec1Ipa";LoanPricingAdjustmentTypeEnum[LoanPricingAdjustmentTypeEnum["Sec1Ira"]=19]="Sec1Ira";LoanPricingAdjustmentTypeEnum[LoanPricingAdjustmentTypeEnum["Sec2Llra"]=20]="Sec2Llra";LoanPricingAdjustmentTypeEnum[LoanPricingAdjustmentTypeEnum["Sec2Ipa"]=21]="Sec2Ipa";LoanPricingAdjustmentTypeEnum[LoanPricingAdjustmentTypeEnum["Sec3Ipa"]=22]="Sec3Ipa";})(srv.LoanPricingAdjustmentTypeEnum||(srv.LoanPricingAdjustmentTypeEnum={}));var LoanPricingAdjustmentTypeEnum=srv.LoanPricingAdjustmentTypeEnum;(function(LoanPurposeTypeEnum){LoanPurposeTypeEnum[LoanPurposeTypeEnum["None"]=0]="None";LoanPurposeTypeEnum[LoanPurposeTypeEnum["Purchase"]=1]="Purchase";LoanPurposeTypeEnum[LoanPurposeTypeEnum["Refinance"]=2]="Refinance";})(srv.LoanPurposeTypeEnum||(srv.LoanPurposeTypeEnum={}));var LoanPurposeTypeEnum=srv.LoanPurposeTypeEnum;(function(LoanStatus){LoanStatus[LoanStatus["Closed"]=1]="Closed";LoanStatus[LoanStatus["InProgress"]=2]="InProgress";LoanStatus[LoanStatus["Cancelled"]=3]="Cancelled";LoanStatus[LoanStatus["Reopened"]=4]="Reopened";})(srv.LoanStatus||(srv.LoanStatus={}));var LoanStatus=srv.LoanStatus;(function(LockingConfigurationEnum){LockingConfigurationEnum[LockingConfigurationEnum["None"]=0]="None";LockingConfigurationEnum[LockingConfigurationEnum["AllowedMinutesFromSearchToRequestMandatory"]=1]="AllowedMinutesFromSearchToRequestMandatory";LockingConfigurationEnum[LockingConfigurationEnum["AllowedMinutesFromSearchToRequestEforts"]=2]="AllowedMinutesFromSearchToRequestEforts";LockingConfigurationEnum[LockingConfigurationEnum["AutoLockSettingsBestEfforts"]=3]="AutoLockSettingsBestEfforts";LockingConfigurationEnum[LockingConfigurationEnum["AutoLockSettingsMandatoryEfforts"]=4]="AutoLockSettingsMandatoryEfforts";LockingConfigurationEnum[LockingConfigurationEnum["MaxNumberOfConcessions"]=5]="MaxNumberOfConcessions";LockingConfigurationEnum[LockingConfigurationEnum["MaxConcessionAmountTotal"]=6]="MaxConcessionAmountTotal";LockingConfigurationEnum[LockingConfigurationEnum["MaxConcessionAmountLevel1"]=7]="MaxConcessionAmountLevel1";LockingConfigurationEnum[LockingConfigurationEnum["MaxConcessionAmountLevel2"]=8]="MaxConcessionAmountLevel2";LockingConfigurationEnum[LockingConfigurationEnum["MaxConcessionAmountLevel3"]=9]="MaxConcessionAmountLevel3";LockingConfigurationEnum[LockingConfigurationEnum["MaxConcessionAmountLevel4"]=10]="MaxConcessionAmountLevel4";LockingConfigurationEnum[LockingConfigurationEnum["MaxConcessionAmountLevel5"]=11]="MaxConcessionAmountLevel5";})(srv.LockingConfigurationEnum||(srv.LockingConfigurationEnum={}));var LockingConfigurationEnum=srv.LockingConfigurationEnum;(function(LockingConfigurationTypeEnum){LockingConfigurationTypeEnum[LockingConfigurationTypeEnum["None"]=0]="None";LockingConfigurationTypeEnum[LockingConfigurationTypeEnum["RulesForLock"]=1]="RulesForLock";LockingConfigurationTypeEnum[LockingConfigurationTypeEnum["RulesForConcession"]=2]="RulesForConcession";})(srv.LockingConfigurationTypeEnum||(srv.LockingConfigurationTypeEnum={}));var LockingConfigurationTypeEnum=srv.LockingConfigurationTypeEnum;(function(MannerOfPaymentRatingEnum){MannerOfPaymentRatingEnum[MannerOfPaymentRatingEnum["Unknown"]=0]="Unknown";MannerOfPaymentRatingEnum[MannerOfPaymentRatingEnum["Late30Days"]=1]="Late30Days";MannerOfPaymentRatingEnum[MannerOfPaymentRatingEnum["Late60Days"]=2]="Late60Days";MannerOfPaymentRatingEnum[MannerOfPaymentRatingEnum["Late90Days"]=3]="Late90Days";MannerOfPaymentRatingEnum[MannerOfPaymentRatingEnum["LateOver120Days"]=4]="LateOver120Days";})(srv.MannerOfPaymentRatingEnum||(srv.MannerOfPaymentRatingEnum={}));var MannerOfPaymentRatingEnum=srv.MannerOfPaymentRatingEnum;(function(MaritalStatusTypeEnum){MaritalStatusTypeEnum[MaritalStatusTypeEnum["Married"]=0]="Married";MaritalStatusTypeEnum[MaritalStatusTypeEnum["Separated"]=1]="Separated";MaritalStatusTypeEnum[MaritalStatusTypeEnum["Unmarried"]=2]="Unmarried";MaritalStatusTypeEnum[MaritalStatusTypeEnum["SelectOne"]=-1]="SelectOne";})(srv.MaritalStatusTypeEnum||(srv.MaritalStatusTypeEnum={}));var MaritalStatusTypeEnum=srv.MaritalStatusTypeEnum;(function(MilestoneStatusTypeEnum){MilestoneStatusTypeEnum[MilestoneStatusTypeEnum["Prospect"]=1]="Prospect";MilestoneStatusTypeEnum[MilestoneStatusTypeEnum["Incomplete"]=2]="Incomplete";MilestoneStatusTypeEnum[MilestoneStatusTypeEnum["Processing"]=3]="Processing";MilestoneStatusTypeEnum[MilestoneStatusTypeEnum["PreApproved"]=4]="PreApproved";MilestoneStatusTypeEnum[MilestoneStatusTypeEnum["Approved"]=5]="Approved";MilestoneStatusTypeEnum[MilestoneStatusTypeEnum["DocsOut"]=6]="DocsOut";MilestoneStatusTypeEnum[MilestoneStatusTypeEnum["Funding"]=7]="Funding";MilestoneStatusTypeEnum[MilestoneStatusTypeEnum["Closed"]=8]="Closed";MilestoneStatusTypeEnum[MilestoneStatusTypeEnum["Canceled"]=9]="Canceled";MilestoneStatusTypeEnum[MilestoneStatusTypeEnum["Unsubmitted"]=10]="Unsubmitted";MilestoneStatusTypeEnum[MilestoneStatusTypeEnum["Registered"]=11]="Registered";MilestoneStatusTypeEnum[MilestoneStatusTypeEnum["Submitted"]=12]="Submitted";MilestoneStatusTypeEnum[MilestoneStatusTypeEnum["Rejected"]=13]="Rejected";MilestoneStatusTypeEnum[MilestoneStatusTypeEnum["Adverse"]=14]="Adverse";})(srv.MilestoneStatusTypeEnum||(srv.MilestoneStatusTypeEnum={}));var MilestoneStatusTypeEnum=srv.MilestoneStatusTypeEnum;(function(MilitaryBranchOrServiceTypeEnum){MilitaryBranchOrServiceTypeEnum[MilitaryBranchOrServiceTypeEnum["AirForce"]=0]="AirForce";MilitaryBranchOrServiceTypeEnum[MilitaryBranchOrServiceTypeEnum["Army"]=1]="Army";MilitaryBranchOrServiceTypeEnum[MilitaryBranchOrServiceTypeEnum["Marines"]=2]="Marines";MilitaryBranchOrServiceTypeEnum[MilitaryBranchOrServiceTypeEnum["Navy"]=3]="Navy";MilitaryBranchOrServiceTypeEnum[MilitaryBranchOrServiceTypeEnum["Other"]=4]="Other";})(srv.MilitaryBranchOrServiceTypeEnum||(srv.MilitaryBranchOrServiceTypeEnum={}));var MilitaryBranchOrServiceTypeEnum=srv.MilitaryBranchOrServiceTypeEnum;(function(MortgageInsuranceTerminationEnum){MortgageInsuranceTerminationEnum[MortgageInsuranceTerminationEnum["LTV78orMidpointTermination"]=0]="LTV78orMidpointTermination";MortgageInsuranceTerminationEnum[MortgageInsuranceTerminationEnum["MidpointTermination"]=1]="MidpointTermination";MortgageInsuranceTerminationEnum[MortgageInsuranceTerminationEnum["NoAutoTermination"]=2]="NoAutoTermination";})(srv.MortgageInsuranceTerminationEnum||(srv.MortgageInsuranceTerminationEnum={}));var MortgageInsuranceTerminationEnum=srv.MortgageInsuranceTerminationEnum;(function(MortgageTypeEnum){MortgageTypeEnum[MortgageTypeEnum["Conventional"]=0]="Conventional";MortgageTypeEnum[MortgageTypeEnum["FHA"]=1]="FHA";MortgageTypeEnum[MortgageTypeEnum["ConventionalJumbo"]=2]="ConventionalJumbo";MortgageTypeEnum[MortgageTypeEnum["ConventionalSuperJumbo"]=3]="ConventionalSuperJumbo";MortgageTypeEnum[MortgageTypeEnum["VA"]=4]="VA";MortgageTypeEnum[MortgageTypeEnum["USDA"]=5]="USDA";})(srv.MortgageTypeEnum||(srv.MortgageTypeEnum={}));var MortgageTypeEnum=srv.MortgageTypeEnum;(function(NtbBenefitEnum){NtbBenefitEnum[NtbBenefitEnum["AvoidForeclosure"]=1]="AvoidForeclosure";NtbBenefitEnum[NtbBenefitEnum["LowerInterestRate"]=2]="LowerInterestRate";NtbBenefitEnum[NtbBenefitEnum["LowerMonthlyPayment"]=3]="LowerMonthlyPayment";NtbBenefitEnum[NtbBenefitEnum["LowerInterestRateOrLowerTermAndCostsRecouped"]=4]="LowerInterestRateOrLowerTermAndCostsRecouped";NtbBenefitEnum[NtbBenefitEnum["LowerDuration"]=5]="LowerDuration";NtbBenefitEnum[NtbBenefitEnum["LowerAmortizationSchedule"]=6]="LowerAmortizationSchedule";NtbBenefitEnum[NtbBenefitEnum["EliminateFeatureNegativeAmortization"]=7]="EliminateFeatureNegativeAmortization";NtbBenefitEnum[NtbBenefitEnum["EliminateFeatureBalloonPayment"]=8]="EliminateFeatureBalloonPayment";NtbBenefitEnum[NtbBenefitEnum["EliminatePrivateMortgageInsurance"]=9]="EliminatePrivateMortgageInsurance";NtbBenefitEnum[NtbBenefitEnum["ChangeAdjustableRateToFixedRate"]=10]="ChangeAdjustableRateToFixedRate";NtbBenefitEnum[NtbBenefitEnum["CashoutReasonable"]=11]="CashoutReasonable";NtbBenefitEnum[NtbBenefitEnum["CashoutReasonableBonaFiedPersonalNeed"]=12]="CashoutReasonableBonaFiedPersonalNeed";NtbBenefitEnum[NtbBenefitEnum["CashoutSignificantPurpose"]=13]="CashoutSignificantPurpose";NtbBenefitEnum[NtbBenefitEnum["ConsolidateLoans"]=14]="ConsolidateLoans";NtbBenefitEnum[NtbBenefitEnum["ConsolidateDebts"]=15]="ConsolidateDebts";NtbBenefitEnum[NtbBenefitEnum["NewLoanGuaranteed"]=16]="NewLoanGuaranteed";NtbBenefitEnum[NtbBenefitEnum["NewLoanQualifiedMortgage"]=17]="NewLoanQualifiedMortgage";NtbBenefitEnum[NtbBenefitEnum["DTIBelowThreshold"]=18]="DTIBelowThreshold";})(srv.NtbBenefitEnum||(srv.NtbBenefitEnum={}));var NtbBenefitEnum=srv.NtbBenefitEnum;(function(OtherCreditType){OtherCreditType[OtherCreditType["CashDepositOnSales"]=0]="CashDepositOnSales";OtherCreditType[OtherCreditType["SellerCredit"]=1]="SellerCredit";OtherCreditType[OtherCreditType["LenderCredit"]=2]="LenderCredit";OtherCreditType[OtherCreditType["RelocationFunds"]=3]="RelocationFunds";OtherCreditType[OtherCreditType["EmployerAssistedHousing"]=4]="EmployerAssistedHousing";OtherCreditType[OtherCreditType["LeasePurchaseFund"]=5]="LeasePurchaseFund";OtherCreditType[OtherCreditType["Other"]=6]="Other";OtherCreditType[OtherCreditType["BorrowerPaidfees"]=7]="BorrowerPaidfees";OtherCreditType[OtherCreditType["LenderPointCredit"]=8]="LenderPointCredit";})(srv.OtherCreditType||(srv.OtherCreditType={}));var OtherCreditType=srv.OtherCreditType;(function(OwnershipStatusTypeEnum){OwnershipStatusTypeEnum[OwnershipStatusTypeEnum["Own"]=0]="Own";OwnershipStatusTypeEnum[OwnershipStatusTypeEnum["Rent"]=1]="Rent";OwnershipStatusTypeEnum[OwnershipStatusTypeEnum["RentFree"]=2]="RentFree";OwnershipStatusTypeEnum[OwnershipStatusTypeEnum["None"]=-1]="None";})(srv.OwnershipStatusTypeEnum||(srv.OwnershipStatusTypeEnum={}));var OwnershipStatusTypeEnum=srv.OwnershipStatusTypeEnum;(function(PartyTypeEnum){PartyTypeEnum[PartyTypeEnum["Borrower"]=1]="Borrower";PartyTypeEnum[PartyTypeEnum["CoBorrower"]=2]="CoBorrower";PartyTypeEnum[PartyTypeEnum["LoanConcierge"]=3]="LoanConcierge";PartyTypeEnum[PartyTypeEnum["LoanProcessor"]=4]="LoanProcessor";PartyTypeEnum[PartyTypeEnum["ImpersonatedConciergeId"]=5]="ImpersonatedConciergeId";PartyTypeEnum[PartyTypeEnum["CallCenter"]=6]="CallCenter";PartyTypeEnum[PartyTypeEnum["LeadSource"]=7]="LeadSource";PartyTypeEnum[PartyTypeEnum["PartnerLeadSource"]=8]="PartnerLeadSource";PartyTypeEnum[PartyTypeEnum["BuyersAgent"]=9]="BuyersAgent";PartyTypeEnum[PartyTypeEnum["SellersAgent"]=10]="SellersAgent";PartyTypeEnum[PartyTypeEnum["LoanOfficer"]=11]="LoanOfficer";PartyTypeEnum[PartyTypeEnum["Investor"]=12]="Investor";})(srv.PartyTypeEnum||(srv.PartyTypeEnum={}));var PartyTypeEnum=srv.PartyTypeEnum;(function(PaymentMonthEnum){PaymentMonthEnum[PaymentMonthEnum["Unspecified"]=0]="Unspecified";PaymentMonthEnum[PaymentMonthEnum["January"]=1]="January";PaymentMonthEnum[PaymentMonthEnum["February"]=2]="February";PaymentMonthEnum[PaymentMonthEnum["March"]=3]="March";PaymentMonthEnum[PaymentMonthEnum["April"]=4]="April";PaymentMonthEnum[PaymentMonthEnum["May"]=5]="May";PaymentMonthEnum[PaymentMonthEnum["June"]=6]="June";PaymentMonthEnum[PaymentMonthEnum["July"]=7]="July";PaymentMonthEnum[PaymentMonthEnum["August"]=8]="August";PaymentMonthEnum[PaymentMonthEnum["September"]=9]="September";PaymentMonthEnum[PaymentMonthEnum["October"]=10]="October";PaymentMonthEnum[PaymentMonthEnum["November"]=11]="November";PaymentMonthEnum[PaymentMonthEnum["December"]=12]="December";})(srv.PaymentMonthEnum||(srv.PaymentMonthEnum={}));var PaymentMonthEnum=srv.PaymentMonthEnum;(function(PeriodTypeEnum){PeriodTypeEnum[PeriodTypeEnum["None"]=0]="None";PeriodTypeEnum[PeriodTypeEnum["Monthly"]=1]="Monthly";PeriodTypeEnum[PeriodTypeEnum["Annually"]=2]="Annually";PeriodTypeEnum[PeriodTypeEnum["Weekly"]=3]="Weekly";PeriodTypeEnum[PeriodTypeEnum["BiWeekly"]=4]="BiWeekly";PeriodTypeEnum[PeriodTypeEnum["Quarterly"]=5]="Quarterly";PeriodTypeEnum[PeriodTypeEnum["SemiAnnually"]=6]="SemiAnnually";})(srv.PeriodTypeEnum||(srv.PeriodTypeEnum={}));var PeriodTypeEnum=srv.PeriodTypeEnum;(function(PledgedAssetCommentTypeEnum){PledgedAssetCommentTypeEnum[PledgedAssetCommentTypeEnum["DoNotPayoff"]=0]="DoNotPayoff";PledgedAssetCommentTypeEnum[PledgedAssetCommentTypeEnum["PaidOffFreeAndClear"]=1]="PaidOffFreeAndClear";PledgedAssetCommentTypeEnum[PledgedAssetCommentTypeEnum["PayoffAtClose"]=2]="PayoffAtClose";PledgedAssetCommentTypeEnum[PledgedAssetCommentTypeEnum["PayoffAtClosingAndDontCloseAccount"]=3]="PayoffAtClosingAndDontCloseAccount";PledgedAssetCommentTypeEnum[PledgedAssetCommentTypeEnum["PayoffAtClosingAndCloseAccount"]=4]="PayoffAtClosingAndCloseAccount";PledgedAssetCommentTypeEnum[PledgedAssetCommentTypeEnum["Sold"]=5]="Sold";PledgedAssetCommentTypeEnum[PledgedAssetCommentTypeEnum["NotMyLoan"]=6]="NotMyLoan";PledgedAssetCommentTypeEnum[PledgedAssetCommentTypeEnum["PendingSale"]=7]="PendingSale";PledgedAssetCommentTypeEnum[PledgedAssetCommentTypeEnum["NotAMortgage"]=8]="NotAMortgage";PledgedAssetCommentTypeEnum[PledgedAssetCommentTypeEnum["Duplicate"]=9]="Duplicate";})(srv.PledgedAssetCommentTypeEnum||(srv.PledgedAssetCommentTypeEnum={}));var PledgedAssetCommentTypeEnum=srv.PledgedAssetCommentTypeEnum;(function(PricingAdjustmentSectionTypeEnum){PricingAdjustmentSectionTypeEnum[PricingAdjustmentSectionTypeEnum["Enterprise"]=1]="Enterprise";PricingAdjustmentSectionTypeEnum[PricingAdjustmentSectionTypeEnum["LOPrice"]=2]="LOPrice";PricingAdjustmentSectionTypeEnum[PricingAdjustmentSectionTypeEnum["FinalPrice"]=3]="FinalPrice";})(srv.PricingAdjustmentSectionTypeEnum||(srv.PricingAdjustmentSectionTypeEnum={}));var PricingAdjustmentSectionTypeEnum=srv.PricingAdjustmentSectionTypeEnum;(function(PrivilegeType){PrivilegeType[PrivilegeType["System"]=0]="System";PrivilegeType[PrivilegeType["User"]=1]="User";})(srv.PrivilegeType||(srv.PrivilegeType={}));var PrivilegeType=srv.PrivilegeType;(function(ProductTypeEnum){ProductTypeEnum[ProductTypeEnum["CreditReport"]=4]="CreditReport";ProductTypeEnum[ProductTypeEnum["AuditReport"]=5]="AuditReport";})(srv.ProductTypeEnum||(srv.ProductTypeEnum={}));var ProductTypeEnum=srv.ProductTypeEnum;(function(PropertyExpenseTypeEnum){PropertyExpenseTypeEnum[PropertyExpenseTypeEnum["None"]=0]="None";PropertyExpenseTypeEnum[PropertyExpenseTypeEnum["PropertyTax"]=1]="PropertyTax";PropertyExpenseTypeEnum[PropertyExpenseTypeEnum["HomeOwnerInurance"]=2]="HomeOwnerInurance";PropertyExpenseTypeEnum[PropertyExpenseTypeEnum["MortgageInsurance"]=3]="MortgageInsurance";PropertyExpenseTypeEnum[PropertyExpenseTypeEnum["HomeOwnerAssociationDues"]=4]="HomeOwnerAssociationDues";PropertyExpenseTypeEnum[PropertyExpenseTypeEnum["FloodInsurance"]=5]="FloodInsurance";})(srv.PropertyExpenseTypeEnum||(srv.PropertyExpenseTypeEnum={}));var PropertyExpenseTypeEnum=srv.PropertyExpenseTypeEnum;(function(PropertyHeldTypeEnum){PropertyHeldTypeEnum[PropertyHeldTypeEnum["Individual"]=0]="Individual";PropertyHeldTypeEnum[PropertyHeldTypeEnum["Trust"]=1]="Trust";PropertyHeldTypeEnum[PropertyHeldTypeEnum["Corporation"]=2]="Corporation";})(srv.PropertyHeldTypeEnum||(srv.PropertyHeldTypeEnum={}));var PropertyHeldTypeEnum=srv.PropertyHeldTypeEnum;(function(PropertyTypeEnum){PropertyTypeEnum[PropertyTypeEnum["None"]=0]="None";PropertyTypeEnum[PropertyTypeEnum["SingleFamily"]=1]="SingleFamily";PropertyTypeEnum[PropertyTypeEnum["Condominium"]=2]="Condominium";PropertyTypeEnum[PropertyTypeEnum["PUD"]=3]="PUD";PropertyTypeEnum[PropertyTypeEnum["ManufacturedHousingDoubleWide"]=4]="ManufacturedHousingDoubleWide";PropertyTypeEnum[PropertyTypeEnum["ManufacturedHousingSingleWide"]=5]="ManufacturedHousingSingleWide";PropertyTypeEnum[PropertyTypeEnum["Cooperative"]=6]="Cooperative";PropertyTypeEnum[PropertyTypeEnum["Condotel"]=7]="Condotel";PropertyTypeEnum[PropertyTypeEnum["Modular"]=8]="Modular";PropertyTypeEnum[PropertyTypeEnum["Timeshare"]=9]="Timeshare";PropertyTypeEnum[PropertyTypeEnum["NonWarrantableCondo"]=10]="NonWarrantableCondo";PropertyTypeEnum[PropertyTypeEnum["TownHouse"]=11]="TownHouse";PropertyTypeEnum[PropertyTypeEnum["Commercial"]=12]="Commercial";PropertyTypeEnum[PropertyTypeEnum["MixedUse"]=13]="MixedUse";PropertyTypeEnum[PropertyTypeEnum["MultiFamilyTwoToFourUnits"]=14]="MultiFamilyTwoToFourUnits";PropertyTypeEnum[PropertyTypeEnum["MobileHome"]=15]="MobileHome";PropertyTypeEnum[PropertyTypeEnum["MultiFamilyMoreThanFourUnits"]=16]="MultiFamilyMoreThanFourUnits";PropertyTypeEnum[PropertyTypeEnum["HomeAndBusinessCombined"]=17]="HomeAndBusinessCombined";PropertyTypeEnum[PropertyTypeEnum["Farm"]=18]="Farm";PropertyTypeEnum[PropertyTypeEnum["Land"]=19]="Land";})(srv.PropertyTypeEnum||(srv.PropertyTypeEnum={}));var PropertyTypeEnum=srv.PropertyTypeEnum;(function(PropertyUsageTypeEnum){PropertyUsageTypeEnum[PropertyUsageTypeEnum["None"]=0]="None";PropertyUsageTypeEnum[PropertyUsageTypeEnum["PrimaryResidence"]=1]="PrimaryResidence";PropertyUsageTypeEnum[PropertyUsageTypeEnum["InvestmentProperty"]=2]="InvestmentProperty";PropertyUsageTypeEnum[PropertyUsageTypeEnum["SecondVacationHome"]=3]="SecondVacationHome";})(srv.PropertyUsageTypeEnum||(srv.PropertyUsageTypeEnum={}));var PropertyUsageTypeEnum=srv.PropertyUsageTypeEnum;(function(ProspectStatusTypeEnum){ProspectStatusTypeEnum[ProspectStatusTypeEnum["NewProspect"]=0]="NewProspect";ProspectStatusTypeEnum[ProspectStatusTypeEnum["Badcredit"]=1]="Badcredit";ProspectStatusTypeEnum[ProspectStatusTypeEnum["Cancelled"]=2]="Cancelled";ProspectStatusTypeEnum[ProspectStatusTypeEnum["DoNotCall"]=3]="DoNotCall";ProspectStatusTypeEnum[ProspectStatusTypeEnum["FollowUp"]=4]="FollowUp";ProspectStatusTypeEnum[ProspectStatusTypeEnum["WarmLead"]=5]="WarmLead";ProspectStatusTypeEnum[ProspectStatusTypeEnum["ApplicationStarted"]=6]="ApplicationStarted";ProspectStatusTypeEnum[ProspectStatusTypeEnum["LostToCompetition"]=8]="LostToCompetition";ProspectStatusTypeEnum[ProspectStatusTypeEnum["NoBenefitRateAlert"]=11]="NoBenefitRateAlert";ProspectStatusTypeEnum[ProspectStatusTypeEnum["NoEquity"]=12]="NoEquity";ProspectStatusTypeEnum[ProspectStatusTypeEnum["NoIncome"]=13]="NoIncome";ProspectStatusTypeEnum[ProspectStatusTypeEnum["NotLicensedInTheState"]=14]="NotLicensedInTheState";ProspectStatusTypeEnum[ProspectStatusTypeEnum["PreApprovalRequest"]=16]="PreApprovalRequest";ProspectStatusTypeEnum[ProspectStatusTypeEnum["LoanApplicationPending"]=17]="LoanApplicationPending";ProspectStatusTypeEnum[ProspectStatusTypeEnum["ApplicationCompleted"]=19]="ApplicationCompleted";})(srv.ProspectStatusTypeEnum||(srv.ProspectStatusTypeEnum={}));var ProspectStatusTypeEnum=srv.ProspectStatusTypeEnum;(function(RefinanceCommentTypeEnum){RefinanceCommentTypeEnum[RefinanceCommentTypeEnum["None"]=0]="None";RefinanceCommentTypeEnum[RefinanceCommentTypeEnum["DoNotPayoff"]=1]="DoNotPayoff";RefinanceCommentTypeEnum[RefinanceCommentTypeEnum["PayoffAtClosing"]=2]="PayoffAtClosing";RefinanceCommentTypeEnum[RefinanceCommentTypeEnum["PayoffDontCloseAccount"]=3]="PayoffDontCloseAccount";RefinanceCommentTypeEnum[RefinanceCommentTypeEnum["PayoffCloseAccount"]=4]="PayoffCloseAccount";})(srv.RefinanceCommentTypeEnum||(srv.RefinanceCommentTypeEnum={}));var RefinanceCommentTypeEnum=srv.RefinanceCommentTypeEnum;(function(RefinancePurposeTypeEnum){RefinancePurposeTypeEnum[RefinancePurposeTypeEnum["None"]=0]="None";RefinancePurposeTypeEnum[RefinancePurposeTypeEnum["CashOut"]=1]="CashOut";RefinancePurposeTypeEnum[RefinancePurposeTypeEnum["RateAndTerm"]=2]="RateAndTerm";})(srv.RefinancePurposeTypeEnum||(srv.RefinancePurposeTypeEnum={}));var RefinancePurposeTypeEnum=srv.RefinancePurposeTypeEnum;(function(RightsTypeEnum){RightsTypeEnum[RightsTypeEnum["FeeSimple"]=0]="FeeSimple";RightsTypeEnum[RightsTypeEnum["Leasehold"]=1]="Leasehold";RightsTypeEnum[RightsTypeEnum["Other"]=2]="Other";})(srv.RightsTypeEnum||(srv.RightsTypeEnum={}));var RightsTypeEnum=srv.RightsTypeEnum;(function(RoleDefaultPage){RoleDefaultPage[RoleDefaultPage["None"]=0]="None";RoleDefaultPage[RoleDefaultPage["ConciergeCenterProspectQueue"]=1]="ConciergeCenterProspectQueue";RoleDefaultPage[RoleDefaultPage["LoanCenter"]=2]="LoanCenter";RoleDefaultPage[RoleDefaultPage["ConciergeCenterNewLoanAppOrPipelineQueue"]=3]="ConciergeCenterNewLoanAppOrPipelineQueue";RoleDefaultPage[RoleDefaultPage["SystemAdmin"]=4]="SystemAdmin";})(srv.RoleDefaultPage||(srv.RoleDefaultPage={}));var RoleDefaultPage=srv.RoleDefaultPage;(function(RoleEnum){RoleEnum[RoleEnum["None"]=0]="None";RoleEnum[RoleEnum["Administrator"]=1]="Administrator";RoleEnum[RoleEnum["Borrower"]=2]="Borrower";RoleEnum[RoleEnum["BranchManager"]=3]="BranchManager";RoleEnum[RoleEnum["Business"]=4]="Business";RoleEnum[RoleEnum["ChannelManager"]=5]="ChannelManager";RoleEnum[RoleEnum["Concierge"]=6]="Concierge";RoleEnum[RoleEnum["DivisionManager"]=7]="DivisionManager";RoleEnum[RoleEnum["HVM"]=8]="HVM";RoleEnum[RoleEnum["LoanAdmin"]=9]="LoanAdmin";RoleEnum[RoleEnum["LoanOfficer"]=10]="LoanOfficer";RoleEnum[RoleEnum["LoanOfficerAssistant"]=11]="LoanOfficerAssistant";RoleEnum[RoleEnum["LoanProcessor"]=12]="LoanProcessor";RoleEnum[RoleEnum["LockDesk"]=13]="LockDesk";RoleEnum[RoleEnum["Manager"]=14]="Manager";RoleEnum[RoleEnum["Public"]=15]="Public";RoleEnum[RoleEnum["SalesManager"]=16]="SalesManager";RoleEnum[RoleEnum["SalesMarketing"]=17]="SalesMarketing";RoleEnum[RoleEnum["SalesMarketingExternal"]=18]="SalesMarketingExternal";RoleEnum[RoleEnum["Secondary"]=19]="Secondary";RoleEnum[RoleEnum["TeamLeader"]=20]="TeamLeader";})(srv.RoleEnum||(srv.RoleEnum={}));var RoleEnum=srv.RoleEnum;(function(RoleTypeEnum){RoleTypeEnum[RoleTypeEnum["None"]=0]="None";RoleTypeEnum[RoleTypeEnum["LoanAssignments"]=1]="LoanAssignments";})(srv.RoleTypeEnum||(srv.RoleTypeEnum={}));var RoleTypeEnum=srv.RoleTypeEnum;(function(SearchCriteriaAmortizationTypeEnum){SearchCriteriaAmortizationTypeEnum[SearchCriteriaAmortizationTypeEnum["Fixed"]=1]="Fixed";SearchCriteriaAmortizationTypeEnum[SearchCriteriaAmortizationTypeEnum["ARM"]=2]="ARM";})(srv.SearchCriteriaAmortizationTypeEnum||(srv.SearchCriteriaAmortizationTypeEnum={}));var SearchCriteriaAmortizationTypeEnum=srv.SearchCriteriaAmortizationTypeEnum;(function(SearchCriteriaARMFixedTermEnum){SearchCriteriaARMFixedTermEnum[SearchCriteriaARMFixedTermEnum["ARM10yr"]=1]="ARM10yr";SearchCriteriaARMFixedTermEnum[SearchCriteriaARMFixedTermEnum["ARM7yr"]=2]="ARM7yr";SearchCriteriaARMFixedTermEnum[SearchCriteriaARMFixedTermEnum["ARM5yr"]=4]="ARM5yr";SearchCriteriaARMFixedTermEnum[SearchCriteriaARMFixedTermEnum["ARM3yr"]=8]="ARM3yr";SearchCriteriaARMFixedTermEnum[SearchCriteriaARMFixedTermEnum["ARM2yr"]=16]="ARM2yr";SearchCriteriaARMFixedTermEnum[SearchCriteriaARMFixedTermEnum["ARM1yr"]=32]="ARM1yr";SearchCriteriaARMFixedTermEnum[SearchCriteriaARMFixedTermEnum["ARM6mo"]=64]="ARM6mo";SearchCriteriaARMFixedTermEnum[SearchCriteriaARMFixedTermEnum["ARM3mo"]=128]="ARM3mo";SearchCriteriaARMFixedTermEnum[SearchCriteriaARMFixedTermEnum["ARM1mo"]=256]="ARM1mo";})(srv.SearchCriteriaARMFixedTermEnum||(srv.SearchCriteriaARMFixedTermEnum={}));var SearchCriteriaARMFixedTermEnum=srv.SearchCriteriaARMFixedTermEnum;(function(SearchCriteriaLoanTermEnum){SearchCriteriaLoanTermEnum[SearchCriteriaLoanTermEnum["Loan40yr"]=1]="Loan40yr";SearchCriteriaLoanTermEnum[SearchCriteriaLoanTermEnum["Loan30yr"]=2]="Loan30yr";SearchCriteriaLoanTermEnum[SearchCriteriaLoanTermEnum["Loan25yr"]=4]="Loan25yr";SearchCriteriaLoanTermEnum[SearchCriteriaLoanTermEnum["Loan20yr"]=8]="Loan20yr";SearchCriteriaLoanTermEnum[SearchCriteriaLoanTermEnum["Loan15yr"]=16]="Loan15yr";SearchCriteriaLoanTermEnum[SearchCriteriaLoanTermEnum["Loan10yr"]=32]="Loan10yr";SearchCriteriaLoanTermEnum[SearchCriteriaLoanTermEnum["Loan7yr"]=64]="Loan7yr";SearchCriteriaLoanTermEnum[SearchCriteriaLoanTermEnum["Loan5yr"]=128]="Loan5yr";SearchCriteriaLoanTermEnum[SearchCriteriaLoanTermEnum["Loan4yr"]=256]="Loan4yr";SearchCriteriaLoanTermEnum[SearchCriteriaLoanTermEnum["Loan2yr"]=512]="Loan2yr";})(srv.SearchCriteriaLoanTermEnum||(srv.SearchCriteriaLoanTermEnum={}));var SearchCriteriaLoanTermEnum=srv.SearchCriteriaLoanTermEnum;(function(SearchCriteriaLoanTypeEnum){SearchCriteriaLoanTypeEnum[SearchCriteriaLoanTypeEnum["Conforming"]=1]="Conforming";SearchCriteriaLoanTypeEnum[SearchCriteriaLoanTypeEnum["NonConforming"]=2]="NonConforming";SearchCriteriaLoanTypeEnum[SearchCriteriaLoanTypeEnum["FHA"]=4]="FHA";SearchCriteriaLoanTypeEnum[SearchCriteriaLoanTypeEnum["USDA"]=8]="USDA";SearchCriteriaLoanTypeEnum[SearchCriteriaLoanTypeEnum["HARP_FannieMae"]=16]="HARP_FannieMae";SearchCriteriaLoanTypeEnum[SearchCriteriaLoanTypeEnum["HARP_FreddieMac"]=32]="HARP_FreddieMac";})(srv.SearchCriteriaLoanTypeEnum||(srv.SearchCriteriaLoanTypeEnum={}));var SearchCriteriaLoanTypeEnum=srv.SearchCriteriaLoanTypeEnum;(function(SecondMortgageInfoTypeEnum){SecondMortgageInfoTypeEnum[SecondMortgageInfoTypeEnum["OpenedAtTimeOfPurchase"]=0]="OpenedAtTimeOfPurchase";SecondMortgageInfoTypeEnum[SecondMortgageInfoTypeEnum["OpenedInLast12Months"]=1]="OpenedInLast12Months";SecondMortgageInfoTypeEnum[SecondMortgageInfoTypeEnum["OpenedOver12MonthsAgo"]=2]="OpenedOver12MonthsAgo";SecondMortgageInfoTypeEnum[SecondMortgageInfoTypeEnum["None"]=-1]="None";})(srv.SecondMortgageInfoTypeEnum||(srv.SecondMortgageInfoTypeEnum={}));var SecondMortgageInfoTypeEnum=srv.SecondMortgageInfoTypeEnum;(function(SectionTypeEnum){SectionTypeEnum[SectionTypeEnum["Empty"]=0]="Empty";SectionTypeEnum[SectionTypeEnum["BorrowerDebits"]=1]="BorrowerDebits";SectionTypeEnum[SectionTypeEnum["BorrowerCredits"]=2]="BorrowerCredits";SectionTypeEnum[SectionTypeEnum["SellerCredits"]=3]="SellerCredits";SectionTypeEnum[SectionTypeEnum["SellerDebits"]=4]="SellerDebits";})(srv.SectionTypeEnum||(srv.SectionTypeEnum={}));var SectionTypeEnum=srv.SectionTypeEnum;(function(ServiceProviderEnum){ServiceProviderEnum[ServiceProviderEnum["BorrowerSelected"]=0]="BorrowerSelected";ServiceProviderEnum[ServiceProviderEnum["Affiliate"]=1]="Affiliate";ServiceProviderEnum[ServiceProviderEnum["SSP"]=2]="SSP";})(srv.ServiceProviderEnum||(srv.ServiceProviderEnum={}));var ServiceProviderEnum=srv.ServiceProviderEnum;(function(SigningStatusEnum){SigningStatusEnum[SigningStatusEnum["None"]=0]="None";SigningStatusEnum[SigningStatusEnum["Decline"]=1]="Decline";SigningStatusEnum[SigningStatusEnum["Signed"]=2]="Signed";})(srv.SigningStatusEnum||(srv.SigningStatusEnum={}));var SigningStatusEnum=srv.SigningStatusEnum;(function(SubSectionTypeEnum){SubSectionTypeEnum[SubSectionTypeEnum["Empty"]=0]="Empty";SubSectionTypeEnum[SubSectionTypeEnum["Main"]=1]="Main";SubSectionTypeEnum[SubSectionTypeEnum["PaidAdjustments"]=2]="PaidAdjustments";SubSectionTypeEnum[SubSectionTypeEnum["UnpaidAdjustments"]=3]="UnpaidAdjustments";SubSectionTypeEnum[SubSectionTypeEnum["OtherCredits"]=4]="OtherCredits";SubSectionTypeEnum[SubSectionTypeEnum["Adjustments"]=5]="Adjustments";SubSectionTypeEnum[SubSectionTypeEnum["AdditionalAdjustments"]=6]="AdditionalAdjustments";SubSectionTypeEnum[SubSectionTypeEnum["Payoffs"]=7]="Payoffs";SubSectionTypeEnum[SubSectionTypeEnum["SellerCredit"]=8]="SellerCredit";})(srv.SubSectionTypeEnum||(srv.SubSectionTypeEnum={}));var SubSectionTypeEnum=srv.SubSectionTypeEnum;(function(TitleCostIncludedTypeEnum){TitleCostIncludedTypeEnum[TitleCostIncludedTypeEnum["None"]=0]="None";TitleCostIncludedTypeEnum[TitleCostIncludedTypeEnum["IncludeInLendersPolicy"]=1]="IncludeInLendersPolicy";TitleCostIncludedTypeEnum[TitleCostIncludedTypeEnum["IncludeInOwnersPolicy"]=2]="IncludeInOwnersPolicy";TitleCostIncludedTypeEnum[TitleCostIncludedTypeEnum["ShowAsALineItem"]=3]="ShowAsALineItem";})(srv.TitleCostIncludedTypeEnum||(srv.TitleCostIncludedTypeEnum={}));var TitleCostIncludedTypeEnum=srv.TitleCostIncludedTypeEnum;(function(TitleVestedAsEnum){TitleVestedAsEnum[TitleVestedAsEnum["None"]=0]="None";TitleVestedAsEnum[TitleVestedAsEnum["Veteran"]=1]="Veteran";TitleVestedAsEnum[TitleVestedAsEnum["VeteranAndSpouse"]=2]="VeteranAndSpouse";TitleVestedAsEnum[TitleVestedAsEnum["Other"]=3]="Other";})(srv.TitleVestedAsEnum||(srv.TitleVestedAsEnum={}));var TitleVestedAsEnum=srv.TitleVestedAsEnum;(function(ToleranceDisclosureTypeEnum){ToleranceDisclosureTypeEnum[ToleranceDisclosureTypeEnum["Disclosure"]=0]="Disclosure";ToleranceDisclosureTypeEnum[ToleranceDisclosureTypeEnum["ReDisclosure"]=1]="ReDisclosure";ToleranceDisclosureTypeEnum[ToleranceDisclosureTypeEnum["Lock"]=2]="Lock";})(srv.ToleranceDisclosureTypeEnum||(srv.ToleranceDisclosureTypeEnum={}));var ToleranceDisclosureTypeEnum=srv.ToleranceDisclosureTypeEnum;(function(TotalPaidByEnum){TotalPaidByEnum[TotalPaidByEnum["Unknown"]=0]="Unknown";TotalPaidByEnum[TotalPaidByEnum["LoanOfficer"]=1]="LoanOfficer";TotalPaidByEnum[TotalPaidByEnum["Division"]=2]="Division";TotalPaidByEnum[TotalPaidByEnum["Company"]=3]="Company";TotalPaidByEnum[TotalPaidByEnum["Borrower"]=4]="Borrower";})(srv.TotalPaidByEnum||(srv.TotalPaidByEnum={}));var TotalPaidByEnum=srv.TotalPaidByEnum;(function(UpfrontPreferredPaymentPeriodEnum){UpfrontPreferredPaymentPeriodEnum[UpfrontPreferredPaymentPeriodEnum["None"]=0]="None";UpfrontPreferredPaymentPeriodEnum[UpfrontPreferredPaymentPeriodEnum["Financed"]=1]="Financed";UpfrontPreferredPaymentPeriodEnum[UpfrontPreferredPaymentPeriodEnum["InCash"]=2]="InCash";})(srv.UpfrontPreferredPaymentPeriodEnum||(srv.UpfrontPreferredPaymentPeriodEnum={}));var UpfrontPreferredPaymentPeriodEnum=srv.UpfrontPreferredPaymentPeriodEnum;(function(US_StateEnum){US_StateEnum[US_StateEnum["Alabama"]=0]="Alabama";US_StateEnum[US_StateEnum["Alaska"]=1]="Alaska";US_StateEnum[US_StateEnum["Arizona"]=2]="Arizona";US_StateEnum[US_StateEnum["Arkansas"]=3]="Arkansas";US_StateEnum[US_StateEnum["California"]=4]="California";US_StateEnum[US_StateEnum["Colorado"]=5]="Colorado";US_StateEnum[US_StateEnum["Connecticut"]=6]="Connecticut";US_StateEnum[US_StateEnum["Delaware"]=7]="Delaware";US_StateEnum[US_StateEnum["Florida"]=8]="Florida";US_StateEnum[US_StateEnum["Georgia"]=9]="Georgia";US_StateEnum[US_StateEnum["Hawaii"]=10]="Hawaii";US_StateEnum[US_StateEnum["Idaho"]=11]="Idaho";US_StateEnum[US_StateEnum["Illinois"]=12]="Illinois";US_StateEnum[US_StateEnum["Indiana"]=13]="Indiana";US_StateEnum[US_StateEnum["Iowa"]=14]="Iowa";US_StateEnum[US_StateEnum["Kansas"]=15]="Kansas";US_StateEnum[US_StateEnum["Kentucky"]=16]="Kentucky";US_StateEnum[US_StateEnum["Louisiana"]=17]="Louisiana";US_StateEnum[US_StateEnum["Maine"]=18]="Maine";US_StateEnum[US_StateEnum["Maryland"]=19]="Maryland";US_StateEnum[US_StateEnum["Massachussets"]=20]="Massachussets";US_StateEnum[US_StateEnum["Michigan"]=21]="Michigan";US_StateEnum[US_StateEnum["Minnesota"]=22]="Minnesota";US_StateEnum[US_StateEnum["Mississippi"]=23]="Mississippi";US_StateEnum[US_StateEnum["Missouri"]=24]="Missouri";US_StateEnum[US_StateEnum["Montana"]=25]="Montana";US_StateEnum[US_StateEnum["Nebraska"]=26]="Nebraska";US_StateEnum[US_StateEnum["Nevada"]=27]="Nevada";US_StateEnum[US_StateEnum["NewHamshire"]=28]="NewHamshire";US_StateEnum[US_StateEnum["NewJersey"]=29]="NewJersey";US_StateEnum[US_StateEnum["NewMexico"]=30]="NewMexico";US_StateEnum[US_StateEnum["NewYork"]=31]="NewYork";US_StateEnum[US_StateEnum["NorthCarolina"]=32]="NorthCarolina";US_StateEnum[US_StateEnum["NorthDakota"]=33]="NorthDakota";US_StateEnum[US_StateEnum["Ohio"]=34]="Ohio";US_StateEnum[US_StateEnum["Oklahoma"]=35]="Oklahoma";US_StateEnum[US_StateEnum["Oregon"]=36]="Oregon";US_StateEnum[US_StateEnum["Pennsylvania"]=37]="Pennsylvania";US_StateEnum[US_StateEnum["RhodeIsland"]=38]="RhodeIsland";US_StateEnum[US_StateEnum["SouthCarolina"]=39]="SouthCarolina";US_StateEnum[US_StateEnum["SouthDakota"]=40]="SouthDakota";US_StateEnum[US_StateEnum["Tennessee"]=41]="Tennessee";US_StateEnum[US_StateEnum["Texas"]=42]="Texas";US_StateEnum[US_StateEnum["Utah"]=43]="Utah";US_StateEnum[US_StateEnum["Vermont"]=44]="Vermont";US_StateEnum[US_StateEnum["Virginia"]=45]="Virginia";US_StateEnum[US_StateEnum["Washington"]=46]="Washington";US_StateEnum[US_StateEnum["WestVirginia"]=47]="WestVirginia";US_StateEnum[US_StateEnum["Wisconsin"]=48]="Wisconsin";US_StateEnum[US_StateEnum["Wyoming"]=49]="Wyoming";US_StateEnum[US_StateEnum["DistrictOfColumbia"]=50]="DistrictOfColumbia";US_StateEnum[US_StateEnum["Undefined"]=-1]="Undefined";})(srv.US_StateEnum||(srv.US_StateEnum={}));var US_StateEnum=srv.US_StateEnum;(function(VaAllowableTypeEnum){VaAllowableTypeEnum[VaAllowableTypeEnum["None"]=0]="None";VaAllowableTypeEnum[VaAllowableTypeEnum["NonAllowable"]=1]="NonAllowable";VaAllowableTypeEnum[VaAllowableTypeEnum["Allowable"]=2]="Allowable";VaAllowableTypeEnum[VaAllowableTypeEnum["NonAllowableToOnePercent"]=3]="NonAllowableToOnePercent";})(srv.VaAllowableTypeEnum||(srv.VaAllowableTypeEnum={}));var VaAllowableTypeEnum=srv.VaAllowableTypeEnum;(function(VACalculatorsEnum){VACalculatorsEnum[VACalculatorsEnum["VAGeneralInformation"]=1]="VAGeneralInformation";VACalculatorsEnum[VACalculatorsEnum["IRRLMax"]=2]="IRRLMax";VACalculatorsEnum[VACalculatorsEnum["IRRLQMCertification"]=3]="IRRLQMCertification";})(srv.VACalculatorsEnum||(srv.VACalculatorsEnum={}));var VACalculatorsEnum=srv.VACalculatorsEnum;(function(VAFeeLimitExceededReasonEnum){VAFeeLimitExceededReasonEnum[VAFeeLimitExceededReasonEnum["None"]=0]="None";VAFeeLimitExceededReasonEnum[VAFeeLimitExceededReasonEnum["UnAllowableFeeCharged"]=1]="UnAllowableFeeCharged";VAFeeLimitExceededReasonEnum[VAFeeLimitExceededReasonEnum["FeesExceedsOnePercentLimit"]=2]="FeesExceedsOnePercentLimit";})(srv.VAFeeLimitExceededReasonEnum||(srv.VAFeeLimitExceededReasonEnum={}));var VAFeeLimitExceededReasonEnum=srv.VAFeeLimitExceededReasonEnum;(function(VALoanPurposeEnum){VALoanPurposeEnum[VALoanPurposeEnum["None"]=0]="None";VALoanPurposeEnum[VALoanPurposeEnum["PurchaseHomePreviouslyOccupied"]=1]="PurchaseHomePreviouslyOccupied";VALoanPurposeEnum[VALoanPurposeEnum["FinanceImprovement"]=2]="FinanceImprovement";VALoanPurposeEnum[VALoanPurposeEnum["Refinance"]=3]="Refinance";VALoanPurposeEnum[VALoanPurposeEnum["PurchaseNewCondoUnit"]=4]="PurchaseNewCondoUnit";VALoanPurposeEnum[VALoanPurposeEnum["PurchaseExistingCondoUnit"]=5]="PurchaseExistingCondoUnit";VALoanPurposeEnum[VALoanPurposeEnum["PurchaseHomeNotPreviouslyOccupied"]=6]="PurchaseHomeNotPreviouslyOccupied";VALoanPurposeEnum[VALoanPurposeEnum["ConstructHome"]=7]="ConstructHome";VALoanPurposeEnum[VALoanPurposeEnum["FinanceCoopPurchase"]=8]="FinanceCoopPurchase";VALoanPurposeEnum[VALoanPurposeEnum["PurchaseManufacturedHome"]=9]="PurchaseManufacturedHome";VALoanPurposeEnum[VALoanPurposeEnum["PurchaseManufacturedHomeAndLot"]=10]="PurchaseManufacturedHomeAndLot";VALoanPurposeEnum[VALoanPurposeEnum["RefiManufacturedHomeToBuyLot"]=11]="RefiManufacturedHomeToBuyLot";VALoanPurposeEnum[VALoanPurposeEnum["RefiManufacturedHomeOrLotLoan"]=12]="RefiManufacturedHomeOrLotLoan";})(srv.VALoanPurposeEnum||(srv.VALoanPurposeEnum={}));var VALoanPurposeEnum=srv.VALoanPurposeEnum;(function(VARegionsEnum){VARegionsEnum[VARegionsEnum["None"]=0]="None";VARegionsEnum[VARegionsEnum["Northeast"]=1]="Northeast";VARegionsEnum[VARegionsEnum["Midwest"]=2]="Midwest";VARegionsEnum[VARegionsEnum["South"]=3]="South";VARegionsEnum[VARegionsEnum["West"]=4]="West";})(srv.VARegionsEnum||(srv.VARegionsEnum={}));var VARegionsEnum=srv.VARegionsEnum;(function(ViewModelFunctionStatusEnum){ViewModelFunctionStatusEnum[ViewModelFunctionStatusEnum["Success"]=0]="Success";ViewModelFunctionStatusEnum[ViewModelFunctionStatusEnum["SectionKeyDoesNotExist"]=1]="SectionKeyDoesNotExist";ViewModelFunctionStatusEnum[ViewModelFunctionStatusEnum["NotDoubleEntry"]=2]="NotDoubleEntry";ViewModelFunctionStatusEnum[ViewModelFunctionStatusEnum["SubSectionIsFull"]=3]="SubSectionIsFull";ViewModelFunctionStatusEnum[ViewModelFunctionStatusEnum["GeneralFailure"]=4]="GeneralFailure";ViewModelFunctionStatusEnum[ViewModelFunctionStatusEnum["LineNumberDoesNotExist"]=5]="LineNumberDoesNotExist";ViewModelFunctionStatusEnum[ViewModelFunctionStatusEnum["LinkedDoubleEntryCannotBeUnlinked"]=6]="LinkedDoubleEntryCannotBeUnlinked";ViewModelFunctionStatusEnum[ViewModelFunctionStatusEnum["LineNumberIsInUse"]=7]="LineNumberIsInUse";ViewModelFunctionStatusEnum[ViewModelFunctionStatusEnum["SubSectionKeyDoesNotExist"]=8]="SubSectionKeyDoesNotExist";ViewModelFunctionStatusEnum[ViewModelFunctionStatusEnum["SubSectionKeyCounterpartDoesNotExist"]=9]="SubSectionKeyCounterpartDoesNotExist";ViewModelFunctionStatusEnum[ViewModelFunctionStatusEnum["MainSubSectionCannotBeAltered"]=10]="MainSubSectionCannotBeAltered";ViewModelFunctionStatusEnum[ViewModelFunctionStatusEnum["ValueIsReadOnly"]=11]="ValueIsReadOnly";ViewModelFunctionStatusEnum[ViewModelFunctionStatusEnum["NameIsReadOnly"]=12]="NameIsReadOnly";ViewModelFunctionStatusEnum[ViewModelFunctionStatusEnum["OtherCostNameStringIsNull"]=13]="OtherCostNameStringIsNull";})(srv.ViewModelFunctionStatusEnum||(srv.ViewModelFunctionStatusEnum={}));var ViewModelFunctionStatusEnum=srv.ViewModelFunctionStatusEnum;})(srv||(srv={}));(function(){angular.module("common").factory("commonModalWindowFactory",["$modal","$modalStack","modalWindowType",function($modal,$modalStack,modalWindowType){return{open:function(modalObject){var modalOpenObject={backdrop:"static",backdropClass:"custom-modal-backdrop",dialogFade:false,keyboard:false,controller:"commonModalController as commonModalCtrl",resolve:{type:function(){return modalObject.type;},message:function(){return modalObject.message;},messageDetails:function(){return modalObject.messageDetails;},ctrl:function(){return modalObject.ctrl;},ctrlButtons:function(){return modalObject.ctrlButtons;},messageClass:function(){return modalObject.messageClass;},header:function(){return modalObject.header;},btnCloseText:function(){return modalObject.btnCloseText;},headerClass:function(){return modalObject.headerClass;}}};modalOpenObject["windowClass"]="common-modal";switch(modalObject.type){case modalWindowType.loader:modalOpenObject["templateUrl"]="angular/common/commonmodalwindow/loadermodalwindow.html";break;case modalWindowType.error:modalOpenObject["windowClass"]="custom-modal-error";modalOpenObject["templateUrl"]="angular/common/commonmodalwindow/errormodalwindow.html";break;case modalWindowType.success:modalOpenObject["templateUrl"]="angular/common/commonmodalwindow/successmodalwindow.html";break;case modalWindowType.unsuccess:modalOpenObject["templateUrl"]="angular/common/commonmodalwindow/unsuccessmodalwindow.html";break;case modalWindowType.confirmation:modalOpenObject["templateUrl"]="angular/common/commonmodalwindow/confirmationmodalwindow.html";break;case modalWindowType.unload:modalOpenObject["windowClass"]="custom-modal-error";modalOpenObject["templateUrl"]="angular/common/commonmodalwindow/unloadloanmodalwindow.html";break;default:break;}$modal.open(modalOpenObject);if(modalObject.type==modalWindowType.error){angular.element(document.getElementsByClassName("modal-backdrop")).addClass("custom-modal-backdrop");}},close:function(reason){$modalStack.dismissAll("close");}};}]);})();(function(){angular.module("common").controller("commonModalController",function($scope,$modalStack,$sce,type,header,message,messageDetails,ctrl,ctrlButtons,messageClass,btnCloseText,headerClass){var vm=this;vm.type=type;vm.header=header;vm.headerClass=headerClass;vm.message=$sce.trustAsHtml(message);vm.messageDetails=messageDetails;vm.ctrl=ctrl;vm.ctrlButtons=ctrlButtons;vm.messageClass=messageClass;vm.btnCloseText=btnCloseText;vm.close=function(){$modalStack.dismissAll("close");};vm.buttonCallback=function(callback){ctrl[callback]();};});})();(function(){angular.module("common").factory("columnOptionsFactory",["$modal","$modalStack",function($modal,$modalStack){return{open:function(modalObject){$modal.open({backdrop:"static",dialogFade:false,controller:"columnOptionsController as columnOptionsCtrl",templateUrl:"angular/common/columnoptions/columnoptions.html",windowClass:"column-options",resolve:{modalObject:function(){return modalObject;}}});},close:function(reason){$modalStack.dismissAll("close");}};}]);})();(function(){angular.module("common").controller("columnOptionsController",columnOptionsController);columnOptionsController.$inject=["$scope","$modalStack","modalObject"];function columnOptionsController($scope,$modalStack,modalObject){var availableColumns=convertToArrayOfObjects(removeElementsFromArray(modalObject.availableColumns.slice(),modalObject.selectedColumns));var selectedColumns=convertToArrayOfObjects(modalObject.selectedColumns);var currentlySelectedColumn={available:-1,selected:-1};var shiftSection={available:{startIndex:-1,endIndex:-1},selected:{startIndex:-1,endIndex:-1}};var listInFocus="";sortByColumnName(availableColumns);var vm=this;vm.modalTitle=modalObject.modalTitle;vm.availableColumnsTitle=modalObject.availableColumnsTitle;vm.selectedColumnsTitle=modalObject.selectedColumnsTitle;vm.availableColumns=availableColumns;vm.selectedColumns=selectedColumns;vm.removeElementsFromArray=removeElementsFromArray;vm.sortByColumnName=sortByColumnName;vm.convertToArrayOfObjects=convertToArrayOfObjects;vm.convertToArrayOfStrings=convertToArrayOfStrings;vm.columnOptionsHandler=columnOptionsHandler;vm.moveElementInArray=moveElementInArray;vm.moveTo=moveTo;vm.moveUp=moveUp;vm.moveDown=moveDown;vm.close=close;vm.update=update;function removeElementsFromArray(removeFrom,elements){for(var i=0;i<elements.length;i++){if(removeFrom.indexOf(elements[i])!=-1){removeFrom.splice(removeFrom.indexOf(elements[i]),1);}}return removeFrom;}function sortByColumnName(array){array.sort(function(a,b){if(a.columnName>=b.columnName){return 1;}else{return -1;}});}function moveElementInArray(array,old_index,new_index){if(new_index<0||new_index>=array.length||old_index<0||old_index>=array.length){return;}array.splice(new_index,0,array.splice(old_index,1)[0]);}function convertToArrayOfObjects(arrayOfStrings){var arrayOfObjects=[arrayOfStrings.length];for(var i=0;i<arrayOfStrings.length;i++){arrayOfObjects[i]={};arrayOfObjects[i].columnName=arrayOfStrings[i];}return arrayOfObjects;}function convertToArrayOfStrings(arrayOfObjects){var arrayOfStrings=[arrayOfObjects.length];for(var i=0;i<arrayOfObjects.length;i++){arrayOfStrings[i]=arrayOfObjects[i].columnName;}return arrayOfStrings;}function moveUp(){if(!selectedColumns[0]||selectedColumns[0].selected){return;}for(var i=1;i<selectedColumns.length;i++){if(selectedColumns[i].selected){moveElementInArray(selectedColumns,i,i-1);}}}function moveDown(){if(!selectedColumns[selectedColumns.length-1]||selectedColumns[selectedColumns.length-1].selected){return;}for(var i=selectedColumns.length-1;i>=0;i--){if(selectedColumns[i].selected){moveElementInArray(selectedColumns,i,i+1);}}}function moveTo(event,moveFrom,moveTo,doSort,index){event.stopPropagation();moveFrom[index].selected=moveFrom[index].selected?!moveFrom[index].selected:true;moveFrom[index].selected=false;moveFrom[index].hover=false;moveTo.push(moveFrom.splice(index,1)[0]);if(doSort){sortByColumnName(moveTo);}}function selectShiftSection(list,listFlag){var smallerIndex=shiftSection[listFlag].startIndex<=shiftSection[listFlag].endIndex?shiftSection[listFlag].startIndex:shiftSection[listFlag].endIndex;var greaterIndex=shiftSection[listFlag].startIndex<=shiftSection[listFlag].endIndex?shiftSection[listFlag].endIndex:shiftSection[listFlag].startIndex;for(var i=0;i<list.length;i++){list[i].selected=(i>=smallerIndex&&i<=greaterIndex);}}function columnOptionsHandler(event,listFlag,index){if(common.string.isNullOrWhiteSpace(listFlag)){return;}listInFocus=listFlag;var list=listFlag=="available"?availableColumns:selectedColumns;if(event.keyCode==38&&event.shiftKey){if(currentlySelectedColumn[listFlag]<=0){return;}currentlySelectedColumn[listFlag]=currentlySelectedColumn[listFlag]-1;shiftSection[listFlag].endIndex--;selectShiftSection(list,listFlag);}else{if(event.keyCode==40&&event.shiftKey){if(currentlySelectedColumn[listFlag]>=list.length-1){return;}currentlySelectedColumn[listFlag]=currentlySelectedColumn[listFlag]+1;shiftSection[listFlag].endIndex++;selectShiftSection(list,listFlag);}else{if(event.shiftKey){if(currentlySelectedColumn[listFlag]==-1){return;}var smallerIndex=currentlySelectedColumn[listFlag]<index?currentlySelectedColumn[listFlag]:index;var greaterIndex=currentlySelectedColumn[listFlag]<index?index+1:currentlySelectedColumn[listFlag]+1;for(var i=0;i<list.length;i++){list[i].selected=(i>=smallerIndex&&i<greaterIndex);}shiftSection[listFlag].startIndex=currentlySelectedColumn[listFlag];shiftSection[listFlag].endIndex=index;currentlySelectedColumn[listFlag]=index;}else{if(event.ctrlKey){list[index].selected=list[index].selected?!list[index].selected:true;currentlySelectedColumn[listFlag]=list[index].selected?index:-1;if(currentlySelectedColumn[listFlag]!=-1&&((list[index-1]&&list[index-1].selected)||(list[index+1]&&list[index+1].selected))){shiftSection[listFlag].endIndex=currentlySelectedColumn[listFlag];}else{if(currentlySelectedColumn[listFlag]!=-1){shiftSection[listFlag].startIndex=currentlySelectedColumn[listFlag];shiftSection[listFlag].endIndex=currentlySelectedColumn[listFlag];}else{shiftSection[listFlag].startIndex=-1;shiftSection[listFlag].endIndex=-1;}}}else{list[index].selected=list[index].selected?!list[index].selected:true;for(var i=0;i<list.length;i++){if(i!=index){list[i].selected=false;}}currentlySelectedColumn[listFlag]=list[index].selected?index:-1;shiftSection[listFlag].startIndex=currentlySelectedColumn[listFlag];shiftSection[listFlag].endIndex=currentlySelectedColumn[listFlag];}}}}}function close(){$modalStack.dismissAll("close");}function update(){if(modalObject.update){modalObject.update(convertToArrayOfStrings(selectedColumns));}close();}}})();(function(){angular.module("contextualBar").controller("ShareComparisonCtrl",ShareComparisonCtrl);ShareComparisonCtrl.$inject=["$scope","$state","$controller","$modal","$modalStack","pricingResultsSvc","NavigationSvc","BroadcastSvc","commonModalWindowFactory","modalWindowType","wrappedLoan","applicationData","userSelectedProductCategoriesVM"];function ShareComparisonCtrl($scope,$state,$controller,$modal,$modalStack,pricingResultsSvc,NavigationSvc,BroadcastSvc,commonModalWindowFactory,modalWindowType,wrappedLoan,applicationData,userSelectedProductCategoriesVM){var vm=this;vm.closeModal=closeModal;vm.shareComparisonModalHeight=shareComparisonModalHeight;vm.saveLoanAndSendUserSelectedProductCategories=saveLoanAndSendUserSelectedProductCategories;vm.addRecipient=addRecipient;vm.comparisonNumberOfAdditionalRecipients=0;vm.additionalRecipients=[];vm.wrappedLoan=wrappedLoan;vm.userSelectedProductCategoriesVM=userSelectedProductCategoriesVM;vm.isEmailValid=wrappedLoan.ref.active.validateEmail(vm.userSelectedProductCategoriesVM.email);function closeModal(){$modalStack.dismissAll("close");}function shareComparisonModalHeight(numberOfAdditionalRecipients){if(numberOfAdditionalRecipients>=5){return"405px";}else{return(285+30*numberOfAdditionalRecipients)+"px";}}function saveLoanAndSendUserSelectedProductCategories(sendEmail){wrappedLoan.ref.active.getBorrower().firstName=vm.userSelectedProductCategoriesVM.firstName;wrappedLoan.ref.active.getBorrower().lastName=vm.userSelectedProductCategoriesVM.lastName;if(vm.userSelectedProductCategoriesVM.email){wrappedLoan.ref.active.getBorrower().userAccount.username=vm.userSelectedProductCategoriesVM.email;}vm.userSelectedProductCategoriesVM.additionalRecipients=vm.additionalRecipients.map(function(item){return item["email"];});NavigationSvc.SaveAndUpdateWrappedLoan(applicationData.currentUserId,wrappedLoan,function(){saveAndSendUserSelectedProductCategories(vm.userSelectedProductCategoriesVM);});}function saveAndSendUserSelectedProductCategories(viewModel){viewModel.loanId=vm.wrappedLoan.ref.loanId;commonModalWindowFactory.open({type:modalWindowType.loader,message:"Saving Comparison PDF ..."});pricingResultsSvc.SaveAndSendUserSelectedProductCategories(viewModel).then(function(result){if(result.data){commonModalWindowFactory.close("close");}closeModal();},function(error){commonModalWindowFactory.open({type:modalWindowType.error,message:"An error occured during saving and sending Comparison PDF."});console.log("Error:"+JSON.stringify(error));});BroadcastSvc.broadcastRepopulatePricingResults();}function isValid(){if(!vm.isEmailValid||_.some(vm.additionalRecipients,function(recipient){return !recipient.isEmailValid;})){return false;}else{return true;}}function addRecipient(){vm.comparisonNumberOfAdditionalRecipients+=1;vm.additionalRecipients.push({email:"",isEmailValid:false});}}})();(function(){angular.module("common").factory("errorModalWindowFactory",["$modal","$modalStack",function($modal,$modalStack){return{open:function(message){$modal.open({templateUrl:"angular/common/errormodalwindow/errormodalwindow.html",backdrop:"static",windowClass:"custom-modal-error",dialogFade:false,keyboard:false,controller:"modalInstanceController as modalInstanceCtrl",resolve:{message:function(){return message;}}});angular.element(document.getElementsByClassName("modal-backdrop")).addClass("custom-modal-backdrop");},close:function(reason){angular.element(document.getElementsByClassName("modal-backdrop")).removeClass("custom-modal-backdrop");$modalStack.dismissAll("close");}};}]);})();(function(){angular.module("common").controller("modalInstanceController",function($scope,$modalStack,message){var vm=this;vm.message=message;vm.close=function(){$modalStack.dismissAll("close");};});})();var loanCenter;(function(loanCenter){var AppraisalController=(function(){function AppraisalController($rootScope,NavigationSvc,enums){this.$rootScope=$rootScope;this.NavigationSvc=NavigationSvc;this.enums=enums;this.$rootScope.navigation="Appraisal";NavigationSvc.contextualType=enums.ContextualTypes.Appraisal;}AppraisalController.className="AppraisalController";AppraisalController.$inject=["$rootScope","NavigationSvc","enums"];return AppraisalController;})();loanCenter.AppraisalController=AppraisalController;moduleRegistration.registerController("loanCenter",AppraisalController);})(loanCenter||(loanCenter={}));var fha;(function(fha){angular.module("fhaCenter",[]);})(fha||(fha={}));(function(){angular.module("fhaCenter").config(config);config.$inject=["$stateProvider"];function config($stateProvider){$stateProvider.state("loanCenter.loan.fhacenter",{url:"/fhacenter",views:{"fhaCenter":{templateUrl:"/angular/fhacenter/fhacenter.html",controller:"fhaCenterController as fhaCenter"},"contextualBar@":{templateUrl:"/angular/contextualbar/contextualbar.html",controller:"ContextualBarCtrl as contextualBarCtrl"}}}).state("loanCenter.loan.fhacenter.simplerefinance",{views:{"calculator":{templateUrl:"/angular/fhacenter/simplerefinance/simplerefinance.html",controller:"simpleRefinanceController as simpleRefi"}}}).state("loanCenter.loan.fhacenter.streamlinerefinance",{views:{"calculator":{templateUrl:"/angular/fhacenter/streamlinerefinance/streamlinerefinance.html",controller:"streamlineRefinanceController as streamlineRefi"}}}).state("loanCenter.loan.fhacenter.rateandtermrefinance",{views:{"calculator":{templateUrl:"/angular/fhacenter/rateandtermrefinance/rateandtermrefinance.html",controller:"rateAndTermRefinanceController as rateAndTermRefi"}}}).state("loanCenter.loan.fhacenter.cashoutrefinance",{views:{"calculator":{templateUrl:"/angular/fhacenter/cashoutrefinance/cashoutrefinance.html",controller:"cashOutController as cashOutRefi"}}}).state("loanCenter.loan.fhacenter.purchase",{views:{"calculator":{templateUrl:"/angular/fhacenter/purchase/purchase.html",controller:"purchaseController as purchase"}}}).state("loanCenter.loan.fhacenter.purchasedown",{views:{"calculator":{templateUrl:"/angular/fhacenter/purchasedown/purchasedown.html",controller:"purchaseDownController as purchaseDown"}}});}})();var fha;(function(fha){var service;(function(service){var FHACenterService=(function(){function FHACenterService($resource,apiRoot,costDetailsSvc,costDetailsHelpers){var _this=this;this.$resource=$resource;this.apiRoot=apiRoot;this.costDetailsSvc=costDetailsSvc;this.costDetailsHelpers=costDetailsHelpers;this.isAppraisedValueValid=function(appraisedValue){return !common.objects.isNullOrUndefined(appraisedValue)&&appraisedValue!=0;};this.getText=function(keyword,value){switch(keyword){case"loantype":return value===1?"Purchase":"Refinance";case"occupancytype":return _this.getOccupancyText(value);case"cashout":return !!Number(value)?"Yes":"No";case"payoff":return !!value?"Yes":"No";default:return !!value?"Yes":"No";}};this.determinFHAProducts=function(loanPurposeType,isFHALoan,occupancyType,isCashout,isSubordinateFinancing,fhaLookup,isPurchaseMOneyOrOverAYear){lib.forEach(fhaLookup,function(item){if(!item.contextFlags){item.disabled=true;}});if(loanPurposeType==2){if(String(isFHALoan)=="true"){if(occupancyType==1&&!isCashout){if(!isSubordinateFinancing){_this.getFHAItemByValue(fhaLookup,String(3));}}if(!isSubordinateFinancing&&!isCashout){_this.getFHAItemByValue(fhaLookup,String(1));}}if(occupancyType==1){_this.getFHAItemByValue(fhaLookup,String(4));if(String(isPurchaseMOneyOrOverAYear)==="true"){_this.getFHAItemByValue(fhaLookup,String(2));}}}else{if(loanPurposeType==1&&occupancyType==1){_this.getFHAItemByValue(fhaLookup,String(5));_this.getFHAItemByValue(fhaLookup,String(6));}}};this.calculateUFMIPFactor=function(selectedDate){if(moment(selectedDate).format("YYYY-MM-DD")<="2009-05-31"){return 0.01;}return 1.75;};this.getLabelText=function(propertyOwnedLessThanOneYear,howLongPropertyIsOccupied,propertyPurchasedInLast12Months){if(propertyOwnedLessThanOneYear=="true"&&howLongPropertyIsOccupied==1){return"(Lesser of A or B2 * 85%)";}else{if(propertyOwnedLessThanOneYear=="false"&&howLongPropertyIsOccupied==1){return"(A * 85%)";}else{if(propertyOwnedLessThanOneYear=="false"&&howLongPropertyIsOccupied==2){return"(A * 97.75%)";}else{if(howLongPropertyIsOccupied==1){return"(A * 85%)";}else{if(propertyOwnedLessThanOneYear=="true"&&howLongPropertyIsOccupied==2||propertyPurchasedInLast12Months=="true"){return"(Lesser of A or B2 * 97.75%)";}else{if(propertyPurchasedInLast12Months!="true"){return"(A * 97.75%)";}}}}}}return"";};this.getFHAItemByValue=function(lookups,value){lib.forEach(lookups,function(item){if(item.value==value&&!item.contextFlags){item.disabled=false;}});};this.getOccupancyText=function(value){switch(Number(value)){case 1:return"Primary Residence";case 2:return"Investment Property";case 3:return"Second Vacation Home";}};this.calculateFHA=function(fhaScenario,countyLoanLimit,baseLoanAmount){var FHACalculatorRequestViewModel=new cls.FHACalculatorRequestViewModel(fhaScenario,_this.costDetailsHelpers.calculateAllowableBorrowerPaidClosingCost(),_this.costDetailsHelpers.calculateSectionTotal(5),_this.costDetailsSvc.wrappedLoan.ref.closingCost.totals.lenderCredits,countyLoanLimit,baseLoanAmount);return _this.$resource(_this.apiRoot+"/CalculateFHAFields").save(FHACalculatorRequestViewModel);};this.addSelectOneAsOptionInLookup=function(listToBeModified,text,value,contextFlag){if(lib.filter(listToBeModified,function(item){return item.value==value;}).length==0){var selectOne=new cls.LookupItem(text,value);selectOne.contextFlags=contextFlag;listToBeModified.push(selectOne);}};this.selectProduct=function(listToBeModified,value){var action=function(item){if(item.value==value){item.selected=true;}else{item.selected=false;}};lib.forEach(listToBeModified,action);};this.setAppraisalValueFHA=function(subjectProperty,loanPurpose,fhaAppraisalValue){if(!subjectProperty.appraisedValue&&!fhaAppraisalValue&&loanPurpose==2){return subjectProperty.currentEstimatedValue;}else{if(subjectProperty.appraisedValue){return subjectProperty.appraisedValue;}}return fhaAppraisalValue;};this.apiRoot=apiRoot+"FHACalculator";}FHACenterService.$inject=["$resource","apiRoot","costDetailsSvc","costDetailsHelpers"];FHACenterService.className="fhaCenterService";return FHACenterService;})();service.FHACenterService=FHACenterService;angular.module("fhaCenter").service("fhaCenterService",FHACenterService);})(service=fha.service||(fha.service={}));})(fha||(fha={}));var fha;(function(fha){var controller;(function(controller){var FHACenterController=(function(){function FHACenterController(fhaCenterService,wrappedLoan,$state,navigationService,applicationData,enums){var _this=this;this.fhaCenterService=fhaCenterService;this.wrappedLoan=wrappedLoan;this.$state=$state;this.navigationService=navigationService;this.applicationData=applicationData;this.enums=enums;this.realEstatePastSixtyMonths=function(value){if(!common.objects.isNullOrUndefined(value)){_this.wrappedLoan.ref.fhaScenarioViewModel.reOwnOrSoldPast60MonthsWithHudFha=common.string.toBool(value);if(!_this.wrappedLoan.ref.fhaScenarioViewModel.reOwnOrSoldPast60MonthsWithHudFha){_this.resetProperty(true);}}else{return _this.wrappedLoan.ref.fhaScenarioViewModel.reOwnOrSoldPast60MonthsWithHudFha;}};this.resetProperty=function(resetPropToBeSoldFlag){if(resetPropToBeSoldFlag===void 0){resetPropToBeSoldFlag=false;}if(resetPropToBeSoldFlag){_this.wrappedLoan.ref.fhaScenarioViewModel.propertyToBeSold=null;}_this.wrappedLoan.ref.fhaScenarioViewModel.salesPrice=0;_this.wrappedLoan.ref.fhaScenarioViewModel.originalMortgageAmount=0;_this.wrappedLoan.ref.fhaScenarioViewModel.propertyToBeSoldAddressViewModel=new srv.cls.PropertyViewModel();};this.isPropertyAdjacent=function(value){if(!common.objects.isNullOrUndefined(value)){_this.wrappedLoan.ref.fhaScenarioViewModel.isPropertyAdjacent=common.string.toBool(value);}else{return _this.wrappedLoan.ref.fhaScenarioViewModel.isPropertyAdjacent;}};this.isAdjacentVisible=function(){return _this.wrappedLoan.ref.primary.OccupancyType==2;};this.moreThenFourDwellingsOwned=function(value){if(!common.objects.isNullOrUndefined(value)){_this.wrappedLoan.ref.fhaScenarioViewModel.moreThenFourDwellingsOwned=common.string.toBool(value);}else{return _this.wrappedLoan.ref.fhaScenarioViewModel.moreThenFourDwellingsOwned;}};this.leadPaintPoisoningInfoReceived=function(value){if(!common.objects.isNullOrUndefined(value)){_this.wrappedLoan.ref.fhaScenarioViewModel.leadPaintPoisoningInfoReceived=common.string.toBool(value);}else{return _this.wrappedLoan.ref.fhaScenarioViewModel.leadPaintPoisoningInfoReceived;}};this.isPropertyToBeSoldVisible=function(){return _this.wrappedLoan.ref.fhaScenarioViewModel.reOwnOrSoldPast60MonthsWithHudFha==true;};this.propertyToBeSold=function(value){if(!common.objects.isNullOrUndefined(value)){_this.wrappedLoan.ref.fhaScenarioViewModel.propertyToBeSold=common.string.toBool(value);if(!_this.wrappedLoan.ref.fhaScenarioViewModel.propertyToBeSold){_this.resetProperty();}}else{return _this.wrappedLoan.ref.fhaScenarioViewModel.propertyToBeSold;}};this.getText=function(keyword,value){if(keyword=="payoff"){value=_this.wrappedLoan.ref.isSubordinateFinancing();}return _this.fhaCenterService.getText(keyword,value);};this.getFHAProducts=function(){_this.fhaCenterService.determinFHAProducts(_this.wrappedLoan.ref.loanPurposeType,_this.wrappedLoan.ref.otherInterviewData.fhaInformation.isCurrentLoanFHA,_this.wrappedLoan.ref.primary.occupancyType,!!Number(_this.wrappedLoan.ref.financialInfo.cashOut),_this.wrappedLoan.ref.isSubordinateFinancing(),_this.applicationData.lookup.fhaProducts,_this.wrappedLoan.ref.fhaScenarioViewModel.isPurchaseMoneyOrOverAYear);_this.eligibleProudctsExists=lib.filter(_this.applicationData.lookup.fhaProducts,function(item){return !item.disabled;}).length>1;if(lib.filter(_this.applicationData.lookup.fhaProducts,function(item){return item.value==String(_this.wrappedLoan.ref.fhaScenarioViewModel.fhaProductId)&&!item.disabled;}).length==0){_this.resetSelectList();}return _this.applicationData.lookup.fhaProducts;};this.getSelectedFHAProduct=function(){return lib.filter(_this.applicationData.lookup.fhaProducts,function(item){return item.value==_this.wrappedLoan.ref.fhaScenarioViewModel.fhaProductId;})[0];};this.selectFHAProduct=function(value){_this.fhaCenterService.selectProduct(_this.applicationData.lookup.fhaProducts,value);_this.wrappedLoan.ref.fhaScenarioViewModel.fhaProductId=value;_this.navigationService.navigateToFHACalculator(_this.wrappedLoan.ref.fhaScenarioViewModel.fhaProductId);};this.saveChanges=function(){_this.navigationService.SaveAndUpdateWrappedLoan(_this.applicationData.currentUserId,_this.wrappedLoan,_this.calculateFha);};this.calculateFha=function(wrappedLoan){_this.fhaCenterService.calculateFHA(wrappedLoan.ref.fhaScenarioViewModel,wrappedLoan.ref.fhaCountyLoanLimit,wrappedLoan.ref.loanAmount).$promise.then(function(data){wrappedLoan.ref.fhaScenarioViewModel.fhaCalculatorResults=data.response;});};this.cancelChanges=function(){_this.navigationService.cancelChanges(_this.wrappedLoan.ref.loanId);};this.calculateUFMIPFactor=function(){return _this.fhaCenterService.calculateUFMIPFactor(_this.wrappedLoan.ref.fhaScenarioViewModel.endorsmentDate);};this.resetSelectList=function(){_this.wrappedLoan.ref.fhaScenarioViewModel.fhaProductId=0;lib.forEach(_this.applicationData.lookup.fhaProducts,function(item){if(item.value==String(_this.wrappedLoan.ref.fhaScenarioViewModel.fhaProductId)){item.selected=true;}else{item.selected=false;}});_this.navigationService.navigateToFHACalculator(_this.wrappedLoan.ref.fhaScenarioViewModel.fhaProductId);};this.isFhaProductVisible=function(item){return !item.disabled&&item.value!="0";};this.loanTypeEnum=srv.LoanPurposeTypeEnum;this.fhaCenterService.addSelectOneAsOptionInLookup(this.applicationData.lookup.fhaProducts,"Select an FHA Worksheet","0",1);navigationService.contextualType=enums.ContextualTypes.FhaCenter;this.wrappedLoan.ref.fhaScenarioViewModel.purchasePrice=this.wrappedLoan.ref.fhaScenarioViewModel.purchasePriceWithDocumentedImprovements=this.wrappedLoan.ref.getSubjectProperty().purchasePrice;this.wrappedLoan.ref.fhaScenarioViewModel.appraisalValue=fhaCenterService.setAppraisalValueFHA(this.wrappedLoan.ref.getSubjectProperty(),this.wrappedLoan.ref.loanPurposeType,this.wrappedLoan.ref.fhaScenarioViewModel.appraisalValue);this.getFHAProducts();}FHACenterController.$inject=["fhaCenterService","wrappedLoan","$state","NavigationSvc","applicationData","enums"];return FHACenterController;})();angular.module("fhaCenter").controller("fhaCenterController",FHACenterController);})(controller=fha.controller||(fha.controller={}));})(fha||(fha={}));var integrationsServices;(function(integrationsServices){angular.module("integrations",[]);})(integrationsServices||(integrationsServices={}));(function(){angular.module("integrations").config(config);config.$inject=["$stateProvider"];function config($stateProvider){$stateProvider.state("loanCenter.loan.integrations",{url:"/integrations",views:{"integrations":{templateUrl:"/angular/integrations/integrations.html",controller:"integrationsController as integrationsCtrl"},"contextualBar@":{templateUrl:"/angular/contextualbar/contextualbar.html",controller:"ContextualBarCtrl as contextualBarCtrl"}}});}})();var integrationsServices;(function(integrationsServices){var service;(function(service){var IntegrationsService=(function(){function IntegrationsService(apiRoot,$resource){var _this=this;this.apiRoot=apiRoot;this.$resource=$resource;this.getIntegrationData=function(loanId,userAccountId){return _this.$resource(_this.apiPath,{loanId:loanId,userAccountId:userAccountId}).get();};this.apiPath=apiRoot+"Integrations/";}IntegrationsService.className="integrationsService";IntegrationsService.$inject=["apiRoot","$resource"];return IntegrationsService;})();service.IntegrationsService=IntegrationsService;angular.module("integrations").service("integrationsService",IntegrationsService);})(service=integrationsServices.service||(integrationsServices.service={}));})(integrationsServices||(integrationsServices={}));var integrationsServices;(function(integrationsServices){var controller;(function(controller){var IntegrationsController=(function(){function IntegrationsController(wrappedLoan,$state,navigationService,applicationData,enums,docVaultSvc,integrationsService){var _this=this;this.wrappedLoan=wrappedLoan;this.$state=$state;this.navigationService=navigationService;this.applicationData=applicationData;this.enums=enums;this.docVaultSvc=docVaultSvc;this.integrationsService=integrationsService;this.showLoader=false;this.showErrorContainer=false;this.downloadDocument=function(document){if(document.documents!=null){for(var key in document.documents){_this.docVaultSvc.downloadDocument(key);}}};this.groupItems=function(items){_this.groupedEvents=new lib.referenceWrapper(_.groupBy(items,"folderName"));};this.formatName=function(folderName,name){var splittedFolderName=name.split("-",5);var nameWithoutDate;if(common.string.isNullOrWhiteSpace(name)){return name;}if(folderName==srv.folderName.FeesClosingCorp){nameWithoutDate=splittedFolderName[0]+"-"+splittedFolderName[1]+"-"+splittedFolderName[2];}else{if(folderName==srv.folderName.LOSEncompass||folderName==srv.folderName.PricingOptimalBlue||folderName==srv.folderName.SigningeOriginal||folderName==srv.folderName.CRMLead360){nameWithoutDate=splittedFolderName[0]+"-"+splittedFolderName[1];}else{if(folderName==srv.folderName.BiDirectionalEncompass||folderName==srv.folderName.AppraisalLenderX){nameWithoutDate=splittedFolderName[0];}else{nameWithoutDate=name;}}}return nameWithoutDate;};this.shouldIconBeVisible=function(document,repositoryId,isEvent){if(isEvent){if(document.folderName==srv.folderName.LOSEncompass||document.folderName==srv.folderName.FeesClosingCorp||document.folderName==srv.folderName.PricingOptimalBlue||document.folderName==srv.folderName.SigningeOriginal||document.folderName==srv.folderName.BiDirectionalEncompass||document.folderName==srv.folderName.CRMLead360||document.folderName==srv.folderName.AppraisalLenderX){return !common.string.isNullOrWhiteSpace(document.eventId);}else{if(document.folderName==srv.folderName.DisclosuresApplicationDocument||document.folderName==srv.folderName.DisclosuresWetSignature){!_this.isConfirmedOrCompleted(document);}}return !common.string.isNullOrWhiteSpace(document.contentXml);}else{return !common.string.isEmptyGuidOrNull(repositoryId);}};this.shouldPdfIconBeVisible=function(document){var index=document.name.indexOf("ServiceCompleted");if(angular.isDefined(document.folderName)&&!common.string.isNullOrWhiteSpace(document.folderName)){return((document.folderName==srv.folderName.Credit||document.folderName==srv.folderName.Audit)&&index!=-1);}else{return false;}};this.isConfirmedOrCompleted=function(document){var splittedFolderName=name.split("_");var indexCompleted=document.name.indexOf("ServiceCompleted");var indexComfirmation=document.name.indexOf("Confirmation");if((document.folderName==srv.folderName.DisclosuresApplicationDocument||document.folderName==srv.folderName.DisclosuresWetSignature)&&(indexComfirmation!=-1||indexCompleted!=-1)){return true;}return false;};this.downloadXmlDocument=function(document,isResponse,isEvent){var downloadLink=_this.getDocumentUrl(document,isResponse,isEvent);if(downloadLink!=""){window.open(downloadLink,"_blank","");}};this.getDocumentUrl=function(document,isResponse,isEvent){if(document==null||document==""||!angular.isDefined(document)){return"";}var encodedEventId=encodeURIComponent(document.eventId);var encodedLoanId=encodeURIComponent(_this.wrappedLoan.ref.loanId);var encodedLoanNumber=encodeURIComponent(_this.wrappedLoan.ref.loanNumber);var encodedLogId=encodeURIComponent(document.id);var encodedEventId=encodeURIComponent(document.eventId);var encodedUserId=encodeURIComponent(_this.applicationData.currentUserId);var encodedRepositoryId=encodeURIComponent(document.requestRepositoryId);if(isResponse){encodedRepositoryId=encodeURIComponent(document.responseRepositoryId);}var url="";if(document.folderName==srv.folderName.LOSEncompass||document.folderName==srv.folderName.FeesClosingCorp||document.folderName==srv.folderName.PricingOptimalBlue||document.folderName==srv.folderName.SigningeOriginal||document.folderName==srv.folderName.BiDirectionalEncompass||document.folderName==srv.folderName.CRMLead360||document.folderName==srv.folderName.AppraisalLenderX){url="/Downloader.axd?documentType=logItem&loanId="+encodedLoanId+"&loanNumber="+encodedLoanNumber+"&logId="+encodedLogId+"&eventId="+encodedEventId+"&userId="+encodedUserId+"&name="+document.name;}else{if((((document.folderName==srv.folderName.DisclosuresApplicationDocument||document.folderName==srv.folderName.DisclosuresWetSignature)&&encodedRepositoryId!=lib.getEmptyGuid())||document.folderName==srv.folderName.AusDl||document.folderName==srv.folderName.AusLp)&&!isEvent){url="/Downloader.axd?documentType=repositoryItem&repositoryItemId="+encodedRepositoryId;}else{url="/Downloader.axd?documentType=LoanServiceContentXml&eventType="+document.eventType+"&eventId="+encodedEventId;}}return url;};var vm=this;navigationService.contextualType=enums.ContextualTypes.Integrations;vm.showLoader=true;vm.showErrorContainer=false;vm.integrationsService.getIntegrationData(this.wrappedLoan.ref.loanId,this.applicationData.currentUserId).$promise.then(function(success){vm.groupItems(success.response.items);vm.showLoader=false;},function(error){console.error("Error on integrations - getIntegrationData. Error: "+String(error));});}IntegrationsController.$inject=["wrappedLoan","$state","NavigationSvc","applicationData","enums","docVaultSvc","integrationsService"];return IntegrationsController;})();angular.module("integrations").controller("integrationsController",IntegrationsController);})(controller=integrationsServices.controller||(integrationsServices.controller={}));})(integrationsServices||(integrationsServices={}));var fha;(function(fha){var controller;(function(controller){var RateAndTermRefinanceController=(function(){function RateAndTermRefinanceController(wrappedLoan,fhaCenterService,commonModalWindowFactory,modalWindowType){var _this=this;this.wrappedLoan=wrappedLoan;this.fhaCenterService=fhaCenterService;this.commonModalWindowFactory=commonModalWindowFactory;this.modalWindowType=modalWindowType;this.getLabelText=function(){return _this.fhaCenterService.getLabelText(String(_this.wrappedLoan.ref.fhaScenarioViewModel.propertyOwnedLessThanOneYear),_this.wrappedLoan.ref.fhaScenarioViewModel.propertyOccupiedFor,"false");};this.calculateFHAFields=function(){var self=_this;_this.fhaCenterService.calculateFHA(_this.wrappedLoan.ref.fhaScenarioViewModel,_this.wrappedLoan.ref.fhaCountyLoanLimit,_this.wrappedLoan.ref.loanAmount).$promise.then(function(data){self.wrappedLoan.ref.fhaScenarioViewModel.fhaCalculatorResults=data.response;self.wrappedLoan.ref.updateGovermentEligibility(1,data.response.isEligible);},function(error){self.commonModalWindowFactory.open({type:self.modalWindowType.error,message:"We couldn't calculate FHA fields at the moment. Please try again"});});};this.isAppraisedValueDisabled=function(){return _this.fhaCenterService.isAppraisedValueValid(_this.wrappedLoan.ref.getSubjectProperty().appraisedValue);};this.calculateFHAFields();}RateAndTermRefinanceController.$inject=["wrappedLoan","fhaCenterService","commonModalWindowFactory","modalWindowType"];return RateAndTermRefinanceController;})();angular.module("fhaCenter").controller("rateAndTermRefinanceController",RateAndTermRefinanceController);})(controller=fha.controller||(fha.controller={}));})(fha||(fha={}));var fha;(function(fha){var controller;(function(controller){var SimpleRefinanceController=(function(){function SimpleRefinanceController(wrappedLoan,fhaCenterService,commonModalWindowFactory,modalWindowType){var _this=this;this.wrappedLoan=wrappedLoan;this.fhaCenterService=fhaCenterService;this.commonModalWindowFactory=commonModalWindowFactory;this.modalWindowType=modalWindowType;this.getLabelText=function(){return _this.fhaCenterService.getLabelText("false",0,String(_this.wrappedLoan.ref.fhaScenarioViewModel.propertyPurchasedInLast12Months));};this.calculateFHAFields=function(){var self=_this;_this.fhaCenterService.calculateFHA(_this.wrappedLoan.ref.fhaScenarioViewModel,_this.wrappedLoan.ref.fhaCountyLoanLimit,_this.wrappedLoan.ref.loanAmount).$promise.then(function(data){self.wrappedLoan.ref.fhaScenarioViewModel.fhaCalculatorResults=data.response;self.wrappedLoan.ref.updateGovermentEligibility(1,data.response.isEligible);},function(error){self.commonModalWindowFactory.open({type:self.modalWindowType.error,message:"We couldn't calculate FHA fields at the moment. Please try again"});});};this.ruleFunctionEndorsementDate=function(input){return false;};this.isAppraisedValueDisabled=function(){return _this.fhaCenterService.isAppraisedValueValid(_this.wrappedLoan.ref.getSubjectProperty().appraisedValue);};this.calculateFHAFields();}SimpleRefinanceController.$inject=["wrappedLoan","fhaCenterService","commonModalWindowFactory","modalWindowType"];return SimpleRefinanceController;})();angular.module("fhaCenter").controller("simpleRefinanceController",SimpleRefinanceController);})(controller=fha.controller||(fha.controller={}));})(fha||(fha={}));var fha;(function(fha){var controller;(function(controller){var StreamlineRefinanceController=(function(){function StreamlineRefinanceController(wrappedLoan,fhaCenterService,commonModalWindowFactory,modalWindowType){var _this=this;this.wrappedLoan=wrappedLoan;this.fhaCenterService=fhaCenterService;this.commonModalWindowFactory=commonModalWindowFactory;this.modalWindowType=modalWindowType;this.calculateFHAFields=function(){var self=_this;_this.fhaCenterService.calculateFHA(_this.wrappedLoan.ref.fhaScenarioViewModel,_this.wrappedLoan.ref.fhaCountyLoanLimit,_this.wrappedLoan.ref.loanAmount).$promise.then(function(data){self.wrappedLoan.ref.fhaScenarioViewModel.fhaCalculatorResults=data.response;self.wrappedLoan.ref.updateGovermentEligibility(1,data.response.isEligible);},function(error){self.commonModalWindowFactory.open({type:self.modalWindowType.error,message:"We couldn't calculate FHA fields at the moment. Please try again"});});};this.ruleFunctionEndorsementDate=function(input){return false;};this.isPrimaryResidence=function(){return _this.wrappedLoan.ref.primary.occupancyType==1;};this.calculateFHAFields();}StreamlineRefinanceController.$inject=["wrappedLoan","fhaCenterService","commonModalWindowFactory","modalWindowType"];return StreamlineRefinanceController;})();angular.module("fhaCenter").controller("streamlineRefinanceController",StreamlineRefinanceController);})(controller=fha.controller||(fha.controller={}));})(fha||(fha={}));var fha;(function(fha){var controller;(function(controller){var CashOutController=(function(){function CashOutController(wrappedLoan,fhaCenterService,commonModalWindowFactory,modalWindowType){var _this=this;this.wrappedLoan=wrappedLoan;this.fhaCenterService=fhaCenterService;this.commonModalWindowFactory=commonModalWindowFactory;this.modalWindowType=modalWindowType;this.calculateFHAFields=function(){var self=_this;_this.fhaCenterService.calculateFHA(_this.wrappedLoan.ref.fhaScenarioViewModel,_this.wrappedLoan.ref.fhaCountyLoanLimit,_this.wrappedLoan.ref.loanAmount).$promise.then(function(data){self.wrappedLoan.ref.fhaScenarioViewModel.fhaCalculatorResults=data.response;self.wrappedLoan.ref.updateGovermentEligibility(1,data.response.isEligible);},function(error){self.commonModalWindowFactory.open({type:self.modalWindowType.error,message:"We couldn't calculate FHA fields at the moment. Please try again"});});};this.isAppraisedValueDisabled=function(){return _this.fhaCenterService.isAppraisedValueValid(_this.wrappedLoan.ref.getSubjectProperty().appraisedValue);};this.calculateFHAFields();}CashOutController.$inject=["wrappedLoan","fhaCenterService","commonModalWindowFactory","modalWindowType"];return CashOutController;})();angular.module("fhaCenter").controller("cashOutController",CashOutController);})(controller=fha.controller||(fha.controller={}));})(fha||(fha={}));var fha;(function(fha){var controller;(function(controller){var PurchaseController=(function(){function PurchaseController(wrappedLoan,fhaCenterService,commonModalWindowFactory,modalWindowType){var _this=this;this.wrappedLoan=wrappedLoan;this.fhaCenterService=fhaCenterService;this.commonModalWindowFactory=commonModalWindowFactory;this.modalWindowType=modalWindowType;this.calculateFHAFields=function(){var self=_this;_this.fhaCenterService.calculateFHA(_this.wrappedLoan.ref.fhaScenarioViewModel,_this.wrappedLoan.ref.fhaCountyLoanLimit,_this.wrappedLoan.ref.loanAmount).$promise.then(function(data){self.wrappedLoan.ref.fhaScenarioViewModel.fhaCalculatorResults=data.response;self.wrappedLoan.ref.updateGovermentEligibility(1,data.response.isEligible);},function(error){self.commonModalWindowFactory.open({type:self.modalWindowType.error,message:"We couldn't calculate FHA fields at the moment. Please try again"});});};this.isAppraisedValueDisabled=function(){return _this.fhaCenterService.isAppraisedValueValid(_this.wrappedLoan.ref.getSubjectProperty().appraisedValue);};this.calculateFHAFields();}PurchaseController.$inject=["wrappedLoan","fhaCenterService","commonModalWindowFactory","modalWindowType"];return PurchaseController;})();angular.module("fhaCenter").controller("purchaseController",PurchaseController);})(controller=fha.controller||(fha.controller={}));})(fha||(fha={}));var fha;(function(fha){var controller;(function(controller){var PurchaseDownController=(function(){function PurchaseDownController(wrappedLoan,fhaCenterService,commonModalWindowFactory,modalWindowType){var _this=this;this.wrappedLoan=wrappedLoan;this.fhaCenterService=fhaCenterService;this.commonModalWindowFactory=commonModalWindowFactory;this.modalWindowType=modalWindowType;this.calculateFHAFields=function(){var self=_this;_this.fhaCenterService.calculateFHA(_this.wrappedLoan.ref.fhaScenarioViewModel,_this.wrappedLoan.ref.fhaCountyLoanLimit,_this.wrappedLoan.ref.loanAmount).$promise.then(function(data){self.wrappedLoan.ref.fhaScenarioViewModel.fhaCalculatorResults=data.response;self.wrappedLoan.ref.updateGovermentEligibility(1,data.response.isEligible);},function(error){self.commonModalWindowFactory.open({type:self.modalWindowType.error,message:"We couldn't calculate FHA fields at the moment. Please try again"});});};this.isAppraisedValueDisabled=function(){return _this.fhaCenterService.isAppraisedValueValid(_this.wrappedLoan.ref.getSubjectProperty().appraisedValue);};this.wrappedLoan.ref.fhaScenarioViewModel.minDownPaymentApprovedByHud=100;this.calculateFHAFields();}PurchaseDownController.$inject=["wrappedLoan","fhaCenterService","commonModalWindowFactory","modalWindowType"];return PurchaseDownController;})();angular.module("fhaCenter").controller("purchaseDownController",PurchaseDownController);})(controller=fha.controller||(fha.controller={}));})(fha||(fha={}));var va;(function(va){angular.module("vaCenter",[]);})(va||(va={}));(function(){angular.module("vaCenter").config(config);config.$inject=["$stateProvider"];function config($stateProvider){$stateProvider.state("loanCenter.loan.vacenter",{url:"/vacenter",views:{"vaCenter":{templateUrl:"/angular/vacenter/vacenter.html",controller:"vaCenterController as vaCenter"},"contextualBar@":{templateUrl:"/angular/contextualbar/contextualbar.html",controller:"ContextualBarCtrl as contextualBarCtrl"}}}).state("loanCenter.loan.vacenter.generalinformation",{views:{"mainContainer":{templateUrl:"/angular/vacenter/generalinformation/generalinformation.html",controller:"generalInformationController as generalInformation"}}}).state("loanCenter.loan.vacenter.irrlmax",{views:{"mainContainer":{templateUrl:"/angular/vacenter/irrlmax/irrlmax.html",controller:"irrlMaxController as irrlMax"}}}).state("loanCenter.loan.vacenter.irrlqmcertification",{views:{"mainContainer":{templateUrl:"/angular/vacenter/irrlqmcertification/irrlqmcertification.html",controller:"irrlQMCertificationController as irrlQMCertification"}}});}})();var va;(function(va){var service;(function(service){var VACenterService=(function(){function VACenterService($resource,apiRoot,$state,costDetailsSvc,costDetailsHelpers,commonModalWindowFactory,modalWindowType,$modalStack){var _this=this;this.$resource=$resource;this.apiRoot=apiRoot;this.$state=$state;this.costDetailsSvc=costDetailsSvc;this.costDetailsHelpers=costDetailsHelpers;this.commonModalWindowFactory=commonModalWindowFactory;this.modalWindowType=modalWindowType;this.$modalStack=$modalStack;this.calculateVA=function(existingVABalance,eehi,veteranCashPayment,discountPoints,vaFundingFee){var VACalculatorRequestViewModel=new cls.VACalculatorRequestViewModel(existingVABalance,eehi,veteranCashPayment,discountPoints,0,_this.getVAFundingFee(),_this.getTotalClosingCosts());return _this.$resource(_this.apiRoot+"/CalculateVAFields").save(VACalculatorRequestViewModel);};this.getVAFundingFee=function(){var costs=_this.costDetailsSvc.wrappedLoan.ref.closingCost.costs;var vaFundingFeeCost=_.find(costs,function(cost){return cost.name=="VA Funding Fee";});if(!vaFundingFeeCost){return 0;}return vaFundingFeeCost.amount;};this.getTotalClosingCosts=function(){return _this.costDetailsSvc.wrappedLoan.ref.closingCost.totals.closingCosts.borrowerTotal-_this.costDetailsHelpers.calculateSectionTotal(5)-_this.costDetailsHelpers.calculateSectionTotal(6)+_this.costDetailsHelpers.getCostsTotalByHUDLineNumber(901);};this.isVAFeeLimitExceeded=function(closingCostViewModel,totalLoanAmount){return _this.$resource(_this.apiRoot+"/IsVAFeeLimitExceeded",{totalLoanAmount:totalLoanAmount}).save(closingCostViewModel);};this.openVaFeeExceededAlertModal=function(vaFeeLimitExceededResults){if(vaFeeLimitExceededResults.length){var buttonTitle=_this.$state.is("loanCenter.loan.cost.details")?"OK":"Cost Details";var buttonCallBack=_this.$state.is("loanCenter.loan.cost.details")?"VAAlertOKButton":"redirectToCostDetails";var message="Fees paid by the veteran exceeds the 1% limit or <br/>unallowable fees are charged to the Veteran. <br/>Please adjust the fees as Lender/Seller paid.<br/><br/>";lib.forEach(vaFeeLimitExceededResults,function(result){if(result.reason==1){message+="<b>Unallowable Fees:</b>";}else{if(result.reason==2){message+="<b>Fees that exceed 1% Limit:</b>";}}message+="<ul>";lib.forEach(result.fees,function(fee){message+="<li>"+fee.name+"</li>";});message+="</ul><br/>";});_this.commonModalWindowFactory.open({type:_this.modalWindowType.confirmation,ctrl:_this,header:"VA Fee Limits Exceeded",headerClass:"confirmation-modal-header",message:message,messageClass:"confirmation-modal-message",btnCloseText:"Cancel",ctrlButtons:[{title:buttonTitle,styleClass:"imp-button-div-hs-ws-prim",width:"140px",height:"30px",callback:buttonCallBack}]});}};this.VAAlertOKButton=function(){_this.$modalStack.dismissAll("OK");};this.redirectToCostDetails=function(){_this.$state.go("loanCenter.loan.cost.details",{redirectedFromLoanDetailsVaAlertModal:true});_this.$modalStack.dismissAll("Close");};this.colorTheText=function(value){if(value){return"#1fb25a";}else{return"#ef1126";}};this.getText=function(value){if(value){return"This Loan Meets the Safe Harbor Requirements";}return"This Loan Does Not Meet the Safe Harbor Requirements";};this.apiRoot=apiRoot+"VaCalculator";}VACenterService.$inject=["$resource","apiRoot","$state","costDetailsSvc","costDetailsHelpers","commonModalWindowFactory","modalWindowType","$modalStack"];VACenterService.className="vaCenterService";return VACenterService;})();service.VACenterService=VACenterService;angular.module("vaCenter").service("vaCenterService",VACenterService);})(service=va.service||(va.service={}));})(va||(va={}));var va;(function(va){var controller;(function(controller){var VACenterController=(function(){function VACenterController(vaCenterService,wrappedLoan,$state,navigationService,applicationData,enums,fhaCenterService){var _this=this;this.vaCenterService=vaCenterService;this.wrappedLoan=wrappedLoan;this.$state=$state;this.navigationService=navigationService;this.applicationData=applicationData;this.enums=enums;this.fhaCenterService=fhaCenterService;this.saveChanges=function(){_this.navigationService.SaveAndUpdateWrappedLoan(_this.applicationData.currentUserId,_this.wrappedLoan);};this.cancelChanges=function(){_this.navigationService.cancelChanges(_this.wrappedLoan.ref.loanId);};this.selectVACalculator=function(value){_this.fhaCenterService.selectProduct(_this.applicationData.lookup.vaCalculators,value);_this.navigationService.navigateToVACalculator(value);};this.getSelectedVACalculatorName=function(){return lib.filter(_this.applicationData.lookup.vaCalculators,function(item){return item.selected;})[0].text;};navigationService.contextualType=enums.ContextualTypes.VaCenter;lib.forEach(this.applicationData.lookup.vaCalculators,function(item){item.selected=item.value==String(1)?true:false;});}VACenterController.$inject=["vaCenterService","wrappedLoan","$state","NavigationSvc","applicationData","enums","fhaCenterService"];return VACenterController;})();angular.module("vaCenter").controller("vaCenterController",VACenterController);})(controller=va.controller||(va.controller={}));})(va||(va={}));var va;(function(va){var controller;(function(controller){var GeneralInformationController=(function(){function GeneralInformationController(wrappedLoan,loanScenarioService,applicationData){var _this=this;this.wrappedLoan=wrappedLoan;this.loanScenarioService=loanScenarioService;this.applicationData=applicationData;this.onCurrentLoanOnSubjectPropertyChange=function(){_this.loanScenarioService.currentLoanOnSubjectPropertyChange(_this.wrappedLoan.ref.vaInformation);};this.onIsVaUsedInPastChange=function(){_this.loanScenarioService.isVaUsedInPastChange(_this.wrappedLoan.ref.vaInformation);};this.getListOfBorrowers=function(){_this.listOfBorrowers=[];lib.forEach(_this.wrappedLoan.ref.getLoanApplications(),function(item){_this.listOfBorrowers.push(item.getBorrower());if(item.isSpouseOnTheLoan){_this.listOfBorrowers.push(item.getCoBorrower());}});};this.getListOfBorrowers();if(!this.wrappedLoan.ref.vaInformation.veteranInformationForId){this.wrappedLoan.ref.vaInformation.veteranInformationForId=wrappedLoan.ref.primary.getBorrower().borrowerId;}}Object.defineProperty(GeneralInformationController.prototype,"isPurchase",{get:function(){return this.wrappedLoan.ref.loanPurposeType==1;},enumerable:true,configurable:true});GeneralInformationController.$inject=["wrappedLoan","loanScenarioSvc","applicationData"];return GeneralInformationController;})();angular.module("vaCenter").controller("generalInformationController",GeneralInformationController);})(controller=va.controller||(va.controller={}));})(va||(va={}));var va;(function(va){var controller;(function(controller){var IRRLMaxController=(function(){function IRRLMaxController(wrappedLoan,vaCenterService,commonModalWindowFactory,modalWindowType){var _this=this;this.wrappedLoan=wrappedLoan;this.vaCenterService=vaCenterService;this.commonModalWindowFactory=commonModalWindowFactory;this.modalWindowType=modalWindowType;this.calculateVAFields=function(){var self=_this;_this.vaCenterService.calculateVA(_this.wrappedLoan.ref.getSubjectProperty().firstMortgageAmount,_this.wrappedLoan.ref.vaInformation.costOfImprovements,_this.wrappedLoan.ref.vaInformation.cashPaymentFromVeteran,_this.wrappedLoan.ref.financialInfo.discountPoints,_this.vaCenterService.getVAFundingFee()).$promise.then(function(data){self.vaCenterService.calculatorResponse=data.response;},function(error){self.commonModalWindowFactory.open({type:self.modalWindowType.error,message:"We couldn't calculate IRRL VA fields at the moment. Please try again"});});};this.showDicountPoints=function(){return _this.wrappedLoan.ref.financialInfo.discountPoints<=0?0:_this.wrappedLoan.ref.financialInfo.discountPoints;};this.calculateVAFields();}IRRLMaxController.$inject=["wrappedLoan","vaCenterService","commonModalWindowFactory","modalWindowType"];return IRRLMaxController;})();angular.module("vaCenter").controller("irrlMaxController",IRRLMaxController);})(controller=va.controller||(va.controller={}));})(va||(va={}));var va;(function(va){var controller;(function(controller){var IRRLQMCertificationController=(function(){function IRRLQMCertificationController(wrappedLoan,vaCenterService,fhaCenterService,modalPopoverFactory,loanEvent){var _this=this;this.wrappedLoan=wrappedLoan;this.vaCenterService=vaCenterService;this.fhaCenterService=fhaCenterService;this.modalPopoverFactory=modalPopoverFactory;this.loanEvent=loanEvent;this.colorTheText=function(value){return _this.vaCenterService.colorTheText(value);};this.getText=function(value,isResult){if(isResult){return _this.vaCenterService.getText(value);}else{return _this.fhaCenterService.getText(null,value);}};this.showCurrentLoanOriginationDate=function(event){var originationDatePopup=_this.modalPopoverFactory.openModalPopover("angular/vacenter/irrlqmcertification/originationdate.html",{},moment(_this.wrappedLoan.ref.CurrentLoanOriginationDate).format("MM/DD/YYYY"),event);originationDatePopup.result.then(function(data){_this.wrappedLoan.ref.CurrentLoanOriginationDate=data;_this.loanEvent.broadcastPropertyChangedEvent(30);});};loanEvent.broadcastPropertyChangedEvent(30);}IRRLQMCertificationController.$inject=["wrappedLoan","vaCenterService","fhaCenterService","modalPopoverFactory","loanEvent"];return IRRLQMCertificationController;})();angular.module("vaCenter").controller("irrlQMCertificationController",IRRLQMCertificationController);})(controller=va.controller||(va.controller={}));})(va||(va={}));var usda;(function(usda){angular.module("usdaCenter",[]);})(usda||(usda={}));(function(){angular.module("usdaCenter").config(config);config.$inject=["$stateProvider"];function config($stateProvider){$stateProvider.state("loanCenter.loan.usdacenter",{url:"/usdacenter",views:{"usdacenter":{templateUrl:"/angular/usdacenter/usdacenter.html",controller:"usdaCenterController as usdaCenter"},"contextualBar@":{templateUrl:"/angular/contextualbar/contextualbar.html",controller:"ContextualBarCtrl as contextualBarCtrl"}}});}})();var usda;(function(usda){var service;(function(service){var USDACenterService=(function(){function USDACenterService(){}USDACenterService.$inject=[];return USDACenterService;})();service.USDACenterService=USDACenterService;angular.module("usdaCenter").service("usdaCenterService",USDACenterService);})(service=usda.service||(usda.service={}));})(usda||(usda={}));var usda;(function(usda){var controller;(function(controller){var USDACenterController=(function(){function USDACenterController(navigationService,enums,$window,$state,applicationData,wrappedLoan,commonService){var _this=this;this.navigationService=navigationService;this.enums=enums;this.$window=$window;this.$state=$state;this.applicationData=applicationData;this.wrappedLoan=wrappedLoan;this.commonService=commonService;this.addNewHouseholdMember=function(){};this.runPropertyEligibility=function(){};this.openThirtPartyWebSite=function(){_this.$window.open("http://eligibility.sc.egov.usda.gov/eligibility/incomeEligibilityAction.do","_blank");};this.saveChanges=function(){_this.navigationService.SaveAndUpdateWrappedLoan(_this.applicationData.currentUserId,_this.wrappedLoan);};this.cancelChanges=function(){_this.$state.reload();};this.getAgeOutOfDoB=function(dateOfBirth){return _this.commonService.getYearsOutOfDate(dateOfBirth);};navigationService.contextualType=enums.ContextualTypes.USDACenter;}USDACenterController.$inject=["NavigationSvc","enums","$window","$state","applicationData","wrappedLoan","commonService"];return USDACenterController;})();angular.module("usdaCenter").controller("usdaCenterController",USDACenterController);})(controller=usda.controller||(usda.controller={}));})(usda||(usda={}));var copyLoan;(function(copyLoan){angular.module("copyLoan",[]);})(copyLoan||(copyLoan={}));var copyLoan;(function(copyLoan){var service;(function(service){var CopyLoanService=(function(){function CopyLoanService($resource,apiRoot){var _this=this;this.$resource=$resource;this.apiRoot=apiRoot;this.duplicateLoan=function(request){return _this.$resource(_this.apiPath).save(request);};this.apiPath=apiRoot+"CopyLoanService/";}CopyLoanService.$inject=["$resource","apiRoot"];CopyLoanService.className="copyLoanService";return CopyLoanService;})();service.CopyLoanService=CopyLoanService;angular.module("copyLoan").service("copyLoanService",CopyLoanService);})(service=copyLoan.service||(copyLoan.service={}));})(copyLoan||(copyLoan={}));var copyLoan;(function(copyLoan){var controller;(function(controller){var CopyLoanController=(function(){function CopyLoanController(copyLoanService,wrappedLoan,applicationData,$modalStack,enums,loanEvent,blockUI,$log,$state){var _this=this;this.copyLoanService=copyLoanService;this.wrappedLoan=wrappedLoan;this.applicationData=applicationData;this.$modalStack=$modalStack;this.enums=enums;this.loanEvent=loanEvent;this.blockUI=blockUI;this.$log=$log;this.$state=$state;this.label="";this.enableCreditReport=function(){lib.forEach(_this.loanApplications,function(item){if(item.isSpouseOnTheLoan){if(!_this.includeBorrower[item.loanApplicationId]||!_this.includeCoBorrower[item.loanApplicationId]){_this.toggleCreditCheckbox(item.loanApplicationId);}else{_this.enableCreditCheckbox[item.loanApplicationId]=true;}}else{if(!_this.includeBorrower[item.loanApplicationId]){_this.toggleCreditCheckbox(item.loanApplicationId);}else{_this.enableCreditCheckbox[item.loanApplicationId]=true;}}});_this.getCheckboxes();};this.toggleCreditCheckbox=function(loanApplicationId){_this.includeCreditReport[loanApplicationId]=false;_this.enableCreditCheckbox[loanApplicationId]=false;};this.getCheckboxes=function(){for(var i=0;i<_this.loanApplications.length;i++){if(_this.includeBorrower[_this.loanApplications[i].loanApplicationId]||_this.includeCoBorrower[_this.loanApplications[i].loanApplicationId]||_this.includeCreditReport[_this.loanApplications[i].loanApplicationId]){_this.enableDuplicateLoan=true;break;}else{_this.enableDuplicateLoan=false;}}};this.setClosingDate=function(){var dateNow=new Date();var currentClosingDate=new Date(moment(_this.wrappedLoan.ref.closingDate.dateValue).format("MM/DD/YYYY"));if(currentClosingDate>dateNow){_this.closingDate=moment(_this.wrappedLoan.ref.closingDate.dateValue).format("MM/DD/YYYY");}else{_this.closingDate=moment(dateNow.setDate(dateNow.getDate()+30)).format("MM/DD/YYYY");}};this.hasBorrowerValidName=function(borrower){return borrower.hasValidName();};this.getLienPositions=function(){if(angular.isDefined(_this.applicationData.lookup.lienPositions)){return _this.applicationData.lookup.lienPositions;}else{return _this.lienPosition;}};this.getLoanPurposeTypes=function(){if(angular.isDefined(_this.applicationData.lookup.loanTransactionTypes)){return _this.applicationData.lookup.loanTransactionTypes;}else{return _this.loanPurpose;}};this.close=function(){_this.$modalStack.dismissAll("close");};this.hasBorrower=function(name){return name!="New Application";};this.duplicateLoan=function(){var self=_this;self.blockUI.start("Duplicating loan...");var loanApplicationIds=[];var borrowerIds=[];var creditReportIds=[];var creditReportIncluded=[];var loanApplications=_this.wrappedLoan.ref.getLoanApplications();var addLoanApplication;for(var i=0;i<loanApplications.length;i++){addLoanApplication=false;if(self.includeBorrower[loanApplications[i].loanApplicationId]){borrowerIds.push(loanApplications[i].getBorrower().borrowerId);addLoanApplication=true;}if(self.includeCoBorrower[loanApplications[i].loanApplicationId]){borrowerIds.push(loanApplications[i].getCoBorrower().borrowerId);addLoanApplication=true;}if(self.includeCreditReport[loanApplications[i].loanApplicationId]){creditReportIds.push(loanApplications[i].credit.creditReportId);creditReportIncluded.push(loanApplications[i].loanApplicationId);addLoanApplication=true;}if(addLoanApplication){loanApplicationIds.push(loanApplications[i].loanApplicationId);addLoanApplication=false;}}var newMainApplicationId=loanApplicationIds.filter(function(id){return id==self.wrappedLoan.ref.primary.loanApplicationId;}).length==0?loanApplicationIds[0]:null;var copyLoanVM=new cls.CopyLoanViewModel(borrowerIds,self.copySubjectPropertyFlag,creditReportIds,creditReportIncluded,loanApplicationIds,self.wrappedLoan.ref.loanId,self.wrappedLoan.ref.loanNumber,self.closingDate,self.lienPosition,self.loanPurpose,newMainApplicationId,_this.subjectPropertyId,_this.userAccountId);self.copyLoanService.duplicateLoan(copyLoanVM).$promise.then(function(result){self.blockUI.stop();self.$state.go("loanCenter.loan.loanDetails.sections",{"loanId":result.Response},{reload:true});},function(error){self.blockUI.stop();self.$log.error("Duplicating loan failed",error);});};this.getLabel=function(borrower,isPrimary){if(isPrimary&&!borrower.isCoBorrower){_this.label="PB";}else{if(!borrower.isCoBorrower){_this.label="B";}else{_this.label="C";}}return _this.label;};this.formatAddress=function(property){return property.formatAddress();};this.onLoanPurposeChange=function(){_this.loanEvent.broadcastPropertyChangedEvent(30);};this.lienPosition=1;this.loanPurpose=wrappedLoan.ref.loanPurposeType;this.userAccountId=applicationData.currentUser.userAccountId;this.setClosingDate();this.loanApplications=wrappedLoan.ref.getLoanApplications();this.subjectPropertyId=wrappedLoan.ref.getSubjectProperty().propertyId;this.copySubjectPropertyFlag=true;this.includeBorrower=new Array();this.includeCoBorrower=new Array();this.includeCreditReport=new Array();this.enableCreditCheckbox=new Array();lib.forEach(this.loanApplications,function(item){_this.includeBorrower[item.loanApplicationId]=true;_this.includeCreditReport[item.loanApplicationId]=true;if(item.isSpouseOnTheLoan){_this.includeCoBorrower[item.loanApplicationId]=true;}_this.enableCreditCheckbox[item.loanApplicationId]=true;});this.enableDuplicateLoan=true;}CopyLoanController.$inject=["copyLoanService","wrappedLoan","applicationData","$modalStack","enums","loanEvent","blockUI","$log","$state"];return CopyLoanController;})();angular.module("copyLoan").controller("copyLoanController",CopyLoanController);})(controller=copyLoan.controller||(copyLoan.controller={}));})(copyLoan||(copyLoan={}));var secureLinkEmail;(function(secureLinkEmail){angular.module("secureLinkEmail",[]);})(secureLinkEmail||(secureLinkEmail={}));var secureLinkEmail;(function(secureLinkEmail){var service;(function(service){var SecureLinkEmailService=(function(){function SecureLinkEmailService($resource,apiRoot){this.$resource=$resource;this.apiRoot=apiRoot;var apiPath=this.apiRoot+"secureLink/";this.secureLinkEmailTemplates=this.$resource(apiPath+"GetSecureLinkEmailTemplates",{},{getTemplates:{method:"GET",url:apiPath+"GetSecureLinkEmailTemplates",params:{LoanId:"@LoanId",LoanApplicationId:"@LoanApplicationId"},isArray:true}});this.secureLinkEmailSend=this.$resource(apiPath+"SendSecureLinkEmail",{},{sendEmail:{method:"POST",url:apiPath+"SendSecureLinkEmail",params:{}}});this.secureLinkUrl=this.$resource(apiPath+"GetSecureLinkUrlToken",{},{getSecureLinkUrl:{method:"GET",url:apiPath+"GetSecureLinkUrlToken",params:{}}});}SecureLinkEmailService.$inject=["$resource","apiRoot"];SecureLinkEmailService.className="secureLinkEmailService";return SecureLinkEmailService;})();service.SecureLinkEmailService=SecureLinkEmailService;angular.module("loanCenter").service("secureLinkEmailService",SecureLinkEmailService);})(service=secureLinkEmail.service||(secureLinkEmail.service={}));})(secureLinkEmail||(secureLinkEmail={}));var secureLinkEmail;(function(secureLinkEmail){var controller;(function(controller){var SecureLinkEmailController=(function(){function SecureLinkEmailController(wrappedLoan,$modalStack,loanEvent,blockUI,$log,$state,$sce,SecureLinkEmailService,applicationData){var _this=this;this.wrappedLoan=wrappedLoan;this.$modalStack=$modalStack;this.loanEvent=loanEvent;this.blockUI=blockUI;this.$log=$log;this.$state=$state;this.$sce=$sce;this.SecureLinkEmailService=SecureLinkEmailService;this.applicationData=applicationData;this.secureLinkEmailTemplateArray=[];this.setActiveTemplate=function(){var i=0;while(i<_this.secureLinkEmailTemplateArray.length){if(_this.secureLinkEmail.activeTemplate.title===_this.secureLinkEmailTemplateArray[i].title){_this.secureLinkEmail.activeTemplate.emailBody=_this.secureLinkEmailTemplateArray[i].emailBody;_this.secureLinkEmail.activeTemplate.emailSubject=_this.secureLinkEmailTemplateArray[i].emailSubject;break;}i++;}};this.close=function(){_this.$modalStack.dismissAll("close");};this.sendEmail=function(){_this.SecureLinkEmailService.SendSecureLinkEmail(_this.tempLoanId,_this.tempLoanId).then(function(result){_this.isEmailSent=result;},function(error){_this.$log.error("Error occurred while getting SecureLink Email Templates Data!",error);_this.isEmailSent=false;});return _this.isEmailSent;};this.getSecureLinkURL=function(){_this.SecureLinkEmailService.GetSecureLinkUrlToken(_this.tempLoanId,_this.tempLoanId).then(function(result){_this.secureLinkURL=result;},function(error){_this.$log.error("Error occurred while getting SecureLink Email Templates Data!",error);_this.secureLinkURL=null;});return _this.secureLinkURL;};var user=applicationData.currentUser;this.secureLinkEmail=new srv.cls.SecureLinkEmailViewModel();this.secureLinkEmail.toEmail=wrappedLoan.ref.active.getBorrower().userAccount.username;this.secureLinkEmail.fromEmail=user.username;var sleml=new srv.cls.SecureLinkEmailViewModel();sleml.loanId=wrappedLoan.ref.loanId;sleml.loanApplicationId=wrappedLoan.ref.active.loanApplicationId;SecureLinkEmailService.GetSecureLinkEmailTemplates(sleml).then(function(result){_this.secureLinkEmailTemplateArray=result;},function(error){_this.$log.error("Error occurred while getting SecureLink Email Templates Data!",error);});}Object.defineProperty(SecureLinkEmailController.prototype,"toEmail",{get:function(){return this.secureLinkEmail.toEmail;},set:function(toEmail){this.secureLinkEmail.toEmail=toEmail;},enumerable:true,configurable:true});Object.defineProperty(SecureLinkEmailController.prototype,"ccEmail",{get:function(){return this.secureLinkEmail.ccEmail;},set:function(ccEmail){this.secureLinkEmail.ccEmail=ccEmail;},enumerable:true,configurable:true});Object.defineProperty(SecureLinkEmailController.prototype,"fromEmail",{get:function(){return this.secureLinkEmail.fromEmail;},set:function(fromEmail){this.secureLinkEmail.fromEmail=fromEmail;},enumerable:true,configurable:true});SecureLinkEmailController.className="secureLinkEmailController";SecureLinkEmailController.$inject=["wrappedLoan","$modalStack","loanEvent","blockUI","$log","$state","$sce","SecureLinkEmailAlternativeService","applicationData"];return SecureLinkEmailController;})();angular.module("secureLinkEmail").controller("secureLinkEmailController",SecureLinkEmailController);})(controller=secureLinkEmail.controller||(secureLinkEmail.controller={}));})(secureLinkEmail||(secureLinkEmail={}));var ntb;(function(ntb){angular.module("ntbCenter",[]);})(ntb||(ntb={}));(function(){angular.module("ntbCenter").config(config);config.$inject=["$stateProvider"];function config($stateProvider){$stateProvider.state("loanCenter.loan.nettangible",{url:"/nettangible",views:{"nettangible":{templateUrl:"/angular/ntbcenter/ntbcenter.html",controller:"ntbCenterController as ntbCenter"},"contextualBar@":{templateUrl:"/angular/contextualbar/contextualbar.html",controller:"ContextualBarCtrl as contextualBarCtrl"}}}).state("loanCenter.loan.nettangible.details",{views:{"resultsSection":{templateUrl:"/angular/ntbcenter/sections/results.html",}}});}})();var ntb;(function(ntb){var service;(function(service){var NTBCenterService=(function(){function NTBCenterService($resource,apiRoot,costDetailsSvc,costDetailsHelpers,loanDetailsSvc){var _this=this;this.$resource=$resource;this.apiRoot=apiRoot;this.costDetailsSvc=costDetailsSvc;this.costDetailsHelpers=costDetailsHelpers;this.loanDetailsSvc=loanDetailsSvc;this.calculateCurrentMonthlyObligations=function(wrappedLoan){return _this.loanDetailsSvc.totalCurrentExpenses(wrappedLoan.ref.housingExpenses.rent,wrappedLoan.ref.housingExpenses.firstMtgPi,wrappedLoan.ref.housingExpenses.secondMtgPi,wrappedLoan.ref.loanPurposeType,wrappedLoan.ref.getSubjectProperty().occupancyType,wrappedLoan.ref.getSubjectProperty,wrappedLoan.ref.primary.getBorrower().getCurrentAddress)+_this.loanDetailsSvc.getAdditionalMortgages(wrappedLoan.ref.getLoanApplications(),wrappedLoan.ref.loanPurposeType,wrappedLoan.ref.getSubjectProperty().occupancyType,wrappedLoan.ref.getSubjectProperty,wrappedLoan.ref.primary.getBorrower().getCurrentAddress,function(){return wrappedLoan.ref.primary;});};this.calculateNTB=function(wrappedLoan){return _this.$resource(_this.apiRoot+"/NtbBenefitActivations").save(_this.getNtbBenefitActivationRequest(wrappedLoan));};this.getNtbBenefitActivationRequest=function(wrappedLoan){var ntbBenefitActivationRequest=new srv.cls.NtbBenefitActivationRequest();ntbBenefitActivationRequest.geoStateUS=wrappedLoan.ref.getSubjectProperty().stateId;ntbBenefitActivationRequest.existingLoans=[];var loan=_this.fillNtbLoan(wrappedLoan.ref.FirstLienReoItem,wrappedLoan);if(loan!=null){ntbBenefitActivationRequest.existingLoans.push(loan);var secondLoan=_this.fillNtbLoan(wrappedLoan.ref.JuniorLienReoItem,wrappedLoan);if(secondLoan!=null){ntbBenefitActivationRequest.existingLoans.push(secondLoan);}}ntbBenefitActivationRequest.proposedLoan=new srv.cls.Loan();ntbBenefitActivationRequest.proposedLoan.loanAmount=wrappedLoan.ref.loanAmount;ntbBenefitActivationRequest.proposedLoan.dti=wrappedLoan.ref.financialInfo.dti;ntbBenefitActivationRequest.proposedLoan.isBalloon=wrappedLoan.ref.financialInfo.isBaloonPayment;ntbBenefitActivationRequest.proposedLoan.monthlyMortgageInsurance=wrappedLoan.ref.loanLock.newMonthlyPayment;ntbBenefitActivationRequest.proposedLoan.mortgageType=wrappedLoan.ref.financialInfo.mortgageType;ntbBenefitActivationRequest.proposedLoan.interestRate=wrappedLoan.ref.financialInfo.baseInterestRate;ntbBenefitActivationRequest.proposedLoan.totalCashout=wrappedLoan.ref.CashFromToBorrower;ntbBenefitActivationRequest.proposedLoan.totalClosingCosts=_this.costDetailsSvc.getBorrowerTotal();ntbBenefitActivationRequest.proposedLoan.amortizationType=wrappedLoan.ref.financialInfo.amortizationType;ntbBenefitActivationRequest.proposedLoan.fullyIndexedRate=wrappedLoan.ref.fullyIndexedRate;ntbBenefitActivationRequest.proposedLoan.hasPrepaymentPenalty=wrappedLoan.ref.prePaymentPenalty;ntbBenefitActivationRequest.proposedLoan.prepaymentPenaltyAmount=wrappedLoan.ref.prePaymentAmount;ntbBenefitActivationRequest.proposedLoan.term=wrappedLoan.ref.financialInfo.term;ntbBenefitActivationRequest.proposedLoan.floodInsurance=wrappedLoan.ref.housingExpenses.floodInsurance;ntbBenefitActivationRequest.proposedLoan.hazardInsurance=wrappedLoan.ref.housingExpenses.hazardInsurance;ntbBenefitActivationRequest.proposedLoan.haveNegativeAmortization=wrappedLoan.ref.negativeAmortization;ntbBenefitActivationRequest.proposedLoan.totalPaymentByLiability=lib.summate(wrappedLoan.ref.primary.getAllLiabilitiesCombined(),function(p){return p.debtCommentId==4;},function(l){return l.minPayment;});ntbBenefitActivationRequest.proposedLoan.totalClosingCostsWithoutG=_this.costDetailsSvc.totalClosingCostsWithoutG();var reos=wrappedLoan.ref.active.reos.filter(function(item){return !item.isSecondaryPartyRecord;});ntbBenefitActivationRequest.proposedLoan.totalReosPayment=lib.summateAll(reos,function(r){return r.minPayment;});return ntbBenefitActivationRequest;};this.fillNtbLoan=function(lienReoItem,wrappedLoan){if(lienReoItem==null){return null;}var loan=new srv.cls.Loan();loan.lienPosition=lienReoItem.lienPosition;loan.dti=wrappedLoan.ref.financialInfo.dti;loan.recoupmentTime=wrappedLoan.ref.recoupmentPeriodCalculated.recoupmentPeriod;loan.monthlyMortgageInsurance=_this.calculateCurrentMonthlyObligations(wrappedLoan);loan.mortgageType=wrappedLoan.ref.financialInfo.mortgageType;loan.totalClosingCosts=_this.costDetailsSvc.getBorrowerTotal();loan.loanAmount=lienReoItem.unpaidBalance;loan.lienTotalPayment=lienReoItem.getTotalPayments();if(lienReoItem.reoInfo!=null){loan.amortizationType=lienReoItem.reoInfo.amortizationType;loan.fullyIndexedRate=lienReoItem.reoInfo.fullyIndexedRate;loan.hasPrepaymentPenalty=lienReoItem.reoInfo.prePaymentPenalty;loan.prepaymentPenaltyAmount=lienReoItem.reoInfo.prePaymentAmount;loan.term=lienReoItem.reoInfo.loanTerm;loan.interestRate=lienReoItem.reoInfo.interestRate;loan.haveNegativeAmortization=lienReoItem.reoInfo.negativeAmortizationFeature;}return loan;};this.updateLoanNTB=function(wrappedLoan,ntbBenefitActivationResponse){if(wrappedLoan.ref.ntbBenefitActivations!=null&&ntbBenefitActivationResponse!=null&&ntbBenefitActivationResponse.ntbBenefitActivations!=null){if(wrappedLoan.ref.ntbBenefitActivations.length==0){for(var i=0;i<ntbBenefitActivationResponse.ntbBenefitActivations.length;i++){var activation=new srv.cls.NtbActivationViewModel();activation.active=ntbBenefitActivationResponse.ntbBenefitActivations[i].active;activation.ntbBenefitEnumId=ntbBenefitActivationResponse.ntbBenefitActivations[i].ntbBenefit;activation.loanId=wrappedLoan.ref.loanId;activation.isManual=false;wrappedLoan.ref.ntbBenefitActivations.push(activation);}}else{for(var i=0;i<ntbBenefitActivationResponse.ntbBenefitActivations.length;i++){if(wrappedLoan.ref.ntbBenefitActivations[i]!=null){if(wrappedLoan.ref.ntbBenefitActivations[i].isManual!=true){var activationResponse=lib.findFirst(ntbBenefitActivationResponse.ntbBenefitActivations,function(x){return x.ntbBenefit==wrappedLoan.ref.ntbBenefitActivations[i].ntbBenefitEnumId;});if(activationResponse!=null){wrappedLoan.ref.ntbBenefitActivations[i].active=activationResponse.active;wrappedLoan.ref.ntbBenefitActivations[i].ntbBenefitEnumId=activationResponse.ntbBenefit;}}}}}}};this.apiRoot=apiRoot+"NetTangibleBenefitService";}NTBCenterService.className="ntbCenterService";NTBCenterService.$inject=["$resource","apiRoot","costDetailsSvc","costDetailsHelpers","loanDetailsSvc"];return NTBCenterService;})();service.NTBCenterService=NTBCenterService;angular.module("ntbCenter").service("ntbCenterService",NTBCenterService);})(service=ntb.service||(ntb.service={}));})(ntb||(ntb={}));var ntb;(function(ntb){var controller;(function(controller){var NTBCenterController=(function(){function NTBCenterController(wrappedLoan,$state,navigationService,applicationData,enums,complianceEaseService,loanDetailsSvc,loanEvent,ntbCenterService,$log){var _this=this;this.wrappedLoan=wrappedLoan;this.$state=$state;this.navigationService=navigationService;this.applicationData=applicationData;this.enums=enums;this.complianceEaseService=complianceEaseService;this.loanDetailsSvc=loanDetailsSvc;this.loanEvent=loanEvent;this.ntbCenterService=ntbCenterService;this.$log=$log;this.getRecoupmentPeriod=function(){if(_this.isRecoupmentPeriodValid()){return String(_this.wrappedLoan.ref.recoupmentPeriodCalculated.recoupmentPeriod)+" months";}else{return"N/A";}};this.isRecoupmentPeriodValid=function(){return(!common.objects.isNullOrUndefined(_this.wrappedLoan.ref.recoupmentPeriodCalculated.recoupmentPeriod)&&_this.wrappedLoan.ref.recoupmentPeriodCalculated.recoupmentPeriod>0);};this.formatDate=function(value){return _this.complianceEaseService.formatDate(value,null);};this.calculatePaymentAndMI=function(payment,isNewLoan){return _this.loanDetailsSvc.calculatePaymentAndMI(payment,_this.getMIAmount(isNewLoan));};this.calculateCurrentMonthlyObligations=function(){return _this.ntbCenterService.calculateCurrentMonthlyObligations(_this.wrappedLoan);};this.saveChanges=function(){_this.navigationService.SaveAndUpdateWrappedLoan(_this.applicationData.currentUserId,_this.wrappedLoan);};this.cancelChanges=function(){_this.navigationService.cancelChanges(_this.wrappedLoan.ref.loanId);};this.getDataNtbConfiguration=function(ntbBenefitEnumId,state,itemName){var ntbBenefitConfiguration=lib.findFirst(_this.applicationData.ntbBenefitConfigurations,function(x){return x.ntbBenefitEnumId==ntbBenefitEnumId&&x.state.indexOf(state)!=-1;});if(ntbBenefitConfiguration!=null){return ntbBenefitConfiguration[itemName];}return null;};this.orderBenefit=function(benefit){var ntbBenefitConfiguration=lib.findFirst(_this.applicationData.ntbBenefitConfigurations,function(x){return x.ntbBenefitEnumId==benefit.ntbBenefitEnumId;});if(ntbBenefitConfiguration!=null){return ntbBenefitConfiguration.order;}return 0;};this.triggerLoanCalculator=function(){_this.loanEvent.broadcastPropertyChangedEvent(30);};this.getNtbActivation=function(ntbBenefitEnumId){return lib.findFirst(_this.wrappedLoan.ref.ntbBenefitActivations,function(x){return x.ntbBenefitEnumId===ntbBenefitEnumId;});};this.updateBonaFideCheckbox=function(bonaFideId){var bonaFideActivation=_this.getNtbActivation(12);if(bonaFideActivation!=null){bonaFideActivation.active=bonaFideId==null?false:true;bonaFideActivation.isManual=true;}};this.callNtbCalculator=function(){var self=_this;_this.ntbCenterService.calculateNTB(_this.wrappedLoan).$promise.then(function(result){if(result&&result.response&&result.response.ntbBenefitActivations){self.ntbCenterService.updateLoanNTB(self.wrappedLoan,result.response);}},function(error){self.$log.error(error);});};this.getMIAmount=function(isNewLoan){return _this.loanDetailsSvc.getMIAmount(isNewLoan,_this.getCostsCb,_this.wrappedLoan.ref.loanPurposeType,_this.wrappedLoan.ref.getSubjectProperty().occupancyType,_this.wrappedLoan.ref.getSubjectProperty,_this.wrappedLoan.ref.primary.getBorrower().getCurrentAddress,_this.enums.housingExpenses.mortgageInsuranceExpense);};this.getCostsCb=function(){return _this.wrappedLoan.ref.closingCost.costs;};navigationService.contextualType=enums.ContextualTypes.NetTangibleBenefit;this.callNtbCalculator();}NTBCenterController.$inject=["wrappedLoan","$state","NavigationSvc","applicationData","enums","complianceEaseService","loanDetailsSvc","loanEvent","ntbCenterService","$log"];return NTBCenterController;})();angular.module("ntbCenter").controller("ntbCenterController",NTBCenterController);})(controller=ntb.controller||(ntb.controller={}));})(ntb||(ntb={}));var inputdirectives;(function(inputdirectives){angular.module("inputDirectives",[]);})(inputdirectives||(inputdirectives={}));var impdirectives;(function(impdirectives){var settings;(function(_settings){var IMPTextareaSettings=(function(){function IMPTextareaSettings(settings){this.settings=settings;this.numberOfRows=!!this.settings&&!!this.settings.numberOfRows?this.settings.numberOfRows:6;this.numberOfCharacters=!!this.settings&&!!this.settings.numberOfCharacters?this.settings.numberOfCharacters:750;this.message=!!this.settings&&!!this.settings.message?this.settings.message:"You have reached max character length!";}return IMPTextareaSettings;})();_settings.IMPTextareaSettings=IMPTextareaSettings;var IMPTextboxSettings=(function(){function IMPTextboxSettings(settings){this.settings=settings;this.textboxDescription=!!this.settings&&!!this.settings.textboxDescription?this.settings.textboxDescription:"";}return IMPTextboxSettings;})();_settings.IMPTextboxSettings=IMPTextboxSettings;})(settings=impdirectives.settings||(impdirectives.settings={}));})(impdirectives||(impdirectives={}));var inputdirectives;(function(inputdirectives){var imptextarea;(function(imptextarea){var IMPTextAreaController=(function(){function IMPTextAreaController(numberOfRows,numberOfCharactersPerRow,element,textValue){var _this=this;this.numberOfRows=numberOfRows;this.numberOfCharactersPerRow=numberOfCharactersPerRow;this.element=element;this.textValue=textValue;this.expandOnKeyUp=function(event){_this.calculateTextAreaHeight(event.target);};this.preventTextEnter=function(event){if(_this.getNumberOfCharactersInTextarea(event.target)==_this.numberOfCharactersPerRow&&event.keyCode!=8&&event.keyCode!=46){$(event.target).parent().find("div#limitMessage").show();event.preventDefault();}else{$(event.target).parent().find("div#limitMessage").hide();}};this.bindEventsOnClick=function(event){$(event.target).bind("keyup",_this.expandOnKeyUp);if(!!_this.numberOfCharactersPerRow){$(event.target).bind("keydown",_this.preventTextEnter);}};this.getNumberOfCharactersInTextarea=function(element){return $(element).val().length;};this.getNumberOfRows=function(element){return parseInt((parseInt(element.scrollHeight)/parseInt($(element).css("lineHeight"),10)).toFixed());};this.setInitialHeight(element,textValue);}IMPTextAreaController.prototype.setInitialHeight=function(element,textValue){var textArea=element.children()[0];$(textArea).val(textValue);this.calculateTextAreaHeight(textArea);};IMPTextAreaController.prototype.calculateTextAreaHeight=function(element){if(this.getNumberOfRows(element)>this.numberOfRows){$(element).height((this.numberOfRows*20)+5);element.style.overflow="auto";}else{$(element).height(24);$(element).height(element.scrollHeight);element.style.overflow="hidden";}};IMPTextAreaController.$inject=[];return IMPTextAreaController;})();function impTextArea(){return{restrict:"E",require:"ngModel",template:'<div><textarea class="imp-textarea" ng-model="model" ng-click="onClick($event)"></textarea><div id="limitMessage" style="display: none">{{textareaSettings.message}}</div></div>',replace:true,scope:{textareaSettings:"=?",model:"=ngModel"},link:function(scope,element,attributes){scope.textareaSettings=new impdirectives.settings.IMPTextareaSettings(scope.textareaSettings);var controller=new IMPTextAreaController(scope.textareaSettings.numberOfRows,scope.textareaSettings.numberOfCharacters,element,scope.model);scope.onClick=controller.bindEventsOnClick;}};}angular.module("inputDirectives").directive("impTextarea",impTextArea);})(imptextarea=inputdirectives.imptextarea||(inputdirectives.imptextarea={}));})(inputdirectives||(inputdirectives={}));var inputdirectives;(function(inputdirectives){var imptextbox;(function(imptextbox){var IMPTextboxController=(function(){function IMPTextboxController(descriptionExists){var _this=this;this.descriptionExists=descriptionExists;this.getActiveClassName=function(){if(!_this.descriptionExists){return"no-description";}};}return IMPTextboxController;})();function impTextBox(){return{restrict:"E",template:"<div class='imp-textbox-directive'><input type='text' ng-model='model' ng-class='getActiveClassName()'/><div ng-if='textboxSettings.textboxDescription'>{{textboxSettings.textboxDescription}}</div></div>",scope:{model:"=ngModel",textboxSettings:"=?"},link:function(scope,element,attributes){scope.textboxSettings=new impdirectives.settings.IMPTextboxSettings(scope.textboxSettings);var controller=new IMPTextboxController(scope.textboxSettings.textboxDescription);scope.getActiveClassName=controller.getActiveClassName;}};}angular.module("inputDirectives").directive("impTextbox",impTextBox);})(imptextbox=inputdirectives.imptextbox||(inputdirectives.imptextbox={}));})(inputdirectives||(inputdirectives={}));var buttondirectives;(function(buttondirectives){var model;(function(model){angular.module("impButtonDirectives",[]);})(model=buttondirectives.model||(buttondirectives.model={}));})(buttondirectives||(buttondirectives={}));var buttondirectives;(function(buttondirectives){var addbutton;(function(addbutton){var AddButtonController=(function(){function AddButtonController(){}return AddButtonController;})();function impAddButton(){return{restrict:"E",replace:true,scope:{buttonText:"=buttonText",eventHandler:"="},template:'<div ng-click="eventHandler()" class="imp-add-button"><imp-circle size="xsmall" color="#208DDC" is-plus="true"></imp-circle><div class="button-text">{{buttonText}}</div></div>',link:function(scope,element,attributes){}};}angular.module("impButtonDirectives").directive("impAddButton",impAddButton);})(addbutton=buttondirectives.addbutton||(buttondirectives.addbutton={}));})(buttondirectives||(buttondirectives={}));(function(){angular.module("loanCenterOldLayout",["iMP.Directives","iMP.Filters","ui.bootstrap","stipsandconditionsOld"]);})();